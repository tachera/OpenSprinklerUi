function initApp() { updateLang(), currLocal || $.ajaxSetup({ timeout: 1e4 }), isIEMobile && insertStyle(".ui-toolbar-back-btn{display:none!important}ul{list-style:none!important;}"), isChromeApp && insertStyle("html,body{overflow-y:scroll}"), isAndroid ? (insertStyle(".ui-toolbar-back-btn{display:none!important}"), $(this).ajaxStart(function () { try { navigator.app.clearCache() } catch (a) { } })) : isFireFoxOS || isFireFox ? $.ajaxSetup({ xhr: function () { return new window.XMLHttpRequest({ mozSystem: !0 }) } }) : $.ajaxSetup({ cache: !1 }), $.mobile.defaultPageTransition = isAndroid || isIEMobile || isFireFoxOS || isBB10 ? "fade" : "slide", $.mobile.hoverDelay = 0, $.mobile.activeBtnClass = "activeButton", isOSXApp || $.mobile.document.on("click", ".iab", function () { var a = $(this), b = window.open(this.href, "_blank", "location=" + (isAndroid ? "yes" : "no") + ",enableViewportScale=" + (a.hasClass("iabNoScale") ? "no" : "yes") + ",toolbarposition=top,closebuttoncaption=" + _(a.hasClass("iabNoScale") ? "Back" : "Done")); return isIEMobile && ($.mobile.document.data("iabOpen", !0), b.addEventListener("exit", function () { $.mobile.document.removeData("iabOpen") })), setTimeout(function () { a.removeClass("ui-btn-active") }, 100), !1 }), $.mobile.document.on("click", ".ui-select .ui-btn", function () { var a = $(this), b = a.attr("id").replace("-button", "-listbox"), c = $("#" + b); return c.popup("destroy").detach().addClass("ui-page-theme-a"), $.mobile.pageContainer.append(c), c.popup({ history: !1, positionTo: a, overlayTheme: "b" }).popup("open"), a.off("click").on("click", function () { c.popup("open") }), !1 }), $.mobile.document.on("swiperight swipeleft", ".ui-page", function (a) { var b = $(".ui-page-active"); "INPUT" === a.target.tagName || "TEXTAREA" === a.target.tagName || "open" === b.jqmData("panel") || b.find(".ui-popup-active").length || ("swiperight" === a.type ? openPanel() : showNotifications()) }), $.widget("mobile.collapsible", $.mobile.collapsible, { _handleExpandCollapse: function (a) { this._trigger("before" + (a ? "collapse" : "expand")) && this._superApply(arguments) } }), $("#site-selector").on("change", function () { updateSite($(this).val()) }), $("#footer-menu").on("click", function () { showHomeMenu(this) }), $("#header,#footer").toolbar(), FastClick.attach(document.body), updateTimers(), $.mobile.document.on("keydown", function (a) { var b = $(a.target).prop("tagName"); if ("INPUT" !== b && "TEXTAREA" !== b) { var c = a.keyCode, d = a.altKey, e = $("#mainMenu-popup").hasClass("ui-popup-active"); if (77 === c) { var f = $("#mainMenu"); f.length > 0 ? $("#mainMenu").popup("close") : showHomeMenu() } else (e || d) && 80 === c ? (a.preventDefault(), changePage("#programs")) : (e || d) && 79 === c ? (a.preventDefault(), changePage("#os-options")) : (e || d) && 86 === c ? (a.preventDefault(), changePage("#preview")) : (e || d) && 76 === c ? (a.preventDefault(), changePage("#logs")) : (e || d) && 82 === c ? (a.preventDefault(), changePage("#runonce")) : (e || d) && 68 === c && (a.preventDefault(), showRainDelay()) } }), bindPanel(), currLocal || "undefined" != typeof cordova || updateDeviceIP(), cloudSync(), setTimeout(function () { checkConfigured(!0) }, 200) } function flipSwitched() { if (!switching) { var a, b = $(this), c = b.attr("id"), d = b.is(":checked"), e = "mmm" === c ? "mm" : c; a = sendToOS(d ? "/cv?pw=&" + e + "=1" : "/cv?pw=&" + e + "=0"), $.when(a).then(function () { refreshStatus(), "mmm" === c && $("#mm_list .green").removeClass("green"), checkStatus() }, function () { switching = !0, setTimeout(function () { switching = !1 }, 200), b.prop("checked", !d).flipswitch("refresh") }) } } function sendToOS(a, b) { a = a.replace("pw=", "pw=" + encodeURIComponent(currPass)), b = b || "text"; var c, d = /\/(?:cv|cs|cr|cp|uwa|dp|co|cl|cu|up|cm)/.exec(a), e = d ? "change" : "default", f = d && checkOSVersion(218), g = { url: currPrefix + currIp + (f ? a.split("?")[0] : a), type: f ? "POST" : "GET", data: f ? getUrlVars(a) : null, dataType: b, shouldRetry: function (a, b) { return !(0 === a.status && "abort" === a.statusText || retryCount < b) || ($.ajaxq.abort(e), !1) } }; return currAuth && $.extend(g, { beforeSend: function (a) { a.setRequestHeader("Authorization", "Basic " + btoa(currAuthUser + ":" + currAuthPass)) } }), curr183 && $.extend(g, { cache: "true" }), c = $.ajaxq(e, g).then(function (b) { if ("string" == typeof b) try { b = $.parseJSON(b) } catch (a) { return b } return "object" != typeof b || "number" != typeof b.result ? b : 1 === b.result ? b : 2 === b.result ? (/\/(?:cv|cs|cr|cp|uwa|dp|co|cl|cu|up|cm)/.exec(a) && showerror(_("Check device password and try again.")), $.Deferred().reject({ status: 401 })) : 32 === b.result ? $.Deferred().reject({ status: 404 }) : /\/(?:cv|cs|cr|cp|uwa|dp|co|cl|cu|up|cm)/.exec(a) ? (showerror(_(48 === b.result ? "The selected station is already running or is scheduled to run." : "Please check input and try again.")), $.Deferred().reject(b)) : void 0 }, function (b) { "timeout" !== b.statusText && 0 !== b.status || !/\/(?:cv|cs|cr|cp|uwa|dp|co|cl|cu|cm)/.exec(a) ? 401 === b.status && showerror(_("Check device password and try again.")) : showerror(_("Connection timed-out. Please try again.")) }) } function networkFail() { changeStatus(0, "red", "<p class='running-text center'>" + _("Network Error") + "</p>", function () { showLoading("#weather,#footer-running"), refreshStatus(), updateWeather() }) } function newLoad() { var a = $("#site-selector").val(), b = "<div class='logo'></div><h1 style='padding-top:5px'>" + _("Connecting to") + " " + a + "</h1><p class='cancel tight center inline-icon'><span class='btn-no-border ui-btn ui-icon-delete ui-btn-icon-notext'></span>Cancel</p>"; $.mobile.loading("show", { html: currLocal ? "<h1>" + _("Loading") + "</h1>" : b, textVisible: !0, theme: "b" }), $(".ui-loader").css({ "box-shadow": "none", "margin-top": "-4em" }).find(".cancel").one("click", function () { $.ajaxq.abort("default"), changePage("#site-control", { transition: "none" }) }), controller = {}, clearNotifications(), timers = {}, $.ajaxq.abort("default"), updateController(function () { var b = $(".weatherAdjust"), c = $(".changePassword"), d = $(".show-providers"); $.mobile.loading("hide"), updateWeather(), checkOSVersion(210) ? b.css("display", "") : b.hide(), isOSPi() || checkOSVersion(208) ? c.css("display", "") : c.hide(), currLocal ? $("#info-list").find("li[data-role='list-divider']").text(_("Information")) : ($("#info-list").find("li[data-role='list-divider']").text(a), document.title = "OpenSprinkler - " + a), checkOSVersion(210) ? d.hide() : d.css("display", ""), checkFirmwareUpdate(), checkOSVersion(213) && 255 !== controller.options.hwv && fixPasswordHash(a), currLocal || "number" != typeof controller.settings.eip || checkPublicAccess(controller.settings.eip), updateLoginButtons(), isOSPi() && showUnifiedFirmwareNotification(), controller.options.firstRun ? showGuidedSetup() : goHome(!0) }, function (b) { $.ajaxq.abort("default"), controller = {}, $.mobile.loading("hide"); var c = function () { currLocal ? storage.remove(["sites"], function () { window.location.reload() }) : "site-control" === $(".ui-page-active").attr("id") ? d() : ($.mobile.document.one("pageshow", d), changePage("#site-control", { transition: "none" })) }, d = function () { showerror(_("Unable to connect to") + " " + a, 3500) }; "object" == typeof b && 401 === b.status ? ($(".ui-popup-active").find("[data-role='popup']").popup("close"), changePassword({ fixIncorrect: !0, name: a, callback: newLoad, cancel: c })) : c() }) } function updateController(a, b) { a = a || function () { }, b = b || function () { }; var c = function () { $("html").trigger("datarefresh"), checkStatus(), a() }; isControllerConnected() && checkOSVersion(216) ? sendToOS("/ja?pw=", "json").then(function (a) { if ("undefined" == typeof a || $.isEmptyObject(a)) return void b(); var d = controller.special; controller = a, controller.special = d, controller.status = controller.status.sn, c() }, b) : $.when(updateControllerPrograms(), updateControllerStations(), updateControllerOptions(), updateControllerStatus(), updateControllerSettings()).then(c, b) } function updateControllerPrograms(a) { return a = a || function () { }, curr183 === !0 ? sendToOS("/gp?d=0").done(function (b) { for (var c, d, e = b.match(/(nprogs|nboards|mnp)=[\w|\d|.\"]+/g), f = /pd=\[\];(.*);/.exec(b), g = {}, h = 0; h < e.length; h++)"" !== e[h] && (c = e[h].split("="), g[c[0]] = parseInt(c[1])); if (g.pd = [], null !== f) for (f = f[1].split(";"), h = 0; h < f.length; h++)d = f[h].split("="), d = d[1].replace("[", ""), d = d.replace("]", ""), g.pd[h] = parseIntArray(d.split(",")); controller.programs = g, a() }) : sendToOS("/jp?pw=", "json").done(function (b) { controller.programs = b, a() }) } function updateControllerStations(a) { return a = a || function () { }, curr183 === !0 ? sendToOS("/vs").done(function (b) { var c = /snames=\[(.*?)\];/.exec(b), d = b.match(/(?:masop|mo)\s?[=|:]\s?\[(.*?)\]/); c = c[1].split(","), c.pop(); for (var e = 0; e < c.length; e++)c[e] = c[e].replace(/'/g, ""); d = parseIntArray(d[1].split(",")), controller.stations = { snames: c, masop: d, maxlen: c.length }, a() }) : sendToOS("/jn?pw=", "json").done(function (b) { controller.stations = b, a() }) } function updateControllerOptions(a) { return a = a || function () { }, curr183 === !0 ? sendToOS("/vo").done(function (b) { var c, d, e, f = b.match(/var sd\s*=/), g = {}; if (f) { for (var h, i = /(tz|htp|htp2|nbrd|seq|sdt|mas|mton|mtoff|urs|rst|wl|ipas)\s?[=|:]\s?([\w|\d|.\"]+)/gm; null !== (c = i.exec(b));)h = c[1].replace("nbrd", "ext").replace("mtoff", "mtof"), g[h] = +c[2]; g.ext-- , g.fwv = "1.8.3-ospi" } else { var j = { 1: "tz", 2: "ntp", 12: "hp0", 13: "hp1", 14: "ar", 15: "ext", 16: "seq", 17: "sdt", 18: "mas", 19: "mton", 20: "mtof", 21: "urs", 22: "rso", 23: "wl", 25: "ipas", 26: "devid" }, k = [1, 2, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 25, 26]; for (c = /var opts=\[(.*)\];/.exec(b), c = c[1].replace(/"/g, "").split(","), d = 0; d < c.length - 1; d += 4)e = +c[d + 3], $.inArray(e, k) !== -1 && (g[j[e]] = +c[d + 2]); g.fwv = 183 } controller.options = g, a() }) : sendToOS("/jo?pw=", "json").done(function (b) { controller.options = b, a() }) } function updateControllerStatus(a) { return a = a || function () { }, curr183 === !0 ? sendToOS("/sn0").then(function (b) { var c = b.toString().match(/\d+/); c = parseIntArray(c[0].split("")), controller.status = c, a() }, function () { controller.status = [] }) : sendToOS("/js?pw=", "json").then(function (b) { controller.status = b.sn, a() }, function () { controller.status = [] }) } function updateControllerSettings(a) { return a = a || function () { }, curr183 === !0 ? sendToOS("").then(function (a) { var b, c, d = /(ver|devt|nbrd|tz|en|rd|rs|mm|rdst|urs)\s?[=|:]\s?([\w|\d|.\"]+)/gm, e = a.match(/loc\s?[=|:]\s?[\"|'](.*)[\"|']/), f = a.match(/lrun=\[(.*)\]/), g = a.match(/ps=\[(.*)\];/), h = {}; for (g = g[1].split("],["), c = g.length - 1; c >= 0; c--)g[c] = parseIntArray(g[c].replace(/\[|\]/g, "").split(",")); for (; null !== (b = d.exec(a));)h[b[1]] = +b[2]; h.loc = e[1], h.ps = g, h.lrun = parseIntArray(f[1].split(",")), controller.settings = h }, function () { if (controller.settings && controller.stations) { var a, b = []; for (a = 0; a < controller.stations.maxlen; a++)b.push([0, 0]); controller.settings.ps = b } }) : sendToOS("/jc?pw=").then(function (b) { if ("object" != typeof b) try { b = JSON.parse(b) } catch (a) { b = b.replace(/,"wto":\{.*\}/, ""); try { b = JSON.parse(b) } catch (a) { return !1 } } if ("undefined" == typeof b.lrun && (b.lrun = [0, 0, 0, 0]), b.loc.match(regex.gps)) { var c = b.loc.split(","); currentCoordinates = [parseFloat(c[0]), parseFloat(c[1])] } controller.settings = b, a() }, function () { if (controller.settings && controller.stations) { var a, b = []; for (a = 0; a < controller.stations.maxlen; a++)b.push([0, 0]); controller.settings.ps = b } }) } function updateControllerStationSpecial(a) { return a = a || function () { }, sendToOS("/je?pw=", "json").then(function (b) { controller.special = b, a() }, function () { controller.special = {} }) } function checkConfigured(a) { storage.get(["sites", "current_site", "cloudToken"], function (b) { var c, d = b.sites, e = b.current_site; return d = parseSites(d), c = Object.keys(d), c.length ? null !== e && e in d ? (updateSiteList(c, e), currIp = d[e].os_ip, currPass = d[e].os_pw, currPrefix = "undefined" != typeof d[e].ssl && "1" === d[e].ssl ? "https://" : "http://", "undefined" != typeof d[e].auth_user && "undefined" != typeof d[e].auth_pw ? (currAuth = !0, currAuthUser = d[e].auth_user, currAuthPass = d[e].auth_pw) : currAuth = !1, curr183 = !!d[e].is183, void newLoad()) : ($.mobile.loading("hide"), void changePage("#site-control", { transition: a ? "none" : void 0 })) : void (a && (void 0 === b.cloudToken || null === b.cloudToken ? changePage("#start", { transition: "none" }) : changePage("#site-control", { transition: "none" }))) }) } function fixPasswordHash(a) { storage.get(["sites"], function (b) { var c = parseSites(b.sites); if (!isMD5(currPass)) { var d = md5(currPass); sendToOS("/sp?pw=&npw=" + encodeURIComponent(d) + "&cpw=" + encodeURIComponent(d), "json").done(function (b) { var e = b.result; return !(!e || e > 1) && (c[a].os_pw = currPass = d, void storage.set({ sites: JSON.stringify(c) }, cloudSaveSites)) }) } }) } function submitNewUser(a, b) { document.activeElement.blur(), $.mobile.loading("show"); var c, d = $.mobile.path.parseUrl($("#os_ip").val()).hrefNoHash.replace(/https?:\/\//, ""), e = function (c, e) { $.mobile.loading("hide"); var f; if (("string" == typeof c && c.match(/var (en|sd)\s*=/) || "number" == typeof c.fwv && 203 === c.fwv) && (f = !0), void 0 !== c.fwv || f === !0) { var g = $("#os_name").val(), h = $("#os_pw").val(), i = $("#save_pw").is(":checked"); "" === g && (g = "Site " + (Object.keys(e).length + 1)), e[g] = {}, e[g].os_ip = currIp = d, "number" == typeof c.fwv && c.fwv >= 213 && "number" == typeof c.wl && (h = md5(h)), e[g].os_pw = i ? h : "", currPass = h, a ? (e[g].ssl = "1", currPrefix = "https://") : currPrefix = "http://", b ? (e[g].auth_user = $("#os_auth_user").val(), e[g].auth_pw = $("#os_auth_pw").val(), currAuth = !0, currAuthUser = e[g].auth_user, currAuthPass = e[g].auth_pw) : currAuth = !1, f === !0 && (e[g].is183 = "1", curr183 = !0), $("#os_name,#os_ip,#os_pw,#os_auth_user,#os_auth_pw").val(""), storage.set({ sites: JSON.stringify(e), current_site: g }, function () { cloudSaveSites(), updateSiteList(Object.keys(e), g), newLoad() }) } else showerror(_("Check IP/Port and try again.")) }, f = function (c) { return b || 401 !== c.status ? void (a ? ($.mobile.loading("hide"), showerror(_("Check IP/Port and try again."))) : submitNewUser(!0)) : void g() }, g = function () { $("#addnew-auth").length ? submitNewUser(a, !0) : i() }, h = function () { return btoa($("#os_auth_user").val() + ":" + $("#os_auth_pw").val()) }, i = function () { $.mobile.loading("hide"); var b = $("<div class='ui-content' id='addnew-auth'><form method='post' novalidate><p class='center smaller'>" + _("Authorization Required") + "</p><label for='os_auth_user'>" + _("Username:") + "</label><input autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' type='text' name='os_auth_user' id='os_auth_user'><label for='os_auth_pw'>" + _("Password:") + "</label><input type='password' name='os_auth_pw' id='os_auth_pw'><input type='submit' value='" + _("Submit") + "'></form></div>").enhanceWithin(); b.on("submit", "form", function () { return submitNewUser(a, !0), !1 }), $("#addnew-content").hide(), $("#addnew").append(b).popup("reposition", { positionTo: "window" }) }; return d ? b !== !0 && $("#os_useauth").is(":checked") ? void g() : ($("#os_usessl").is(":checked") === !0 && (a = !0), c = a ? "https://" : "http://", b && ($("#addnew-auth").hide(), $("#addnew-content").show(), $("#addnew").popup("reposition", { positionTo: "window" })), void $.ajax({ url: c + d + "/jo?pw=" + md5($("#os_pw").val()), type: "GET", dataType: "json", timeout: 1e4, global: !1, beforeSend: function (a) { b && a.setRequestHeader("Authorization", "Basic " + h()) }, error: function (a) { return b || 401 !== a.status ? void $.ajax({ url: c + d, type: "GET", dataType: "text", timeout: 1e4, global: !1, cache: !0, beforeSend: function (a) { b && a.setRequestHeader("Authorization", "Basic " + h()) }, success: function (a) { storage.get("sites", function (b) { var c = parseSites(b.sites); e(a, c) }) }, error: f }) : void g() }, success: function (a) { storage.get("sites", function (b) { var c = parseSites(b.sites); e(a, c) }) } })) : void showerror(_("An IP address is required to continue.")) } function parseSites(a) { return void 0 === a || null === a ? {} : JSON.parse(a) } function showSiteSelect(a) { $("#site-select").popup("destroy").remove(); var b = $("<div data-role='popup' id='site-select' data-theme='a' data-overlay-theme='b'><div data-role='header' data-theme='b'><h1>" + _("Select Site") + "</h1></div><div class='ui-content'><ul data-role='none' class='ui-listview ui-corner-all ui-shadow'></ul></div></div>"); a && b.find("ul").html(a), b.one("popupafterclose", function () { $(this).popup("destroy").remove() }).popup({ history: !1, positionTo: "window" }).enhanceWithin().popup("open") } function showAddNew(a, b) { $("#addnew").popup("destroy").remove(); var c = !!a, d = $("<div data-role='popup' id='addnew' data-theme='a' data-overlay-theme='b'><div data-role='header' data-theme='b'><h1>" + _("New Device") + "</h1></div><div class='ui-content' id='addnew-content'><form method='post' novalidate>" + (c ? "" : "<p class='center smaller'>" + _("Note: The name is used to identify the OpenSprinkler within the app. OpenSprinkler IP can be either an IP or hostname. You can also specify a port by using IP:Port") + "</p>") + "<label for='os_name'>" + _("Open Sprinkler Name:") + "</label><input autocorrect='off' spellcheck='false' type='text' name='os_name' id='os_name' placeholder='Home'>" + (c ? "" : "<label for='os_ip'>" + _("Open Sprinkler IP:") + "</label>") + "<input " + (c ? "data-role='none' style='display:none' " : "") + "autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' type='url' pattern='' name='os_ip' id='os_ip' value='" + (c ? a : "") + "' placeholder='home.dyndns.org'><label for='os_pw'>" + _("Open Sprinkler Password:") + "</label><input type='password' name='os_pw' id='os_pw' value=''><label for='save_pw'>" + _("Save Password") + "</label><input type='checkbox' data-wrapper-class='save_pw' name='save_pw' id='save_pw' data-mini='true' checked='checked'>" + (c ? "" : "<div data-theme='a' data-mini='true' data-role='collapsible'><h4>" + _("Advanced") + "</h4><fieldset data-role='controlgroup' data-type='horizontal' data-mini='true' class='center'><input type='checkbox' name='os_usessl' id='os_usessl'><label for='os_usessl'>" + _("Use SSL") + "</label><input type='checkbox' name='os_useauth' id='os_useauth'><label for='os_useauth'>" + _("Use Auth") + "</label></fieldset></div>") + "<input type='submit' data-theme='b' value='" + _("Submit") + "'></form></div></div>"); return d.find("form").on("submit", function () { return submitNewUser(), !1 }), d.one("popupafterclose", function () { $(this).popup("destroy").remove() }).popup({ history: !1, positionTo: "window" }).enhanceWithin(), b ? $(".ui-popup-active").children().first().one("popupafterclose", function () { d.popup("open") }).popup("close") : d.popup("open"), fixInputClick(d), d.find(".ui-collapsible-heading-toggle").on("click", function () { var a = $(this).parents(".ui-collapsible").hasClass("ui-collapsible-collapsed"), b = $(".ui-page-active"), c = parseInt(b.css("min-height")); a ? b.css("min-height", c + 65 + "px") : b.css("min-height", c - 65 + "px"), d.popup("reposition", { positionTo: "window" }) }), !1 } function addSyncStatus(a) { var b = $("<div class='ui-bar smaller ui-bar-a ui-corner-all logged-in-alert'><div class='inline ui-btn ui-icon-recycle btn-no-border ui-btn-icon-notext ui-mini'></div><div class='inline syncStatus'>" + _("Synced with OpenSprinkler.com") + " (" + getTokenUser(a) + ")</div><div class='inline ui-btn ui-icon-delete btn-no-border ui-btn-icon-notext ui-mini logout'></div></div>"); return b.find(".logout").on("click", logout), b.find(".ui-icon-recycle").on("click", function () { var a = $(this); a.addClass("spin"), cloudSync(function () { a.removeClass("spin") }) }), b } function testSite(a, b, c) { $.ajax({ url: ("1" === a.ssl ? "https://" : "http://") + a.os_ip + "/jo?pw=" + encodeURIComponent(a.os_pw), type: "GET", dataType: "json", beforeSend: function (b) { "undefined" != typeof a.auth_user && "undefined" != typeof a.auth_pw && b.setRequestHeader("Authorization", "Basic " + btoa(a.auth_user + ":" + a.auth_pw)) } }).then(function () { c(b, !0) }, function () { c(b, !1) }) } function updateSiteList(a, b) { var c = "", d = $("#site-selector"); $.each(a, function () { c += "<option " + (this.toString() === b ? "selected " : "") + "value='" + htmlEscape(this) + "'>" + this + "</option>" }), $("#info-list").find("li[data-role='list-divider']").text(b), d.html(c), d.parent().parent().hasClass("ui-select") && d.selectmenu("refresh") } function updateSite(a) { storage.get("sites", function (b) { var c = parseSites(b.sites); a in c && closePanel(function () { storage.set({ current_site: a }, checkConfigured) }) }) } function findLocalSiteName(a, b) { for (var c in a) if (a.hasOwnProperty(c) && currIp.indexOf(a[c].os_ip) !== -1) return void b(c); b(!1) } function updateDeviceIP(a) { var b, c = function (b) { deviceip = b, "function" == typeof a && a(b) }; if (isChromeApp) chrome.system.network.getNetworkInterfaces(function (a) { var d; for (d in a) a.hasOwnProperty(d) && /^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$/.test(a[d].address) && (b = a[d].address); c(b) }); else try { networkinterface.getIPAddress(function (a) { b = a, c(b) }) } catch (a) { findRouter(function (a, b) { c(a ? b : void 0) }) } } function isLocalIP(a) { var b = parseIntArray(a.split(".")); return 10 === b[0] || 127 === b[0] || 172 === b[0] && b[1] > 17 && b[1] < 32 || 192 === b[0] && 168 === b[1] } function startScan(a, b) { var c, d, e, f, g, h, i, j, k, l = deviceip.split("."), m = 1, n = 0, o = "", p = "", q = [], r = !1; for (b = b || 0, a = "number" == typeof a ? a : 80, storage.get("sites", function (a) { var b, c = parseSites(a.sites); for (b in c) c.hasOwnProperty(b) && q.push(c[b].os_ip) }), e = function () { m++ }, f = function (a) { m++; var b, c, d = $.mobile.path.parseUrl(this.url).authority; if ($.inArray(d, q) === -1) { if ("text" === this.dataType) { if (c = a.match(/var\s*ver=(\d+)/), !c) return; b = c[1] } else { if (!a.hasOwnProperty("fwv")) return; b = a.fwv } n++ , o += "<li><a class='ui-btn ui-btn-icon-right ui-icon-carat-r' href='#' data-ip='" + d + "'>" + d + "<p>" + _("Firmware") + ": " + getOSVersion(b) + "</p></a></li>" } }, h = function () { return r === !0 ? ($.mobile.loading("hide"), clearInterval(i), !1) : void (245 === m && ($.mobile.loading("hide"), clearInterval(i), n ? (o = $(o), o.find("a").on("click", function () { return addFound($(this).data("ip")), !1 }), showSiteSelect(o)) : 0 === b ? startScan(8080, 1) : 1 === b ? startScan(80, 2) : 2 === b ? startScan(8080, 3) : showerror(_("No new devices were detected on your network")))) }, l.pop(), g = l.join("."), 0 === b ? k = _("Scanning for OpenSprinkler") : 1 === b ? k = _("Scanning for OpenSprinkler Pi") : 2 === b ? k = _("Scanning for OpenSprinkler (1.8.3)") : 3 === b && (k = _("Scanning for OpenSprinkler Pi (1.8.3)")), $.mobile.loading("show", { html: "<h1>" + k + "</h1><p class='cancel tight center inline-icon'><span class='btn-no-border ui-btn ui-icon-delete ui-btn-icon-notext'></span>" + _("Cancel") + "</p>", textVisible: !0, theme: "b" }), $(".ui-loader").find(".cancel").one("click", function () { r = !0 }), c = 1; c <= 244; c++)l = g + "." + c, b < 2 ? (p = "/jo", j = "json") : j = "text", d = "http://" + l + (a && 80 !== a ? ":" + a : "") + p, $.ajax({ url: d, type: "GET", dataType: j, timeout: 6e3, global: !1, error: e, success: f }); i = setInterval(h, 200) } function findRouter(a) { a = a || function () { }; var b, c, d, e = ["192.168.1.1", "10.0.1.1", "192.168.1.220", "192.168.2.1", "10.1.1.1", "192.168.11.1", "192.168.0.1", "192.168.0.30", "192.168.0.50", "192.168.10.1", "192.168.20.1", "192.168.30.1", "192.168.62.1", "192.168.102.1", "192.168.1.254", "192.168.0.227", "10.0.0.138", "192.168.123.254", "192.168.4.1", "10.0.0.2", "10.0.2.1", "10.0.3.1", "10.0.4.1", "10.0.5.1"], f = e.length, g = 0, h = function (a, b) { g++ , a === !0 && (c = b) }, i = function () { g !== f && "string" != typeof c || (clearInterval(b), "string" == typeof c ? a(!0, c) : a(!1)) }; for (d = 0; d < f; d++)"string" != typeof c && ping(e[d], h); b = setInterval(i, 50) } function ping(a, b) { b = b || function () { }, a && "" !== a || b(!1), $.ajax({ url: "http://" + a, type: "GET", timeout: 6e3, global: !1 }).then(function () { b(!0, a) }, function (c) { "timeout" === c.statusText ? b(!1) : b(!0, a) }) } function addFound(a) { $("#site-select").one("popupafterclose", function () { showAddNew(a) }).popup("close") } function showZimmermanAdjustmentOptions(a, b) { $(".ui-popup-active").find("[data-role='popup']").popup("close"); var c = $.extend({}, { h: 100, t: 100, r: 100, bh: 30, bt: 70, br: 0 }, controller.settings.wto), d = "US" !== weather.forecast.region && "BM" !== weather.forecast.region && "PW" !== weather.forecast.region, e = checkOSVersion(2162); d && (c.bt = Math.round(5 * (c.bt - 32) / 9 * 10) / 10, c.br = Math.round(25.4 * c.br * 10) / 10); var f = $("<div data-role='popup' data-theme='a' id='adjustmentOptions'><div data-role='header' data-theme='b'><h1>" + _("Weather Adjustment Options") + "</h1></div><div class='ui-content'><p class='rain-desc center smaller'>" + _("Set the baseline weather conditions for your location. ") + _("The Zimmerman method will adjust the watering duration based on differences from this reference point.") + "</p><div class='ui-grid-b'><div class='ui-block-a'><label class='center'>" + _("Temp") + (d ? " &#176;C" : " &#176;F") + "</label><input data-wrapper-class='pad_buttons' class='bt' type='number' " + (d ? "min='-20' max='50'" : "min='0' max='120'") + " value='" + c.bt + (e ? "'>" : "' disabled='disabled'>") + "</div><div class='ui-block-b'><label class='center'>" + _("Rain") + (d ? " mm" : ' "') + "</label><input data-wrapper-class='pad_buttons' class='br' type='number' " + (d ? "min='0' max='25' step='0.1'" : "min='0' max='1' step='0.01'") + " value='" + c.br + (e ? "'>" : "' disabled='disabled'>") + "</div><div class='ui-block-c'><label class='center'>" + _("Humidity") + " %</label><input data-wrapper-class='pad_buttons' class='bh' type='number'  min='0' max='100' value='" + c.bh + (e ? "'>" : "' disabled='disabled'>") + "</div></div><p class='rain-desc center smaller'>" + _("Set the sensitivity of the watering adjustment to changes in each of the above weather conditions.") + "</p><span><fieldset class='ui-grid-b incr'><div class='ui-block-a'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='plus' data-iconpos='bottom'></a></div><div class='ui-block-b'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='plus' data-iconpos='bottom'></a></div><div class='ui-block-c'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='plus' data-iconpos='bottom'></a></div></fieldset><div class='ui-grid-b inputs'><div class='ui-block-a'><input data-wrapper-class='pad_buttons' class='t' type='number' min='0' max='100' value='" + c.t + "'></div><div class='ui-block-b'><input data-wrapper-class='pad_buttons' class='r' type='number'  min='0' max='100' value='" + c.r + "'></div><div class='ui-block-c'><input data-wrapper-class='pad_buttons' class='h' type='number'  min='0' max='100' value='" + c.h + "'></div></div><fieldset class='ui-grid-b decr'><div class='ui-block-a'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='minus' data-iconpos='bottom'></a></div><div class='ui-block-b'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='minus' data-iconpos='bottom'></a></div><div class='ui-block-c'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='minus' data-iconpos='bottom'></a></div></fieldset></span><button class='submit' data-theme='b'>" + _("Submit") + "</button></div></div>"), g = function (a, b) { var c = f.find(".inputs input").eq(a), d = parseInt(c.val()); b === -1 && 0 === d || 1 === b && 100 === d || c.val(d + b) }; f.find(".submit").on("click", function () { var c = { h: parseInt(f.find(".h").val()), t: parseInt(f.find(".t").val()), r: parseInt(f.find(".r").val()) }; return e && ($.extend(c, { bh: parseInt(f.find(".bh").val()), bt: parseFloat(f.find(".bt").val()), br: parseFloat(f.find(".br").val()) }), d && (c.bt = Math.round(100 * (9 * c.bt / 5 + 32)) / 100, c.br = Math.round(c.br / 25.4 * 1e3) / 1e3)), a && (a.value = escapeJSON(c)), b(), f.popup("close"), !1 }), f.on("focus", "input[type='number']", function () { this.value = "" }).on("blur", "input[type='number']", function () { var a = parseFloat(this.min), b = parseFloat(this.max); "" === this.value && (this.value = "0"), (this.value < a || this.value > b) && (this.value = this.value < a ? a : b) }), holdButton(f.find(".incr").children(), function (a) { var b = $(a.currentTarget).index(); return g(b, 1), !1 }), holdButton(f.find(".decr").children(), function (a) { var b = $(a.currentTarget).index(); return g(b, -1), !1 }), $("#adjustmentOptions").remove(), f.css("max-width", "380px"), openPopup(f, { positionTo: "window" }) } function showAutoRainDelayAdjustmentOptions(a, b) { $(".ui-popup-active").find("[data-role='popup']").popup("close"); var c = $.extend({}, { d: 24 }, controller.settings.wto), d = $("<div data-role='popup' data-theme='a' id='adjustmentOptions'><div data-role='header' data-theme='b'><h1>" + _("Weather Adjustment Options") + "</h1></div><div class='ui-content'><p class='rain-desc center smaller'>" + _("If the weather reports any condition suggesting rain, a rain delay is automatically issued using the below set delay duration.") + "</p><label class='center' for='delay_duration'>" + _("Delay Duration (hours)") + "</label><div class='input_with_buttons'><button class='decr ui-btn ui-btn-icon-notext ui-icon-carat-l btn-no-border'></button><input id='delay_duration' type='number' pattern='[0-9]*' value='" + c.d + "'><button class='incr ui-btn ui-btn-icon-notext ui-icon-carat-r btn-no-border'></button></div><button class='submit' data-theme='b'>" + _("Submit") + "</button></div></div>"), e = function (a) { var b = d.find("#delay_duration"), c = parseInt(b.val()); a === -1 && 0 === c || 1 === a && 8760 === c || b.val(c + a) }; d.find(".submit").on("click", function () { return c = { d: parseInt(d.find("#delay_duration").val()) }, a && (a.value = escapeJSON(c)), b(), d.popup("close"), !1 }), d.on("focus", "input[type='number']", function () { this.value = "" }).on("blur", "input[type='number']", function () { ("" === this.value || parseInt(this.value) < 0) && (this.value = "0") }), holdButton(d.find(".incr"), function () { return e(1), !1 }), holdButton(d.find(".decr"), function () { return e(-1), !1 }), $("#adjustmentOptions").remove(), d.css("max-width", "380px"), openPopup(d, { positionTo: "window" }) } function validateWUValues(a, b) { var c; if ("object" != typeof b) return !1; for (c in a) if (a.hasOwnProperty(c) && (c = a[c], !b.hasOwnProperty(c) || null === b[c] || parseInt(b[c]) === -999)) return !1; return !0 } function validateWUData(a, b) { if ("object" == typeof a && "object" == typeof a.dailysummary) { var c = a.dailysummary[0]; return !(!validateWUValues(["minhumidity", "maxhumidity", "meantempm", "meantempi", "precipm", "precipi"], c) || !validateWUValues(["precip_today_metric", "precip_today_in"], b)) } return !1 } function validateWULocation(a, b) { "string" == typeof controller.settings.wtkey && "" !== controller.settings.wtkey || b(!1), $.ajax({ url: "https://api.wunderground.com/api/" + controller.settings.wtkey + "/yesterday/conditions/q/" + encodeURIComponent(a) + ".json", dataType: isChromeApp || isWinApp ? "json" : "jsonp", shouldRetry: retryCount }).done(function (a) { return "object" == typeof a.response.error ? void b(!1) : void b(validateWUData(a.history, a.current_observation)) }).fail(function () { b(!1) }) } function convertTemp(a, b) { return "United States" === b || "Bermuda" === b || "Palau" === b ? a += "&#176;F" : a = parseInt(Math.round((a - 32) * (5 / 9))) + "&#176;C", a } function hideWeather() { $("#weather").empty().parents(".info-card").addClass("noweather") } function updateWeather() { return "undefined" != typeof controller.settings.wtkey && "" !== controller.settings.wtkey ? void updateWundergroundWeather(controller.settings.wtkey) : void storage.get(["provider", "wapikey"], function (a) { return "" === controller.settings.loc ? void hideWeather() : (showLoading("#weather"), void ("wunderground" === a.provider && a.wapikey ? updateWundergroundWeather(a.wapikey) : updateYahooWeather())) }) } function updateYahooWeather(a) { return !a && controller.settings.loc.match(regex.gps) ? void coordsToLocation(controller.settings.loc.split(",")[0], controller.settings.loc.split(",")[1], function (a) { updateYahooWeather(a) }) : void $.ajax({ url: "https://query.yahooapis.com/v1/public/yql?q=select%20woeid%20from%20geo.placefinder%20where%20text=%22" + encodeURIComponent(a || controller.settings.loc) + "%22&format=json", dataType: isChromeApp || isWinApp ? "json" : "jsonp", contentType: "application/json; charset=utf-8", shouldRetry: retryCount, success: function (a) { if ("object" != typeof a || "object" != typeof a.query || null === a.query.results) return void hideWeather(); var b; "string" == typeof a.query.results.Result.woeid ? b = a.query.results.Result.woeid : Array.isArray(a.query.results.Result) && (b = a.query.results.Result[0].woeid), $.ajax({ url: "https://query.yahooapis.com/v1/public/yql?q=select%20item%2Ctitle%2Clocation%20from%20weather.forecast%20where%20woeid%3D%22" + b + "%22&format=json", dataType: isChromeApp || isWinApp ? "json" : "jsonp", contentType: "application/json; charset=utf-8", shouldRetry: retryCount, success: function (a) { if ("City not found" === a.query.results.channel.item.title) return void hideWeather(); var b = a.query.results.channel.item.condition, c = a.query.results.channel.title, d = /Yahoo! Weather - (.*)/.exec(c), e = a.query.results.channel.location.country; currentCoordinates = [a.query.results.channel.item.lat, a.query.results.channel.item.long], weather = { title: b.text, code: b.code, temp: convertTemp(b.temp, e), location: d[1], forecast: a.query.results.channel.item.forecast, region: e, source: "yahoo" }, isWUDataValid = !1, updateWeatherBox(), $.mobile.document.trigger("weatherUpdateComplete") } }) } }) } function updateWeatherBox() {
    $("#weather").html("<div title='" + weather.title + "' class='wicon cond" + weather.code + "'></div><div class='inline tight'>" + weather.temp + "</div><br><div class='inline location tight'>" + weather.location + "</div>" + ("object" == typeof weather.alert ? "<div><button class='tight help-icon btn-no-border ui-btn ui-icon-alert ui-btn-icon-notext ui-corner-all'></button>" + weather.alert.type + "</div>" : "")).off("click").on("click", function () { return changePage("#forecast"), !1 }).parents(".info-card").removeClass("noweather");
} function updateWundergroundWeather(a) { $.ajax({ url: "https://api.wunderground.com/api/" + a + "/yesterday/conditions/forecast/alerts/lang:EN/q/" + encodeURIComponent(controller.settings.loc) + ".json", dataType: isChromeApp || isWinApp ? "json" : "jsonp", contentType: "application/json; charset=utf-8", shouldRetry: retryCount, success: function (a) { var b, c; if ("object" == typeof a.response.error) return "querynotfound" !== a.response.error.type && (weatherKeyFail = !0), void updateYahooWeather(); weatherKeyFail = !1, isWUDataValid = !!validateWUData(a.history, a.current_observation), b = a.current_observation.icon_url.indexOf("nt_") !== -1 ? "nt_" + a.current_observation.icon : a.current_observation.icon; var d = { condition: { text: a.current_observation.weather, code: b, temp_c: a.current_observation.temp_c, temp_f: a.current_observation.temp_f, date: a.current_observation.observation_time, precip_today_in: a.current_observation.precip_today_in, precip_today_metric: a.current_observation.precip_today_metric }, location: a.current_observation.display_location.full, region: a.current_observation.display_location.country_iso3166, simpleforecast: {} }; if (currentCoordinates = [a.current_observation.display_location.latitude || a.current_observation.observation_location.latitude, a.current_observation.display_location.longitude || a.current_observation.observation_location.longitude], $.each(a.forecast.simpleforecast.forecastday, function (a, b) { d.simpleforecast[a] = b }), c = "US" === d.region || "BM" === d.region || "PW" === d.region ? Math.round(d.condition.temp_f) + "&#176;F" : d.condition.temp_c + "&#176;C", weather = { title: d.condition.text, code: b, temp: c, forecast: d, source: "wunderground" }, a.alerts.length > 0) { var e = { HUR: _("Hurricane Local Statement"), TOR: _("Tornado Warning"), TOW: _("Tornado Watch"), WRN: _("Severe Thunderstorm Warning"), SEW: _("Severe Thunderstorm Watch"), WIN: _("Winter Weather Advisory"), FLO: _("Flood Warning"), WAT: _("Flood Watch / Statement"), WND: _("High Wind Advisory"), SVR: _("Severe Weather Statement"), HEA: _("Heat Advisory"), FOG: _("Dense Fog Advisory"), SPE: _("Special Weather Statement"), FIR: _("Fire Weather Advisory"), VOL: _("Volcanic Activity Statement"), HWW: _("Hurricane Wind Warning"), REC: _("Record Set"), REP: _("Public Reports"), PUB: _("Public Information Statement") }; weather.alert = { type: e[a.alerts[0].type], name: a.alerts[0].wtype_meteoalarm_name || a.alerts[0].description, message: a.alerts[0].message } } coordsToLocation(currentCoordinates[0], currentCoordinates[1], function (a) { weather.location = a, updateWeatherBox() }, d.location), $.mobile.document.trigger("weatherUpdateComplete") } }) } function coordsToLocation(a, b, c, d) { d = d || a + "," + b, $.getJSON("https://maps.googleapis.com/maps/api/geocode/json?latlng=" + a + "," + b + "&key=AIzaSyDaT_HTZwFojXmvYIhwWudK00vFXzMmOKc&result_type=locality|sublocality|administrative_area_level_1|country", function (a) { if (0 === a.results.length) return void c(d); a = a.results, d = a[0].formatted_address; var b = !1; for (var e in a) if (a.hasOwnProperty(e) && ($.inArray("locality", a[e].types) > -1 || $.inArray("sublocality", a[e].types) > -1 || $.inArray("postal_code", a[e].types) > -1 || $.inArray("street_address", a[e].types) > -1)) { b = !0; break } if (b === !1) return void c(d); a = a[e].address_components; var f = "", g = ""; b = !1; for (e in a) a.hasOwnProperty(e) && !b && ("" === f && $.inArray("locality", a[e].types) > -1 && (f = a[e].long_name + ", " + f), "" === f && $.inArray("sublocality", a[e].types) > -1 && (f = a[e].long_name + ", " + f), $.inArray("administrative_area_level_1", a[e].types) > -1 && (f += a[e].long_name, b = !0), $.inArray("country", a[e].types) > -1 && (g = a[e].long_name)); b || (f += g), c(f) }) } function getSunTimes(a) { a = a || new Date(1e3 * controller.settings.devt); var b = SunCalc.getTimes(a, currentCoordinates[0], currentCoordinates[1]), c = b.sunrise, d = b.sunset, e = getTimezoneOffset(); return c.setUTCMinutes(c.getUTCMinutes() + e), d.setUTCMinutes(d.getUTCMinutes() + e), c = 60 * c.getUTCHours() + c.getUTCMinutes(), d = 60 * d.getUTCHours() + d.getUTCMinutes(), [c, d] } function showForecast() { var a = $("<div data-role='page' id='forecast'><div class='ui-content' role='main'><ul data-role='listview' data-inset='true'>" + ("wunderground" === weather.source ? makeWundergroundForecast() : makeYahooForecast()) + "</ul></div></div>"); changeHeader({ title: _("Forecast"), leftBtn: { icon: "carat-l", text: _("Back"), class: "ui-toolbar-back-btn", on: goBack }, rightBtn: { icon: "refresh", text: _("Refresh"), on: function () { $.mobile.loading("show"), $.mobile.document.one("weatherUpdateComplete", function () { $.mobile.loading("hide") }), updateWeather() } } }), a.one("pagehide", function () { a.remove() }), a.find(".alert").on("click", function () { openPopup($("<div data-role='popup' data-theme='a'><div data-role='header' data-theme='b'><h1>" + weather.alert.name + "</h1></div><div class='ui-content'><span style='white-space: pre-wrap'>" + $.trim(weather.alert.message) + "</span></div></div>")) }), $("#forecast").remove(), $.mobile.pageContainer.append(a) } function makeWundergroundForecast() { var a, b; "US" === weather.forecast.region || "BM" === weather.forecast.region || "PW" === weather.forecast.region ? (a = weather.forecast.condition.temp_f + "&#176;F", b = weather.forecast.condition.precip_today_in + " in") : (a = weather.forecast.condition.temp_c + "&#176;C", b = weather.forecast.condition.precip_today_metric + " mm"); var c = "<li data-role='list-divider' data-theme='a' class='center'>" + weather.location + "</li>"; return "object" == typeof weather.alert && (c += "<li data-icon='false' class='center red alert'><div>" + weather.alert.type + "</div><br><span class='smaller'>" + _("Click to read more...") + "</span></li>"), c += "<li data-icon='false' class='center'><div>" + _("Now") + "</div><br><div title='" + weather.forecast.condition.text + "' class='wicon cond" + weather.forecast.condition.code + "'></div><span>" + a + "</span><br><span>" + _("Sunrise") + "</span><span>: " + pad(parseInt(controller.settings.sunrise / 60) % 24) + ":" + pad(controller.settings.sunrise % 60) + "</span> <span>" + _("Sunset") + "</span><span>: " + pad(parseInt(controller.settings.sunset / 60) % 24) + ":" + pad(controller.settings.sunset % 60) + "</span><br><span>" + _("Precip") + "</span><span>: " + b + "</span></li>", $.each(weather.forecast.simpleforecast, function (a) { if ("0" !== a) { var b, d = getSunTimes(new Date(1e3 * this.date.epoch)), e = d[0], f = d[1]; "US" === weather.forecast.region || "BM" === weather.forecast.region || "PW" === weather.forecast.region ? (b = this.qpf_allday.in, null === b && (b = 0), c += "<li data-icon='false' class='center'><div>" + this.date.monthname_short + " " + this.date.day + "</div><br><div title='" + this.conditions + "' class='wicon cond" + this.icon + "'></div><span>" + _(this.date.weekday_short) + "</span><br><span>" + _("Low") + "</span><span>: " + this.low.fahrenheit + "&#176;F  </span><span>" + _("High") + "</span><span>: " + this.high.fahrenheit + "&#176;F</span><br><span>" + _("Sunrise") + "</span><span>: " + pad(parseInt(e / 60) % 24) + ":" + pad(e % 60) + "</span> <span>" + _("Sunset") + "</span><span>: " + pad(parseInt(f / 60) % 24) + ":" + pad(f % 60) + "</span><br><span>" + _("Precip") + "</span><span>: " + b + " in</span></li>") : (b = this.qpf_allday.mm, null === b && (b = 0), c += "<li data-icon='false' class='center'><div>" + this.date.monthname_short + " " + this.date.day + "</div><br><div title='" + this.conditions + "' class='wicon cond" + this.icon + "'></div><span>" + _(this.date.weekday_short) + "</span><br><span>" + _("Low") + "</span><span>: " + this.low.celsius + "&#176;C  </span><span>" + _("High") + "</span><span>: " + this.high.celsius + "&#176;C</span><br><span>" + _("Sunrise") + "</span><span>: " + pad(parseInt(e / 60) % 24) + ":" + pad(e % 60) + "</span> <span>" + _("Sunset") + "</span><span>: " + pad(parseInt(f / 60) % 24) + ":" + pad(controller.settings.sunset % 60) + "</span><br><span>" + _("Precip") + "</span><span>: " + b + " mm</span></li>") } }), c } function makeYahooForecast() { var a, b = "<li data-role='list-divider' data-theme='a' class='center'>" + weather.location + "</li>", c = controller.settings.sunrise ? controller.settings.sunrise : getSunTimes()[0], d = controller.settings.sunset ? controller.settings.sunset : getSunTimes()[1]; for (b += "<li data-icon='false' class='center'><div>" + _("Now") + "</div><br><div title='" + weather.title + "' class='wicon cond" + weather.code + "'></div><span>" + weather.temp + "</span><br><span>" + _("Sunrise") + "</span><span>: " + pad(parseInt(c / 60) % 24) + ":" + pad(c % 60) + "</span> <span>" + _("Sunset") + "</span><span>: " + pad(parseInt(d / 60) % 24) + ":" + pad(d % 60) + "</span></li>", a = 1; a < weather.forecast.length; a++) { var e = getSunTimes(new Date(weather.forecast[a].date)); c = e[0], d = e[1], b += "<li data-icon='false' class='center'><div>" + weather.forecast[a].date + "</div><br><div title='" + weather.forecast[a].text + "' class='wicon cond" + weather.forecast[a].code + "'></div><span>" + _(weather.forecast[a].day) + "</span><br><span>" + _("Low") + "</span><span>: " + convertTemp(weather.forecast[a].low, weather.region) + "  </span><span>" + _("High") + "</span><span>: " + convertTemp(weather.forecast[a].high, weather.region) + "</span><br><span>" + _("Sunrise") + "</span><span>: " + pad(parseInt(c / 60) % 24) + ":" + pad(c % 60) + "</span> <span>" + _("Sunset") + "</span><span>: " + pad(parseInt(d / 60) % 24) + ":" + pad(d % 60) + "</span></li>" } return b } function overlayMap(a) { $("#location-list").popup("destroy").remove(), $.mobile.loading("show"), a = a || function () { }; var b = $("<div data-role='popup' id='location-list' data-theme='a' style='background-color:rgb(229, 227, 223);'><a href='#' data-rel='back' class='ui-btn ui-corner-all ui-shadow ui-btn-b ui-icon-delete ui-btn-icon-notext ui-btn-right'>" + _("Close") + "</a><iframe style='border:none' src='" + getAppURLPath() + "map.html' width='100%' height='100%' seamless=''></iframe></div>"), c = function (a) { a = a || function (a) { a && e.get(0).contentWindow.postMessage({ type: "currentLocation", payload: { lat: a.coords.latitude, lon: a.coords.longitude } }, "*") }; var b, c = function (c) { clearTimeout(b), $.mobile.loading("hide"), c || showerror(_("Unable to retrieve your current location")), a(c) }; try { b = setTimeout(function () { $.mobile.loading("show", { html: "<div class='logo'></div><h1 style='padding-top:5px'>" + _("Attempting to retrieve your current location") + "</h1></p>", textVisible: !0, theme: "b" }) }, 100), navigator.geolocation.getCurrentPosition(function (a) { clearTimeout(b), c(a) }, function () { c(!1) }, { timeout: 1e4 }) } catch (a) { c(!1) } }, d = function (a, b) { "string" == typeof controller.settings.wtkey && "" !== controller.settings.wtkey && $.ajax({ url: "https://api.wunderground.com/api/" + controller.settings.wtkey + "/geolookup/q/" + (a === -999 || b === -999 ? "autoip" : encodeURIComponent(a) + "," + encodeURIComponent(b)) + ".json", dataType: isChromeApp || isWinApp ? "json" : "jsonp", shouldRetry: retryCount }).done(function (a) { if ("object" != typeof a.response.error) { var b; try { b = a.location.nearby_weather_stations.airport.station, a = a.location.nearby_weather_stations.pws.station } catch (a) { return } a.length > 0 && (a = encodeURIComponent(JSON.stringify(a)), e.get(0).contentWindow.postMessage({ type: "pwsData", payload: a }, "*")), b.length > 0 && (b = encodeURIComponent(JSON.stringify(b)), e.get(0).contentWindow.postMessage({ type: "airportData", payload: b }, "*")) } }) }, e = b.find("iframe"), f = $("#loc").val(), g = { lat: f.match(regex.gps) ? f.split(",")[0] : currentCoordinates[0], lon: f.match(regex.gps) ? f.split(",")[1] : currentCoordinates[1] }, h = !1; $.mobile.window.off("message onmessage").on("message onmessage", function (e) { var f = e.originalEvent.data; if ("undefined" != typeof f.WS) { var g = f.WS.split(","); a(g.length > 1 ? g : f.WS, f.station), h = !0, b.popup("destroy").remove() } else f.loaded === !0 ? $.mobile.loading("hide") : "object" == typeof f.location ? d(f.location[0], f.location[1]) : f.dismissKeyboard === !0 ? document.activeElement.blur() : f.getLocation === !0 && c() }), e.one("load", function () { 0 === g.lat && 0 === g.lon && c(), this.contentWindow.postMessage({ type: "startLocation", payload: { start: g } }, "*") }), b.one("popupafterclose", function () { h === !1 && a(!1) }), openPopup(b, { beforeposition: function () { b.css({ width: window.innerWidth - 36, height: window.innerHeight - 28 }) }, x: 0, y: 0 }), d(g.lat, g.lon) } function debugWU() { return "string" != typeof controller.settings.wtkey || "" === controller.settings.wtkey ? void showerror(_("An API key must be provided for Weather Underground")) : ($.mobile.loading("show"), $.ajax({ url: "https://api.wunderground.com/api/" + controller.settings.wtkey + "/yesterday/conditions/q/" + controller.settings.loc + ".json", dataType: isChromeApp || isWinApp ? "json" : "jsonp", shouldRetry: retryCount }).done(function (a) { if ($.mobile.loading("hide"), "object" == typeof a.response.error) return void showerror(_("An invalid API key has been detected")); if ("object" != typeof a.history || "object" != typeof a.history.dailysummary) return void showerror(_("Weather data cannot be found for your location")); var b = a.history.dailysummary[0], c = a.current_observation; if (!validateWUValues(["minhumidity", "maxhumidity", "meantempm", "meantempi", "precipm", "precipi"], b) || !validateWUValues(["precip_today_metric", "precip_today_in"], c)) return void showerror(_("Weather data cannot be found for your location")); var d = c.display_location.country_iso3166, e = "US" !== d && "BM" !== d && "PW" !== d, f = $("<div data-role='popup' id='debugWU' class='ui-content ui-page-theme-a'><table class='debugWU'><tr><td>" + _("Min Humidity") + "</td><td>" + b.minhumidity + "%</td></tr><tr><td>" + _("Max Humidity") + "</td><td>" + b.maxhumidity + "%</td></tr><tr><td>" + _("Mean Temp") + "</td><td>" + (e ? b.meantempm + "&#176;C" : b.meantempi + "&#176;F") + "</td></tr><tr><td>" + _("Precip Yesterday") + "</td><td>" + (e ? b.precipm + "mm" : b.precipi + '"') + "</td></tr><tr><td>" + _("Precip Today") + "</td><td>" + (e ? c.precip_today_metric + "mm" : c.precip_today_in + '"') + "</td></tr><tr><td>" + _("Adjustment Method") + "</td><td>" + getAdjustmentName(controller.options.uwt) + "</td></tr><tr><td>" + _("Current % Watering") + "</td><td>" + controller.options.wl + "%</td></tr>" + ("number" == typeof controller.settings.lwc ? "<tr><td>" + _("Last Weather Call") + "</td><td>" + dateToString(new Date(1e3 * controller.settings.lwc)) + "</td></tr>" : "") + ("number" == typeof controller.settings.lswc ? "<tr><td>" + _("Last Successful Weather Call") + "</td><td>" + dateToString(new Date(1e3 * controller.settings.lswc)) + "</td></tr>" : "") + "</table></div>"); openPopup(f) }).fail(function () { $.mobile.loading("hide"), showerror(_("Connection timed-out. Please try again.")) }), !1) } function showRainDelay() { $(".ui-popup-active").find("[data-role='popup']").popup("close"), showDurationBox({ title: _("Change Rain Delay"), callback: raindelay, label: _("Duration"), maximum: 31536e3, granularity: 2, preventCompression: !0, incrementalUpdate: !1, updateOnChange: !1, helptext: _("Enable manual rain delay by entering a value into the input below. To turn off a currently enabled rain delay use a value of 0.") }) } function getAdjustmentName(a) { var b = [_("Manual"), "Zimmerman"]; return checkOSVersion(216) && b.push(_("Auto Rain Delay")), "length" === a ? b.length : b[a & -129] } function getAdjustmentMethod() { return controller.options.uwt & -129 } function getRestriction(a) { return [{ isCurrent: 0, name: _("None") }, { isCurrent: !!(controller.options.uwt >> 7 & 1), name: _("California Restriction") }][a] } function setRestriction(a, b) { return b = b || controller.options.uwt & -129, 1 === a && (b |= 128), b } function testAPIKey(a, b) { $.ajax({ url: "https://api.wunderground.com/api/" + a + "/conditions/forecast/lang:EN/q/75252.json", dataType: isChromeApp || isWinApp ? "json" : "jsonp", shouldRetry: retryCount }).done(function (a) { return "object" == typeof a.response.error && "keynotfound" === a.response.error.type ? void b(!1) : void b(!0) }).fail(function () { b(!1) }) } function bindPanel() { var a = $("#sprinklers-settings"), b = function () { return _(controller && controller.settings && controller.settings.en && 1 === controller.settings.en ? "Disable" : "Enable") }; a.enhanceWithin().panel().removeClass("hidden").panel("option", "classes.modal", "needsclick ui-panel-dismiss"), a.find("a[href='#site-control']").on("click", function () { return changePage("#site-control"), !1 }), a.find("a[href='#about']").on("click", function () { return changePage("#about"), !1 }), a.find(".cloud-login").on("click", function () { return requestCloudAuth(), !1 }), a.find("a[href='#debugWU']").on("click", debugWU), a.find("a[href='#localization']").on("click", languageSelect), a.find(".export_config").on("click", function () { return "object" != typeof controller.stations.stn_spe || "object" == typeof controller.special || controller.stations.stn_spe.every(function (a) { return 0 === a }) ? getExportMethod() : updateControllerStationSpecial(getExportMethod), !1 }), a.find(".import_config").on("click", function () { return storage.get("backup", function (a) { getImportMethod(a.backup) }), !1 }), a.find(".toggleOperation").on("click", function () { var a = $(this), c = 1 - controller.settings.en; return areYouSure(_("Are you sure you want to") + " " + b().toLowerCase() + " " + _("operation?"), "", function () { sendToOS("/cv?pw=&en=" + c).done(function () { $.when(updateControllerSettings(), updateControllerStatus()).done(function () { checkStatus(), a.find("span:first").html(b()).attr("data-translate", b()) }) }) }), !1 }).find("span:first").html(b()).attr("data-translate", b()), a.find(".reboot-os").on("click", function () { return areYouSure(_("Are you sure you want to reboot OpenSprinkler?"), "", function () { $.mobile.loading("show"), sendToOS("/cv?pw=&rbt=1").done(function () { $.mobile.loading("hide"), showerror(_("OpenSprinkler is rebooting now")) }) }), !1 }), a.find(".show-providers").on("click", function () { $("#providers").popup("destroy").remove(), storage.get(["provider", "wapikey"], function (a) { a.provider = a.provider || "yahoo"; var b = $("<div data-role='popup' id='providers' data-theme='a' data-overlay-theme='b'><div class='ui-content'><form><label for='weather_provider'>" + _("Weather Provider") + "<select data-mini='true' id='weather_provider' class='needsclick'><option value='yahoo'>" + _("Yahoo!") + "</option><option " + ("wunderground" === a.provider ? "selected " : "") + "value='wunderground'>" + _("Wunderground") + "</option></select></label><label for='wapikey'>" + _("Wunderground API Key") + "<input data-mini='true' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' type='text' id='wapikey' value='" + (a.wapikey ? a.wapikey : "") + "'></label><input type='submit' value='" + _("Submit") + "'></form></div></div>"); return "yahoo" === a.provider && b.find("#wapikey").closest("label").hide(), b.find("form").on("submit", function (a) { a.preventDefault(); var b = $("#wapikey").val(), c = $("#weather_provider").val(); return "wunderground" === c && "" === b ? void showerror(_("An API key must be provided for Weather Underground")) : (storage.set({ wapikey: b, provider: c }), updateWeather(), $("#providers").popup("close"), !1) }), b.on("change", "#weather_provider", function () { var a = $(this).val(); "wunderground" === a ? $("#wapikey").closest("label").show() : $("#wapikey").closest("label").hide(), b.popup("reposition", { positionTo: "window" }) }), b.one("popupafterclose", function () { document.activeElement.blur(), this.remove() }).popup().enhanceWithin().popup("open"), !1 }) }), a.find(".changePassword > a").on("click", changePassword), a.find("#downgradeui").on("click", function () { return areYouSure(_("Are you sure you want to downgrade the UI?"), "", function () { var a = "http://rayshobby.net/scripts/java/svc" + getOSVersion(); sendToOS("/cu?jsp=" + encodeURIComponent(a) + "&pw=").done(function () { storage.remove(["sites", "current_site", "lang", "provider", "wapikey", "runonce"]), location.reload() }) }), !1 }), a.find("#logout").on("click", function () { return logout(), !1 }), openPanel = function () { function a() { var a = $(".ui-page-active").attr("id"); "start" !== a && "loadingPage" !== a && isControllerConnected() && 1 === $(".ui-page-active").length && (c(), b.panel("open")) } var b = $("#sprinklers-settings"), c = function () { var a = _(controller && controller.settings && controller.settings.en && 1 === controller.settings.en ? "Disable" : "Enable"); b.find(".toggleOperation span:first").html(a).attr("data-translate", a) }; return $("html").on("datarefresh", c), a }() } function showOptions(a) {
    var b, c, d, e = "", f = $("<div data-role='page' id='os-options'><div class='ui-content' role='main'><div data-role='collapsibleset' id='os-options-list'></div><a class='submit preventBack' style='display:none'></a></div></div>"), g = function () { var a, b = {}, c = !1, d = isOSPi(), e = h.eq(2), g = { 1: "tz", 2: "ntp", 12: "htp", 13: "htp2", 14: "ar", 15: "nbrd", 16: "seq", 17: "sdt", 18: "mas", 19: "mton", 20: "mtoff", 21: "urs", 22: "rst", 23: "wl", 25: "ipas", 30: "rlp", 36: "lg", 31: "uwt", 37: "mas2", 38: "mton2", 39: "mtof2", 41: "fpr0", 42: "fpr1", 48: "sar", 49: "ife" }; return e.prop("disabled", !0), f.find(".submit").removeClass("hasChanges"), f.find("#os-options-list").find(":input,button").filter(":not(.noselect)").each(function () { var e, h = $(this), i = h.attr("id"), j = h.val(); if (!i || !j && "" !== j) return !0; switch (i) { case "o1": var k = j.split(":"); k[0] = parseInt(k[0], 10), k[1] = parseInt(k[1], 10), k[1] = (k[1] / 15 >> 0) / 4, k[0] = k[0] + (k[0] >= 0 ? k[1] : -k[1]), j = 4 * (k[0] + 12) >> 0; break; case "datetime": var l = new Date(1e3 * j); return b.tyy = l.getUTCFullYear(), b.tmm = l.getUTCMonth(), b.tdd = l.getUTCDate(), b.thh = l.getUTCHours(), b.tmi = l.getUTCMinutes(), b.ttt = Math.round(l.getTime() / 1e3), !0; case "ip_addr": return e = j.split("."), "0.0.0.0" === e ? (showerror(_("A valid IP address is required when DHCP is not used")), c = !0, !1) : (b.o4 = e[0], b.o5 = e[1], b.o6 = e[2], b.o7 = e[3], !0); case "gateway": return e = j.split("."), "0.0.0.0" === e ? (showerror(_("A valid gateway address is required when DHCP is not used")), c = !0, !1) : (b.o8 = e[0], b.o9 = e[1], b.o10 = e[2], b.o11 = e[3], !0); case "dns": return e = j.split("."), "0.0.0.0" === e ? (showerror(_("A valid DNS address is required when DHCP is not used")), c = !0, !1) : (b.o44 = e[0], b.o45 = e[1], b.o46 = e[2], b.o47 = e[3], !0); case "ntp_addr": return e = j.split("."), b.o32 = e[0], b.o33 = e[1], b.o34 = e[2], b.o35 = e[3], !0; case "wto": if (escapeJSON(controller.settings.wto) === j) return !0; break; case "o12": return d || (b.o12 = 255 & j, b.o13 = j >> 8 & 255), !0; case "o31": if (j > 0 && "" === $("#wtkey").val()) return showerror(_("Weather Underground API key is required for weather-based control")), c = !0, !1; var m = f.find("#weatherRestriction"); m.length && (j = setRestriction(parseInt(m.val()), j)); break; case "o18": case "o37": parseInt(j) > 8 * (parseInt(f.find("#o15").val()) + 1) && (j = 0); break; case "o41": return "gallon" === f.find("#o41-units").val() && (j = 3.78541 * j), b.o41 = 100 * j & 255, b.o42 = 100 * j >> 8 & 255, !0; case "o2": case "o14": case "o16": case "o21": case "o22": case "o25": case "o36": case "o48": case "o3": if (j = h.is(":checked") ? 1 : 0, !j) return !0 }d && ("loc" === i || "lg" === i ? i = "o" + i : (a = /\d+/.exec(i), i = "o" + g[a])), checkOSVersion(208) === !0 && "loc" === i && (j = j.replace(/\s/g, "_")), b[i] = j }), c ? (e.prop("disabled", !1), void f.find(".submit").addClass("hasChanges")) : ("undefined" != typeof controller.options.fpr0 && (b.o21 = f.find("input[name='o21'][type='radio']:checked").val()), $.mobile.loading("show"), void sendToOS("/co?pw=&" + $.param(b)).done(function () { $.mobile.document.one("pageshow", function () { showerror(_("Settings have been saved")) }), goBack(), updateController(updateWeather) }).fail(function () { e.prop("disabled", !1), f.find(".submit").addClass("hasChanges") })) }, h = changeHeader({ title: _("Edit Options"), leftBtn: { icon: "carat-l", text: _("Back"), class: "ui-toolbar-back-btn", on: checkChangesBeforeBack }, rightBtn: { icon: "check", text: _("Submit"), class: "submit", on: g } }); if (f.find(".submit").on("click", g), e = "<fieldset data-role='collapsible'" + ("string" != typeof a || "system" === a ? " data-collapsed='false'" : "") + "><legend>" + _("System") + "</legend>", "undefined" != typeof controller.options.ntp && (e += "<div class='ui-field-contain datetime-input'><label for='datetime'>" + _("Device Time") + "</label><button " + (controller.options.ntp ? "disabled " : "") + "data-mini='true' id='datetime' value='" + (controller.settings.devt + 60 * new Date(1e3 * controller.settings.devt).getTimezoneOffset()) + "'>" + dateToString(new Date(1e3 * controller.settings.devt)).slice(0, -3) + "</button></div>"), !isOSPi() && "undefined" != typeof controller.options.tz) { for (b = ["-12:00", "-11:30", "-11:00", "-10:00", "-09:30", "-09:00", "-08:30", "-08:00", "-07:00", "-06:00", "-05:00", "-04:30", "-04:00", "-03:30", "-03:00", "-02:30", "-02:00", "+00:00", "+01:00", "+02:00", "+03:00", "+03:30", "+04:00", "+04:30", "+05:00", "+05:30", "+05:45", "+06:00", "+06:30", "+07:00", "+08:00", "+08:45", "+09:00", "+09:30", "+10:00", "+10:30", "+11:00", "+11:30", "+12:00", "+12:45", "+13:00", "+13:45", "+14:00"], c = controller.options.tz - 48, c = (c >= 0 ? "+" : "-") + pad(Math.abs(c) / 4 >> 0) + ":" + (Math.abs(c) % 4 * 15 / 10 >> 0) + Math.abs(c) % 4 * 15 % 10, e += "<div class='ui-field-contain'><label for='o1' class='select'>" + _("Timezone") + "</label><select " + (checkOSVersion(210) && "object" == typeof weather ? "disabled='disabled' " : "") + "data-mini='true' id='o1'>", d = 0; d < b.length; d++)e += "<option " + (b[d] === c ? "selected" : "") + " value='" + b[d] + "'>" + b[d] + "</option>"; e += "</select></div>" } if (e += "<div class='ui-field-contain'><label for='loc'>" + _("Location") + "</label><button data-mini='true' id='loc' value='" + controller.settings.loc + "'" + (isWUDataValid === !0 ? " class='green'" : "") + "><span>" + ("object" == typeof weather ? weather.location : "''" === controller.settings.loc.trim() ? _("Not specified") : controller.settings.loc) + "</span><a class='ui-btn btn-no-border ui-btn-icon-notext ui-icon-delete ui-btn-corner-all clear-loc'></a></button></div>", "undefined" != typeof controller.options.lg && (e += "<label for='o36'><input data-mini='true' id='o36' type='checkbox' " + (1 === controller.options.lg ? "checked='checked'" : "") + ">" + _("Enable Logging") + "</label>"), e += "</fieldset><fieldset data-role='collapsible'" + ("string" == typeof a && "master" === a ? " data-collapsed='false'" : "") + "><legend>" + _("Configure Master") + "</legend>", "undefined" != typeof controller.options.mas) { for (e += "<div class='ui-field-contain ui-field-no-border'><label for='o18' class='select'>" + _("Master Station") + " " + ("undefined" != typeof controller.options.mas2 ? "1" : "") + "</label><select data-mini='true' id='o18'><option value='0'>" + _("None") + "</option>", d = 0; d < controller.stations.snames.length && (e += "<option " + (1 === isStationMaster(d) ? "selected" : "") + " value='" + (d + 1) + "'>" + controller.stations.snames[d] + "</option>", checkOSVersion(214) || 7 !== d); d++); e += "</select></div>", "undefined" != typeof controller.options.mton && (e += "<div " + (0 === controller.options.mas ? "style='display:none' " : "") + "class='ui-field-no-border ui-field-contain duration-field'><label for='o19'>" + _("Master On Adjustment") + "</label><button data-mini='true' id='o19' value='" + controller.options.mton + "'>" + controller.options.mton + "s</button></div>"), "undefined" != typeof controller.options.mtof && (e += "<div " + (0 === controller.options.mas ? "style='display:none' " : "") + "class='ui-field-no-border ui-field-contain duration-field'><label for='o20'>" + _("Master Off Adjustment") + "</label><button data-mini='true' id='o20' value='" + controller.options.mtof + "'>" + controller.options.mtof + "s</button></div>") } if ("undefined" != typeof controller.options.mas2) { for (e += "<hr style='width:95%' class='content-divider'>", e += "<div class='ui-field-contain ui-field-no-border'><label for='o37' class='select'>" + _("Master Station") + " 2</label><select data-mini='true' id='o37'><option value='0'>" + _("None") + "</option>", d = 0; d < controller.stations.snames.length && (e += "<option " + (2 === isStationMaster(d) ? "selected" : "") + " value='" + (d + 1) + "'>" + controller.stations.snames[d] + "</option>", checkOSVersion(214) || 7 !== d); d++); e += "</select></div>", "undefined" != typeof controller.options.mton2 && (e += "<div " + (0 === controller.options.mas2 ? "style='display:none' " : "") + "class='ui-field-no-border ui-field-contain duration-field'><label for='o38'>" + _("Master On Delay") + "</label><button data-mini='true' id='o38' value='" + controller.options.mton2 + "'>" + controller.options.mton2 + "s</button></div>"), "undefined" != typeof controller.options.mtof2 && (e += "<div " + (0 === controller.options.mas2 ? "style='display:none' " : "") + "class='ui-field-no-border ui-field-contain duration-field'><label for='o39'>" + _("Master Off Delay") + "</label><button data-mini='true' id='o39' value='" + controller.options.mtof2 + "'>" + controller.options.mtof2 + "s</button></div>") } if (e += "</fieldset><fieldset data-role='collapsible'" + ("string" == typeof a && "station" === a ? " data-collapsed='false'" : "") + "><legend>" + _("Station Handling") + "</legend>", "undefined" != typeof controller.options.ext) { for (e += "<div class='ui-field-contain'><label for='o15' class='select'>" + _("Number of Stations") + ("number" == typeof controller.options.dexp && controller.options.dexp < 255 && controller.options.dexp >= 0 ? " <span class='nobr'>(" + (8 * controller.options.dexp + 8) + " " + _("available") + ")</span>" : "") + "</label><select data-mini='true' id='o15'>", d = 0; d <= (controller.options.mexp || 5); d++)e += "<option " + (controller.options.ext === d ? "selected" : "") + " value='" + d + "'>" + (8 * d + 8) + " " + _("stations") + "</option>"; e += "</select></div>" } if ("undefined" != typeof controller.options.sdt && (e += "<div class='ui-field-contain duration-field'><label for='o17'>" + _("Station Delay") + "</label><button data-mini='true' id='o17' value='" + controller.options.sdt + "'>" + dhms2str(sec2dhms(controller.options.sdt)) + "</button></div>"), "undefined" != typeof controller.options.seq && (e += "<label for='o16'><input data-mini='true' id='o16' type='checkbox' " + (1 === controller.options.seq ? "checked='checked'" : "") + ">" + _("Sequential") + "</label>"), e += "</fieldset><fieldset data-role='collapsible'" + ("string" == typeof a && "weather" === a ? " data-collapsed='false'" : "") + "><legend>" + _("Weather and Sensors") + "</legend>", "undefined" != typeof controller.settings.wtkey && (e += "<div class='ui-field-contain'><label for='wtkey'>" + _("Wunderground Key").replace("Wunderground", "Wunder&shy;ground") + "<button data-helptext='" + _("Weather Underground requires an API Key which can be obtained from ") + "' class='help-icon btn-no-border ui-btn ui-icon-info ui-btn-icon-notext'></button></label><table><tr style='width:100%;vertical-align: top;'><td style='width:100%'><div class='" + (weatherKeyFail === !0 ? "red " : controller.settings.wtkey && "" !== controller.settings.wtkey ? "green " : "") + "ui-input-text controlgroup-textinput ui-btn ui-body-inherit ui-corner-all ui-mini ui-shadow-inset ui-input-has-clear'><input data-role='none' data-mini='true' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' type='text' id='wtkey' value='" + controller.settings.wtkey + "'><a href='#' tabindex='-1' aria-hidden='true' data-helptext='" + _("An invalid API key has been detected.") + "' class='" + (weatherKeyFail === !0 ? "" : "hidden ") + "help-icon ui-input-clear ui-btn ui-icon-alert ui-btn-icon-notext ui-corner-all'></a></div></td><td><button class='noselect' data-mini='true' id='verify-api'>" + _("Verify") + "</button></td></tr></table></div>"), "undefined" != typeof controller.options.uwt) { for (e += "<div class='ui-field-contain'><label for='o31' class='select'>" + _("Weather Adjustment Method") + "<button data-helptext='" + _("Weather adjustment uses Weather Underground data in conjunction with the selected method to adjust the watering percentage.") + "' class='help-icon btn-no-border ui-btn ui-icon-info ui-btn-icon-notext'></button></label><select " + (controller.settings.wtkey && "" !== controller.settings.wtkey ? "" : "disabled='disabled' ") + "data-mini='true' id='o31'>", d = 0; d < getAdjustmentName("length"); d++)e += "<option " + (d === getAdjustmentMethod() ? "selected" : "") + " value='" + d + "'>" + getAdjustmentName(d) + "</option>"; if (e += "</select></div>", "object" == typeof controller.settings.wto && (e += "<div class='ui-field-contain" + (0 === getAdjustmentMethod() ? " hidden" : "") + "'><label for='wto'>" + _("Adjustment Method Options") + "</label><button data-mini='true' id='wto' value='" + escapeJSON(controller.settings.wto) + "'>" + _("Tap to Configure") + "</button></div>"), checkOSVersion(214)) { for (e += "<div class='ui-field-contain'><label for='weatherRestriction' class='select'>" + _("Weather-Based Restrictions") + "<button data-helptext='" + _("Prevents watering when the selected restriction is met.") + "' class='help-icon btn-no-border ui-btn ui-icon-info ui-btn-icon-notext'></button></label><select " + (controller.settings.wtkey && "" !== controller.settings.wtkey ? "" : "disabled='disabled' ") + "data-mini='true' class='noselect' id='weatherRestriction'>", d = 0; d < 2; d++) { var i = getRestriction(d); e += "<option " + (i.isCurrent === !0 ? "selected" : "") + " value='" + d + "'>" + i.name + "</option>" } e += "</select></div>" } } if ("undefined" != typeof controller.options.wl && (e += "<div class='ui-field-contain duration-field'><label for='o23'>" + _("% Watering") + "<button data-helptext='" + _("The watering percentage scales station run times by the set value. When weather adjustment is used the watering percentage is automatically adjusted.") + "' class='help-icon btn-no-border ui-btn ui-icon-info ui-btn-icon-notext'></button></label><button " + (controller.options.uwt && getAdjustmentMethod() > 0 ? "disabled='disabled' " : "") + "data-mini='true' id='o23' value='" + controller.options.wl + "'>" + controller.options.wl + "%</button></div>"), "undefined" != typeof controller.options.urs && (e += "undefined" != typeof controller.options.fpr0 ? "<div class='ui-field-contain'><fieldset data-role='controlgroup' class='ui-mini center' data-type='horizontal'><legend class='left'>" + _("Attached Sensor Type") + "</legend><input class='noselect' type='radio' name='o21' id='o21-none' value='0'" + (0 === controller.options.urs ? " checked='checked'" : "") + "><label for='o21-none'>" + _("None") + "</label><input class='noselect' type='radio' name='o21' id='o21-rain' value='1'" + (1 === controller.options.urs ? " checked='checked'" : "") + "><label for='o21-rain'>" + _("Rain") + "</label><input class='noselect' type='radio' name='o21' id='o21-flow' value='2'" + (2 === controller.options.urs ? " checked='checked'" : "") + "><label for='o21-flow'>" + _("Flow") + "</label>" + (checkOSVersion(217) ? "<input class='noselect' type='radio' name='o21' id='o21-program' value='240'" + (240 === controller.options.urs ? " checked='checked'" : "") + "><label for='o21-program'>" + _("Program Switch") + "</label>" : "") + "</fieldset></div>" + (checkOSVersion(217) ? "<label id='prgswitch' class='center smaller" + (240 === controller.options.urs ? "" : " hidden") + "'>" + _("When using program switch, a switch is connected to the sensor port to trigger Program 1 every time the switch is pressed for at least 1 second.") + "</label>" : "") : "<label for='o21'><input data-mini='true' id='o21' type='checkbox' " + (1 === controller.options.urs ? "checked='checked'" : "") + ">" + _("Use Rain Sensor") + "</label>"),
        "undefined" != typeof controller.options.rso && (e += "<label for='o22'><input " + (1 === controller.options.urs ? "" : "data-wrapper-class='hidden' ") + "data-mini='true' id='o22' type='checkbox' " + (1 === controller.options.rso ? "checked='checked'" : "") + ">" + _("Normally Open (Rain Sensor)") + "</label>"), "undefined" != typeof controller.options.fpr0 && (e += "<div class='ui-field-contain" + (2 === controller.options.urs ? "" : " hidden") + "'><label for='o41'>" + _("Flow Pulse Rate") + "</label><table><tr style='width:100%;vertical-align: top;'><td style='width:100%'><div class='ui-input-text controlgroup-textinput ui-btn ui-body-inherit ui-corner-all ui-mini ui-shadow-inset ui-input-has-clear'><input data-role='none' data-mini='true' type='number' pattern='^[-+]?[0-9]*.?[0-9]*$' id='o41' value='" + (256 * controller.options.fpr1 + controller.options.fpr0) / 100 + "'></div></td><td class='tight-select'><select id='o41-units' class='noselect' data-mini='true'><option selected='selected' value='liter'>L/pulse</option><option value='gallon'>Gal/pulse</option></select></td></tr></table></div>"), "undefined" != typeof controller.settings.ifkey && (e += "</fieldset><fieldset data-role='collapsible'" + ("string" == typeof a && "integrations" === a ? " data-collapsed='false'" : "") + "><legend>" + _("Integrations") + "</legend>", e += "<div class='ui-field-contain'><label for='ifkey'>" + _("IFTTT Key") + "<button data-helptext='" + _("To enable IFTTT, a Maker channel key is required which can be obtained from https://ifttt.com") + "' class='help-icon btn-no-border ui-btn ui-icon-info ui-btn-icon-notext'></button></label><input autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' data-mini='true' type='text' id='ifkey' value='" + controller.settings.ifkey + "'></div>", e += "<div class='ui-field-contain'><label for='o49'>" + _("IFTTT Events") + "<button data-helptext='" + _("Select which events to send to IFTTT for use in recipes.") + "' class='help-icon btn-no-border ui-btn ui-icon-info ui-btn-icon-notext'></button></label><button data-mini='true' id='o49' value='" + controller.options.ife + "'>Configure Events</button></div>"), e += "</fieldset><fieldset class='full-width-slider' data-role='collapsible'" + ("string" == typeof a && "lcd" === a ? " data-collapsed='false'" : "") + "><legend>" + _("LCD Screen") + "</legend>", "undefined" != typeof controller.options.con && (e += "<div class='ui-field-contain'><label for='o27'>" + _("Contrast") + "</label><input type='range' id='o27' min='0' max='255' step='10' data-highlight='true' value='" + controller.options.con + "'></div>"), "undefined" != typeof controller.options.lit && (e += "<div class='ui-field-contain'><label for='o28'>" + _("Brightness") + "</label><input type='range' id='o28' min='0' max='255' step='10' data-highlight='true' value='" + controller.options.lit + "'></div>"), "undefined" != typeof controller.options.dim && (e += "<div class='ui-field-contain'><label for='o29'>" + _("Idle Brightness") + "</label><input type='range' id='o29' min='0' max='255' step='10' data-highlight='true' value='" + controller.options.dim + "'></div>"), e += "</fieldset><fieldset data-role='collapsible' data-theme='b'" + ("string" == typeof a && "advanced" === a ? " data-collapsed='false'" : "") + "><legend>" + _("Advanced") + "</legend>", "undefined" != typeof controller.options.hp0 && (e += "<div class='ui-field-contain'><label for='o12'>" + _("HTTP Port (restart required)") + "</label><input data-mini='true' type='number' pattern='[0-9]*' id='o12' value='" + (256 * controller.options.hp1 + controller.options.hp0) + "'></div>"), "undefined" != typeof controller.options.devid && (e += "<div class='ui-field-contain'><label for='o26'>" + _("Device ID (restart required)") + "<button data-helptext='" + _("Device ID modifies the last byte of the MAC address.") + "' class='help-icon btn-no-border ui-btn ui-icon-info ui-btn-icon-notext'></button></label><input data-mini='true' type='number' pattern='[0-9]*' max='255' id='o26' value='" + controller.options.devid + "'></div>"), "undefined" != typeof controller.options.rlp ? e += "<div class='ui-field-contain duration-field'><label for='o30'>" + _("Relay Pulse") + "<button data-helptext='" + _("Relay pulsing is used for special situations where rapid pulsing is needed in the output with a range from 1 to 2000 milliseconds. A zero value disables the pulsing option.") + "' class='help-icon btn-no-border ui-btn ui-icon-info ui-btn-icon-notext'></button></label><button data-mini='true' id='o30' value='" + controller.options.rlp + "'>" + controller.options.rlp + "ms</button></div>" : checkOSVersion(215) !== !0 && "undefined" != typeof controller.options.bst && (e += "<div class='ui-field-contain duration-field'><label for='o30'>" + _("Boost Time") + "<button data-helptext='" + _("Boost time changes how long the boost converter is activated with a range from 0 to 1000 milliseconds.") + "' class='help-icon btn-no-border ui-btn ui-icon-info ui-btn-icon-notext'></button></label><button data-mini='true' id='o30' value='" + controller.options.bst + "'>" + controller.options.bst + "ms</button></div>"), "undefined" != typeof controller.options.ntp && checkOSVersion(210)) { var j = [controller.options.ntp1, controller.options.ntp2, controller.options.ntp3, controller.options.ntp4].join("."); e += "<div class='" + (1 === controller.options.ntp ? "" : "hidden ") + "ui-field-contain duration-field'><label for='ntp_addr'>" + _("NTP IP Address") + "</label><button data-mini='true' id='ntp_addr' value='" + j + "'>" + j + "</button></div>" } if ("undefined" != typeof controller.options.dhcp && checkOSVersion(210)) { var k = [controller.options.ip1, controller.options.ip2, controller.options.ip3, controller.options.ip4].join("."), l = [controller.options.gw1, controller.options.gw2, controller.options.gw3, controller.options.gw4].join("."); if (e += "<div class='" + (1 === controller.options.dhcp ? "hidden " : "") + "ui-field-contain duration-field'><label for='ip_addr'>" + _("IP Address") + "</label><button data-mini='true' id='ip_addr' value='" + k + "'>" + k + "</button></div>", e += "<div class='" + (1 === controller.options.dhcp ? "hidden " : "") + "ui-field-contain duration-field'><label for='gateway'>" + _("Gateway Address") + "</label><button data-mini='true' id='gateway' value='" + l + "'>" + l + "</button></div>", controller.options.dns1) { var m = [controller.options.dns1, controller.options.dns2, controller.options.dns3, controller.options.dns4].join("."); e += "<div class='" + (1 === controller.options.dhcp ? "hidden " : "") + "ui-field-contain duration-field'><label for='dns'>" + _("DNS Address") + "</label><button data-mini='true' id='dns' value='" + m + "'>" + m + "</button></div>" } e += "<label for='o3'><input data-mini='true' id='o3' type='checkbox' " + (1 === controller.options.dhcp ? "checked='checked'" : "") + ">" + _("Use DHCP (restart required)") + "</label>" } "undefined" != typeof controller.options.ntp && (e += "<label for='o2'><input data-mini='true' id='o2' type='checkbox' " + (1 === controller.options.ntp ? "checked='checked'" : "") + ">" + _("NTP Sync") + "</label>"), "undefined" != typeof controller.options.ar && (e += "<label for='o14'><input data-mini='true' id='o14' type='checkbox' " + (1 === controller.options.ar ? "checked='checked'" : "") + ">" + _("Auto Reconnect") + "</label>"), "undefined" != typeof controller.options.ipas && (e += "<label for='o25'><input data-mini='true' id='o25' type='checkbox' " + (1 === controller.options.ipas ? "checked='checked'" : "") + ">" + _("Ignore Password") + "</label>"), "undefined" != typeof controller.options.sar && (e += "<label for='o48'><input data-mini='true' id='o48' type='checkbox' " + (1 === controller.options.sar ? "checked='checked'" : "") + ">" + _("Special Station Auto-Refresh") + "</label>"), e += "</fieldset><fieldset data-role='collapsible' data-theme='b'" + ("string" == typeof a && "reset" === a ? " data-collapsed='false'" : "") + "><legend>" + _("Reset") + "</legend>", e += "<button data-mini='true' class='center-div reset-log'>" + _("Clear Log Data") + "</button>", e += "<button data-mini='true' class='center-div reset-options'>" + _("Reset All Options") + "</button>", e += "<button data-mini='true' class='center-div reset-stations'>" + _("Reset All Station Data") + "</button>", e += "</fieldset>", f.find("#os-options-list").html(e).one("change input", function () { h.eq(2).prop("disabled", !1), f.find(".submit").addClass("hasChanges") }).find("fieldset").each(function () { var a = $(this); 1 === a.children().length && a.remove() }), f.find(".clear-loc").on("click", function (a) { a.stopImmediatePropagation(), areYouSure(_("Are you sure you want to clear the current location?"), "", function () { f.find("#loc").val("''").removeClass("green").find("span").text(_("Not specified")), f.find("#o1").selectmenu("enable"), h.eq(2).prop("disabled", !1), f.find(".submit").addClass("hasChanges") }) }), f.find("#loc").on("click", function () { $.mobile.loading("show"); var a = $(this); a.prop("disabled", !0), overlayMap(function (b, c) { b === !1 ? "" === a.val() && (a.removeClass("green"), f.find("#o1").selectmenu("enable")) : (checkOSVersion(210) && f.find("#o1").selectmenu("disable"), "string" == typeof b ? a.val(b).find("span").text(b) : (b[0] = parseFloat(b[0]).toFixed(5), b[1] = parseFloat(b[1]).toFixed(5), "string" == typeof c ? a.val(c) : a.val(b), coordsToLocation(b[0], b[1], function (b) { a.find("span").text(b) })), validateWULocation(b, function (b) { b ? a.addClass("green") : b || a.removeClass("green") }), h.eq(2).prop("disabled", !1), f.find(".submit").addClass("hasChanges")), a.prop("disabled", !1) }) }), f.find("#wto").on("click", function () { var a = parseInt(f.find("#o31").val()), b = function () { h.eq(2).prop("disabled", !1), f.find(".submit").addClass("hasChanges") }; 1 === a ? showZimmermanAdjustmentOptions(this, b) : 2 === a && showAutoRainDelayAdjustmentOptions(this, b) }), f.find(".reset-log").on("click", clearLogs), f.find(".reset-options").on("click", function () { areYouSure(_("Are you sure you want to delete all settings and return to the default settings?"), "", function () { var a; a = isOSPi() ? "otz=32&ontp=1&onbrd=0&osdt=0&omas=0&omton=0&omtoff=0&orst=1&owl=100&orlp=0&ouwt=0&olg=1&oloc=Boston,MA" : "o1=32&o2=1&o3=1&o12=80&o13=0&o15=0&o17=0&o18=0&o19=0&o20=0&o22=1&o23=100&o26=0&o27=110&o28=100&o29=15&o30=0&o31=0&o32=50&o33=97&o34=210&o35=169&o36=1&o37=0&038=0&o39=0&loc=Boston,MA", sendToOS("/co?pw=&" + a).done(function () { $.mobile.document.one("pageshow", function () { showerror(_("Settings have been saved")) }), goBack(), updateController(updateWeather) }) }) }), f.find(".reset-stations").on("click", function () { for (var a = "", b = 0; b < controller.stations.snames.length; b++)a += "s" + b + "=S" + pad(b + 1) + "&"; if (controller.options.mas) for (b = 0; b < controller.settings.nbrd; b++)a += "m" + b + "=255&"; if ("object" == typeof controller.stations.ignore_rain) for (b = 0; b < controller.settings.nbrd; b++)a += "i" + b + "=0&"; if ("object" == typeof controller.stations.act_relay) for (b = 0; b < controller.settings.nbrd; b++)a += "a" + b + "=0&"; if ("object" == typeof controller.stations.stn_dis) for (b = 0; b < controller.settings.nbrd; b++)a += "d" + b + "=0&"; if ("object" == typeof controller.stations.stn_seq) for (b = 0; b < controller.settings.nbrd; b++)a += "q" + b + "=255&"; areYouSure(_("Are you sure you want to reset all stations?"), _("This will reset all station names and attributes"), function () { $.mobile.loading("show"), storage.get(["sites", "current_site"], function (a) { var b = parseSites(a.sites); b[a.current_site].notes = {}, b[a.current_site].images = {}, b[a.current_site].lastRunTime = {}, storage.set({ sites: JSON.stringify(b) }, cloudSaveSites) }), sendToOS("/cs?pw=&" + a).done(function () { showerror(_("Stations have been updated")), updateController() }) }) }), f.find("#o3").on("change", function () { var a = $(this), b = a.is(":checked"), c = f.find("#ip_addr,#gateway,#dns").parents(".ui-field-contain"); b ? c.addClass("hidden") : c.removeClass("hidden") }), f.find("#o21,input[name='o21'][type='radio']").on("change", function () { var a = $(this), b = "o21" === a.attr("id") ? a.is(":checked") : "1" === a.val(); b ? f.find("#o22").parent().removeClass("hidden") : f.find("#o22").parent().addClass("hidden"), "2" === a.val() ? f.find("#o41").parents(".ui-field-contain").removeClass("hidden") : f.find("#o41").parents(".ui-field-contain").addClass("hidden"), "240" === a.val() ? f.find("#prgswitch").removeClass("hidden") : f.find("#prgswitch").addClass("hidden") }), f.find("#verify-api").on("click", function () { var a = f.find("#wtkey"), b = $(this); b.prop("disabled", !0), testAPIKey(a.val(), function (c) { c === !0 ? (a.parent().find(".ui-icon-alert").hide(), a.parent().removeClass("red").addClass("green")) : (a.parent().find(".ui-icon-alert").removeClass("hidden").show(), a.parent().removeClass("green").addClass("red")), b.prop("disabled", !1) }) }), f.find(".help-icon").on("click", showHelpText), f.find(".duration-field button:not(.help-icon)").on("click", function () { var a = $(this), b = a.attr("id"), c = f.find("label[for='" + b + "']").text(), d = a.parent().find(".help-icon").data("helptext"), e = 240; if (h.eq(2).prop("disabled", !1), f.find(".submit").addClass("hasChanges"), "ip_addr" === b || "gateway" === b || "dns" === b || "ntp_addr" === b) showIPRequest({ title: c, ip: a.val().split("."), callback: function (b) { a.val(b.join(".")).text(b.join(".")) } }); else if ("o19" === b || "o38" === b) showSingleDurationInput({ data: a.val(), title: c, callback: function (b) { a.val(b).text(b + "s") }, label: _("Seconds"), maximum: 60, helptext: d }); else if ("o30" === b) showSingleDurationInput({ data: a.val(), title: c, callback: function (b) { a.val(b).text(b + "ms") }, label: _("Milliseconds"), maximum: 2e3, helptext: d }); else if ("o20" === b || "o39" === b) showSingleDurationInput({ data: a.val(), title: c, callback: function (b) { a.val(b).text(b + "s") }, label: _("Seconds"), maximum: checkOSVersion(217) ? 0 : 60, minimum: -60, helptext: d }); else if ("o23" === b) showSingleDurationInput({ data: a.val(), title: c, callback: function (b) { a.val(b).text(b + "%") }, label: _("% Watering"), maximum: 250, helptext: d }); else if ("o17" === b) { var g = 0; checkOSVersion(210) && (e = checkOSVersion(214) ? 57600 : 64800), checkOSVersion(211) && (g = -3540, e = 3540), checkOSVersion(217) && (g = -600, e = 600), showSingleDurationInput({ data: a.val(), title: c, label: _("Seconds"), callback: function (b) { a.val(b), a.text(dhms2str(sec2dhms(b))) }, maximum: e, minimum: g }) } return !1 }), f.find("#o2").on("change", function () { var a = $(this).is(":checked"); f.find(".datetime-input button").prop("disabled", a), f.find("#ntp_addr").parents(".ui-field-contain").toggleClass("hidden", !a) }), f.find("#o18,#o37").on("change", function () { f.find("#o19,#o20").parents(".ui-field-contain").toggle(0 !== parseInt(f.find("#o18").val())), "undefined" != typeof controller.options.mas2 && f.find("#o38,#o39").parents(".ui-field-contain").toggle(0 !== parseInt(f.find("#o37").val())) }), f.find("#o31").on("change", function () { f.find("#o23").prop("disabled", 0 !== parseInt(this.value) && "" !== f.find("#wtkey").val()), f.find("#wto").parents(".ui-field-contain").toggleClass("hidden", 0 === parseInt(this.value)) }), f.find("#wtkey").on("change input", function () { f.find("#wtkey").siblings(".help-icon").hide(), f.find("#wtkey").parent().removeClass("red green"), "" === this.value ? (f.find("#wto").parents(".ui-field-contain").toggleClass("hidden", !0), f.find("#o31,#weatherRestriction").val("0").selectmenu("refresh").selectmenu("disable"), f.find("#o23").prop("disabled", !1)) : f.find("#o31,#weatherRestriction").selectmenu("enable") }), f.find("#o49").on("click", function () { var a = { program: _("Program Start"), rain: _("Rain Sensor Update"), flow: _("Flow Sensor Update"), weather: _("Weather Adjustment Update"), reboot: _("Controller Reboot"), run: _("Station Run") }, b = this, c = parseInt(b.value), d = "", e = 0, g = 0; $.each(a, function (a, b) { d += "<label for='ifttt-" + a + "'><input class='needsclick' data-iconpos='right' id='ifttt-" + a + "' type='checkbox' " + (getBitFromByte(c, e) ? "checked='checked'" : "") + ">" + b + "</label>", e++ }); var i = $("<div data-role='popup' data-theme='a'><div data-role='controlgroup' data-mini='true' class='tight'><div class='ui-bar ui-bar-a'>" + _("Select IFTTT Events") + "</div>" + d + "<input data-wrapper-class='attrib-submit' class='submit' data-theme='b' type='submit' value='" + _("Submit") + "' /></div></div>"); i.find(".submit").on("click", function () { e = 0, $.each(a, function (a) { g |= i.find("#ifttt-" + a).is(":checked") << e, e++ }), i.popup("close"), c !== g && (b.value = g, h.eq(2).prop("disabled", !1), f.find(".submit").addClass("hasChanges")) }), openPopup(i) }), f.find(".datetime-input").on("click", function () { var a = $(this).find("button"); if (!a.prop("disabled")) return h.eq(2).prop("disabled", !1), f.find(".submit").addClass("hasChanges"), showDateTimeInput(a.val(), function (b) { a.text(dateToString(b).slice(0, -3)).val(Math.round(b.getTime() / 1e3)) }), !1 }), f.one("pagehide", function () { f.remove() }), h.eq(2).prop("disabled", !0), $("#os-options").remove(), $.mobile.pageContainer.append(f)
} function showGuidedSetup() { } function isStationMaster(a) { var b = "number" == typeof controller.options.mas ? controller.options.mas : 0, c = "number" == typeof controller.options.mas2 ? controller.options.mas2 : 0; return a++ , b === a ? 1 : c === a ? 2 : 0 } function isStationDisabled(a) { return "object" == typeof controller.stations.stn_dis && (controller.stations.stn_dis[parseInt(a / 8)] & 1 << a % 8) > 0 } function isStationSpecial(a) { return "object" == typeof controller.stations.stn_spe && (controller.stations.stn_spe[parseInt(a / 8)] & 1 << a % 8) > 0 } function isStationSequential(a) { return "object" == typeof controller.stations.stn_seq ? (controller.stations.stn_seq[parseInt(a / 8)] & 1 << a % 8) > 0 : controller.options.seq } function parseRemoteStationData(a) { a = a.split(""); for (var b, c = [], d = {}, e = 0; e < 8; e++)b = parseInt(a[e] + a[e + 1], 16) || 0, c.push(b), e++; return d.ip = c.join("."), d.port = parseInt(a[8] + a[9] + a[10] + a[11], 16), d.station = parseInt(a[12] + a[13], 16), d } function verifyRemoteStation(a, b) { a = parseRemoteStationData(a), $.ajax({ url: "http://" + a.ip + ":" + a.port + "/jo?pw=" + encodeURIComponent(currPass), type: "GET", dataType: "json" }).then(function (a) { b("object" == typeof a && a.hasOwnProperty("fwv") ? 1 === Object.keys(a).length ? -2 : a.hasOwnProperty("re") && 0 !== a.re ? !0 : -3 : -1) }, function () { b(!1) }) } function convertRemoteToExtender(a) { a = parseRemoteStationData(a), $.ajax({ url: "http://" + a.ip + ":" + a.port + "/cv?re=1&pw=" + encodeURIComponent(currPass), type: "GET", dataType: "json" }) } function refreshStatus() { if (isControllerConnected()) { var a = function () { $("html").trigger("datarefresh"), checkStatus() }; checkOSVersion(216) ? updateController(a, networkFail) : $.when(updateControllerStatus(), updateControllerSettings(), updateControllerOptions()).then(a, networkFail) } } function refreshData() { isControllerConnected() && (checkOSVersion(216) ? updateController(null, networkFail) : $.when(updateControllerPrograms(), updateControllerStations()).fail(networkFail)) } function changeStatus(a, b, c, d) { var e = $("#footer-running"), f = ""; d = d || function () { }, a > 1 && (timers.statusbar = { val: a, type: "statusbar", update: function () { $("#countdown").text("(" + sec2hms(this.val) + " " + _("remaining") + ")") } }), isControllerConnected() && "undefined" != typeof controller.settings.curr && (f += _("Current") + ": " + controller.settings.curr + " mA "), isControllerConnected() && 2 === controller.options.urs && "undefined" != typeof controller.settings.flcrt && "undefined" != typeof controller.settings.flwrt && (f += "<span style='padding-left:5px'>" + _("Flow") + ": " + (flowCountToVolume(controller.settings.flcrt) / (controller.settings.flwrt / 60)).toFixed(2) + " L/min</span>"), f = "" !== f ? c + "<p class='running-text smaller center'>" + f + "</p>" : c, e.removeClass().addClass(b).html(f).off("click").on("click", d) } function checkStatus() { var a, b, c, d, e, f, g, h, i; if (!isControllerConnected()) return void changeStatus(0, "transparent", "<p class='running-text smaller'></p>"); if (1 === controller.options.re) return void changeStatus(0, "red", "<p class='running-text center pointer'>" + _("Configured as Extender") + "</p>", function () { areYouSure(_("Do you wish to disable extender mode?"), "", function () { showLoading("#footer-running"), sendToOS("/cv?pw=&re=0").done(function () { updateController() }) }) }); if (!controller.settings.en) return void changeStatus(0, "red", "<p class='running-text center pointer'>" + _("System Disabled") + "</p>", function () { areYouSure(_("Do you want to re-enable system operation?"), "", function () { showLoading("#footer-running"), sendToOS("/cv?pw=&en=1").done(function () { updateController() }) }) }); for (a = {}, i = 0; i < controller.status.length; i++)controller.status[i] && !isStationMaster(i) && (a[i] = controller.status[i]); if (Object.keys(a).length >= 2) { b = 0; for (i in a) a.hasOwnProperty(i) && (h = controller.settings.ps[i][1], h > b && (b = h)); return c = Object.keys(a)[0], d = controller.settings.ps[c][0], e = pidname(d), f = "<div><div class='running-icon'></div><div class='running-text pointer'>", f += e + " " + _("is running on") + " " + Object.keys(a).length + " " + _("stations") + " ", b > 0 && (f += "<span id='countdown' class='nobr'>(" + sec2hms(b) + " " + _("remaining") + ")</span>"), f += "</div></div>", void changeStatus(b, "green", f, goHome) } for (g = !1, i = 0; i < controller.stations.snames.length; i++)if (controller.settings.ps[i] && controller.settings.ps[i][0] && controller.status[i] && !isStationMaster(i)) { g = !0, d = controller.settings.ps[i][0], e = pidname(d), f = "<div><div class='running-icon'></div><div class='running-text pointer'>", f += e + " " + _("is running on station") + " <span class='nobr'>" + controller.stations.snames[i] + "</span> ", controller.settings.ps[i][1] > 0 && (f += "<span id='countdown' class='nobr'>(" + sec2hms(controller.settings.ps[i][1]) + " " + _("remaining") + ")</span>"), f += "</div></div>"; break } if (g) return void changeStatus(controller.settings.ps[i][1], "green", f, goHome); if (controller.settings.rd) return void changeStatus(0, "red", "<p class='running-text center pointer'>" + _("Rain delay until") + " " + dateToString(new Date(1e3 * controller.settings.rdst)) + "</p>", function () { areYouSure(_("Do you want to turn off rain delay?"), "", function () { showLoading("#footer-running"), sendToOS("/cv?pw=&rd=0").done(function () { updateController() }) }) }); if (1 === controller.options.urs && 1 === controller.settings.rs) return void changeStatus(0, "red", "<p class='running-text center'>" + _("Rain detected") + "</p>"); if (1 === controller.settings.mm) return void changeStatus(0, "red", "<p class='running-text center pointer'>" + _("Manual mode enabled") + "</p>", function () { areYouSure(_("Do you want to turn off manual mode?"), "", function () { showLoading("#footer-running"), sendToOS("/cv?pw=&mm=0").done(function () { updateController() }) }) }); var j = controller.settings.lrun[2]; if (0 !== j) { var k = controller.settings.lrun[1]; return e = pidname(k), void changeStatus(0, "transparent", "<p class='running-text smaller center pointer'>" + e + " " + _("last ran station") + " " + controller.stations.snames[controller.settings.lrun[0]] + " " + _("for") + " " + (j / 60 >> 0) + "m " + j % 60 + "s " + _("on") + " " + dateToString(new Date(1e3 * (controller.settings.lrun[3] - j))) + "</p>", goHome) } changeStatus(0, "transparent", "<p class='running-text smaller center pointer'>" + _("System Idle") + "</p>", goHome) } function calculateTotalRunningTime(a) { var b = 0, c = 0; return $.each(controller.stations.snames, function (d) { var e = a[d]; isStationSequential(d) ? b += e : e > c && (c = e) }), Math.max(b, c) } function updateTimers() { var a = (new Date).getTime(); setInterval(function () { if (!isControllerConnected()) return !1; var b = (new Date).getTime(), c = b - a; if (c > 2e3 && (checkStatus(), refreshStatus()), a = b, !$.isEmptyObject(timers)) for (var d in timers) timers.hasOwnProperty(d) && (timers[d].val <= 0 ? ("statusbar" === d && (showLoading("#footer-running"), refreshStatus()), "function" == typeof timers[d].done && timers[d].done(), delete timers[d]) : "clock" === d ? (++timers[d].val, timers[d].update()) : "statusbar" !== d && "number" != typeof timers[d].station || (--timers[d].val, timers[d].update())) }, 1e3) } function removeStationTimers() { for (var a in timers) timers.hasOwnProperty(a) && "clock" !== a && delete timers[a] } function submitRunonce(a) { a instanceof Array || (a = [], $("#runonce").find("[id^='zone-']").each(function () { a.push(parseInt(this.value) || 0) }), a.push(0)); var b = function () { $.mobile.loading("show"), storage.set({ runonce: JSON.stringify(a) }), sendToOS("/cr?pw=&t=" + JSON.stringify(a)).done(function () { $.mobile.loading("hide"), $.mobile.document.one("pageshow", function () { showerror(_("Run-once program has been scheduled")) }), refreshStatus(), goBack() }) }, c = isRunning(); c !== -1 ? areYouSure(_("Do you want to stop the currently running program?"), pidname(controller.settings.ps[c][0]), function () { $.mobile.loading("show"), stopStations(b) }) : b() } function getStationDuration(a, b) { if (checkOSVersion(214)) { var c = getSunTimes(b); 65535 === a ? a = 60 * (c[0] + 1440 - c[1]) : 65534 === a && (a = 60 * (c[1] - c[0])) } return a } function clearLogs(a) { areYouSure(_("Are you sure you want to clear ALL your log data?"), "", function () { var b = isOSPi() ? "/cl?pw=" : "/dl?pw=&day=all"; $.mobile.loading("show"), sendToOS(b).done(function () { "function" == typeof a && a(), showerror(_("Logs have been cleared")) }) }) } function expandProgram(a) { var b = parseInt(a.attr("id").split("-")[1]); a.find(".ui-collapsible-content").html(makeProgram(b)).enhanceWithin().on("change input click", function (b) { "click" === b.type && "BUTTON" !== b.target.tagName || ($(this).off("change input click"), a.find("[id^='submit-']").addClass("hasChanges")) }), a.find("[id^='submit-']").on("click", function () { return submitProgram(b), !1 }), a.find("[id^='delete-']").on("click", function () { return deleteProgram(b), !1 }), a.find("[id^='run-']").on("click", function () { var a = [], c = function () { a.push(0), submitRunonce(a) }; if (checkOSVersion(210)) { if (a = controller.programs.pd[b][4], controller.programs.pd[b][0] >> 1 & 1) return areYouSure(_("Do you wish to apply the current watering level?"), "", function () { for (var b = a.length - 1; b >= 0; b--)a[b] = parseInt(a[b] * (controller.options.wl / 100)); c() }, c), !1 } else { var d = parseInt($("#duration-" + b).val()), e = $("[id^='station_'][id$='-" + b + "']"); $.each(e, function () { $(this).is(":checked") ? a.push(d) : a.push(0) }) } return c(), !1 }) } function readProgram(a) { return checkOSVersion(210) ? readProgram21(a) : readProgram183(a) } function readProgram183(a) { var b = a[1], c = a[2], d = !1, e = !1, f = !1, g = "", h = "", i = {}; i.en = a[0]; for (var j = 0; j < controller.programs.nboards; j++)for (var k = a[7 + j], l = 0; l < 8; l++)h += k & 1 << l ? "1" : "0"; if (i.stations = h, i.duration = a[6], i.start = a[3], i.end = a[4], i.interval = a[5], 128 & b && c > 1) g = [c, 127 & b], f = !0; else { for (var m = 0; m < 7; m++)g += b & 1 << m ? "1" : "0"; 128 & b && 0 === c && (d = !0), 128 & b && 1 === c && (e = !0) } return i.days = g, i.is_even = d, i.is_odd = e, i.is_interval = f, i } function readProgram21(a) { var b = a[1], c = a[2], d = a[0] >> 2 & 3, e = a[0] >> 4 & 3, f = a[0] >> 6 & 1, g = "", h = { repeat: 0, interval: 0 }; if (h.en = a[0] >> 0 & 1, h.weather = a[0] >> 1 & 1, h.is_even = 2 === d, h.is_odd = 1 === d, h.is_interval = 3 === e, h.stations = a[4], h.name = a[5], 0 === f ? (h.start = a[3][0], h.repeat = a[3][1], h.interval = a[3][2]) : 1 === f && (h.start = a[3]), 3 === e) g = [c, b]; else if (0 === e) for (var i = 0; i < 7; i++)g += b & 1 << i ? "1" : "0"; return h.days = g, h } function getStartTime(a, b) { var c = 2047 & a, d = 0, e = getSunTimes(b); if (a < 0) return a; if (a >> 13 & 1) d = 1; else if (1 & !(a >> 14)) return a; return a >> 12 & 1 && (c = -c), a = e[d], a += c, a < 0 ? a = 0 : a > 1440 && (a = 1440), a } function readStartTime(a) { var b = 2047 & a, c = _("Sunrise"); if (a >> 13 & 1) c = _("Sunset"); else if (1 & !(a >> 14)) return minutesToTime(a); return a >> 12 & 1 && (b = -b), c + (0 !== b ? (b > 0 ? "+" : "") + dhms2str(sec2dhms(60 * b)) : "") } function pidname(a) { var b = _("Program") + " " + a; return 255 === a || 99 === a ? b = _("Manual program") : 254 === a || 98 === a ? b = _("Run-once program") : checkOSVersion(210) && a <= controller.programs.pd.length && (b = controller.programs.pd[a - 1][5]), b } function updateProgramHeader() { $("#programs_list").find("[id^=program-]").each(function (a, b) { var c = $(b), d = c.find(".ui-collapsible-heading-toggle"), e = checkOSVersion(210) ? 1 & controller.programs.pd[a][0] : controller.programs.pd[a][0]; e ? d.removeClass("red") : d.addClass("red") }) } function makeAllPrograms() { if (0 === controller.programs.pd.length) return "<p class='center'>" + _("You have no programs currently added. Tap the Add button on the top right corner to get started.") + "</p>"; for (var a, b = "<p class='center'>" + _("Click any program below to expand/edit. Be sure to save changes.") + "</p><div data-role='collapsible-set'>", c = 0; c < controller.programs.pd.length; c++)a = _("Program") + " " + (c + 1), checkOSVersion(210) && (a = controller.programs.pd[c][5]), b += "<fieldset id='program-" + c + "' data-role='collapsible'><h3><a " + (c > 0 ? "" : "style='visibility:hidden' ") + "class='hidden ui-btn ui-btn-icon-notext ui-icon-arrow-u ui-btn-corner-all move-up'></a><a class='ui-btn ui-btn-corner-all program-copy'>" + _("copy") + "</a><span class='program-name'>" + a + "</span></h3>", b += "</fieldset>"; return b + "</div>" } function makeProgram(a, b) { return checkOSVersion(210) ? makeProgram21(a, b) : makeProgram183(a, b) } function makeProgram183(a, b) {
    var c, d, e, f, g, h, i = [_("Monday"), _("Tuesday"), _("Wednesday"), _("Thursday"), _("Friday"), _("Saturday"), _("Sunday")], j = "", k = b ? "new" : a; if (g = "new" === a ? { en: 0, weather: 0, is_interval: 0, is_even: 0, is_odd: 0, duration: 0, interval: 0, start: 0, end: 0, days: [0, 0] } : readProgram(controller.programs.pd[a]), "string" == typeof g.days) for (c = g.days.split(""), d = c.length; d--;)c[d] = 0 | c[d]; else c = [0, 0, 0, 0, 0, 0, 0]; if ("undefined" != typeof g.stations) for (f = g.stations.split(""), d = f.length - 1; d >= 0; d--)f[d] = 0 | f[d]; for (j += "<label for='en-" + k + "'><input data-mini='true' type='checkbox' " + (g.en || "new" === a ? "checked='checked'" : "") + " name='en-" + k + "' id='en-" + k + "'>" + _("Enabled") + "</label>", j += "<fieldset data-role='controlgroup' data-type='horizontal' class='center'>", j += "<input data-mini='true' type='radio' name='rad_days-" + k + "' id='days_week-" + k + "' value='days_week-" + k + "' " + (g.is_interval ? "" : "checked='checked'") + "><label for='days_week-" + k + "'>" + _("Weekly") + "</label>", j += "<input data-mini='true' type='radio' name='rad_days-" + k + "' id='days_n-" + k + "' value='days_n-" + k + "' " + (g.is_interval ? "checked='checked'" : "") + "><label for='days_n-" + k + "'>" + _("Interval") + "</label>", j += "</fieldset><div id='input_days_week-" + k + "' " + (g.is_interval ? "style='display:none'" : "") + ">", j += "<div class='center'><p class='tight'>" + _("Restrictions") + "</p><select data-inline='true' data-iconpos='left' data-mini='true' id='days_rst-" + k + "'>", j += "<option value='none' " + (g.is_even || g.is_odd ? "" : "selected='selected'") + ">" + _("None") + "</option>", j += "<option value='odd' " + (!g.is_even && g.is_odd ? "selected='selected'" : "") + ">" + _("Odd Days Only") + "</option>", j += "<option value='even' " + (!g.is_odd && g.is_even ? "selected='selected'" : "") + ">" + _("Even Days Only") + "</option>", j += "</select></div>", j += "<div class='center'><p class='tight'>" + _("Days of the Week") + "</p><select " + ($.mobile.window.width() > 560 ? "data-inline='true' " : "") + "data-iconpos='left' data-mini='true' multiple='multiple' data-native-menu='false' id='d-" + k + "'><option>" + _("Choose day(s)") + "</option>", e = 0; e < i.length; e++)j += "<option " + (!g.is_interval && c[e] ? "selected='selected'" : "") + " value='" + e + "'>" + i[e] + "</option>"; for (j += "</select></div></div>", j += "<div " + (g.is_interval ? "" : "style='display:none'") + " id='input_days_n-" + k + "' class='ui-grid-a'>", j += "<div class='ui-block-a'><label class='center' for='every-" + k + "'>" + _("Interval (Days)") + "</label><input data-wrapper-class='pad_buttons' data-mini='true' type='number' name='every-" + k + "' pattern='[0-9]*' id='every-" + k + "' value='" + g.days[0] + "'></div>", j += "<div class='ui-block-b'><label class='center' for='starting-" + k + "'>" + _("Starting In") + "</label><input data-wrapper-class='pad_buttons' data-mini='true' type='number' name='starting-" + k + "' pattern='[0-9]*' id='starting-" + k + "' value='" + g.days[1] + "'></div>", j += "</div>", j += "<fieldset data-role='controlgroup'><legend>" + _("Stations:") + "</legend>", e = 0; e < controller.stations.snames.length; e++)j += "<label for='station_" + e + "-" + k + "'><input " + (isStationDisabled(e) ? "data-wrapper-class='station-hidden hidden' " : "") + "data-mini='true' type='checkbox' " + ("undefined" != typeof f && f[e] ? "checked='checked'" : "") + " name='station_" + e + "-" + k + "' id='station_" + e + "-" + k + "'>" + controller.stations.snames[e] + "</label>"; return j += "</fieldset>", j += "<fieldset data-role='controlgroup' data-type='horizontal' class='center'>", j += "<button class='ui-btn ui-mini' name='s_checkall-" + k + "' id='s_checkall-" + k + "'>" + _("Check All") + "</button>", j += "<button class='ui-btn ui-mini' name='s_uncheckall-" + k + "' id='s_uncheckall-" + k + "'>" + _("Uncheck All") + "</button>", j += "</fieldset>", j += "<div class='ui-grid-a'>", j += "<div class='ui-block-a'><label class='center' for='start-" + k + "'>" + _("Start Time") + "</label><button class='timefield pad_buttons' data-mini='true' id='start-" + k + "' value='" + g.start + "'>" + minutesToTime(g.start) + "</button></div>", j += "<div class='ui-block-b'><label class='center' for='end-" + k + "'>" + _("End Time") + "</label><button class='timefield pad_buttons' data-mini='true' id='end-" + k + "' value='" + g.end + "'>" + minutesToTime(g.end) + "</button></div>", j += "</div>", j += "<div class='ui-grid-a'>", j += "<div class='ui-block-a'><label class='pad_buttons center' for='duration-" + k + "'>" + _("Station Duration") + "</label><button class='pad_buttons' data-mini='true' name='duration-" + k + "' id='duration-" + k + "' value='" + g.duration + "'>" + dhms2str(sec2dhms(g.duration)) + "</button></div>", j += "<div class='ui-block-b'><label class='pad_buttons center' for='interval-" + k + "'>" + _("Program Interval") + "</label><button class='pad_buttons' data-mini='true' name='interval-" + k + "' id='interval-" + k + "' value='" + 60 * g.interval + "'>" + dhms2str(sec2dhms(60 * g.interval)) + "</button></div>",
        j += "</div>", b === !0 || "new" === a ? j += "<input data-mini='true' data-icon='check' type='submit' data-theme='b' name='submit-" + k + "' id='submit-" + k + "' value='" + _("Save New Program") + "'>" : (j += "<button data-mini='true' data-icon='check' data-theme='b' name='submit-" + k + "' id='submit-" + k + "'>" + _("Save Changes to Program") + " " + (a + 1) + "</button>", j += "<button data-mini='true' data-icon='arrow-r' name='run-" + k + "' id='run-" + k + "'>" + _("Run Program") + " " + (a + 1) + "</button>", j += "<button data-mini='true' data-icon='delete' class='red bold' data-theme='b' name='delete-" + k + "' id='delete-" + k + "'>" + _("Delete Program") + " " + (a + 1) + "</button>"), h = $(j), h.find("input[name^='rad_days']").on("change", function () { var a, b = $(this).val().split("-")[0]; b = b.split("_")[1], a = "n" === b ? "week" : "n", $("#input_days_" + b + "-" + k).show(), $("#input_days_" + a + "-" + k).hide() }), h.find("[id^='duration-'],[id^='interval-']").on("click", function () { var a = $(this), b = a.attr("id").match("interval") ? 1 : 0, c = h.find("label[for='" + a.attr("id") + "']").text(); showDurationBox({ seconds: a.val(), title: c, callback: function (b) { a.val(b), a.text(dhms2str(sec2dhms(b))) }, maximum: b ? 86340 : 65535, granularity: b }) }), h.find(".timefield").on("click", function () { var a = $(this), b = h.find("label[for='" + a.attr("id") + "']").text(); showTimeInput({ minutes: a.val(), title: b, callback: function (b) { a.val(b), a.text(minutesToTime(b)) } }) }), h.find("[id^='s_checkall-']").on("click", function () { return h.find("[id^='station_'][id$='-" + k + "']").prop("checked", !0).checkboxradio("refresh"), !1 }), h.find("[id^='s_uncheckall-']").on("click", function () { return h.find("[id^='station_'][id$='-" + k + "']").prop("checked", !1).checkboxradio("refresh"), !1 }), fixInputClick(h), h
} function makeProgram21(a, b) { var c, d, e, f, g, h, i, j, k = [_("Monday"), _("Tuesday"), _("Wednesday"), _("Thursday"), _("Friday"), _("Saturday"), _("Sunday")], l = "", m = b ? "new" : a; if (f = "new" === a ? { name: "", en: 0, weather: 0, is_interval: 0, is_even: 0, is_odd: 0, interval: 0, start: 0, days: [0, 0], repeat: 0, stations: [] } : readProgram(controller.programs.pd[a]), "string" == typeof f.days) for (c = f.days.split(""), d = c.length; d--;)c[d] = 0 | c[d]; else c = [0, 0, 0, 0, 0, 0, 0]; for (h = "object" == typeof f.start ? f.start : [f.start, -1, -1, -1], l += "<div style='margin-top:5px' class='ui-corner-all'>", l += "<div class='ui-bar ui-bar-a'><h3>" + _("Basic Settings") + "</h3></div>", l += "<div class='ui-body ui-body-a center'>", l += "<label for='name-" + m + "'>" + _("Program Name") + "</label><input data-mini='true' type='text' name='name-" + m + "' id='name-" + m + "' maxlength='" + controller.programs.pnsize + "' placeholder='" + _("Program") + " " + (controller.programs.pd.length + 1) + "' value='" + f.name + "'>", l += "<label for='en-" + m + "'><input data-mini='true' type='checkbox' " + (f.en || "new" === a ? "checked='checked'" : "") + " name='en-" + m + "' id='en-" + m + "'>" + _("Enabled") + "</label>", l += "<label for='uwt-" + m + "'><input data-mini='true' type='checkbox' " + (f.weather ? "checked='checked'" : "") + " name='uwt-" + m + "' id='uwt-" + m + "'>" + _("Use Weather Adjustment") + "</label>", l += "<label class='center' for='start_1-" + m + "'>" + _("Start Time") + "</label><button class='timefield' data-mini='true' id='start_1-" + m + "' value='" + h[0] + "'>" + readStartTime(h[0]) + "</button>", l += "</div></div></div></div>", l += "<div style='margin-top:10px' class='ui-corner-all'>", l += "<div class='ui-bar ui-bar-a'><h3>" + _("Program Type") + "</h3></div>", l += "<div class='ui-body ui-body-a'>", l += "<fieldset data-role='controlgroup' data-type='horizontal' class='center'>", l += "<input data-mini='true' type='radio' name='rad_days-" + m + "' id='days_week-" + m + "' value='days_week-" + m + "' " + (f.is_interval ? "" : "checked='checked'") + "><label for='days_week-" + m + "'>" + _("Weekly") + "</label>", l += "<input data-mini='true' type='radio' name='rad_days-" + m + "' id='days_n-" + m + "' value='days_n-" + m + "' " + (f.is_interval ? "checked='checked'" : "") + "><label for='days_n-" + m + "'>" + _("Interval") + "</label>", l += "</fieldset>", l += "<div id='input_days_week-" + m + "' " + (f.is_interval ? "style='display:none'" : "") + ">", l += "<div class='center'><p class='tight'>" + _("Days of the Week") + "</p><select " + ($.mobile.window.width() > 560 ? "data-inline='true' " : "") + "data-iconpos='left' data-mini='true' multiple='multiple' data-native-menu='false' id='d-" + m + "'><option>" + _("Choose day(s)") + "</option>", e = 0; e < k.length; e++)l += "<option " + (!f.is_interval && c[e] ? "selected='selected'" : "") + " value='" + e + "'>" + k[e] + "</option>"; l += "</select></div></div>", l += "<div " + (f.is_interval ? "" : "style='display:none'") + " id='input_days_n-" + m + "' class='ui-grid-a'>", l += "<div class='ui-block-a'><label class='center' for='every-" + m + "'>" + _("Interval (Days)") + "</label><input data-wrapper-class='pad_buttons' data-mini='true' type='number' name='every-" + m + "' pattern='[0-9]*' id='every-" + m + "' value='" + f.days[0] + "'></div>", l += "<div class='ui-block-b'><label class='center' for='starting-" + m + "'>" + _("Starting In") + "</label><input data-wrapper-class='pad_buttons' data-mini='true' type='number' name='starting-" + m + "' pattern='[0-9]*' id='starting-" + m + "' value='" + f.days[1] + "'></div>", l += "</div>", l += "<div class='center'><p class='tight'>" + _("Restrictions") + "</p><select data-inline='true' data-iconpos='left' data-mini='true' id='days_rst-" + m + "'>", l += "<option value='none' " + (f.is_even || f.is_odd ? "" : "selected='selected'") + ">" + _("None") + "</option>", l += "<option value='odd' " + (!f.is_even && f.is_odd ? "selected='selected'" : "") + ">" + _("Odd Days Only") + "</option>", l += "<option value='even' " + (!f.is_odd && f.is_even ? "selected='selected'" : "") + ">" + _("Even Days Only") + "</option>", l += "</select></div>", l += "</div></div>", l += "<div style='margin-top:10px' class='ui-corner-all'>", l += "<div class='ui-bar ui-bar-a'><h3>" + _("Stations") + "</h3></div>", l += "<div class='ui-body ui-body-a'>"; var n = $("#programs").hasClass("show-hidden") ? "" : "' style='display:none"; for (e = 0; e < controller.stations.snames.length; e++)isStationMaster(e) ? l += "<div class='ui-field-contain duration-input" + (isStationDisabled(e) ? " station-hidden" + n : "") + "'><label for='station_" + e + "-" + m + "'>" + controller.stations.snames[e] + ":</label><button disabled='true' data-mini='true' name='station_" + e + "-" + m + "' id='station_" + e + "-" + m + "' value='0'>" + _("Master") + "</button></div>" : (i = f.stations[e] || 0, l += "<div class='ui-field-contain duration-input" + (isStationDisabled(e) ? " station-hidden" + n : "") + "'><label for='station_" + e + "-" + m + "'>" + controller.stations.snames[e] + ":</label><button " + (i > 0 ? "class='green' " : "") + "data-mini='true' name='station_" + e + "-" + m + "' id='station_" + e + "-" + m + "' value='" + i + "'>" + getDurationText(i) + "</button></div>"); for (l += "</div></div>", l += "<div style='margin-top:10px' class='ui-corner-all'>", l += "<div class='ui-bar ui-bar-a'><h3>" + _("Additional Start Times") + "</h3></div>", l += "<div class='ui-body ui-body-a'>", l += "<fieldset data-role='controlgroup' data-type='horizontal' class='center'>", l += "<input data-mini='true' type='radio' name='stype-" + m + "' id='stype_repeat-" + m + "' value='stype_repeat-" + m + "' " + ("object" == typeof f.start ? "" : "checked='checked'") + "><label for='stype_repeat-" + m + "'>" + _("Repeating") + "</label>", l += "<input data-mini='true' type='radio' name='stype-" + m + "' id='stype_set-" + m + "' value='stype_set-" + m + "' " + ("object" == typeof f.start ? "checked='checked'" : "") + "><label for='stype_set-" + m + "'>" + _("Fixed") + "</label>", l += "</fieldset>", l += "<div " + ("object" == typeof f.start ? "style='display:none'" : "") + " id='input_stype_repeat-" + m + "'>", l += "<div class='ui-grid-a'>", l += "<div class='ui-block-a'><label class='pad_buttons center' for='interval-" + m + "'>" + _("Repeat Every") + "</label><button class='pad_buttons' data-mini='true' name='interval-" + m + "' id='interval-" + m + "' value='" + 60 * f.interval + "'>" + dhms2str(sec2dhms(60 * f.interval)) + "</button></div>", l += "<div class='ui-block-b'><label class='pad_buttons center' for='repeat-" + m + "'>" + _("Repeat Count") + "</label><button class='pad_buttons' data-mini='true' name='repeat-" + m + "' id='repeat-" + m + "' value='" + f.repeat + "'>" + f.repeat + "</button></div>", l += "</div></div>", l += "<table style='width:100%;" + ("object" == typeof f.start ? "" : "display:none") + "' id='input_stype_set-" + m + "'><tr><th class='center'>" + _("Enable") + "</th><th>" + _("Start Time") + "</th></tr>", e = 1; e < 4; e++)j = h[e] === -1, l += "<tr><td data-role='controlgroup' data-type='horizontal' class='use_master center'><label for='ust_" + (e + 1) + "'><input id='ust_" + (e + 1) + "' type='checkbox' " + (j ? "" : "checked='checked'") + "></label></td>", l += "<td><button class='timefield' data-mini='true' type='time' id='start_" + (e + 1) + "-" + m + "' value='" + (j ? 0 : h[e]) + "'>" + readStartTime(j ? 0 : h[e]) + "</button></td></tr>"; return l += "</table>", l += "</div></div>", b === !0 || "new" === a ? l += "<button data-mini='true' data-icon='check' data-theme='b' id='submit-" + m + "'>" + _("Save New Program") + "</button>" : (l += "<button data-mini='true' data-icon='check' data-theme='b' id='submit-" + m + "'>" + _("Save Changes to") + " <span class='program-name'>" + f.name + "</span></button>", l += "<button data-mini='true' data-icon='arrow-r' id='run-" + m + "'>" + _("Run") + " <span class='program-name'>" + f.name + "</span></button>", l += "<button data-mini='true' data-icon='delete' class='bold red' data-theme='b' id='delete-" + m + "'>" + _("Delete") + " <span class='program-name'>" + f.name + "</span></button>"), g = $(l), g.find("input[name^='rad_days'],input[name^='stype']").on("change", function () { var a = $(this).val().split("-")[0].split("_"); $("[id^='input_" + a[0] + "_']").hide(), $("#input_" + a[0] + "_" + a[1] + "-" + m).show() }), g.find("[id^='interval-']").on("click", function () { var a = $(this), b = g.find("label[for='" + a.attr("id") + "']").text(); showDurationBox({ seconds: a.val(), title: b, callback: function (b) { a.val(b), a.text(dhms2str(sec2dhms(b))) }, maximum: 86340, granularity: 1, preventCompression: !0 }) }), g.find(".timefield").on("click", function () { var a = $(this); showTimeInput({ minutes: a.val(), title: _("Start Time"), showSun: !!checkOSVersion(213), callback: function (b) { a.val(b), a.text(readStartTime(b)) } }) }), g.find("[id^='repeat-']").on("click", function () { var a = $(this), b = g.find("label[for='" + a.attr("id") + "']").text(); showSingleDurationInput({ data: a.val(), title: b, label: _("Repeat Count"), callback: function (b) { a.val(b).text(b) }, maximum: 1440 }) }), g.find("[id^=station_]").on("click", function () { var a = $(this), b = controller.stations.snames[a.attr("id").split("_")[1].split("-")[0]]; showDurationBox({ seconds: a.val(), title: b, callback: function (b) { a.val(b).addClass("green"), a.text(getDurationText(b)), 0 === b && a.removeClass("green") }, maximum: 65535, showSun: !!checkOSVersion(214) }) }), fixInputClick(g), g } function addProgram(a) { a = a >= 0 ? a : "new"; var b = $("<div data-role='page' id='addprogram'><div class='ui-content' role='main' id='newprogram'><fieldset id='program-new'></fieldset></div></div>"), c = function () { return submitProgram("new"), !1 }, d = changeHeader({ title: _("Add Program"), leftBtn: { icon: "carat-l", text: _("Back"), class: "ui-toolbar-back-btn", on: checkChangesBeforeBack }, rightBtn: { icon: "check", text: _("Submit"), on: c } }); b.find("#program-new").html(makeProgram(a, !0)).one("change input", function () { d.eq(2).prop("disabled", !1).addClass("hasChanges") }), b.find("[id^='submit-']").on("click", function () { return submitProgram("new"), !1 }), b.one("pagehide", function () { b.remove() }), "string" == typeof a && d.eq(2).prop("disabled", !0), $("#addprogram").remove(), $.mobile.pageContainer.append(b) } function deleteProgram(a) { var b = pidname(parseInt(a) + 1); areYouSure(_("Are you sure you want to delete program") + " " + b + "?", "", function () { $.mobile.loading("show"), sendToOS("/dp?pw=&pid=" + a).done(function () { $.mobile.loading("hide"), updateControllerPrograms(function () { $("#programs").trigger("programrefresh"), showerror(_("Program") + " " + b + " " + _("deleted")) }) }) }) } function submitProgram(a) { $("#program-" + a).find(".hasChanges").removeClass("hasChanges"), checkOSVersion(210) ? submitProgram21(a) : submitProgram183(a) } function submitProgram183(a) { var b, c, d, e = [], f = [0, 0], g = 0, h = $("#en-" + a).is(":checked") ? 1 : 0; if (e[0] = h, $("#days_week-" + a).is(":checked")) { for (b = $("#d-" + a).val(), b = null === b ? [] : parseIntArray(b), c = 0; c < 7; c++)$.inArray(c, b) !== -1 && (f[0] |= 1 << c); if (0 === f[0]) return void showerror(_("Error: You have not selected any days of the week.")); "odd" === $("#days_rst-" + a).val() ? (f[0] |= 128, f[1] = 1) : "even" === $("#days_rst-" + a).val() && (f[0] |= 128, f[1] = 0) } else if ($("#days_n-" + a).is(":checked")) { if (f[1] = parseInt($("#every-" + a).val(), 10), !(f[1] >= 2 && f[1] <= 128)) return void showerror(_("Error: Interval days must be between 2 and 128.")); if (f[0] = parseInt($("#starting-" + a).val(), 10), !(f[0] >= 0 && f[0] < f[1])) return void showerror(_("Error: Starting in days wrong.")); f[0] |= 128 } if (e[1] = f[0], e[2] = f[1], e[3] = parseInt($("#start-" + a).val()), e[4] = parseInt($("#end-" + a).val()), e[3] > e[4]) return void showerror(_("Error: Start time must be prior to end time.")); e[5] = parseInt($("#interval-" + a).val() / 60); var i = $("[id^=station_][id$=-" + a + "]"), j = i.length, k = j / 8; e[6] = parseInt($("#duration-" + a).val()); var l, m, n = [0]; for (l = 0; l < k; l++)for (n[l] = 0, d = 0; d < 8; d++)m = 8 * l + d, $("#station_" + m + "-" + a).is(":checked") && (n[l] |= 1 << d, g = 1); return e = JSON.stringify(e.concat(n)), 0 === g ? void showerror(_("Error: You have not selected any stations.")) : ($.mobile.loading("show"), void ("new" === a ? sendToOS("/cp?pw=&pid=-1&v=" + e).done(function () { $.mobile.loading("hide"), updateControllerPrograms(function () { $.mobile.document.one("pageshow", function () { showerror(_("Program added successfully")) }), goBack() }) }) : sendToOS("/cp?pw=&pid=" + a + "&v=" + e).done(function () { $.mobile.loading("hide"), updateControllerPrograms(function () { updateProgramHeader() }), showerror(_("Program has been updated")) }))) } function submitProgram21(a, b) { var c, d, e, f, g = [], h = [0, 0], i = [0, 0, 0, 0], j = 0, k = $("#en-" + a).is(":checked") ? 1 : 0, l = $("#uwt-" + a).is(":checked") ? 1 : 0, m = 0; if (m |= k << 0, m |= l << 1, "odd" === $("#days_rst-" + a).val() ? m |= 4 : "even" === $("#days_rst-" + a).val() && (m |= 8), $("#days_n-" + a).is(":checked")) { if (m |= 48, h[1] = parseInt($("#every-" + a).val(), 10), !(h[1] >= 2 && h[1] <= 128)) return void showerror(_("Error: Interval days must be between 2 and 128.")); if (h[0] = parseInt($("#starting-" + a).val(), 10), !(h[0] >= 0 && h[0] < h[1])) return void showerror(_("Error: Starting in days wrong.")) } else if ($("#days_week-" + a).is(":checked")) { for (m |= 0, c = $("#d-" + a).val(), c = null === c ? [] : parseIntArray(c), d = 0; d < 7; d++)$.inArray(d, c) !== -1 && (h[0] |= 1 << d); if (0 === h[0]) return void showerror(_("Error: You have not selected any days of the week.")) } if ($("#stype_repeat-" + a).is(":checked")) m |= 0, i[0] = parseInt($("#start_1-" + a).val()), i[1] = parseInt($("#repeat-" + a).val()), i[2] = parseInt($("#interval-" + a).val() / 60); else if ($("#stype_set-" + a).is(":checked")) { m |= 64; var n = $("[id^='start_'][id$='-" + a + "']"); n.each(function (a, b) { var c = parseInt(b.value); ("number" != typeof c || a > 0 && !$("#ust_" + (a + 1)).is(":checked")) && (c = -1), i[a] = c }) } var o = $("[id^=station_][id$=-" + a + "]"), p = []; return o.each(function () { var a = parseInt(this.value); parseInt(a) > 0 && (j = 1), p.push(a) }), g[0] = m, g[1] = h[0], g[2] = h[1], g[3] = i, g[4] = p, e = $("#name-" + a).val(), f = "&v=" + JSON.stringify(g) + "&name=" + encodeURIComponent(e), 0 === j ? void showerror(_("Error: You have not selected any stations.")) : !b && $("#stype_repeat-" + a).is(":checked") && i[1] > 0 && calculateTotalRunningTime(p) > 60 * i[2] ? void areYouSure(_("Warning: The repeat interval is less than the program run time."), _("Do you want to continue?"), function () { submitProgram21(a, !0) }) : b || 3 !== (m >> 4 & 3) || 1 & h[1] || !((m >> 2 & 3) > 0) ? ($.mobile.loading("show"), void ("new" === a ? sendToOS("/cp?pw=&pid=-1" + f).done(function () { $.mobile.loading("hide"), updateControllerPrograms(function () { $.mobile.document.one("pageshow", function () { showerror(_("Program added successfully")) }), goBack() }) }) : sendToOS("/cp?pw=&pid=" + a + f).done(function () { $.mobile.loading("hide"), updateControllerPrograms(function () { updateProgramHeader(), $("#program-" + a).find(".program-name").text(e) }), showerror(_("Program has been updated")) }))) : void areYouSure(_("Warning: The use of odd/even restrictions with the selected interval day may result in the program not running at all."), _("Do you want to continue?"), function () { submitProgram21(a, !0) }) } function raindelay(a) { return $.mobile.loading("show"), sendToOS("/cv?pw=&rd=" + a / 3600).done(function () { $.mobile.loading("hide"), showLoading("#footer-running"), refreshStatus(), showerror(_("Rain delay has been successfully set")) }), !1 } function getExportMethod() { var a = $("<div data-role='popup' data-theme='a'><div class='ui-bar ui-bar-a'>" + _("Select Export Method") + "</div><div data-role='controlgroup' class='tight'><a class='ui-btn hidden fileMethod'>" + _("File") + "</a><a class='ui-btn pasteMethod'>" + _("Email") + "</a><a class='ui-btn localMethod'>" + _("Internal (within app)") + "</a></div></div>"), b = encodeURIComponent(JSON.stringify(controller)), c = "OpenSprinkler Data Export on " + dateToString(new Date); isFileCapable && a.find(".fileMethod").removeClass("hidden").attr({ href: "data:text/json;charset=utf-8," + b, download: "backup-" + (new Date).toLocaleDateString().replace(/\//g, "-") + ".json" }).on("click", function () { a.popup("close") }); var d = "mailto:?subject=" + encodeURIComponent(c) + "&body=" + b; a.find(".pasteMethod").attr("href", d).on("click", function () { window.open(d), a.popup("close") }), a.find(".localMethod").on("click", function () { a.popup("close"), storage.set({ backup: JSON.stringify(controller) }, function () { showerror(_("Backup saved on this device")) }) }), openPopup(a, { positionTo: $("#sprinklers-settings").find(".export_config") }) } function getImportMethod(a) { var b = function () { var a = $("<div data-role='popup' data-theme='a' id='paste_config'><p class='ui-bar'><textarea class='textarea' rows='10' placeholder='" + _("Paste your backup here") + "'></textarea><button data-mini='true' data-theme='b'>" + _("Import") + "</button></p></div>"), b = $.mobile.window.width(); return a.find("button").on("click", function () { var b = a.find("textarea").val(); if ("" !== b) try { b = JSON.parse($.trim(b).replace(/||/g, '"')), a.popup("close"), importConfig(b) } catch (b) { a.find("textarea").val(""), showerror(_("Unable to read the configuration file. Please check the file and try again.")) } }), a.css("width", b > 600 ? .4 * b + "px" : "100%"), openPopup(a), !1 }, c = $("<div data-role='popup' data-theme='a'><div class='ui-bar ui-bar-a'>" + _("Select Import Method") + "</div><div data-role='controlgroup' class='tight'><button class='hidden fileMethod'>" + _("File") + "</button><button class='pasteMethod'>" + _("Email (copy/paste)") + "</button><button class='hidden localMethod'>" + _("Internal (within app)") + "</button></div></div>"); if (isFileCapable) c.find(".fileMethod").removeClass("hidden").on("click", function () { c.popup("close"); var a = $("<input type='file' id='configInput' data-role='none' style='visibility:hidden;position:absolute;top:-50px;left:-50px'/>").on("change", function () { var a = this.files[0], b = new FileReader; "object" == typeof a && (b.onload = function (a) { try { var b = JSON.parse($.trim(a.target.result)); importConfig(b) } catch (a) { showerror(_("Unable to read the configuration file. Please check the file and try again.")) } }, b.readAsText(a)) }); return a.appendTo("#sprinklers-settings"), a.click(), !1 }); else if (!a) return void b(); c.find(".pasteMethod").on("click", function () { return c.popup("close"), b(), !1 }), a && c.find(".localMethod").removeClass("hidden").on("click", function () { return c.popup("close"), importConfig(JSON.parse(a)), !1 }), openPopup(c, { positionTo: $("#sprinklers-settings").find(".import_config") }) } function importConfig(a) { var b = { 1: "tz", 2: "ntp", 12: "htp", 13: "htp2", 14: "ar", 15: "nbrd", 16: "seq", 17: "sdt", 18: "mas", 19: "mton", 20: "mtoff", 21: "urs", 22: "rst", 23: "wl", 25: "ipas", 30: "rlp", 36: "lg" }, c = { tz: 1, ntp: 2, dhcp: 3, hp0: 12, hp1: 13, ar: 14, ext: 15, seq: 16, sdt: 17, mas: 18, mton: 19, mtof: 20, urs: 21, rso: 22, wl: 23, ipas: 25, devid: 26, con: 27, lit: 28, dim: 29, rlp: 30, lg: 36, uwt: 31, ntp1: 32, ntp2: 33, ntp3: 34, ntp4: 35, mas2: 37, mton2: 38, mtof2: 39, fpr0: 41, fpr1: 42, re: 43, dns1: 44, dns2: 45, dns3: 46, dns4: 47, sar: 48, ife: 49 }, d = ""; return "object" == typeof a && a.settings ? ((checkOSVersion(210) && "object" == typeof a.options && (a.options.hp0 !== controller.options.hp0 || a.options.hp1 !== controller.options.hp1) || a.options.dhcp !== controller.options.dhcp || a.options.devid !== controller.options.devid) && (d = _("Warning: Network changes will be made and the device may no longer be accessible from this address.")), void areYouSure(_("Are you sure you want to restore the configuration?"), d, function () { $.mobile.loading("show"); var d, e, f, g, h = "/cs?pw=", i = "/co?pw=", j = "/cp?pw=", k = isOSPi(); for (d in a.options) if (a.options.hasOwnProperty(d) && c.hasOwnProperty(d)) { if (e = c[d], $.inArray(e, [2, 14, 16, 21, 22, 25, 36]) !== -1 && 0 === a.options[d]) continue; if (3 === e) { checkOSVersion(210) && 1 === controller.options.dhcp && (i += "&o3=1"); continue } if (k) { if (e = b[e], void 0 === e) continue } else e = e; f = checkOSVersion(208) === !0 && "string" == typeof a.options[d] ? a.options[d].replace(/\s/g, "_") : a.options[d], i += "&o" + e + "=" + f } for (a.settings.hasOwnProperty("wtkey") && "" !== a.settings.wtkey && checkOSVersion(210) && (i += "&wtkey=" + a.settings.wtkey), !k && "number" == typeof a.options.fwv && a.options.fwv < 211 && checkOSVersion(211) && (i += "&o36=1"), i += "&" + (k ? "o" : "") + "loc=" + a.settings.loc, d = 0; d < a.stations.snames.length; d++)g = checkOSVersion(208) === !0 ? a.stations.snames[d].replace(/\s/g, "_") : a.stations.snames[d], h += "&s" + d + "=" + encodeURIComponent(g); for (d = 0; d < a.stations.masop.length; d++)h += "&m" + d + "=" + a.stations.masop[d]; if ("object" == typeof a.stations.masop2) for (d = 0; d < a.stations.masop2.length; d++)h += "&n" + d + "=" + a.stations.masop2[d]; if ("object" == typeof a.stations.ignore_rain) for (d = 0; d < a.stations.ignore_rain.length; d++)h += "&i" + d + "=" + a.stations.ignore_rain[d]; if ("object" == typeof a.stations.stn_dis) for (d = 0; d < a.stations.stn_dis.length; d++)h += "&d" + d + "=" + a.stations.stn_dis[d]; if ("object" == typeof a.stations.stn_spe) for (d = 0; d < a.stations.stn_spe.length; d++)h += "&p" + d + "=" + a.stations.stn_spe[d]; if ("object" == typeof a.stations.stn_seq) for (d = 0; d < a.stations.stn_seq.length; d++)h += "&q" + d + "=" + a.stations.stn_seq[d]; else if (!k && "number" == typeof a.options.fwv && a.options.fwv < 211 && !checkOSVersion(211)) { var l; for (l = 0; l < a.settings.nbrd; l++)h += "&q" + l + "=" + (1 === a.options.seq ? 255 : 0) } if ("object" == typeof a.stations.act_relay) for (d = 0; d < a.stations.act_relay.length; d++)h += "&a" + d + "=" + a.stations.act_relay[d]; a.special = a.special || {}, $.when(sendToOS(i), sendToOS(h), sendToOS("/dp?pw=&pid=-1"), $.each(a.programs.pd, function (b, c) { var d = ""; if (k && "number" == typeof a.options.fwv && a.options.fwv >= 210) return showerror(_("Program data is newer than the device firmware and cannot be imported")), !1; if (!k && "number" == typeof a.options.fwv && a.options.fwv >= 210 && !checkOSVersion(210)) return showerror(_("Program data is newer than the device firmware and cannot be imported")), !1; if (!k && "number" == typeof a.options.fwv && a.options.fwv >= 210 && checkOSVersion(210) && (d = "&name=" + c[5], c = c.slice(0, 5)), !k && "number" == typeof a.options.fwv && a.options.fwv < 210 && checkOSVersion(210)) { var e, f, g, h = readProgram183(c), i = c.length - 7, l = [], m = 0; for (m |= h.en << 0, m |= h.is_even ? 8 : h.is_odd ? 4 : 0, m |= h.is_interval ? 48 : 0, m |= 0, c[0] = m, f = 0; f < i; f++)for (e = c[7 + f], g = 0; g < 8; g++)l.push(e & 1 << g ? h.duration : 0); c[3] = [h.start, parseInt((h.end - h.start) / h.interval), h.interval, 0], c[4] = l, c = c.slice(0, 5), d = "&name=" + _("Program") + " " + (b + 1) } sendToOS(j + "&pid=-1&v=" + JSON.stringify(c) + d) }), $.each(a.special, function (a, b) { checkOSVersion(216) && sendToOS("/cs?pw=&sid=" + a + "&st=" + b.st + "&sd=" + b.sd) })).then(function () { setTimeout(function () { updateController(function () { $.mobile.loading("hide"), showerror(_("Backup restored to your device")), updateWeather(), goHome(!0) }, function () { $.mobile.loading("hide"), networkFail() }) }, 1500) }, function () { $.mobile.loading("hide"), showerror(_("Unable to import configuration.")) }) })) : void showerror(_("Invalid configuration")) } function isRunning() { for (var a = 0; a < controller.status.length; a++)if (controller.status[a] > 0 && controller.settings.ps[a][0] > 0) return a; return -1 } function stopStations(a) { $.mobile.loading("show"), sendToOS("/cv?pw=&rsn=1").done(function () { setTimeout(function () { $.mobile.loading("hide"), a() }, 1e3) }) } function flowCountToVolume(a) { return parseFloat((a * ((controller.options.fpr1 << 8) + controller.options.fpr0) / 100).toFixed(2)) } function isOSPi() { return !(!controller || "object" != typeof controller.options || "string" != typeof controller.options.fwv || controller.options.fwv.search(/ospi/i) === -1) } function checkPW(a, b) { $.ajax({ url: currPrefix + currIp + "/sp?pw=" + encodeURIComponent(a) + "&npw=" + encodeURIComponent(a) + "&cpw=" + encodeURIComponent(a), cache: !1, crossDomain: !0, type: "GET" }).then(function (a) { var c = a.result; b(!("undefined" == typeof c || c > 1)) }, function () { b(!1) }) } function changePassword(a) { var b = { fixIncorrect: !1, name: "", callback: function () { }, cancel: function () { } }; a = $.extend({}, b, a); var c = isOSPi(), d = !1, e = $("<div data-role='popup' class='modal' id='changePassword' data-theme='a' data-overlay-theme='b'><ul data-role='listview' data-inset='true'>" + (a.fixIncorrect === !0 ? "" : "<li data-role='list-divider'>" + _("Change Password") + "</li>") + "<li>" + (a.fixIncorrect === !0 ? "<p class='rain-desc red-text bold'>" + _("Incorrect password for ") + a.name + ". " + _("Please re-enter password to try again.") + "</p>" : "") + "<form method='post' novalidate><label for='npw'>" + (a.fixIncorrect === !0 ? _("Password:") : _("New Password") + ":") + "</label><input type='password' name='npw' id='npw' value=''" + (c ? "" : " maxlength='32'") + ">" + (a.fixIncorrect === !0 ? "" : "<label for='cpw'>" + _("Confirm New Password") + ":</label><input type='password' name='cpw' id='cpw' value=''" + (c ? "" : " maxlength='32'") + ">") + (a.fixIncorrect === !0 ? "<label for='save_pw'>" + _("Save Password") + "</label><input type='checkbox' data-wrapper-class='save_pw' name='save_pw' id='save_pw' data-mini='true'>" : "") + "<input type='submit' value='" + _("Submit") + "'></form></li></ul></div>"); e.find("form").on("submit", function () { var b = e.find("#npw").val(), f = e.find("#cpw").val(); return a.fixIncorrect === !0 ? (d = !0, storage.get(["sites"], function (c) { var d = parseSites(c.sites), f = function (b) { currPass = b, d[a.name].os_pw = e.find("#save_pw").is(":checked") ? b : "", storage.set({ sites: JSON.stringify(d) }, cloudSaveSites), e.popup("close"), a.callback() }; checkPW(md5(b), function (a) { f(a === !0 ? md5(b) : b) }) }), !1) : b !== f ? (showerror(_("The passwords don't match. Please try again.")), !1) : "" === b ? (showerror(_("Password cannot be empty")), !1) : (!c && b.length > 32 && showerror(_("Password cannot be longer than 32 characters")), checkOSVersion(213) && (b = md5(b), f = md5(f)), $.mobile.loading("show"), sendToOS("/sp?pw=&npw=" + encodeURIComponent(b) + "&cpw=" + encodeURIComponent(f), "json").done(function (a) { var c = a.result; !c || c > 1 ? showerror(2 === c ? _("Please check the current device password is correct then try again") : _("Unable to change password. Please try again.")) : (storage.get(["sites", "current_site"], function (a) { var c = parseSites(a.sites); c[a.current_site].os_pw = b, currPass = b, storage.set({ sites: JSON.stringify(c) }, cloudSaveSites) }), $.mobile.loading("hide"), e.popup("close"), showerror(_("Password changed successfully"))) }), !1) }), e.one("popupafterclose", function () { document.activeElement.blur(), e.remove(), a.fixIncorrect && !d && a.cancel() }).popup().enhanceWithin(), a.fixIncorrect ? storage.get(["sites", "current_site"], function (b) { var c = parseSites(b.sites), d = b.current_site, f = md5(c[d].os_pw); isMD5(c[d].os_pw) ? e.popup("open") : $.ajax({ url: currPrefix + currIp + "/jc?pw=" + f, type: "GET", dataType: "json" }).then(function () { c[d].os_pw = currPass = f, storage.set({ sites: JSON.stringify(c) }, cloudSaveSites), a.callback() }, function () { e.popup("open") }) }) : e.popup("open") } function requestCloudAuth(a) { a = a || function () { }; var b = $("<div data-role='popup' class='modal' id='requestCloudAuth' data-theme='a'><ul data-role='listview' data-inset='true'><li data-role='list-divider'>" + _("OpenSprinkler.com Login") + "</li><li><p class='rain-desc tight'>" + _("Use your OpenSprinkler.com login and password to securely sync sites between all your devices.") + "<br><br>" + _("Don't have an account?") + " <a href='https://opensprinkler.com/wp-login.php?action=register' class='iab'>" + _("Register here") + "</a></p></li><li><form method='post' novalidate><label for='cloudUser'>" + _("Username:") + "</label><input type='text' name='cloudUser' id='cloudUser' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false'><label for='cloudPass'>" + _("Password:") + "</label><input type='password' name='cloudPass' id='cloudPass'><input type='submit' value='" + _("Submit") + "'></form></li></ul></div>"), c = !1; b.find("form").on("submit", function () { return $.mobile.loading("show"), cloudLogin(b.find("#cloudUser").val(), b.find("#cloudPass").val(), function (a) { return a === !1 ? void showerror(_("Invalid username/password combination. Please try again.")) : ($.mobile.loading("hide"), c = !0, b.popup("close"), void 0) }), !1 }), b.one("popupafterclose", function () { a(c), c && cloudSyncStart() }), openPopup(b) } function cloudLogin(a, b, c) { c = c || function () { }, $.ajax({ type: "POST", dataType: "json", url: "https://opensprinkler.com/wp-admin/admin-ajax.php", data: { action: "ajaxLogin", username: a, password: b }, success: function (a) { "string" == typeof a.token && storage.set({ cloudToken: a.token, cloudDataToken: sjcl.codec.hex.fromBits(sjcl.hash.sha256.hash(b)) }), c(a.loggedin) }, fail: function () { c(!1) } }) } function cloudSaveSites(a) { "function" != typeof a && (a = function () { }), storage.get(["cloudToken", "cloudDataToken", "sites"], function (b) { return null === b.cloudToken || void 0 === b.cloudToken ? void a(!1) : void $.ajax({ type: "POST", dataType: "json", url: "https://opensprinkler.com/wp-admin/admin-ajax.php", data: { action: "saveSites", token: b.cloudToken, sites: encodeURIComponent(JSON.stringify(sjcl.encrypt(b.cloudDataToken, b.sites))) }, success: function (b) { b.success === !1 ? ("BAD_TOKEN" === b.message && handleExpiredLogin(), a(!1, b.message)) : (storage.set({ cloudToken: b.token }), a(b.success)) }, fail: function () { a(!1) } }) }) } function cloudGetSites(a) { a = a || function () { }, storage.get(["cloudToken", "cloudDataToken"], function (b) { return void 0 === b.cloudToken || null === b.cloudToken ? void a(!1) : void 0 === b.cloudDataToken || null === b.cloudDataToken ? (handleInvalidDataToken(), void a(!1)) : void $.ajax({ type: "POST", dataType: "json", url: "https://opensprinkler.com/wp-admin/admin-ajax.php", data: { action: "getSites", token: b.cloudToken }, success: function (c) { if (c.success === !1 || "" === c.sites) "BAD_TOKEN" === c.message && handleExpiredLogin(), a(!1, c.message); else { storage.set({ cloudToken: c.token }); var d; try { d = sjcl.decrypt(b.cloudDataToken, c.sites) } catch (b) { "ccm: tag doesn't match" === b.message && handleInvalidDataToken(), a(!1) } try { a(JSON.parse(d)) } catch (b) { a(!1) } } }, fail: function () { a(!1) } }) }) } function cloudSyncStart() { cloudGetSites(function (a) { var b = $(".ui-page-active").attr("id"); "start" === b ? (Object.keys(a).length > 0 && storage.set({ sites: JSON.stringify(a) }), changePage("#site-control")) : (updateLoginButtons(), storage.get("sites", function (c) { if (JSON.stringify(a) !== c.sites) { if (c.sites = parseSites(c.sites), currLocal) return void findLocalSiteName(a, function (b) { b === !1 ? areYouSure(_("Do you wish to add this location to your cloud synced site list?"), _("This site is not found in the currently synced site list but may be added now."), function () { a[currIp] = c.sites.Local, storage.set({ sites: JSON.stringify(a) }, cloudSaveSites), storage.set({ current_site: currIp }), updateSiteList(Object.keys(a), currIp) }, function () { storage.remove("cloudToken", updateLoginButtons) }) : (storage.set({ sites: JSON.stringify(a) }, cloudSaveSites), storage.set({ current_site: b }), updateSiteList(Object.keys(a), b)) }); if (Object.keys(a).length > 0) { var d = $("<div data-role='popup' data-theme='a' data-overlay-theme='b'><div class='ui-bar ui-bar-a'>" + _("Select Merge Method") + "</div><div data-role='controlgroup' class='tight'><button class='merge'>" + _("Merge") + "</button><button class='replaceLocal'>" + _("Replace local with cloud") + "</button><button class='replaceCloud'>" + _("Replace cloud with local") + "</button></div></div>"), e = function () { storage.set({ sites: JSON.stringify(a) }, cloudSaveSites), d.popup("close"), "site-control" === b && changePage("#site-control") }; d.find(".merge").on("click", function () { a = $.extend({}, c.sites, a), e() }), d.find(".replaceLocal").on("click", function () { e() }), d.find(".replaceCloud").on("click", function () { a = c.sites, e() }), d.one("popupafterclose", function () { d.popup("destroy").remove() }).popup({ history: !1, positionTo: "window" }).enhanceWithin().popup("open") } else cloudSaveSites() } })) }) } function cloudSync(a) { "function" != typeof a && (a = function () { }), storage.get(["cloudToken", "current_site"], function (b) { "string" == typeof b.cloudToken && cloudGetSites(function (c) { c !== !1 && storage.set({ sites: JSON.stringify(c) }, function () { updateSiteList(Object.keys(c), b.current_site), a(), $("html").trigger("siterefresh") }) }) }) } function handleExpiredLogin() {
    storage.remove(["cloudToken"], updateLoginButtons),
    addNotification({ title: _("OpenSprinkler.com Login Expired"), desc: _("Click here to re-login to OpenSprinkler.com"), on: function () { var a = $(this).parent(); return requestCloudAuth(function (b) { removeNotification(a), b === !0 && (updateLoginButtons(), cloudSync()) }), !1 } })
} function handleInvalidDataToken() { storage.remove(["cloudDataToken"]), addNotification({ title: _("Unable to read cloud data"), desc: _("Click here to enter a valid password to decrypt the data"), on: function () { var a = $(this).parent(), b = $("<div data-role='popup' data-theme='a' class='modal ui-content' id='dataPassword'><p class='tight rain-desc'>" + _("Please enter your OpenSprinkler.com password. If you have recently changed your password, you may need to enter your previous password to decrypt the data.") + "</p><form><input type='password' id='dataPasswordInput' name='dataPasswordInput' placeholder='" + _("Password") + "' /><input type='submit' data-theme='b' value='" + _("Submit") + "' /></form></div>"), c = !1; return b.find("form").on("submit", function () { return removeNotification(a), c = !0, storage.set({ cloudDataToken: sjcl.codec.hex.fromBits(sjcl.hash.sha256.hash(b.find("#dataPasswordInput").val())) }, function () { b.popup("close") }), !1 }), b.one("popupafterclose", function () { c === !0 && cloudSync() }), openPopup(b), !1 } }) } function getTokenUser(a) { return atob(a).split("|")[0] } function showUnifiedFirmwareNotification() { isOSPi() && storage.get("ignoreUnifiedFirmware", function (a) { "1" !== a.ignoreUnifiedFirmware && addNotification({ title: _("Unified firmware is now avaialble"), desc: _("Click here for more details"), on: function () { var a = window.open("https://openthings.freshdesk.com/support/solutions/articles/5000631599", "_blank", "location=" + (isAndroid ? "yes" : "no") + ",enableViewportScale=yes,toolbarposition=top,closebuttoncaption=" + _("Back")); return isIEMobile && ($.mobile.document.data("iabOpen", !0), a.addEventListener("exit", function () { $.mobile.document.removeData("iabOpen") })), !1 }, off: function () { return storage.set({ ignoreUnifiedFirmware: "1" }), !0 } }) }) } function intToIP(a) { return (a >> 24 & 255) + "." + (a >> 16 & 255) + "." + (a >> 8 & 255) + "." + (255 & a) } function checkPublicAccess(a) { if (0 !== a) { var b = intToIP(a), c = currIp.match(/.*:(\d+)/), d = function () { storage.get("ignoreRemoteFailed", function (a) { "1" !== a.ignoreRemoteFailed && addNotification({ title: _("Remote access is not enabled"), desc: _("Click here to troubleshoot remote access issues"), on: function () { var a = window.open("https://openthings.freshdesk.com/support/solutions/articles/5000569763", "_blank", "location=" + (isAndroid ? "yes" : "no") + ",enableViewportScale=yes,toolbarposition=top,closebuttoncaption=" + _("Back")); return isIEMobile && ($.mobile.document.data("iabOpen", !0), a.addEventListener("exit", function () { $.mobile.document.removeData("iabOpen") })), !1 }, off: function () { return storage.set({ ignoreRemoteFailed: "1" }), !0 } }) }) }; b !== currIp && !isLocalIP(b) && isLocalIP(currIp) && (c = c ? parseInt(c[1]) : 80, $.ajax({ url: currPrefix + b + ":" + c + "/jo?pw=" + currPass, global: !1, dataType: "json", type: "GET" }).then(function (a) { return "object" != typeof a || !a.hasOwnProperty("fwv") || a.fwv !== controller.options.fwv || checkOSVersion(214) && controller.options.ip4 !== a.ip4 ? void d() : void storage.get(["sites", "current_site"], function (a) { var d = parseSites(a.sites), e = a.current_site; d[e].os_ip = b + (80 === c ? "" : ":" + c), storage.set({ sites: JSON.stringify(d) }, cloudSaveSites) }) }, d)) } } function logout(a) { "function" != typeof a && (a = function () { }), areYouSure(_("Are you sure you want to logout?"), "", function () { currLocal ? storage.remove(["sites", "current_site", "lang", "provider", "wapikey", "runonce", "cloudToken"], function () { location.reload() }) : storage.remove(["cloudToken"], function () { updateLoginButtons(), a() }) }) } function updateLoginButtons() { var a = $(".ui-page-active"); storage.get("cloudToken", function (b) { var c = $(".login-button"), d = $(".logout-button"); null === b.cloudToken || void 0 === b.cloudToken ? (c.removeClass("hidden"), currLocal || d.addClass("hidden"), d.find("a").text(_("Logout")), "site-control" === a.attr("id") && a.find(".logged-in-alert").remove()) : (d.removeClass("hidden").find("a").text(_("Logout") + " (" + getTokenUser(b.cloudToken) + ")"), c.addClass("hidden"), "site-control" === a.attr("id") && 0 === a.find(".logged-in-alert").length && a.find(".ui-content").prepend(addSyncStatus(b.cloudToken))) }) } function addNotification(a) { notifications.push(a), updateNotificationBadge(); var b = $("#notificationPanel"); b.hasClass("ui-panel-open") && b.find("ul").append(createNotificationItem(a)).listview("refresh") } function updateNotificationBadge() { var a = notifications.length, b = $("#header"); 0 === a ? b.find(".notifications").hide() : (b.find(".notifications").show(), b.find(".notificationCount").text(a)) } function createNotificationItem(a) { var b = $("<li><a class='primary' href='#'><h2>" + a.title + "</h2>" + (a.desc ? "<p>" + a.desc + "</p>" : "") + "</a><a class='ui-btn ui-btn-icon-notext ui-icon-delete'></a></li>"); return b.find(".primary").on("click", a.on), b.find(".ui-icon-delete").on("click", function () { removeNotification($(this).parent()) }), b } function showNotifications() { if (0 !== notifications.length) { for (var a = $("#notificationPanel"), b = $("#footer-menu"), c = [$("<li data-role='list-divider'>" + _("Notifications") + "<button class='ui-btn ui-btn-icon-notext ui-icon-delete btn-no-border clear-all delete'></button></li>").on("click", ".clear-all", function () { var a = $(this); a.hasClass("clear") ? clearNotifications() : (a.removeClass("delete ui-btn-icon-notext ui-icon-delete").addClass("clear").text(_("Clear")), setTimeout(function () { $.mobile.document.one("click", function () { a.removeClass("clear").addClass("delete ui-btn-icon-notext ui-icon-delete").text("") }) }, 1)) })], d = notifications.length - 1; d >= 0; d--)c.push(createNotificationItem(notifications[d])); a.find("ul").replaceWith($("<ul/>").append(c).listview()), a.on("panelbeforeclose", function () { b.removeClass("moveLeft") }), a.panel().panel("option", "classes.modal", "needsclick ui-panel-dismiss"), b.addClass("moveLeft"), a.panel("open") } } function clearNotifications() { var a = $("#notificationPanel"); notifications = [], updateNotificationBadge(), a.find("ul").empty(), a.hasClass("ui-panel-open") && a.panel("close") } function removeNotification(a) { var b = $("#notificationPanel"), c = notifications[a.index() - 1].off; ("function" != typeof c || c()) && (notifications.remove(a.index() - 1), a.remove(), updateNotificationBadge(), 0 === notifications.length && b.hasClass("ui-panel-open") && b.panel("close")) } function checkFirmwareUpdate() { checkOSVersion(200) && $.getJSON("https://api.github.com/repos/opensprinkler/opensprinkler-firmware/releases").done(function (a) { controller.options.fwv < a[0].tag_name && storage.get("updateDismiss", function (b) { (!b.updateDismiss || b.updateDismiss < a[0].tag_name) && addNotification({ title: _("Firmware update available"), on: function () { var b = $(this).parent(), c = controller.options.hwv > 63 && checkOSVersion(216), d = a[0].html_url, e = $("<div data-role='popup' class='modal' data-theme='a'><h3 class='center' style='margin-bottom:0'>" + _("Latest") + " " + _("Firmware") + ": " + a[0].name + "</h3><h5 class='center' style='margin:0'>" + _("This Controller") + ": " + getOSVersion() + getOSMinorVersion() + "</h5><a class='iab ui-btn ui-corner-all ui-shadow' style='width:80%;margin:5px auto;' target='_blank' href='" + d + "'>" + _("View Changelog") + "</a><a class='guide ui-btn ui-corner-all ui-shadow' style='width:80%;margin:5px auto;' href='#'>" + _(c ? "Update Now" : "Update Guide") + "</a><a class='dismiss ui-btn ui-btn-b ui-corner-all ui-shadow' style='width:80%;margin:5px auto;' href='#'>" + _("Dismiss") + "</a></div>"); e.find(".guide").on("click", function () { if (c) sendToOS("/cv?pw=&update=1", "json").then(function () { showerror(_("Update successful")), e.find(".dismiss").click() }, function () { $.mobile.loading("show", { html: "<div class='center'>" + _("Update did not complete.") + "<br><a class='iab ui-btn' href='https://openthings.freshdesk.com/support/solutions/articles/5000631599-installing-and-updating-the-unified-firmware#upgrade'>" + _("Update Guide") + "</a></div>", textVisible: !0, theme: "b" }), setTimeout(function () { $.mobile.loading("hide") }, 3e3) }); else { var a = controller.options.hwv > 63 ? "https://openthings.freshdesk.com/support/solutions/articles/5000631599-installing-and-updating-the-unified-firmware#upgrade" : "https://openthings.freshdesk.com/support/solutions/articles/5000381694-opensprinkler-firmware-update-guide"; $("<a class='hidden iab' href='" + a + "'></a>").appendTo(e).click() } }), e.find(".dismiss").one("click", function () { return storage.set({ updateDismiss: a[0].tag_name }), e.popup("close"), removeNotification(b), !1 }), openPopup(e) } }) }) }) } function stopAllStations() { return !!isControllerConnected() && void areYouSure(_("Are you sure you want to stop all stations?"), "", function () { $.mobile.loading("show"), sendToOS("/cv?pw=&rsn=1").done(function () { $.mobile.loading("hide"), removeStationTimers(), refreshStatus(), showerror(_("All stations have been stopped")) }) }) } function checkOSPiVersion(a) { var b; return !!isOSPi() && (b = controller.options.fwv.split("-")[0], b === a || (b = b.split("."), a = a.split("."), versionCompare(b, a))) } function checkOSVersion(a) { var b = controller.options.fwv; return a >= 1e3 && (b = 10 * b + controller.options.fwm), !isOSPi() && (a === b || versionCompare(b.toString().split(""), a.toString().split(""))) } function versionCompare(a, b) { for (var c, d = Math.max(a.length, b.length); a.length < d;)a.push(0); for (; b.length < d;)b.push(0); for (var e = 0; e < d && (c = Math.max(-1, Math.min(1, a[e] - b[e])), 0 === c); e++); return c === -1 && (c = !1), c } function getOSVersion(a) { return a || "object" != typeof controller.options || (a = controller.options.fwv), "string" == typeof a && a.search(/ospi/i) !== -1 ? a : (a / 100 >> 0) + "." + (a / 10 >> 0) % 10 + "." + a % 10 } function getOSMinorVersion() { return !isOSPi() && "object" == typeof controller.options && "number" == typeof controller.options.fwm && controller.options.fwm > 0 ? " (" + controller.options.fwm + ")" : "" } function getHWVersion(a) { if (!a) { if ("object" != typeof controller.options || "undefined" == typeof controller.options.hwv) return !1; a = controller.options.hwv } return "string" == typeof a ? a : 64 === a ? "OSPi" : 128 === a ? "OSBo" : 192 === a ? "Linux" : 255 === a ? "Demo" : (a / 10 >> 0) % 10 + "." + a % 10 } function getHWType() { return isOSPi() || "number" != typeof controller.options.hwt || 0 === controller.options.hwt ? "" : 172 === controller.options.hwt ? " - AC" : 220 === controller.options.hwt ? " - DC" : 26 === controller.options.hwt ? " - Latching" : "" } function areYouSure(a, b, c, d) { $("#sure").popup("destroy").remove(), c = c || function () { }, d = d || function () { }; var e = $("<div data-role='popup' data-theme='a' id='sure'><h3 class='sure-1 center'>" + a + "</h3><p class='sure-2 center'>" + b + "</p><a class='sure-do ui-btn ui-btn-b ui-corner-all ui-shadow' href='#'>" + _("Yes") + "</a><a class='sure-dont ui-btn ui-corner-all ui-shadow' href='#'>" + _("No") + "</a></div>"); e.find(".sure-do").one("click.sure", function () { return e.popup("close"), c(), !1 }), e.find(".sure-dont").one("click.sure", function () { return e.popup("close"), d(), !1 }), openPopup(e) } function showIPRequest(a) { var b = { title: _("Enter IP Address"), ip: [0, 0, 0, 0], showBack: !0, callback: function () { } }; a = $.extend({}, b, a), $("#ipInput").popup("destroy").remove(); var c = $("<div data-role='popup' id='ipInput' data-theme='a'><div data-role='header' data-theme='b'><h1>" + a.title + "</h1></div><div class='ui-content'><span><fieldset class='ui-grid-c incr'><div class='ui-block-a'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='plus' data-iconpos='bottom'></a></div><div class='ui-block-b'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='plus' data-iconpos='bottom'></a></div><div class='ui-block-c'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='plus' data-iconpos='bottom'></a></div><div class='ui-block-d'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='plus' data-iconpos='bottom'></a></div></fieldset><div class='ui-grid-c inputs'><div class='ui-block-a'><input data-wrapper-class='pad_buttons' class='ip_addr' type='number' pattern='[0-9]*' max='255' value='" + a.ip[0] + "'></div><div class='ui-block-b'><input data-wrapper-class='pad_buttons' class='ip_addr' type='number' pattern='[0-9]*' max='255' value='" + a.ip[1] + "'></div><div class='ui-block-c'><input data-wrapper-class='pad_buttons' class='ip_addr' type='number' pattern='[0-9]*' max='255' value='" + a.ip[2] + "'></div><div class='ui-block-d'><input data-wrapper-class='pad_buttons' class='ip_addr' type='number' pattern='[0-9]*' max='255' value='" + a.ip[3] + "'></div></div><fieldset class='ui-grid-c decr'><div class='ui-block-a'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='minus' data-iconpos='bottom'></a></div><div class='ui-block-b'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='minus' data-iconpos='bottom'></a></div><div class='ui-block-c'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='minus' data-iconpos='bottom'></a></div><div class='ui-block-d'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='minus' data-iconpos='bottom'></a></div></fieldset></span>" + (a.showBack ? "<button class='submit' data-theme='b'>" + _("Submit") + "</button>" : "") + "</div></div>"), d = function (b, d) { var f = c.find(".inputs input").eq(b), g = parseInt(f.val()); d === -1 && 0 === g || 1 === d && g >= 255 || (f.val(g + d), a.callback(e())) }, e = function () { return $.makeArray(c.find(".ip_addr").map(function () { return parseInt($(this).val()) })) }; c.find("button.submit").on("click", function () { a.callback(e()), c.popup("destroy").remove() }), c.on("focus", "input[type='number']", function () { this.value = "" }).on("blur", "input[type='number']", function () { "" === this.value && (this.value = "0") }), holdButton(c.find(".incr").children(), function (a) { var b = $(a.currentTarget).index(); return d(b, 1), !1 }), holdButton(c.find(".decr").children(), function (a) { var b = $(a.currentTarget).index(); return d(b, -1), !1 }), c.css("max-width", "350px").one("popupafterclose", function () { a.callback(e()) }), openPopup(c) } function showDurationBox(a) { var b = { seconds: 0, title: _("Duration"), granularity: 0, preventCompression: !1, incrementalUpdate: !0, showBack: !0, showSun: !1, minimum: 0, callback: function () { } }, c = 0; a = $.extend({}, b, a), $("#durationBox").popup("destroy").remove(), a.seconds = parseInt(a.seconds), 65535 === a.seconds ? (c = 1, a.seconds = 0) : 65534 === a.seconds && (c = 2, a.seconds = 0), checkOSVersion(217) && (a.preventCompression = !0); var d, e = ["days", "hours", "minutes", "seconds"], f = [_("Days"), _("Hours"), _("Minutes"), _("Seconds")], g = [86400, 3600, 60, 1], h = [0, 23, 59, 59], i = 4 - a.granularity, j = 0, k = sec2dhms(a.seconds); if (!a.preventCompression && checkOSVersion(210) && a.maximum > 64800 && (a.maximum = checkOSVersion(214) ? 57600 : 64800), a.maximum) for (d = g.length - 1; d >= 0; d--)if (a.maximum < g[d]) { j = d + 1, i = g.length - j - a.granularity; break } var l = "<fieldset class='ui-grid-" + String.fromCharCode(95 + i) + " incr'>", m = "<div class='ui-grid-" + String.fromCharCode(95 + i) + " inputs'>", n = "<fieldset class='ui-grid-" + String.fromCharCode(95 + i) + " decr'>", o = $("<div data-role='popup' id='durationBox' data-theme='a'><div data-role='header' data-theme='b'><h1>" + a.title + "</h1></div><div class='ui-content'>" + (a.helptext ? "<p class='rain-desc center smaller'>" + a.helptext + "</p>" : "") + "<span></span>" + (a.showSun ? "<div class='ui-grid-a useSun'><div class='ui-block-a'><button value='65534' class='ui-mini ui-btn rise " + (2 === c ? "ui-btn-active" : "") + "'>" + _("Sunrise to Sunset") + "</button></div><div class='ui-block-b'><button value='65535' class='ui-mini ui-btn set " + (1 === c ? "ui-btn-active" : "") + "'>" + _("Sunset to Sunrise") + "</button></div></div>" : "") + (a.showBack ? "<button class='submit' data-theme='b'>" + _("Submit") + "</button>" : "") + "</div></div>"), p = function (b, c) { var d = o.find(".inputs input").eq(b), e = b + j, f = parseInt(d.val()); if (!d.prop("disabled") && !(c === -1 && (q() <= a.minimum || f <= 0) || 1 === c && q() + g[e] > a.maximum) && (0 !== h[e] && 0 !== b && Math.abs(f) >= h[e] && (d.val(0), d = o.find(".inputs input").eq(b - 1), f = parseInt(d.val())), d.val(f + c), a.incrementalUpdate && a.callback(q()), !a.preventCompression && checkOSVersion(210))) { var i = 1 === c; 1 === c ? (q() >= 60 && r("seconds", i), q() >= 10800 && r("minutes", i)) : c === -1 && (q() <= -60 ? r("seconds", !i) : q() <= -10800 ? r("minutes", !i) : q() < 60 ? r("seconds", i) : q() < 10800 && r("minutes", i)) } }, q = function () { var a = o.find(".useSun").find("button.ui-btn-active"); return 1 === a.length ? parseInt(a.val()) : dhms2sec({ days: parseInt(o.find(".days").val()) || 0, hours: parseInt(o.find(".hours").val()) || 0, minutes: parseInt(o.find(".minutes").val()) || 0, seconds: parseInt(o.find(".seconds").val()) || 0 }) }, r = function (a, b) { o.find("." + a).toggleClass("ui-state-disabled", b).prop("disabled", b).val(function () { return b ? 0 : this.value }).parent(".ui-input-text").toggleClass("ui-state-disabled", b) }; for (d = j; d < g.length - a.granularity; d++)l += "<div " + (i > 1 ? "class='ui-block-" + String.fromCharCode(97 + d - j) + "'" : "") + "><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='plus' data-iconpos='bottom'></a></div>", m += "<div " + (i > 1 ? "class='ui-block-" + String.fromCharCode(97 + d - j) + "'" : "") + "><label class='center'>" + _(f[d]) + "</label><input data-wrapper-class='pad_buttons' class='" + e[d] + "' type='number' pattern='[0-9]*' value='" + k[e[d]] + "'></div>", n += "<div " + (i > 1 ? "class='ui-block-" + String.fromCharCode(97 + d - j) + "'" : "") + "><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='minus' data-iconpos='bottom'></a></div>"; l += "</fieldset>", m += "</div>", n += "</fieldset>", o.find("span").prepend(l + m + n), o.find("button.submit").on("click", function () { a.callback(q()), o.popup("destroy").remove() }), !a.preventCompression && checkOSVersion(210) && (a.seconds <= -60 && r("seconds", !0), a.seconds <= -10800 && r("minutes", !0), a.seconds >= 60 && r("seconds", !0), a.seconds >= 10800 && r("minutes", !0)), o.on("focus", "input[type='number']", function () { this.value = "" }).on("blur", "input[type='number']", function () { "" === this.value && (this.value = "0") }), holdButton(o.find(".incr").children(), function (a) { var b = $(a.currentTarget).index(); return p(b, 1), !1 }), holdButton(o.find(".decr").children(), function (a) { var b = $(a.currentTarget).index(); return p(b, -1), !1 }), a.showSun && o.find(".useSun").on("click", "button", function () { var b = $(this), c = o.find(".useSun").find("button").not(b), d = o.find("span").find(".ui-btn,input"); c.removeClass("ui-btn-active"), b.hasClass("ui-btn-active") ? (b.removeClass("ui-btn-active"), d.prop("disabled", !1).removeClass("ui-disabled")) : (b.addClass("ui-btn-active"), d.prop("disabled", !0).addClass("ui-disabled")), a.incrementalUpdate && a.callback(q()) }), o.css("max-width", "350px").one("popupafteropen", function () { 0 !== c && o.find("span").find(".ui-btn,input").prop("disabled", !0).addClass("ui-disabled") }).one("popupafterclose", function () { a.incrementalUpdate && a.callback(q()) }), openPopup(o) } function showSingleDurationInput(a) { $("#singleDuration").popup("destroy").remove(); var b = { data: 0, title: _("Duration"), minimum: 0, label: "", updateOnChange: !0, showBack: !0, callback: function () { } }; a = $.extend({}, b, a); var c = $("<div data-role='popup' id='singleDuration' data-theme='a'><div data-role='header' data-theme='b'><h1>" + a.title + "</h1></div><div class='ui-content'>" + (a.helptext ? "<p class='rain-desc center smaller'>" + a.helptext + "</p>" : "") + "<label class='center'>" + a.label + "</label><div class='input_with_buttons'><button class='decr ui-btn ui-btn-icon-notext ui-icon-carat-l btn-no-border'></button><input type='number' pattern='[0-9]*' value='" + a.data + "'><button class='incr ui-btn ui-btn-icon-notext ui-icon-carat-r btn-no-border'></button></div>" + (a.updateOnChange && !a.showBack ? "" : "<input type='submit' data-theme='b' value='" + _("Submit") + "'>") + "</div></div>"), d = c.find("input"), e = function (b) { a.callback(parseInt(b).clamp(a.minimum, a.maximum)) }, f = function (b) { var c = parseInt(d.val()); b === -1 && c === a.minimum || 1 === b && c === a.maximum || (d.val(c + b), a.updateOnChange && e(c + b)) }; holdButton(c.find(".incr"), function () { return f(1), !1 }), holdButton(c.find(".decr"), function () { return f(-1), !1 }), c.find("input[type='number']").on("focus", function () { this.value = "" }).on("blur", function () { "" === this.value && (this.value = "0") }), c.find("input[type='submit']").on("click", function () { e(d.val()), c.popup("destroy").remove() }), c.one("popupafterclose", function () { a.updateOnChange && e(d.val()) }), openPopup(c) } function showDateTimeInput(a, b) { $("#datetimeInput").popup("destroy").remove(), a instanceof Date || (a = new Date(1e3 * a), a.setMinutes(a.getMinutes() - a.getTimezoneOffset())), b = b || function () { }; var c = ["Month", "Date", "FullYear", "Hours", "Minutes"], d = [_("Jan"), _("Feb"), _("Mar"), _("Apr"), _("May"), _("Jun"), _("Jul"), _("Aug"), _("Sep"), _("Oct"), _("Nov"), _("Dec")], e = $("<div data-role='popup' id='datetimeInput' data-theme='a'><div data-role='header' data-theme='b'><h1>" + _("Enter Date/Time") + "</h1></div><div class='ui-content'></div></div>"), f = function (c, d) { a["setUTC" + c](a["getUTC" + c]() + d), b(new Date(a.getTime())), g() }, g = function () { var b, g, h, i = "<fieldset class='ui-grid-d incr'>", j = "<div class='ui-grid-d inputs'>", k = "<fieldset class='ui-grid-d decr'>"; for (h = 0; h < 5; h++)b = a["getUTC" + c[h]](), g = "", b = "Month" === c[h] ? "<p class='center'>" + d[b] + "</p>" : "Date" === c[h] ? "<p class='center'>" + b + ",</p>" : "Hours" === c[h] ? "<p style='width:90%;display:inline-block' class='center'>" + b + "</p><p style='display:inline-block'>:</p>" : "<p class='center'>" + b + "</p>", i += "<div class='ui-block-" + String.fromCharCode(97 + h) + "'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='plus' data-iconpos='bottom'></a></div>", j += "<div id='" + c[h] + "' class='ui-block-" + String.fromCharCode(97 + h) + "'>" + b + "</div>", k += "<div class='ui-block-" + String.fromCharCode(97 + h) + "'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='minus' data-iconpos='bottom'></a></div>"; i += "</fieldset>", j += "</div>", k += "</fieldset>", e.find(".ui-content").html("<span>" + i + j + k + "</span>").enhanceWithin(), e.find(".incr").children().on("vclick", function () { var a = $(this).index(); return f(e.find(".inputs").children().eq(a).attr("id"), 1), !1 }), e.find(".decr").children().on("vclick", function () { var a = $(this).index(); return f(e.find(".inputs").children().eq(a).attr("id"), -1), !1 }) }; g(), e.css("width", "280px").one("popupafterclose", function () { b(a) }), openPopup(e) } function showTimeInput(a) { var b = { minutes: 0, title: _("Time"), incrementalUpdate: !0, showBack: !0, showSun: !1, callback: function () { } }; a = $.extend({}, b, a), $("#timeInput").popup("destroy").remove(); var c = 2047 & a.minutes, d = 0; a.minutes >> 12 & 1 && (c = -c), a.minutes >> 14 & 1 ? d = 1 : a.minutes >> 13 & 1 && (d = 2); var e = a.minutes > 719, f = function () { return _(e ? "PM" : "AM") }, g = $("<div data-role='popup' id='timeInput' data-theme='a'><div data-role='header' data-theme='b'><h1>" + a.title + "</h1></div><div class='ui-content'>" + (a.helptext ? "<p class='pad-top rain-desc center smaller'>" + a.helptext + "</p>" : "") + "<span><fieldset class='ui-grid-b incr'><div class='ui-block-a'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='plus' data-iconpos='bottom'></a></div><div class='ui-block-b'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='plus' data-iconpos='bottom'></a></div><div class='ui-block-c'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='plus' data-iconpos='bottom'></a></div></fieldset><div class='ui-grid-b inputs'><div class='ui-block-a'><input data-wrapper-class='pad_buttons' class='hour dontPad' type='number' pattern='[0-9]*' value='" + (parseInt(a.minutes / 60) % 12 === 0 ? 12 : parseInt(a.minutes / 60) % 12) + "'></div><div class='ui-block-b'><input data-wrapper-class='pad_buttons' class='minute' type='number' pattern='[0-9]*' value='" + pad(a.minutes % 60) + "'></div><div class='ui-block-c'><p class='center period'>" + f() + "</p></div></div><fieldset class='ui-grid-b decr'><div class='ui-block-a'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='minus' data-iconpos='bottom'></a></div><div class='ui-block-b'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='minus' data-iconpos='bottom'></a></div><div class='ui-block-c'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='minus' data-iconpos='bottom'></a></div></fieldset></span>" + (a.showSun ? "<div class='ui-grid-a useSun'><div class='ui-block-a'><button class='ui-mini ui-btn rise " + (1 === d ? "ui-btn-active" : "") + "'>" + _("Use Sunrise") + "</button></div><div class='ui-block-b'><button class='ui-mini ui-btn set " + (2 === d ? "ui-btn-active" : "") + "'>" + _("Use Sunset") + "</button></div></div><div class='offsetInput'" + (0 === d ? " style='display: none;'" : "") + "><h5 class='center tight'>" + _("Offset (minutes)") + "</h5><div class='input_with_buttons'><button class='decr ui-btn ui-btn-icon-notext ui-icon-carat-l btn-no-border'></button><input class='dontPad' type='number' pattern='[0-9]*' value='" + c + "'><button class='incr ui-btn ui-btn-icon-notext ui-icon-carat-r btn-no-border'></button></div></div>" : "") + (a.showBack ? "<button class='submit' data-theme='b'>" + _("Submit") + "</button>" : "") + "</div></div>"), h = function (b, c) { if (0 === b || 1 === b) { var d = i(), h = d + c * (0 === b ? 60 : 1), j = g.find(".inputs input").eq(b), k = j.hasClass("hour"), l = parseInt(j.val()); if (1 === c) { if (k && l >= 12 && (l = 0), !k && l >= 59) { l = -1; var m = g.find(".hour"), n = parseInt(m.val()); 12 === n && (n = 0), m.val(n + 1) } } else if (k && l <= 1) l = 13; else if (!k && l <= 0) return; (!e && h > 719 || e && h < 721 || e && h > 1439 || !e && c === -1 && h < 0) && (e = !e, g.find(".period").text(f())), l = k ? l + c : pad(l + c), j.val(l) } else 2 === b && (e = !e, g.find(".period").text(f())); a.incrementalUpdate && a.callback(i()) }, i = function () { var a = g.find(".useSun").find("button.ui-btn-active"); if (1 === a.length) { var b = 0, c = parseInt(g.find(".offsetInput input").val()); return a.hasClass("rise") ? (c >= 0 ? b = c : (b = -c, b |= 4096), b |= 16384) : (c >= 0 ? b = c : (b = -c, b |= 4096), b |= 8192), b } var d = parseInt(g.find(".hour").val()); return e && 12 !== d && (d += 12), e || 12 !== d || (d = 0), 60 * d + parseInt(g.find(".minute").val()) }; if (g.find("button.submit").on("click", function () { a.callback(i()), g.popup("destroy").remove() }), g.on("focus", "input[type='number']", function (a) { a.target.value = "" }).on("blur", "input[type='number']", function (a) { var b = parseInt(a.target.value) || 0; a.target.value = $(a.target).hasClass("dontPad") ? b : pad(b) }), holdButton(g.find(".incr").children(), function (a) { var b = $(a.currentTarget), c = b.index(); return 0 === b.find(".ui-disabled").length && h(c, 1), !1 }), holdButton(g.find(".decr").children(), function (a) { var b = $(a.currentTarget), c = b.index(); return 0 === b.find(".ui-disabled").length && h(c, -1), !1 }), a.showSun) { g.find(".useSun").on("click", "button", function () { var b = $(this), c = g.find(".useSun").find("button").not(b), d = g.find(".offsetInput"), e = g.find("span").find(".ui-btn,input,p"); c.removeClass("ui-btn-active"), b.hasClass("ui-btn-active") ? (b.removeClass("ui-btn-active"), d.slideUp(), e.prop("disabled", !1).removeClass("ui-disabled")) : (b.addClass("ui-btn-active"), d.slideDown(), e.prop("disabled", !0).addClass("ui-disabled")), a.incrementalUpdate && a.callback(i()) }); var j = g.find(".offsetInput").find("input"), k = function (b) { var c = parseInt(j.val()); b === -1 && c === -240 || 1 === b && 240 === c || (j.val(c + b), a.incrementalUpdate && a.callback(i())) }; j.on("focus", function () { this.value = "" }).on("blur", function () { "" === this.value ? this.value = "0" : this.value > 240 ? this.value = "240" : this.value < -240 && (this.value = "-240") }), holdButton(g.find(".offsetInput").find(".incr"), function () { return k(1), !1 }), holdButton(g.find(".offsetInput").find(".decr"), function () { return k(-1), !1 }) } g.css("max-width", "350px").one("popupafteropen", function () { 0 !== d && g.find("span").find(".ui-btn,input,p").prop("disabled", !0).addClass("ui-disabled") }).one("popupafterclose", function () { a.incrementalUpdate && a.callback(i()) }), openPopup(g) } function showHelpText(a) { a.stopImmediatePropagation(); var b, c = $(this), d = c.data("helptext"); return "wtkey" === c.parent().attr("for") && (d += "<a class='iab' target='_blank' href='https://openthings.freshdesk.com/support/solutions/articles/5000017485-getting-a-weather-api#article-show-5000017485'>here</a>."), b = $("<div data-role='popup' data-theme='a'><p>" + d + "</p></div>"), openPopup(b, { positionTo: c }), !1 } function changePage(a, b) { b = b || {}, 0 !== a.indexOf("#") && (a = "#" + a), closePanel(function () { $.mobile.pageContainer.pagecontainer("change", a, b) }) } function openPopup(a, b) { b = $.extend({}, { history: !1, positionTo: "window", overlayTheme: "b" }, b), $.mobile.pageContainer.append(a), a.one("popupafterclose", function () { a.popup("destroy").remove() }).popup(b).enhanceWithin(), a.popup("open") } function closePanel(a) { var b = $(".ui-panel-open"); return b.length > 0 ? (b.one("panelclose", function () { a() }), void b.panel("close")) : void a() } function changeHeader(a) { var b = { title: "", class: "", animate: !0, leftBtn: { icon: "", class: "", text: "", on: function () { } }, rightBtn: { icon: "", class: "", text: "", on: function () { } } }, c = $("#header"); a = $.extend(!0, {}, b, a), "" === a.title && "" === a.class && (a.class = "logo"); var d = $("<button data-icon='" + a.leftBtn.icon + "' " + ("" === a.leftBtn.text ? "data-iconpos='notext' " : "") + "class='ui-btn-left " + a.leftBtn.class + "'>" + a.leftBtn.text + "</button><h3 class='" + a.class + "'>" + a.title + "</h3><button data-icon='" + a.rightBtn.icon + "' " + ("" === a.rightBtn.text ? "data-iconpos='notext' " : "") + "class='ui-btn-right " + a.rightBtn.class + "'>" + a.rightBtn.text + "</button>"), e = a.animate ? "fast" : 0; return c.children().stop().fadeOut(e, function () { c.html(d).toolbar(c.hasClass("ui-header") ? "refresh" : null), c.find(".ui-btn-left").on("click", a.leftBtn.on), c.find(".ui-btn-right").on("click", a.rightBtn.on) }).fadeIn(e), d } function getPageTop() { var a = $.mobile.window; return { x: (a[0].innerWidth || a.width()) / 2 + a.scrollLeft(), y: a.scrollTop() + 22.5 } } function showLoading(a) { a = "string" == typeof a ? $(a) : a, a.off("click").html("<p class='ui-icon ui-icon-loading mini-load'></p>"); var b = a.filter("#footer-running"); 1 === b.length && b.find(".mini-load").addClass("bottom") } function takePicture(a) { "object" == typeof navigator.camera && "function" == typeof navigator.camera.getPicture && navigator.camera.getPicture(a, function () { }, { quality: 50, destinationType: Camera.DestinationType.DATA_URL, allowEdit: !0, targetWidth: 200, targetHeight: 200 }) } function goHome(a) { if ("sprinklers" !== $(".ui-page-active").attr("id")) { $.mobile.document.one("pageshow", function () { delete $.mobile.navigate.history.getActive().transition }); var b = { reverse: !0 }; a === !0 && (b = { firstLoad: !0, showLoading: !1, transition: "none" }), changePage("#sprinklers", b) } } function goBack() { var a = $(".ui-page-active"); if (1 === a.length) { a = a.attr("id"); var b = "site-control" === a && !isControllerConnected(), c = $(".ui-popup-active"); if (c.length) return void c.find("[data-role='popup']").popup("close"); if ("sprinklers" === a || "start" === a || b) try { navigator.app.exitApp() } catch (a) { } else if (isChromeApp || "file:" === window.location.protocol) { var d = $.mobile.navigate.history.getPrev().url; if ("#" !== d.slice(0, 1)) return; changePage(d, { reverse: !0 }), $.mobile.document.one("pagehide", function () { $.mobile.navigate.history.activeIndex -= 2 }) } else pageHistoryCount > 0 && pageHistoryCount-- , 0 === pageHistoryCount ? navigator.app.exitApp() : (goingBack = !0, $.mobile.back()) } } function checkChangesBeforeBack() { checkChanges(goBack) } function checkChanges(a) { var b = $(".ui-page-active"), c = b.find(".hasChanges"); return a = a || function () { }, 0 !== c.length ? (areYouSure(_("Do you want to save your changes?"), "", function () { c.click(), c.hasClass("preventBack") || a() }, a), !1) : void a() } function showerror(a, b) { b = b || 2500, clearTimeout(errorTimeout), $.mobile.loading("show", { text: a, textVisible: !0, textonly: !0, theme: "b" }), errorTimeout = setTimeout(function () { $.mobile.loading("hide") }, b) } function fixInputClick(a) { FastClick.notNeeded(document.body) || (a.find("input[type='checkbox']:not([data-role='flipswitch']),.ui-select > .ui-btn").addClass("needsclick"), a.find(".ui-collapsible-heading-toggle").on("click", function () { var a = $(this); setTimeout(function () { a.removeClass("ui-btn-active") }, 100) })) } function holdButton(a, b) { var c; a.on(isTouchCapable ? "tap" : "click", b).on("taphold", function (a) { c = setInterval(function () { b(a) }, 100) }).on("vmouseup vmouseout vmousecancel touchend", function () { clearInterval(c) }).on("touchmove", function (a) { a.preventDefault() }) } function insertStyle(a) { var b = document.createElement("style"); b.innerHTML = a, document.head.appendChild(b) } function parseIntArray(a) { for (var b = 0; b < a.length; b++)a[b] = +a[b]; return a } function getDurationText(a) { return 65535 === a ? _("Sunset to Sunrise") : 65534 === a ? _("Sunrise to Sunset") : dhms2str(sec2dhms(a)) } function sec2hms(a) { var b = "", c = Math.max(0, parseInt(a / 3600) % 24), d = Math.max(0, parseInt(a / 60) % 60), e = a % 60; return c && (b += pad(c) + ":"), b + pad(d) + ":" + pad(e) } function sec2dhms(a) {
    var b = a < 0 ? -1 : 1; return a = Math.abs(a), { days: Math.max(0, parseInt(a / 86400)) * b, hours: Math.max(0, parseInt(a % 86400 / 3600)) * b, minutes: Math.max(0, parseInt(a % 86400 % 3600 / 60)) * b, seconds: Math.max(0, parseInt(a % 86400 % 3600 % 60)) * b }
} function dhms2str(a) { var b = ""; return a.days && (b += a.days + _("d") + " "), a.hours && (b += a.hours + _("h") + " "), a.minutes && (b += a.minutes + _("m") + " "), a.seconds && (b += a.seconds + _("s") + " "), "" === b && (b = "0" + _("s")), b.trim() } function dhms2sec(a) { return parseInt(86400 * a.days + 3600 * a.hours + 60 * a.minutes + a.seconds) } function isControllerConnected() { return !("" === currIp || $.isEmptyObject(controller) || $.isEmptyObject(controller.options) || $.isEmptyObject(controller.programs) || $.isEmptyObject(controller.settings) || $.isEmptyObject(controller.status) || $.isEmptyObject(controller.stations)) } function exportObj(a, b, c) { if (b = encodeURIComponent(JSON.stringify(b)), isFileCapable) $(a).attr({ href: "data:text/json;charset=utf-8," + b, download: "backup-" + (new Date).toLocaleDateString().replace(/\//g, "-") + ".json" }); else { c = c || "OpenSprinkler Data Export on " + dateToString(new Date); var d = "mailto:?subject=" + encodeURIComponent(c) + "&body=" + b; $(a).attr("href", d).on("click", function () { window.open(d) }) } } function sortObj(a, b) { var c = []; for (var d in a) a.hasOwnProperty(d) && c.push(d); "function" == typeof b ? c.sort(b) : "value" === b ? c.sort(function (b, c) { var d = a[b], e = a[c]; return d < e ? -1 : d > e ? 1 : 0 }) : c.sort(); for (var e = {}, f = 0; f < c.length; f++)e[c[f]] = a[c[f]]; return e } function getDayName(a, b) { var c = [_("Sunday"), _("Monday"), _("Tuesday"), _("Wednesday"), _("Thursday"), _("Friday"), _("Saturday")], d = [_("Sun"), _("Mon"), _("Tue"), _("Wed"), _("Thu"), _("Fri"), _("Sat")]; return "short" === b ? d[a.getDay()] : c[a.getDay()] } function pad(a) { var b = String(a); return 1 === b.length && (b = "0" + b), b } function htmlEscape(a) { return String(a).replace(/&/g, "&amp;").replace(/"/g, "&quot;").replace(/'/g, "&#39;").replace(/</g, "&lt;").replace(/>/g, "&gt;") } function _(a) { if ("object" == typeof language && language.hasOwnProperty(a)) { var b = language[a]; return b ? b : a } return a } function setLang() { $("[data-translate]").text(function () { var a = $(this), b = a.data("translate"); return a.is("input[type='submit']") ? (a.val(_(b)), void (a.parent("div.ui-btn").length > 0 && a.button("refresh"))) : _(b) }), $(".ui-toolbar-back-btn").text(_("Back")), checkCurrLang() } function updateLang(a) { return language = {}, "undefined" == typeof a ? void storage.get("lang", function (a) { var b = a.lang || navigator.language || navigator.browserLanguage || navigator.systemLanguage || navigator.userLanguage || "en"; updateLang(b.substring(0, 2)) }) : (storage.set({ lang: a }), currLang = a, "en" === a ? void setLang() : void $.getJSON(getAppURLPath() + "locale/" + a + ".js", function (a) { language = a.messages, setLang() }).fail(setLang)) } function languageSelect() { $("#localization").popup("destroy").remove(); var a = "<div data-role='popup' data-theme='a' id='localization' data-corners='false'><ul data-inset='true' data-role='listview' id='lang' data-corners='false'><li data-role='list-divider' data-theme='b' class='center' data-translate='Localization'>" + _("Localization") + "</li>", b = { af: "Afrikaans", am: "Amharic", zh: "Chinese", hr: "Croatian", cs: "Czech", nl: "Dutch", en: "English", pes: "Farsi", fr: "French", de: "German", el: "Greek", he: "Hebrew", hu: "Hungarian", is: "Icelandic", it: "Italian", lv: "Latvian", mn: "Mongolian", no: "Norwegian", pl: "Polish", pt: "Portuguese", ru: "Russian", sk: "Slovak", sl: "Slovenian", es: "Spanish", th: "Thai" }; return $.each(b, function (b, c) { a += "<li><a href='#' data-translate='" + c + "' data-lang-code='" + b + "'>" + _(c) + "</a></li>" }), a += "</ul></div>", a = $(a), a.find("a").on("click", function () { var a = $(this), b = a.data("lang-code"); updateLang(b) }), openPopup(a), !1 } function checkCurrLang() { storage.get("lang", function (a) { var b = $("#localization"); b.find("a").each(function () { var b = $(this); b.data("lang-code") === a.lang ? b.removeClass("ui-icon-carat-r").addClass("ui-icon-check") : b.removeClass("ui-icon-check").addClass("ui-icon-carat-r") }), b.find("li.ui-last-child").removeClass("ui-last-child") }) } function getAppURLPath() { return currLocal ? $.mobile.path.parseUrl($("head").find("script[src$='app.jgz'],script[src$='app.js']").attr("src")).hrefNoHash.slice(0, -10) : "" } function getUrlVars(a) { for (var b, c = {}, d = a.slice(a.indexOf("?") + 1).split("&"), e = 0; e < d.length; e++)b = d[e].split("="), c[b[0]] = decodeURIComponent(b[1].replace(/\+/g, "%20")); return c } function escapeJSON(a) { return JSON.stringify(a).replace(/\{|\}/g, "") } function isMD5(a) { return /^[a-f0-9]{32}$/i.test(a) } function sortByStation(a, b) { return a.station < b.station ? -1 : a.station > b.station ? 1 : 0 } function minutesToTime(a) { var b = a > 719 ? "PM" : "AM", c = parseInt(a / 60) % 12; return 0 === c && (c = 12), c + ":" + pad(a % 60) + " " + b } function getBitFromByte(a, b) { return 0 !== (a & 1 << b) } function getTimezoneOffset() { var a = controller.options.tz - 48, b = a >= 0 ? 1 : -1; return a = 60 * (Math.abs(a) / 4 >> 0) + (Math.abs(a) % 4 * 15 / 10 >> 0) + Math.abs(a) % 4 * 15 % 10, a * b } function dateToString(a, b, c) { var d = [_("Sun"), _("Mon"), _("Tue"), _("Wed"), _("Thr"), _("Fri"), _("Sat")], e = [_("Jan"), _("Feb"), _("Mar"), _("Apr"), _("May"), _("Jun"), _("Jul"), _("Aug"), _("Sep"), _("Oct"), _("Nov"), _("Dec")]; return 0 === a.getTime() ? "--" : (b !== !1 && a.setMinutes(a.getMinutes() + a.getTimezoneOffset()), "de" === currLang ? pad(a.getDate()) + "." + pad(a.getMonth() + 1) + "." + a.getFullYear() + " " + pad(a.getHours()) + ":" + pad(a.getMinutes()) + ":" + pad(a.getSeconds()) : c ? e[a.getMonth()] + " " + pad(a.getDate()) + ", " + a.getFullYear() + " " + pad(a.getHours()) + ":" + pad(a.getMinutes()) + ":" + pad(a.getSeconds()) : d[a.getDay()] + ", " + pad(a.getDate()) + " " + e[a.getMonth()] + " " + a.getFullYear() + " " + pad(a.getHours()) + ":" + pad(a.getMinutes()) + ":" + pad(a.getSeconds())) } function q(a) { throw a } function w(a, b, c) { 4 !== b.length && q(new sjcl.exception.invalid("invalid aes block size")); var d = a.b[c], e = b[0] ^ d[0], f = b[c ? 3 : 1] ^ d[1], g = b[2] ^ d[2]; b = b[c ? 1 : 3] ^ d[3]; var h, i, j, k, l = d.length / 4 - 2, m = 4, n = [0, 0, 0, 0]; h = a.l[c], a = h[0]; var o = h[1], p = h[2], r = h[3], s = h[4]; for (k = 0; k < l; k++)h = a[e >>> 24] ^ o[f >> 16 & 255] ^ p[g >> 8 & 255] ^ r[255 & b] ^ d[m], i = a[f >>> 24] ^ o[g >> 16 & 255] ^ p[b >> 8 & 255] ^ r[255 & e] ^ d[m + 1], j = a[g >>> 24] ^ o[b >> 16 & 255] ^ p[e >> 8 & 255] ^ r[255 & f] ^ d[m + 2], b = a[b >>> 24] ^ o[e >> 16 & 255] ^ p[f >> 8 & 255] ^ r[255 & g] ^ d[m + 3], m += 4, e = h, f = i, g = j; for (k = 0; 4 > k; k++)n[c ? 3 & -k : k] = s[e >>> 24] << 24 ^ s[f >> 16 & 255] << 16 ^ s[g >> 8 & 255] << 8 ^ s[255 & b] ^ d[m++], h = e, e = f, f = g, g = b, b = h; return n } function x(a, b) { var c, d, e, f = b.slice(0), g = a.s, h = a.b, i = g[0], j = g[1], k = g[2], l = g[3], m = g[4], n = g[5], o = g[6], p = g[7]; for (c = 0; 64 > c; c++)16 > c ? d = f[c] : (d = f[c + 1 & 15], e = f[c + 14 & 15], d = f[15 & c] = (d >>> 7 ^ d >>> 18 ^ d >>> 3 ^ d << 25 ^ d << 14) + (e >>> 17 ^ e >>> 19 ^ e >>> 10 ^ e << 15 ^ e << 13) + f[15 & c] + f[c + 9 & 15] | 0), d = d + p + (m >>> 6 ^ m >>> 11 ^ m >>> 25 ^ m << 26 ^ m << 21 ^ m << 7) + (o ^ m & (n ^ o)) + h[c], p = o, o = n, n = m, m = l + d | 0, l = k, k = j, j = i, i = d + (j & k ^ l & (j ^ k)) + (j >>> 2 ^ j >>> 13 ^ j >>> 22 ^ j << 30 ^ j << 19 ^ j << 10) | 0; g[0] = g[0] + i | 0, g[1] = g[1] + j | 0, g[2] = g[2] + k | 0, g[3] = g[3] + l | 0, g[4] = g[4] + m | 0, g[5] = g[5] + n | 0, g[6] = g[6] + o | 0, g[7] = g[7] + p | 0 } function C(a, b) { var c, d = sjcl.random.B[a], e = []; for (c in d) d.hasOwnProperty(c) && e.push(d[c]); for (c = 0; c < e.length; c++)e[c](b) } function E(a) { "undefined" != typeof window && window.performance && "function" == typeof window.performance.now ? sjcl.random.addEntropy(window.performance.now(), a, "loadtime") : sjcl.random.addEntropy((new Date).valueOf(), a, "loadtime") } function A(a) { a.b = B(a).concat(B(a)), a.C = new sjcl.cipher.aes(a.b) } function B(a) { for (var b = 0; 4 > b && (a.f[b] = a.f[b] + 1 | 0, !a.f[b]); b++); return a.C.encrypt(a.f) } function D(a, b) { return function () { b.apply(a, arguments) } } !function (a, b) { "object" == typeof module && "object" == typeof module.exports ? module.exports = a.document ? b(a, !0) : function (a) { if (!a.document) throw new Error("jQuery requires a window with a document"); return b(a) } : b(a) }("undefined" != typeof window ? window : this, function (a, b) {
    function c(a) { var b = a.length, c = _.type(a); return "function" !== c && !_.isWindow(a) && (!(1 !== a.nodeType || !b) || ("array" === c || 0 === b || "number" == typeof b && b > 0 && b - 1 in a)) } function d(a, b, c) { if (_.isFunction(b)) return _.grep(a, function (a, d) { return !!b.call(a, d, a) !== c }); if (b.nodeType) return _.grep(a, function (a) { return a === b !== c }); if ("string" == typeof b) { if (ha.test(b)) return _.filter(b, a, c); b = _.filter(b, a) } return _.grep(a, function (a) { return U.call(b, a) >= 0 !== c }) } function e(a, b) { for (; (a = a[b]) && 1 !== a.nodeType;); return a } function f(a) { var b = oa[a] = {}; return _.each(a.match(na) || [], function (a, c) { b[c] = !0 }), b } function g() { Z.removeEventListener("DOMContentLoaded", g, !1), a.removeEventListener("load", g, !1), _.ready() } function h() { Object.defineProperty(this.cache = {}, 0, { get: function () { return {} } }), this.expando = _.expando + Math.random() } function i(a, b, c) { var d; if (void 0 === c && 1 === a.nodeType) if (d = "data-" + b.replace(ua, "-$1").toLowerCase(), c = a.getAttribute(d), "string" == typeof c) { try { c = "true" === c || "false" !== c && ("null" === c ? null : +c + "" === c ? +c : ta.test(c) ? _.parseJSON(c) : c) } catch (a) { } sa.set(a, b, c) } else c = void 0; return c } function j() { return !0 } function k() { return !1 } function l() { try { return Z.activeElement } catch (a) { } } function m(a, b) { return _.nodeName(a, "table") && _.nodeName(11 !== b.nodeType ? b : b.firstChild, "tr") ? a.getElementsByTagName("tbody")[0] || a.appendChild(a.ownerDocument.createElement("tbody")) : a } function n(a) { return a.type = (null !== a.getAttribute("type")) + "/" + a.type, a } function o(a) { var b = Ka.exec(a.type); return b ? a.type = b[1] : a.removeAttribute("type"), a } function p(a, b) { for (var c = 0, d = a.length; d > c; c++)ra.set(a[c], "globalEval", !b || ra.get(b[c], "globalEval")) } function q(a, b) { var c, d, e, f, g, h, i, j; if (1 === b.nodeType) { if (ra.hasData(a) && (f = ra.access(a), g = ra.set(b, f), j = f.events)) { delete g.handle, g.events = {}; for (e in j) for (c = 0, d = j[e].length; d > c; c++)_.event.add(b, e, j[e][c]) } sa.hasData(a) && (h = sa.access(a), i = _.extend({}, h), sa.set(b, i)) } } function r(a, b) { var c = a.getElementsByTagName ? a.getElementsByTagName(b || "*") : a.querySelectorAll ? a.querySelectorAll(b || "*") : []; return void 0 === b || b && _.nodeName(a, b) ? _.merge([a], c) : c } function s(a, b) { var c = b.nodeName.toLowerCase(); "input" === c && ya.test(a.type) ? b.checked = a.checked : ("input" === c || "textarea" === c) && (b.defaultValue = a.defaultValue) } function t(b, c) { var d, e = _(c.createElement(b)).appendTo(c.body), f = a.getDefaultComputedStyle && (d = a.getDefaultComputedStyle(e[0])) ? d.display : _.css(e[0], "display"); return e.detach(), f } function u(a) { var b = Z, c = Oa[a]; return c || (c = t(a, b), "none" !== c && c || (Na = (Na || _("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement), b = Na[0].contentDocument, b.write(), b.close(), c = t(a, b), Na.detach()), Oa[a] = c), c } function v(a, b, c) { var d, e, f, g, h = a.style; return c = c || Ra(a), c && (g = c.getPropertyValue(b) || c[b]), c && ("" !== g || _.contains(a.ownerDocument, a) || (g = _.style(a, b)), Qa.test(g) && Pa.test(b) && (d = h.width, e = h.minWidth, f = h.maxWidth, h.minWidth = h.maxWidth = h.width = g, g = c.width, h.width = d, h.minWidth = e, h.maxWidth = f)), void 0 !== g ? g + "" : g } function w(a, b) { return { get: function () { return a() ? void delete this.get : (this.get = b).apply(this, arguments) } } } function x(a, b) { if (b in a) return b; for (var c = b[0].toUpperCase() + b.slice(1), d = b, e = Xa.length; e--;)if (b = Xa[e] + c, b in a) return b; return d } function y(a, b, c) { var d = Ta.exec(b); return d ? Math.max(0, d[1] - (c || 0)) + (d[2] || "px") : b } function z(a, b, c, d, e) { for (var f = c === (d ? "border" : "content") ? 4 : "width" === b ? 1 : 0, g = 0; 4 > f; f += 2)"margin" === c && (g += _.css(a, c + wa[f], !0, e)), d ? ("content" === c && (g -= _.css(a, "padding" + wa[f], !0, e)), "margin" !== c && (g -= _.css(a, "border" + wa[f] + "Width", !0, e))) : (g += _.css(a, "padding" + wa[f], !0, e), "padding" !== c && (g += _.css(a, "border" + wa[f] + "Width", !0, e))); return g } function A(a, b, c) { var d = !0, e = "width" === b ? a.offsetWidth : a.offsetHeight, f = Ra(a), g = "border-box" === _.css(a, "boxSizing", !1, f); if (0 >= e || null == e) { if (e = v(a, b, f), (0 > e || null == e) && (e = a.style[b]), Qa.test(e)) return e; d = g && (Y.boxSizingReliable() || e === a.style[b]), e = parseFloat(e) || 0 } return e + z(a, b, c || (g ? "border" : "content"), d, f) + "px" } function B(a, b) { for (var c, d, e, f = [], g = 0, h = a.length; h > g; g++)d = a[g], d.style && (f[g] = ra.get(d, "olddisplay"), c = d.style.display, b ? (f[g] || "none" !== c || (d.style.display = ""), "" === d.style.display && xa(d) && (f[g] = ra.access(d, "olddisplay", u(d.nodeName)))) : (e = xa(d), "none" === c && e || ra.set(d, "olddisplay", e ? c : _.css(d, "display")))); for (g = 0; h > g; g++)d = a[g], d.style && (b && "none" !== d.style.display && "" !== d.style.display || (d.style.display = b ? f[g] || "" : "none")); return a } function C(a, b, c, d, e) { return new C.prototype.init(a, b, c, d, e) } function D() { return setTimeout(function () { Ya = void 0 }), Ya = _.now() } function E(a, b) { var c, d = 0, e = { height: a }; for (b = b ? 1 : 0; 4 > d; d += 2 - b)c = wa[d], e["margin" + c] = e["padding" + c] = a; return b && (e.opacity = e.width = a), e } function F(a, b, c) { for (var d, e = (cb[b] || []).concat(cb["*"]), f = 0, g = e.length; g > f; f++)if (d = e[f].call(c, b, a)) return d } function G(a, b, c) { var d, e, f, g, h, i, j, k, l = this, m = {}, n = a.style, o = a.nodeType && xa(a), p = ra.get(a, "fxshow"); c.queue || (h = _._queueHooks(a, "fx"), null == h.unqueued && (h.unqueued = 0, i = h.empty.fire, h.empty.fire = function () { h.unqueued || i() }), h.unqueued++ , l.always(function () { l.always(function () { h.unqueued-- , _.queue(a, "fx").length || h.empty.fire() }) })), 1 === a.nodeType && ("height" in b || "width" in b) && (c.overflow = [n.overflow, n.overflowX, n.overflowY], j = _.css(a, "display"), k = "none" === j ? ra.get(a, "olddisplay") || u(a.nodeName) : j, "inline" === k && "none" === _.css(a, "float") && (n.display = "inline-block")), c.overflow && (n.overflow = "hidden", l.always(function () { n.overflow = c.overflow[0], n.overflowX = c.overflow[1], n.overflowY = c.overflow[2] })); for (d in b) if (e = b[d], $a.exec(e)) { if (delete b[d], f = f || "toggle" === e, e === (o ? "hide" : "show")) { if ("show" !== e || !p || void 0 === p[d]) continue; o = !0 } m[d] = p && p[d] || _.style(a, d) } else j = void 0; if (_.isEmptyObject(m)) "inline" === ("none" === j ? u(a.nodeName) : j) && (n.display = j); else { p ? "hidden" in p && (o = p.hidden) : p = ra.access(a, "fxshow", {}), f && (p.hidden = !o), o ? _(a).show() : l.done(function () { _(a).hide() }), l.done(function () { var b; ra.remove(a, "fxshow"); for (b in m) _.style(a, b, m[b]) }); for (d in m) g = F(o ? p[d] : 0, d, l), d in p || (p[d] = g.start, o && (g.end = g.start, g.start = "width" === d || "height" === d ? 1 : 0)) } } function H(a, b) { var c, d, e, f, g; for (c in a) if (d = _.camelCase(c), e = b[d], f = a[c], _.isArray(f) && (e = f[1], f = a[c] = f[0]), c !== d && (a[d] = f, delete a[c]), g = _.cssHooks[d], g && "expand" in g) { f = g.expand(f), delete a[d]; for (c in f) c in a || (a[c] = f[c], b[c] = e) } else b[d] = e } function I(a, b, c) { var d, e, f = 0, g = bb.length, h = _.Deferred().always(function () { delete i.elem }), i = function () { if (e) return !1; for (var b = Ya || D(), c = Math.max(0, j.startTime + j.duration - b), d = c / j.duration || 0, f = 1 - d, g = 0, i = j.tweens.length; i > g; g++)j.tweens[g].run(f); return h.notifyWith(a, [j, f, c]), 1 > f && i ? c : (h.resolveWith(a, [j]), !1) }, j = h.promise({ elem: a, props: _.extend({}, b), opts: _.extend(!0, { specialEasing: {} }, c), originalProperties: b, originalOptions: c, startTime: Ya || D(), duration: c.duration, tweens: [], createTween: function (b, c) { var d = _.Tween(a, j.opts, b, c, j.opts.specialEasing[b] || j.opts.easing); return j.tweens.push(d), d }, stop: function (b) { var c = 0, d = b ? j.tweens.length : 0; if (e) return this; for (e = !0; d > c; c++)j.tweens[c].run(1); return b ? h.resolveWith(a, [j, b]) : h.rejectWith(a, [j, b]), this } }), k = j.props; for (H(k, j.opts.specialEasing); g > f; f++)if (d = bb[f].call(j, a, k, j.opts)) return d; return _.map(k, F, j), _.isFunction(j.opts.start) && j.opts.start.call(a, j), _.fx.timer(_.extend(i, { elem: a, anim: j, queue: j.opts.queue })), j.progress(j.opts.progress).done(j.opts.done, j.opts.complete).fail(j.opts.fail).always(j.opts.always) } function J(a) { return function (b, c) { "string" != typeof b && (c = b, b = "*"); var d, e = 0, f = b.toLowerCase().match(na) || []; if (_.isFunction(c)) for (; d = f[e++];)"+" === d[0] ? (d = d.slice(1) || "*", (a[d] = a[d] || []).unshift(c)) : (a[d] = a[d] || []).push(c) } } function K(a, b, c, d) { function e(h) { var i; return f[h] = !0, _.each(a[h] || [], function (a, h) { var j = h(b, c, d); return "string" != typeof j || g || f[j] ? g ? !(i = j) : void 0 : (b.dataTypes.unshift(j), e(j), !1) }), i } var f = {}, g = a === vb; return e(b.dataTypes[0]) || !f["*"] && e("*") } function L(a, b) { var c, d, e = _.ajaxSettings.flatOptions || {}; for (c in b) void 0 !== b[c] && ((e[c] ? a : d || (d = {}))[c] = b[c]); return d && _.extend(!0, a, d), a } function M(a, b, c) { for (var d, e, f, g, h = a.contents, i = a.dataTypes; "*" === i[0];)i.shift(), void 0 === d && (d = a.mimeType || b.getResponseHeader("Content-Type")); if (d) for (e in h) if (h[e] && h[e].test(d)) { i.unshift(e); break } if (i[0] in c) f = i[0]; else { for (e in c) { if (!i[0] || a.converters[e + " " + i[0]]) { f = e; break } g || (g = e) } f = f || g } return f ? (f !== i[0] && i.unshift(f), c[f]) : void 0 } function N(a, b, c, d) { var e, f, g, h, i, j = {}, k = a.dataTypes.slice(); if (k[1]) for (g in a.converters) j[g.toLowerCase()] = a.converters[g]; for (f = k.shift(); f;)if (a.responseFields[f] && (c[a.responseFields[f]] = b), !i && d && a.dataFilter && (b = a.dataFilter(b, a.dataType)), i = f, f = k.shift()) if ("*" === f) f = i; else if ("*" !== i && i !== f) { if (g = j[i + " " + f] || j["* " + f], !g) for (e in j) if (h = e.split(" "), h[1] === f && (g = j[i + " " + h[0]] || j["* " + h[0]])) { g === !0 ? g = j[e] : j[e] !== !0 && (f = h[0], k.unshift(h[1])); break } if (g !== !0) if (g && a.throws) b = g(b); else try { b = g(b) } catch (a) { return { state: "parsererror", error: g ? a : "No conversion from " + i + " to " + f } } } return { state: "success", data: b } } function O(a, b, c, d) { var e; if (_.isArray(b)) _.each(b, function (b, e) { c || yb.test(a) ? d(a, e) : O(a + "[" + ("object" == typeof e ? b : "") + "]", e, c, d) }); else if (c || "object" !== _.type(b)) d(a, b); else for (e in b) O(a + "[" + e + "]", b[e], c, d) } function P(a) { return _.isWindow(a) ? a : 9 === a.nodeType && a.defaultView } var Q = [], R = Q.slice, S = Q.concat, T = Q.push, U = Q.indexOf, V = {}, W = V.toString, X = V.hasOwnProperty, Y = {}, Z = a.document, $ = "2.1.1", _ = function (a, b) { return new _.fn.init(a, b) }, aa = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, ba = /^-ms-/, ca = /-([\da-z])/gi, da = function (a, b) { return b.toUpperCase() }; _.fn = _.prototype = { jquery: $, constructor: _, selector: "", length: 0, toArray: function () { return R.call(this) }, get: function (a) { return null != a ? 0 > a ? this[a + this.length] : this[a] : R.call(this) }, pushStack: function (a) { var b = _.merge(this.constructor(), a); return b.prevObject = this, b.context = this.context, b }, each: function (a, b) { return _.each(this, a, b) }, map: function (a) { return this.pushStack(_.map(this, function (b, c) { return a.call(b, c, b) })) }, slice: function () { return this.pushStack(R.apply(this, arguments)) }, first: function () { return this.eq(0) }, last: function () { return this.eq(-1) }, eq: function (a) { var b = this.length, c = +a + (0 > a ? b : 0); return this.pushStack(c >= 0 && b > c ? [this[c]] : []) }, end: function () { return this.prevObject || this.constructor(null) }, push: T, sort: Q.sort, splice: Q.splice }, _.extend = _.fn.extend = function () { var a, b, c, d, e, f, g = arguments[0] || {}, h = 1, i = arguments.length, j = !1; for ("boolean" == typeof g && (j = g, g = arguments[h] || {}, h++), "object" == typeof g || _.isFunction(g) || (g = {}), h === i && (g = this, h--); i > h; h++)if (null != (a = arguments[h])) for (b in a) c = g[b], d = a[b], g !== d && (j && d && (_.isPlainObject(d) || (e = _.isArray(d))) ? (e ? (e = !1, f = c && _.isArray(c) ? c : []) : f = c && _.isPlainObject(c) ? c : {}, g[b] = _.extend(j, f, d)) : void 0 !== d && (g[b] = d)); return g }, _.extend({ expando: "jQuery" + ($ + Math.random()).replace(/\D/g, ""), isReady: !0, error: function (a) { throw new Error(a) }, noop: function () { }, isFunction: function (a) { return "function" === _.type(a) }, isArray: Array.isArray, isWindow: function (a) { return null != a && a === a.window }, isNumeric: function (a) { return !_.isArray(a) && a - parseFloat(a) >= 0 }, isPlainObject: function (a) { return "object" === _.type(a) && !a.nodeType && !_.isWindow(a) && !(a.constructor && !X.call(a.constructor.prototype, "isPrototypeOf")) }, isEmptyObject: function (a) { var b; for (b in a) return !1; return !0 }, type: function (a) { return null == a ? a + "" : "object" == typeof a || "function" == typeof a ? V[W.call(a)] || "object" : typeof a }, globalEval: function (a) { var b, c = eval; a = _.trim(a), a && (1 === a.indexOf("use strict") ? (b = Z.createElement("script"), b.text = a, Z.head.appendChild(b).parentNode.removeChild(b)) : c(a)) }, camelCase: function (a) { return a.replace(ba, "ms-").replace(ca, da) }, nodeName: function (a, b) { return a.nodeName && a.nodeName.toLowerCase() === b.toLowerCase() }, each: function (a, b, d) { var e, f = 0, g = a.length, h = c(a); if (d) { if (h) for (; g > f && (e = b.apply(a[f], d), e !== !1); f++); else for (f in a) if (e = b.apply(a[f], d), e === !1) break } else if (h) for (; g > f && (e = b.call(a[f], f, a[f]), e !== !1); f++); else for (f in a) if (e = b.call(a[f], f, a[f]), e === !1) break; return a }, trim: function (a) { return null == a ? "" : (a + "").replace(aa, "") }, makeArray: function (a, b) { var d = b || []; return null != a && (c(Object(a)) ? _.merge(d, "string" == typeof a ? [a] : a) : T.call(d, a)), d }, inArray: function (a, b, c) { return null == b ? -1 : U.call(b, a, c) }, merge: function (a, b) { for (var c = +b.length, d = 0, e = a.length; c > d; d++)a[e++] = b[d]; return a.length = e, a }, grep: function (a, b, c) { for (var d, e = [], f = 0, g = a.length, h = !c; g > f; f++)d = !b(a[f], f), d !== h && e.push(a[f]); return e }, map: function (a, b, d) { var e, f = 0, g = a.length, h = c(a), i = []; if (h) for (; g > f; f++)e = b(a[f], f, d), null != e && i.push(e); else for (f in a) e = b(a[f], f, d), null != e && i.push(e); return S.apply([], i) }, guid: 1, proxy: function (a, b) { var c, d, e; return "string" == typeof b && (c = a[b], b = a, a = c), _.isFunction(a) ? (d = R.call(arguments, 2), e = function () { return a.apply(b || this, d.concat(R.call(arguments))) }, e.guid = a.guid = a.guid || _.guid++ , e) : void 0 }, now: Date.now, support: Y }), _.each("Boolean Number String Function Array Date RegExp Object Error".split(" "), function (a, b) { V["[object " + b + "]"] = b.toLowerCase() }); var ea = function (a) {
        function b(a, b, c, d) { var e, f, g, h, i, j, l, n, o, p; if ((b ? b.ownerDocument || b : O) !== G && F(b), b = b || G, c = c || [], !a || "string" != typeof a) return c; if (1 !== (h = b.nodeType) && 9 !== h) return []; if (I && !d) { if (e = sa.exec(a)) if (g = e[1]) { if (9 === h) { if (f = b.getElementById(g), !f || !f.parentNode) return c; if (f.id === g) return c.push(f), c } else if (b.ownerDocument && (f = b.ownerDocument.getElementById(g)) && M(b, f) && f.id === g) return c.push(f), c } else { if (e[2]) return _.apply(c, b.getElementsByTagName(a)), c; if ((g = e[3]) && v.getElementsByClassName && b.getElementsByClassName) return _.apply(c, b.getElementsByClassName(g)), c } if (v.qsa && (!J || !J.test(a))) { if (n = l = N, o = b, p = 9 === h && a, 1 === h && "object" !== b.nodeName.toLowerCase()) { for (j = z(a), (l = b.getAttribute("id")) ? n = l.replace(ua, "\\$&") : b.setAttribute("id", n), n = "[id='" + n + "'] ", i = j.length; i--;)j[i] = n + m(j[i]); o = ta.test(a) && k(b.parentNode) || b, p = j.join(",") } if (p) try { return _.apply(c, o.querySelectorAll(p)), c } catch (a) { } finally { l || b.removeAttribute("id") } } } return B(a.replace(ia, "$1"), b, c, d) } function c() { function a(c, d) { return b.push(c + " ") > w.cacheLength && delete a[b.shift()], a[c + " "] = d } var b = []; return a } function d(a) { return a[N] = !0, a } function e(a) { var b = G.createElement("div"); try { return !!a(b) } catch (a) { return !1 } finally { b.parentNode && b.parentNode.removeChild(b), b = null } } function f(a, b) { for (var c = a.split("|"), d = a.length; d--;)w.attrHandle[c[d]] = b } function g(a, b) { var c = b && a, d = c && 1 === a.nodeType && 1 === b.nodeType && (~b.sourceIndex || W) - (~a.sourceIndex || W); if (d) return d; if (c) for (; c = c.nextSibling;)if (c === b) return -1; return a ? 1 : -1 } function h(a) { return function (b) { var c = b.nodeName.toLowerCase(); return "input" === c && b.type === a } } function i(a) { return function (b) { var c = b.nodeName.toLowerCase(); return ("input" === c || "button" === c) && b.type === a } } function j(a) { return d(function (b) { return b = +b, d(function (c, d) { for (var e, f = a([], c.length, b), g = f.length; g--;)c[e = f[g]] && (c[e] = !(d[e] = c[e])) }) }) } function k(a) { return a && typeof a.getElementsByTagName !== V && a } function l() { } function m(a) { for (var b = 0, c = a.length, d = ""; c > b; b++)d += a[b].value; return d } function n(a, b, c) { var d = b.dir, e = c && "parentNode" === d, f = Q++; return b.first ? function (b, c, f) { for (; b = b[d];)if (1 === b.nodeType || e) return a(b, c, f) } : function (b, c, g) { var h, i, j = [P, f]; if (g) { for (; b = b[d];)if ((1 === b.nodeType || e) && a(b, c, g)) return !0 } else for (; b = b[d];)if (1 === b.nodeType || e) { if (i = b[N] || (b[N] = {}), (h = i[d]) && h[0] === P && h[1] === f) return j[2] = h[2]; if (i[d] = j, j[2] = a(b, c, g)) return !0 } } } function o(a) { return a.length > 1 ? function (b, c, d) { for (var e = a.length; e--;)if (!a[e](b, c, d)) return !1; return !0 } : a[0] } function p(a, c, d) { for (var e = 0, f = c.length; f > e; e++)b(a, c[e], d); return d } function q(a, b, c, d, e) { for (var f, g = [], h = 0, i = a.length, j = null != b; i > h; h++)(f = a[h]) && (!c || c(f, d, e)) && (g.push(f), j && b.push(h)); return g } function r(a, b, c, e, f, g) { return e && !e[N] && (e = r(e)), f && !f[N] && (f = r(f, g)), d(function (d, g, h, i) { var j, k, l, m = [], n = [], o = g.length, r = d || p(b || "*", h.nodeType ? [h] : h, []), s = !a || !d && b ? r : q(r, m, a, h, i), t = c ? f || (d ? a : o || e) ? [] : g : s; if (c && c(s, t, h, i), e) for (j = q(t, n), e(j, [], h, i), k = j.length; k--;)(l = j[k]) && (t[n[k]] = !(s[n[k]] = l)); if (d) { if (f || a) { if (f) { for (j = [], k = t.length; k--;)(l = t[k]) && j.push(s[k] = l); f(null, t = [], j, i) } for (k = t.length; k--;)(l = t[k]) && (j = f ? ba.call(d, l) : m[k]) > -1 && (d[j] = !(g[j] = l)) } } else t = q(t === g ? t.splice(o, t.length) : t), f ? f(null, g, t, i) : _.apply(g, t) }) } function s(a) { for (var b, c, d, e = a.length, f = w.relative[a[0].type], g = f || w.relative[" "], h = f ? 1 : 0, i = n(function (a) { return a === b }, g, !0), j = n(function (a) { return ba.call(b, a) > -1 }, g, !0), k = [function (a, c, d) { return !f && (d || c !== C) || ((b = c).nodeType ? i(a, c, d) : j(a, c, d)) }]; e > h; h++)if (c = w.relative[a[h].type]) k = [n(o(k), c)]; else { if (c = w.filter[a[h].type].apply(null, a[h].matches), c[N]) { for (d = ++h; e > d && !w.relative[a[d].type]; d++); return r(h > 1 && o(k), h > 1 && m(a.slice(0, h - 1).concat({ value: " " === a[h - 2].type ? "*" : "" })).replace(ia, "$1"), c, d > h && s(a.slice(h, d)), e > d && s(a = a.slice(d)), e > d && m(a)) } k.push(c) } return o(k) } function t(a, c) { var e = c.length > 0, f = a.length > 0, g = function (d, g, h, i, j) { var k, l, m, n = 0, o = "0", p = d && [], r = [], s = C, t = d || f && w.find.TAG("*", j), u = P += null == s ? 1 : Math.random() || .1, v = t.length; for (j && (C = g !== G && g); o !== v && null != (k = t[o]); o++) { if (f && k) { for (l = 0; m = a[l++];)if (m(k, g, h)) { i.push(k); break } j && (P = u) } e && ((k = !m && k) && n-- , d && p.push(k)) } if (n += o, e && o !== n) { for (l = 0; m = c[l++];)m(p, r, g, h); if (d) { if (n > 0) for (; o--;)p[o] || r[o] || (r[o] = Z.call(i)); r = q(r) } _.apply(i, r), j && !d && r.length > 0 && n + c.length > 1 && b.uniqueSort(i) } return j && (P = u, C = s), p }; return e ? d(g) : g } var u, v, w, x, y, z, A, B, C, D, E, F, G, H, I, J, K, L, M, N = "sizzle" + -new Date, O = a.document, P = 0, Q = 0, R = c(), S = c(), T = c(), U = function (a, b) { return a === b && (E = !0), 0 }, V = "undefined", W = 1 << 31, X = {}.hasOwnProperty, Y = [], Z = Y.pop, $ = Y.push, _ = Y.push, aa = Y.slice, ba = Y.indexOf || function (a) { for (var b = 0, c = this.length; c > b; b++)if (this[b] === a) return b; return -1 }, ca = "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped", da = "[\\x20\\t\\r\\n\\f]", ea = "(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+", fa = ea.replace("w", "w#"), ga = "\\[" + da + "*(" + ea + ")(?:" + da + "*([*^$|!~]?=)" + da + "*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|(" + fa + "))|)" + da + "*\\]", ha = ":(" + ea + ")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|" + ga + ")*)|.*)\\)|)", ia = new RegExp("^" + da + "+|((?:^|[^\\\\])(?:\\\\.)*)" + da + "+$", "g"), ja = new RegExp("^" + da + "*," + da + "*"), ka = new RegExp("^" + da + "*([>+~]|" + da + ")" + da + "*"), la = new RegExp("=" + da + "*([^\\]'\"]*?)" + da + "*\\]", "g"), ma = new RegExp(ha), na = new RegExp("^" + fa + "$"), oa = { ID: new RegExp("^#(" + ea + ")"), CLASS: new RegExp("^\\.(" + ea + ")"), TAG: new RegExp("^(" + ea.replace("w", "w*") + ")"), ATTR: new RegExp("^" + ga), PSEUDO: new RegExp("^" + ha), CHILD: new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + da + "*(even|odd|(([+-]|)(\\d*)n|)" + da + "*(?:([+-]|)" + da + "*(\\d+)|))" + da + "*\\)|)", "i"), bool: new RegExp("^(?:" + ca + ")$", "i"), needsContext: new RegExp("^" + da + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" + da + "*((?:-\\d)?\\d*)" + da + "*\\)|)(?=[^-]|$)", "i") }, pa = /^(?:input|select|textarea|button)$/i, qa = /^h\d$/i, ra = /^[^{]+\{\s*\[native \w/, sa = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/, ta = /[+~]/, ua = /'|\\/g, va = new RegExp("\\\\([\\da-f]{1,6}" + da + "?|(" + da + ")|.)", "ig"), wa = function (a, b, c) { var d = "0x" + b - 65536; return d !== d || c ? b : 0 > d ? String.fromCharCode(d + 65536) : String.fromCharCode(d >> 10 | 55296, 1023 & d | 56320) }; try { _.apply(Y = aa.call(O.childNodes), O.childNodes), Y[O.childNodes.length].nodeType } catch (a) { _ = { apply: Y.length ? function (a, b) { $.apply(a, aa.call(b)) } : function (a, b) { for (var c = a.length, d = 0; a[c++] = b[d++];); a.length = c - 1 } } } v = b.support = {}, y = b.isXML = function (a) { var b = a && (a.ownerDocument || a).documentElement; return !!b && "HTML" !== b.nodeName }, F = b.setDocument = function (a) { var b, c = a ? a.ownerDocument || a : O, d = c.defaultView; return c !== G && 9 === c.nodeType && c.documentElement ? (G = c, H = c.documentElement, I = !y(c), d && d !== d.top && (d.addEventListener ? d.addEventListener("unload", function () { F() }, !1) : d.attachEvent && d.attachEvent("onunload", function () { F() })), v.attributes = e(function (a) { return a.className = "i", !a.getAttribute("className") }), v.getElementsByTagName = e(function (a) { return a.appendChild(c.createComment("")), !a.getElementsByTagName("*").length }), v.getElementsByClassName = ra.test(c.getElementsByClassName) && e(function (a) { return a.innerHTML = "<div class='a'></div><div class='a i'></div>", a.firstChild.className = "i", 2 === a.getElementsByClassName("i").length }), v.getById = e(function (a) { return H.appendChild(a).id = N, !c.getElementsByName || !c.getElementsByName(N).length }), v.getById ? (w.find.ID = function (a, b) { if (typeof b.getElementById !== V && I) { var c = b.getElementById(a); return c && c.parentNode ? [c] : [] } }, w.filter.ID = function (a) { var b = a.replace(va, wa); return function (a) { return a.getAttribute("id") === b } }) : (delete w.find.ID, w.filter.ID = function (a) { var b = a.replace(va, wa); return function (a) { var c = typeof a.getAttributeNode !== V && a.getAttributeNode("id"); return c && c.value === b } }), w.find.TAG = v.getElementsByTagName ? function (a, b) { return typeof b.getElementsByTagName !== V ? b.getElementsByTagName(a) : void 0 } : function (a, b) { var c, d = [], e = 0, f = b.getElementsByTagName(a); if ("*" === a) { for (; c = f[e++];)1 === c.nodeType && d.push(c); return d } return f }, w.find.CLASS = v.getElementsByClassName && function (a, b) { return typeof b.getElementsByClassName !== V && I ? b.getElementsByClassName(a) : void 0 }, K = [], J = [], (v.qsa = ra.test(c.querySelectorAll)) && (e(function (a) { a.innerHTML = "<select msallowclip=''><option selected=''></option></select>", a.querySelectorAll("[msallowclip^='']").length && J.push("[*^$]=" + da + "*(?:''|\"\")"), a.querySelectorAll("[selected]").length || J.push("\\[" + da + "*(?:value|" + ca + ")"), a.querySelectorAll(":checked").length || J.push(":checked") }), e(function (a) { var b = c.createElement("input"); b.setAttribute("type", "hidden"), a.appendChild(b).setAttribute("name", "D"), a.querySelectorAll("[name=d]").length && J.push("name" + da + "*[*^$|!~]?="), a.querySelectorAll(":enabled").length || J.push(":enabled", ":disabled"), a.querySelectorAll("*,:x"), J.push(",.*:") })), (v.matchesSelector = ra.test(L = H.matches || H.webkitMatchesSelector || H.mozMatchesSelector || H.oMatchesSelector || H.msMatchesSelector)) && e(function (a) { v.disconnectedMatch = L.call(a, "div"), L.call(a, "[s!='']:x"), K.push("!=", ha) }), J = J.length && new RegExp(J.join("|")), K = K.length && new RegExp(K.join("|")), b = ra.test(H.compareDocumentPosition), M = b || ra.test(H.contains) ? function (a, b) { var c = 9 === a.nodeType ? a.documentElement : a, d = b && b.parentNode; return a === d || !(!d || 1 !== d.nodeType || !(c.contains ? c.contains(d) : a.compareDocumentPosition && 16 & a.compareDocumentPosition(d))) } : function (a, b) { if (b) for (; b = b.parentNode;)if (b === a) return !0; return !1 }, U = b ? function (a, b) { if (a === b) return E = !0, 0; var d = !a.compareDocumentPosition - !b.compareDocumentPosition; return d ? d : (d = (a.ownerDocument || a) === (b.ownerDocument || b) ? a.compareDocumentPosition(b) : 1, 1 & d || !v.sortDetached && b.compareDocumentPosition(a) === d ? a === c || a.ownerDocument === O && M(O, a) ? -1 : b === c || b.ownerDocument === O && M(O, b) ? 1 : D ? ba.call(D, a) - ba.call(D, b) : 0 : 4 & d ? -1 : 1) } : function (a, b) { if (a === b) return E = !0, 0; var d, e = 0, f = a.parentNode, h = b.parentNode, i = [a], j = [b]; if (!f || !h) return a === c ? -1 : b === c ? 1 : f ? -1 : h ? 1 : D ? ba.call(D, a) - ba.call(D, b) : 0; if (f === h) return g(a, b); for (d = a; d = d.parentNode;)i.unshift(d); for (d = b; d = d.parentNode;)j.unshift(d); for (; i[e] === j[e];)e++; return e ? g(i[e], j[e]) : i[e] === O ? -1 : j[e] === O ? 1 : 0 }, c) : G }, b.matches = function (a, c) { return b(a, null, null, c) }, b.matchesSelector = function (a, c) { if ((a.ownerDocument || a) !== G && F(a), c = c.replace(la, "='$1']"), !(!v.matchesSelector || !I || K && K.test(c) || J && J.test(c))) try { var d = L.call(a, c); if (d || v.disconnectedMatch || a.document && 11 !== a.document.nodeType) return d } catch (a) { } return b(c, G, null, [a]).length > 0 }, b.contains = function (a, b) { return (a.ownerDocument || a) !== G && F(a), M(a, b) }, b.attr = function (a, b) { (a.ownerDocument || a) !== G && F(a); var c = w.attrHandle[b.toLowerCase()], d = c && X.call(w.attrHandle, b.toLowerCase()) ? c(a, b, !I) : void 0; return void 0 !== d ? d : v.attributes || !I ? a.getAttribute(b) : (d = a.getAttributeNode(b)) && d.specified ? d.value : null }, b.error = function (a) { throw new Error("Syntax error, unrecognized expression: " + a) }, b.uniqueSort = function (a) { var b, c = [], d = 0, e = 0; if (E = !v.detectDuplicates, D = !v.sortStable && a.slice(0), a.sort(U), E) { for (; b = a[e++];)b === a[e] && (d = c.push(e)); for (; d--;)a.splice(c[d], 1) } return D = null, a }, x = b.getText = function (a) { var b, c = "", d = 0, e = a.nodeType; if (e) { if (1 === e || 9 === e || 11 === e) { if ("string" == typeof a.textContent) return a.textContent; for (a = a.firstChild; a; a = a.nextSibling)c += x(a) } else if (3 === e || 4 === e) return a.nodeValue } else for (; b = a[d++];)c += x(b); return c }, w = b.selectors = {
            cacheLength: 50, createPseudo: d, match: oa, attrHandle: {}, find: {}, relative: { ">": { dir: "parentNode", first: !0 }, " ": { dir: "parentNode" }, "+": { dir: "previousSibling", first: !0 }, "~": { dir: "previousSibling" } }, preFilter: {
                ATTR: function (a) {
                    return a[1] = a[1].replace(va, wa), a[3] = (a[3] || a[4] || a[5] || "").replace(va, wa),
                        "~=" === a[2] && (a[3] = " " + a[3] + " "), a.slice(0, 4)
                }, CHILD: function (a) { return a[1] = a[1].toLowerCase(), "nth" === a[1].slice(0, 3) ? (a[3] || b.error(a[0]), a[4] = +(a[4] ? a[5] + (a[6] || 1) : 2 * ("even" === a[3] || "odd" === a[3])), a[5] = +(a[7] + a[8] || "odd" === a[3])) : a[3] && b.error(a[0]), a }, PSEUDO: function (a) { var b, c = !a[6] && a[2]; return oa.CHILD.test(a[0]) ? null : (a[3] ? a[2] = a[4] || a[5] || "" : c && ma.test(c) && (b = z(c, !0)) && (b = c.indexOf(")", c.length - b) - c.length) && (a[0] = a[0].slice(0, b), a[2] = c.slice(0, b)), a.slice(0, 3)) }
            }, filter: { TAG: function (a) { var b = a.replace(va, wa).toLowerCase(); return "*" === a ? function () { return !0 } : function (a) { return a.nodeName && a.nodeName.toLowerCase() === b } }, CLASS: function (a) { var b = R[a + " "]; return b || (b = new RegExp("(^|" + da + ")" + a + "(" + da + "|$)")) && R(a, function (a) { return b.test("string" == typeof a.className && a.className || typeof a.getAttribute !== V && a.getAttribute("class") || "") }) }, ATTR: function (a, c, d) { return function (e) { var f = b.attr(e, a); return null == f ? "!=" === c : !c || (f += "", "=" === c ? f === d : "!=" === c ? f !== d : "^=" === c ? d && 0 === f.indexOf(d) : "*=" === c ? d && f.indexOf(d) > -1 : "$=" === c ? d && f.slice(-d.length) === d : "~=" === c ? (" " + f + " ").indexOf(d) > -1 : "|=" === c && (f === d || f.slice(0, d.length + 1) === d + "-")) } }, CHILD: function (a, b, c, d, e) { var f = "nth" !== a.slice(0, 3), g = "last" !== a.slice(-4), h = "of-type" === b; return 1 === d && 0 === e ? function (a) { return !!a.parentNode } : function (b, c, i) { var j, k, l, m, n, o, p = f !== g ? "nextSibling" : "previousSibling", q = b.parentNode, r = h && b.nodeName.toLowerCase(), s = !i && !h; if (q) { if (f) { for (; p;) { for (l = b; l = l[p];)if (h ? l.nodeName.toLowerCase() === r : 1 === l.nodeType) return !1; o = p = "only" === a && !o && "nextSibling" } return !0 } if (o = [g ? q.firstChild : q.lastChild], g && s) { for (k = q[N] || (q[N] = {}), j = k[a] || [], n = j[0] === P && j[1], m = j[0] === P && j[2], l = n && q.childNodes[n]; l = ++n && l && l[p] || (m = n = 0) || o.pop();)if (1 === l.nodeType && ++m && l === b) { k[a] = [P, n, m]; break } } else if (s && (j = (b[N] || (b[N] = {}))[a]) && j[0] === P) m = j[1]; else for (; (l = ++n && l && l[p] || (m = n = 0) || o.pop()) && ((h ? l.nodeName.toLowerCase() !== r : 1 !== l.nodeType) || !++m || (s && ((l[N] || (l[N] = {}))[a] = [P, m]), l !== b));); return m -= e, m === d || m % d === 0 && m / d >= 0 } } }, PSEUDO: function (a, c) { var e, f = w.pseudos[a] || w.setFilters[a.toLowerCase()] || b.error("unsupported pseudo: " + a); return f[N] ? f(c) : f.length > 1 ? (e = [a, a, "", c], w.setFilters.hasOwnProperty(a.toLowerCase()) ? d(function (a, b) { for (var d, e = f(a, c), g = e.length; g--;)d = ba.call(a, e[g]), a[d] = !(b[d] = e[g]) }) : function (a) { return f(a, 0, e) }) : f } }, pseudos: { not: d(function (a) { var b = [], c = [], e = A(a.replace(ia, "$1")); return e[N] ? d(function (a, b, c, d) { for (var f, g = e(a, null, d, []), h = a.length; h--;)(f = g[h]) && (a[h] = !(b[h] = f)) }) : function (a, d, f) { return b[0] = a, e(b, null, f, c), !c.pop() } }), has: d(function (a) { return function (c) { return b(a, c).length > 0 } }), contains: d(function (a) { return function (b) { return (b.textContent || b.innerText || x(b)).indexOf(a) > -1 } }), lang: d(function (a) { return na.test(a || "") || b.error("unsupported lang: " + a), a = a.replace(va, wa).toLowerCase(), function (b) { var c; do if (c = I ? b.lang : b.getAttribute("xml:lang") || b.getAttribute("lang")) return c = c.toLowerCase(), c === a || 0 === c.indexOf(a + "-"); while ((b = b.parentNode) && 1 === b.nodeType); return !1 } }), target: function (b) { var c = a.location && a.location.hash; return c && c.slice(1) === b.id }, root: function (a) { return a === H }, focus: function (a) { return a === G.activeElement && (!G.hasFocus || G.hasFocus()) && !!(a.type || a.href || ~a.tabIndex) }, enabled: function (a) { return a.disabled === !1 }, disabled: function (a) { return a.disabled === !0 }, checked: function (a) { var b = a.nodeName.toLowerCase(); return "input" === b && !!a.checked || "option" === b && !!a.selected }, selected: function (a) { return a.parentNode && a.parentNode.selectedIndex, a.selected === !0 }, empty: function (a) { for (a = a.firstChild; a; a = a.nextSibling)if (a.nodeType < 6) return !1; return !0 }, parent: function (a) { return !w.pseudos.empty(a) }, header: function (a) { return qa.test(a.nodeName) }, input: function (a) { return pa.test(a.nodeName) }, button: function (a) { var b = a.nodeName.toLowerCase(); return "input" === b && "button" === a.type || "button" === b }, text: function (a) { var b; return "input" === a.nodeName.toLowerCase() && "text" === a.type && (null == (b = a.getAttribute("type")) || "text" === b.toLowerCase()) }, first: j(function () { return [0] }), last: j(function (a, b) { return [b - 1] }), eq: j(function (a, b, c) { return [0 > c ? c + b : c] }), even: j(function (a, b) { for (var c = 0; b > c; c += 2)a.push(c); return a }), odd: j(function (a, b) { for (var c = 1; b > c; c += 2)a.push(c); return a }), lt: j(function (a, b, c) { for (var d = 0 > c ? c + b : c; --d >= 0;)a.push(d); return a }), gt: j(function (a, b, c) { for (var d = 0 > c ? c + b : c; ++d < b;)a.push(d); return a }) }
        }, w.pseudos.nth = w.pseudos.eq; for (u in { radio: !0, checkbox: !0, file: !0, password: !0, image: !0 }) w.pseudos[u] = h(u); for (u in { submit: !0, reset: !0 }) w.pseudos[u] = i(u); return l.prototype = w.filters = w.pseudos, w.setFilters = new l, z = b.tokenize = function (a, c) { var d, e, f, g, h, i, j, k = S[a + " "]; if (k) return c ? 0 : k.slice(0); for (h = a, i = [], j = w.preFilter; h;) { (!d || (e = ja.exec(h))) && (e && (h = h.slice(e[0].length) || h), i.push(f = [])), d = !1, (e = ka.exec(h)) && (d = e.shift(), f.push({ value: d, type: e[0].replace(ia, " ") }), h = h.slice(d.length)); for (g in w.filter) !(e = oa[g].exec(h)) || j[g] && !(e = j[g](e)) || (d = e.shift(), f.push({ value: d, type: g, matches: e }), h = h.slice(d.length)); if (!d) break } return c ? h.length : h ? b.error(a) : S(a, i).slice(0) }, A = b.compile = function (a, b) { var c, d = [], e = [], f = T[a + " "]; if (!f) { for (b || (b = z(a)), c = b.length; c--;)f = s(b[c]), f[N] ? d.push(f) : e.push(f); f = T(a, t(e, d)), f.selector = a } return f }, B = b.select = function (a, b, c, d) { var e, f, g, h, i, j = "function" == typeof a && a, l = !d && z(a = j.selector || a); if (c = c || [], 1 === l.length) { if (f = l[0] = l[0].slice(0), f.length > 2 && "ID" === (g = f[0]).type && v.getById && 9 === b.nodeType && I && w.relative[f[1].type]) { if (b = (w.find.ID(g.matches[0].replace(va, wa), b) || [])[0], !b) return c; j && (b = b.parentNode), a = a.slice(f.shift().value.length) } for (e = oa.needsContext.test(a) ? 0 : f.length; e-- && (g = f[e], !w.relative[h = g.type]);)if ((i = w.find[h]) && (d = i(g.matches[0].replace(va, wa), ta.test(f[0].type) && k(b.parentNode) || b))) { if (f.splice(e, 1), a = d.length && m(f), !a) return _.apply(c, d), c; break } } return (j || A(a, l))(d, b, !I, c, ta.test(a) && k(b.parentNode) || b), c }, v.sortStable = N.split("").sort(U).join("") === N, v.detectDuplicates = !!E, F(), v.sortDetached = e(function (a) { return 1 & a.compareDocumentPosition(G.createElement("div")) }), e(function (a) { return a.innerHTML = "<a href='#'></a>", "#" === a.firstChild.getAttribute("href") }) || f("type|href|height|width", function (a, b, c) { return c ? void 0 : a.getAttribute(b, "type" === b.toLowerCase() ? 1 : 2) }), v.attributes && e(function (a) { return a.innerHTML = "<input/>", a.firstChild.setAttribute("value", ""), "" === a.firstChild.getAttribute("value") }) || f("value", function (a, b, c) { return c || "input" !== a.nodeName.toLowerCase() ? void 0 : a.defaultValue }), e(function (a) { return null == a.getAttribute("disabled") }) || f(ca, function (a, b, c) { var d; return c ? void 0 : a[b] === !0 ? b.toLowerCase() : (d = a.getAttributeNode(b)) && d.specified ? d.value : null }), b
    }(a); _.find = ea, _.expr = ea.selectors, _.expr[":"] = _.expr.pseudos, _.unique = ea.uniqueSort, _.text = ea.getText, _.isXMLDoc = ea.isXML, _.contains = ea.contains; var fa = _.expr.match.needsContext, ga = /^<(\w+)\s*\/?>(?:<\/\1>|)$/, ha = /^.[^:#\[\.,]*$/; _.filter = function (a, b, c) { var d = b[0]; return c && (a = ":not(" + a + ")"), 1 === b.length && 1 === d.nodeType ? _.find.matchesSelector(d, a) ? [d] : [] : _.find.matches(a, _.grep(b, function (a) { return 1 === a.nodeType })) }, _.fn.extend({ find: function (a) { var b, c = this.length, d = [], e = this; if ("string" != typeof a) return this.pushStack(_(a).filter(function () { for (b = 0; c > b; b++)if (_.contains(e[b], this)) return !0 })); for (b = 0; c > b; b++)_.find(a, e[b], d); return d = this.pushStack(c > 1 ? _.unique(d) : d), d.selector = this.selector ? this.selector + " " + a : a, d }, filter: function (a) { return this.pushStack(d(this, a || [], !1)) }, not: function (a) { return this.pushStack(d(this, a || [], !0)) }, is: function (a) { return !!d(this, "string" == typeof a && fa.test(a) ? _(a) : a || [], !1).length } }); var ia, ja = /^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/, ka = _.fn.init = function (a, b) { var c, d; if (!a) return this; if ("string" == typeof a) { if (c = "<" === a[0] && ">" === a[a.length - 1] && a.length >= 3 ? [null, a, null] : ja.exec(a), !c || !c[1] && b) return !b || b.jquery ? (b || ia).find(a) : this.constructor(b).find(a); if (c[1]) { if (b = b instanceof _ ? b[0] : b, _.merge(this, _.parseHTML(c[1], b && b.nodeType ? b.ownerDocument || b : Z, !0)), ga.test(c[1]) && _.isPlainObject(b)) for (c in b) _.isFunction(this[c]) ? this[c](b[c]) : this.attr(c, b[c]); return this } return d = Z.getElementById(c[2]), d && d.parentNode && (this.length = 1, this[0] = d), this.context = Z, this.selector = a, this } return a.nodeType ? (this.context = this[0] = a, this.length = 1, this) : _.isFunction(a) ? "undefined" != typeof ia.ready ? ia.ready(a) : a(_) : (void 0 !== a.selector && (this.selector = a.selector, this.context = a.context), _.makeArray(a, this)) }; ka.prototype = _.fn, ia = _(Z); var la = /^(?:parents|prev(?:Until|All))/, ma = { children: !0, contents: !0, next: !0, prev: !0 }; _.extend({ dir: function (a, b, c) { for (var d = [], e = void 0 !== c; (a = a[b]) && 9 !== a.nodeType;)if (1 === a.nodeType) { if (e && _(a).is(c)) break; d.push(a) } return d }, sibling: function (a, b) { for (var c = []; a; a = a.nextSibling)1 === a.nodeType && a !== b && c.push(a); return c } }), _.fn.extend({ has: function (a) { var b = _(a, this), c = b.length; return this.filter(function () { for (var a = 0; c > a; a++)if (_.contains(this, b[a])) return !0 }) }, closest: function (a, b) { for (var c, d = 0, e = this.length, f = [], g = fa.test(a) || "string" != typeof a ? _(a, b || this.context) : 0; e > d; d++)for (c = this[d]; c && c !== b; c = c.parentNode)if (c.nodeType < 11 && (g ? g.index(c) > -1 : 1 === c.nodeType && _.find.matchesSelector(c, a))) { f.push(c); break } return this.pushStack(f.length > 1 ? _.unique(f) : f) }, index: function (a) { return a ? "string" == typeof a ? U.call(_(a), this[0]) : U.call(this, a.jquery ? a[0] : a) : this[0] && this[0].parentNode ? this.first().prevAll().length : -1 }, add: function (a, b) { return this.pushStack(_.unique(_.merge(this.get(), _(a, b)))) }, addBack: function (a) { return this.add(null == a ? this.prevObject : this.prevObject.filter(a)) } }), _.each({ parent: function (a) { var b = a.parentNode; return b && 11 !== b.nodeType ? b : null }, parents: function (a) { return _.dir(a, "parentNode") }, parentsUntil: function (a, b, c) { return _.dir(a, "parentNode", c) }, next: function (a) { return e(a, "nextSibling") }, prev: function (a) { return e(a, "previousSibling") }, nextAll: function (a) { return _.dir(a, "nextSibling") }, prevAll: function (a) { return _.dir(a, "previousSibling") }, nextUntil: function (a, b, c) { return _.dir(a, "nextSibling", c) }, prevUntil: function (a, b, c) { return _.dir(a, "previousSibling", c) }, siblings: function (a) { return _.sibling((a.parentNode || {}).firstChild, a) }, children: function (a) { return _.sibling(a.firstChild) }, contents: function (a) { return a.contentDocument || _.merge([], a.childNodes) } }, function (a, b) { _.fn[a] = function (c, d) { var e = _.map(this, b, c); return "Until" !== a.slice(-5) && (d = c), d && "string" == typeof d && (e = _.filter(d, e)), this.length > 1 && (ma[a] || _.unique(e), la.test(a) && e.reverse()), this.pushStack(e) } }); var na = /\S+/g, oa = {}; _.Callbacks = function (a) { a = "string" == typeof a ? oa[a] || f(a) : _.extend({}, a); var b, c, d, e, g, h, i = [], j = !a.once && [], k = function (f) { for (b = a.memory && f, c = !0, h = e || 0, e = 0, g = i.length, d = !0; i && g > h; h++)if (i[h].apply(f[0], f[1]) === !1 && a.stopOnFalse) { b = !1; break } d = !1, i && (j ? j.length && k(j.shift()) : b ? i = [] : l.disable()) }, l = { add: function () { if (i) { var c = i.length; !function b(c) { _.each(c, function (c, d) { var e = _.type(d); "function" === e ? a.unique && l.has(d) || i.push(d) : d && d.length && "string" !== e && b(d) }) }(arguments), d ? g = i.length : b && (e = c, k(b)) } return this }, remove: function () { return i && _.each(arguments, function (a, b) { for (var c; (c = _.inArray(b, i, c)) > -1;)i.splice(c, 1), d && (g >= c && g-- , h >= c && h--) }), this }, has: function (a) { return a ? _.inArray(a, i) > -1 : !(!i || !i.length) }, empty: function () { return i = [], g = 0, this }, disable: function () { return i = j = b = void 0, this }, disabled: function () { return !i }, lock: function () { return j = void 0, b || l.disable(), this }, locked: function () { return !j }, fireWith: function (a, b) { return !i || c && !j || (b = b || [], b = [a, b.slice ? b.slice() : b], d ? j.push(b) : k(b)), this }, fire: function () { return l.fireWith(this, arguments), this }, fired: function () { return !!c } }; return l }, _.extend({ Deferred: function (a) { var b = [["resolve", "done", _.Callbacks("once memory"), "resolved"], ["reject", "fail", _.Callbacks("once memory"), "rejected"], ["notify", "progress", _.Callbacks("memory")]], c = "pending", d = { state: function () { return c }, always: function () { return e.done(arguments).fail(arguments), this }, then: function () { var a = arguments; return _.Deferred(function (c) { _.each(b, function (b, f) { var g = _.isFunction(a[b]) && a[b]; e[f[1]](function () { var a = g && g.apply(this, arguments); a && _.isFunction(a.promise) ? a.promise().done(c.resolve).fail(c.reject).progress(c.notify) : c[f[0] + "With"](this === d ? c.promise() : this, g ? [a] : arguments) }) }), a = null }).promise() }, promise: function (a) { return null != a ? _.extend(a, d) : d } }, e = {}; return d.pipe = d.then, _.each(b, function (a, f) { var g = f[2], h = f[3]; d[f[1]] = g.add, h && g.add(function () { c = h }, b[1 ^ a][2].disable, b[2][2].lock), e[f[0]] = function () { return e[f[0] + "With"](this === e ? d : this, arguments), this }, e[f[0] + "With"] = g.fireWith }), d.promise(e), a && a.call(e, e), e }, when: function (a) { var b, c, d, e = 0, f = R.call(arguments), g = f.length, h = 1 !== g || a && _.isFunction(a.promise) ? g : 0, i = 1 === h ? a : _.Deferred(), j = function (a, c, d) { return function (e) { c[a] = this, d[a] = arguments.length > 1 ? R.call(arguments) : e, d === b ? i.notifyWith(c, d) : --h || i.resolveWith(c, d) } }; if (g > 1) for (b = new Array(g), c = new Array(g), d = new Array(g); g > e; e++)f[e] && _.isFunction(f[e].promise) ? f[e].promise().done(j(e, d, f)).fail(i.reject).progress(j(e, c, b)) : --h; return h || i.resolveWith(d, f), i.promise() } }); var pa; _.fn.ready = function (a) { return _.ready.promise().done(a), this }, _.extend({ isReady: !1, readyWait: 1, holdReady: function (a) { a ? _.readyWait++ : _.ready(!0) }, ready: function (a) { (a === !0 ? --_.readyWait : _.isReady) || (_.isReady = !0, a !== !0 && --_.readyWait > 0 || (pa.resolveWith(Z, [_]), _.fn.triggerHandler && (_(Z).triggerHandler("ready"), _(Z).off("ready")))) } }), _.ready.promise = function (b) { return pa || (pa = _.Deferred(), "complete" === Z.readyState ? setTimeout(_.ready) : (Z.addEventListener("DOMContentLoaded", g, !1), a.addEventListener("load", g, !1))), pa.promise(b) }, _.ready.promise(); var qa = _.access = function (a, b, c, d, e, f, g) { var h = 0, i = a.length, j = null == c; if ("object" === _.type(c)) { e = !0; for (h in c) _.access(a, b, h, c[h], !0, f, g) } else if (void 0 !== d && (e = !0, _.isFunction(d) || (g = !0), j && (g ? (b.call(a, d), b = null) : (j = b, b = function (a, b, c) { return j.call(_(a), c) })), b)) for (; i > h; h++)b(a[h], c, g ? d : d.call(a[h], h, b(a[h], c))); return e ? a : j ? b.call(a) : i ? b(a[0], c) : f }; _.acceptData = function (a) { return 1 === a.nodeType || 9 === a.nodeType || !+a.nodeType }, h.uid = 1, h.accepts = _.acceptData, h.prototype = { key: function (a) { if (!h.accepts(a)) return 0; var b = {}, c = a[this.expando]; if (!c) { c = h.uid++; try { b[this.expando] = { value: c }, Object.defineProperties(a, b) } catch (d) { b[this.expando] = c, _.extend(a, b) } } return this.cache[c] || (this.cache[c] = {}), c }, set: function (a, b, c) { var d, e = this.key(a), f = this.cache[e]; if ("string" == typeof b) f[b] = c; else if (_.isEmptyObject(f)) _.extend(this.cache[e], b); else for (d in b) f[d] = b[d]; return f }, get: function (a, b) { var c = this.cache[this.key(a)]; return void 0 === b ? c : c[b] }, access: function (a, b, c) { var d; return void 0 === b || b && "string" == typeof b && void 0 === c ? (d = this.get(a, b), void 0 !== d ? d : this.get(a, _.camelCase(b))) : (this.set(a, b, c), void 0 !== c ? c : b) }, remove: function (a, b) { var c, d, e, f = this.key(a), g = this.cache[f]; if (void 0 === b) this.cache[f] = {}; else { _.isArray(b) ? d = b.concat(b.map(_.camelCase)) : (e = _.camelCase(b), b in g ? d = [b, e] : (d = e, d = d in g ? [d] : d.match(na) || [])), c = d.length; for (; c--;)delete g[d[c]] } }, hasData: function (a) { return !_.isEmptyObject(this.cache[a[this.expando]] || {}) }, discard: function (a) { a[this.expando] && delete this.cache[a[this.expando]] } }; var ra = new h, sa = new h, ta = /^(?:\{[\w\W]*\}|\[[\w\W]*\])$/, ua = /([A-Z])/g; _.extend({ hasData: function (a) { return sa.hasData(a) || ra.hasData(a) }, data: function (a, b, c) { return sa.access(a, b, c) }, removeData: function (a, b) { sa.remove(a, b) }, _data: function (a, b, c) { return ra.access(a, b, c) }, _removeData: function (a, b) { ra.remove(a, b) } }), _.fn.extend({ data: function (a, b) { var c, d, e, f = this[0], g = f && f.attributes; if (void 0 === a) { if (this.length && (e = sa.get(f), 1 === f.nodeType && !ra.get(f, "hasDataAttrs"))) { for (c = g.length; c--;)g[c] && (d = g[c].name, 0 === d.indexOf("data-") && (d = _.camelCase(d.slice(5)), i(f, d, e[d]))); ra.set(f, "hasDataAttrs", !0) } return e } return "object" == typeof a ? this.each(function () { sa.set(this, a) }) : qa(this, function (b) { var c, d = _.camelCase(a); if (f && void 0 === b) { if (c = sa.get(f, a), void 0 !== c) return c; if (c = sa.get(f, d), void 0 !== c) return c; if (c = i(f, d, void 0), void 0 !== c) return c } else this.each(function () { var c = sa.get(this, d); sa.set(this, d, b), -1 !== a.indexOf("-") && void 0 !== c && sa.set(this, a, b) }) }, null, b, arguments.length > 1, null, !0) }, removeData: function (a) { return this.each(function () { sa.remove(this, a) }) } }), _.extend({ queue: function (a, b, c) { var d; return a ? (b = (b || "fx") + "queue", d = ra.get(a, b), c && (!d || _.isArray(c) ? d = ra.access(a, b, _.makeArray(c)) : d.push(c)), d || []) : void 0 }, dequeue: function (a, b) { b = b || "fx"; var c = _.queue(a, b), d = c.length, e = c.shift(), f = _._queueHooks(a, b), g = function () { _.dequeue(a, b) }; "inprogress" === e && (e = c.shift(), d--), e && ("fx" === b && c.unshift("inprogress"), delete f.stop, e.call(a, g, f)), !d && f && f.empty.fire() }, _queueHooks: function (a, b) { var c = b + "queueHooks"; return ra.get(a, c) || ra.access(a, c, { empty: _.Callbacks("once memory").add(function () { ra.remove(a, [b + "queue", c]) }) }) } }), _.fn.extend({ queue: function (a, b) { var c = 2; return "string" != typeof a && (b = a, a = "fx", c--), arguments.length < c ? _.queue(this[0], a) : void 0 === b ? this : this.each(function () { var c = _.queue(this, a, b); _._queueHooks(this, a), "fx" === a && "inprogress" !== c[0] && _.dequeue(this, a) }) }, dequeue: function (a) { return this.each(function () { _.dequeue(this, a) }) }, clearQueue: function (a) { return this.queue(a || "fx", []) }, promise: function (a, b) { var c, d = 1, e = _.Deferred(), f = this, g = this.length, h = function () { --d || e.resolveWith(f, [f]) }; for ("string" != typeof a && (b = a, a = void 0), a = a || "fx"; g--;)c = ra.get(f[g], a + "queueHooks"), c && c.empty && (d++ , c.empty.add(h)); return h(), e.promise(b) } }); var va = /[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source, wa = ["Top", "Right", "Bottom", "Left"], xa = function (a, b) { return a = b || a, "none" === _.css(a, "display") || !_.contains(a.ownerDocument, a) }, ya = /^(?:checkbox|radio)$/i; !function () { var a = Z.createDocumentFragment(), b = a.appendChild(Z.createElement("div")), c = Z.createElement("input"); c.setAttribute("type", "radio"), c.setAttribute("checked", "checked"), c.setAttribute("name", "t"), b.appendChild(c), Y.checkClone = b.cloneNode(!0).cloneNode(!0).lastChild.checked, b.innerHTML = "<textarea>x</textarea>", Y.noCloneChecked = !!b.cloneNode(!0).lastChild.defaultValue }(); var za = "undefined"; Y.focusinBubbles = "onfocusin" in a; var Aa = /^key/, Ba = /^(?:mouse|pointer|contextmenu)|click/, Ca = /^(?:focusinfocus|focusoutblur)$/, Da = /^([^.]*)(?:\.(.+)|)$/; _.event = { global: {}, add: function (a, b, c, d, e) { var f, g, h, i, j, k, l, m, n, o, p, q = ra.get(a); if (q) for (c.handler && (f = c, c = f.handler, e = f.selector), c.guid || (c.guid = _.guid++), (i = q.events) || (i = q.events = {}), (g = q.handle) || (g = q.handle = function (b) { return typeof _ !== za && _.event.triggered !== b.type ? _.event.dispatch.apply(a, arguments) : void 0 }), b = (b || "").match(na) || [""], j = b.length; j--;)h = Da.exec(b[j]) || [], n = p = h[1], o = (h[2] || "").split(".").sort(), n && (l = _.event.special[n] || {}, n = (e ? l.delegateType : l.bindType) || n, l = _.event.special[n] || {}, k = _.extend({ type: n, origType: p, data: d, handler: c, guid: c.guid, selector: e, needsContext: e && _.expr.match.needsContext.test(e), namespace: o.join(".") }, f), (m = i[n]) || (m = i[n] = [], m.delegateCount = 0, l.setup && l.setup.call(a, d, o, g) !== !1 || a.addEventListener && a.addEventListener(n, g, !1)), l.add && (l.add.call(a, k), k.handler.guid || (k.handler.guid = c.guid)), e ? m.splice(m.delegateCount++, 0, k) : m.push(k), _.event.global[n] = !0) }, remove: function (a, b, c, d, e) { var f, g, h, i, j, k, l, m, n, o, p, q = ra.hasData(a) && ra.get(a); if (q && (i = q.events)) { for (b = (b || "").match(na) || [""], j = b.length; j--;)if (h = Da.exec(b[j]) || [], n = p = h[1], o = (h[2] || "").split(".").sort(), n) { for (l = _.event.special[n] || {}, n = (d ? l.delegateType : l.bindType) || n, m = i[n] || [], h = h[2] && new RegExp("(^|\\.)" + o.join("\\.(?:.*\\.|)") + "(\\.|$)"), g = f = m.length; f--;)k = m[f], !e && p !== k.origType || c && c.guid !== k.guid || h && !h.test(k.namespace) || d && d !== k.selector && ("**" !== d || !k.selector) || (m.splice(f, 1), k.selector && m.delegateCount-- , l.remove && l.remove.call(a, k)); g && !m.length && (l.teardown && l.teardown.call(a, o, q.handle) !== !1 || _.removeEvent(a, n, q.handle), delete i[n]) } else for (n in i) _.event.remove(a, n + b[j], c, d, !0); _.isEmptyObject(i) && (delete q.handle, ra.remove(a, "events")) } }, trigger: function (b, c, d, e) { var f, g, h, i, j, k, l, m = [d || Z], n = X.call(b, "type") ? b.type : b, o = X.call(b, "namespace") ? b.namespace.split(".") : []; if (g = h = d = d || Z, 3 !== d.nodeType && 8 !== d.nodeType && !Ca.test(n + _.event.triggered) && (n.indexOf(".") >= 0 && (o = n.split("."), n = o.shift(), o.sort()), j = n.indexOf(":") < 0 && "on" + n, b = b[_.expando] ? b : new _.Event(n, "object" == typeof b && b), b.isTrigger = e ? 2 : 3, b.namespace = o.join("."), b.namespace_re = b.namespace ? new RegExp("(^|\\.)" + o.join("\\.(?:.*\\.|)") + "(\\.|$)") : null, b.result = void 0, b.target || (b.target = d), c = null == c ? [b] : _.makeArray(c, [b]), l = _.event.special[n] || {}, e || !l.trigger || l.trigger.apply(d, c) !== !1)) { if (!e && !l.noBubble && !_.isWindow(d)) { for (i = l.delegateType || n, Ca.test(i + n) || (g = g.parentNode); g; g = g.parentNode)m.push(g), h = g; h === (d.ownerDocument || Z) && m.push(h.defaultView || h.parentWindow || a) } for (f = 0; (g = m[f++]) && !b.isPropagationStopped();)b.type = f > 1 ? i : l.bindType || n, k = (ra.get(g, "events") || {})[b.type] && ra.get(g, "handle"), k && k.apply(g, c), k = j && g[j], k && k.apply && _.acceptData(g) && (b.result = k.apply(g, c), b.result === !1 && b.preventDefault()); return b.type = n, e || b.isDefaultPrevented() || l._default && l._default.apply(m.pop(), c) !== !1 || !_.acceptData(d) || j && _.isFunction(d[n]) && !_.isWindow(d) && (h = d[j], h && (d[j] = null), _.event.triggered = n, d[n](), _.event.triggered = void 0, h && (d[j] = h)), b.result } }, dispatch: function (a) { a = _.event.fix(a); var b, c, d, e, f, g = [], h = R.call(arguments), i = (ra.get(this, "events") || {})[a.type] || [], j = _.event.special[a.type] || {}; if (h[0] = a, a.delegateTarget = this, !j.preDispatch || j.preDispatch.call(this, a) !== !1) { for (g = _.event.handlers.call(this, a, i), b = 0; (e = g[b++]) && !a.isPropagationStopped();)for (a.currentTarget = e.elem, c = 0; (f = e.handlers[c++]) && !a.isImmediatePropagationStopped();)(!a.namespace_re || a.namespace_re.test(f.namespace)) && (a.handleObj = f, a.data = f.data, d = ((_.event.special[f.origType] || {}).handle || f.handler).apply(e.elem, h), void 0 !== d && (a.result = d) === !1 && (a.preventDefault(), a.stopPropagation())); return j.postDispatch && j.postDispatch.call(this, a), a.result } }, handlers: function (a, b) { var c, d, e, f, g = [], h = b.delegateCount, i = a.target; if (h && i.nodeType && (!a.button || "click" !== a.type)) for (; i !== this; i = i.parentNode || this)if (i.disabled !== !0 || "click" !== a.type) { for (d = [], c = 0; h > c; c++)f = b[c], e = f.selector + " ", void 0 === d[e] && (d[e] = f.needsContext ? _(e, this).index(i) >= 0 : _.find(e, this, null, [i]).length), d[e] && d.push(f); d.length && g.push({ elem: i, handlers: d }) } return h < b.length && g.push({ elem: this, handlers: b.slice(h) }), g }, props: "altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "), fixHooks: {}, keyHooks: { props: "char charCode key keyCode".split(" "), filter: function (a, b) { return null == a.which && (a.which = null != b.charCode ? b.charCode : b.keyCode), a } }, mouseHooks: { props: "button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "), filter: function (a, b) { var c, d, e, f = b.button; return null == a.pageX && null != b.clientX && (c = a.target.ownerDocument || Z, d = c.documentElement, e = c.body, a.pageX = b.clientX + (d && d.scrollLeft || e && e.scrollLeft || 0) - (d && d.clientLeft || e && e.clientLeft || 0), a.pageY = b.clientY + (d && d.scrollTop || e && e.scrollTop || 0) - (d && d.clientTop || e && e.clientTop || 0)), a.which || void 0 === f || (a.which = 1 & f ? 1 : 2 & f ? 3 : 4 & f ? 2 : 0), a } }, fix: function (a) { if (a[_.expando]) return a; var b, c, d, e = a.type, f = a, g = this.fixHooks[e]; for (g || (this.fixHooks[e] = g = Ba.test(e) ? this.mouseHooks : Aa.test(e) ? this.keyHooks : {}), d = g.props ? this.props.concat(g.props) : this.props, a = new _.Event(f), b = d.length; b--;)c = d[b], a[c] = f[c]; return a.target || (a.target = Z), 3 === a.target.nodeType && (a.target = a.target.parentNode), g.filter ? g.filter(a, f) : a }, special: { load: { noBubble: !0 }, focus: { trigger: function () { return this !== l() && this.focus ? (this.focus(), !1) : void 0 }, delegateType: "focusin" }, blur: { trigger: function () { return this === l() && this.blur ? (this.blur(), !1) : void 0 }, delegateType: "focusout" }, click: { trigger: function () { return "checkbox" === this.type && this.click && _.nodeName(this, "input") ? (this.click(), !1) : void 0 }, _default: function (a) { return _.nodeName(a.target, "a") } }, beforeunload: { postDispatch: function (a) { void 0 !== a.result && a.originalEvent && (a.originalEvent.returnValue = a.result) } } }, simulate: function (a, b, c, d) { var e = _.extend(new _.Event, c, { type: a, isSimulated: !0, originalEvent: {} }); d ? _.event.trigger(e, null, b) : _.event.dispatch.call(b, e), e.isDefaultPrevented() && c.preventDefault() } }, _.removeEvent = function (a, b, c) { a.removeEventListener && a.removeEventListener(b, c, !1) }, _.Event = function (a, b) { return this instanceof _.Event ? (a && a.type ? (this.originalEvent = a, this.type = a.type, this.isDefaultPrevented = a.defaultPrevented || void 0 === a.defaultPrevented && a.returnValue === !1 ? j : k) : this.type = a, b && _.extend(this, b), this.timeStamp = a && a.timeStamp || _.now(), void (this[_.expando] = !0)) : new _.Event(a, b) }, _.Event.prototype = { isDefaultPrevented: k, isPropagationStopped: k, isImmediatePropagationStopped: k, preventDefault: function () { var a = this.originalEvent; this.isDefaultPrevented = j, a && a.preventDefault && a.preventDefault() }, stopPropagation: function () { var a = this.originalEvent; this.isPropagationStopped = j, a && a.stopPropagation && a.stopPropagation() }, stopImmediatePropagation: function () { var a = this.originalEvent; this.isImmediatePropagationStopped = j, a && a.stopImmediatePropagation && a.stopImmediatePropagation(), this.stopPropagation() } }, _.each({ mouseenter: "mouseover", mouseleave: "mouseout", pointerenter: "pointerover", pointerleave: "pointerout" }, function (a, b) { _.event.special[a] = { delegateType: b, bindType: b, handle: function (a) { var c, d = this, e = a.relatedTarget, f = a.handleObj; return (!e || e !== d && !_.contains(d, e)) && (a.type = f.origType, c = f.handler.apply(this, arguments), a.type = b), c } } }), Y.focusinBubbles || _.each({ focus: "focusin", blur: "focusout" }, function (a, b) { var c = function (a) { _.event.simulate(b, a.target, _.event.fix(a), !0) }; _.event.special[b] = { setup: function () { var d = this.ownerDocument || this, e = ra.access(d, b); e || d.addEventListener(a, c, !0), ra.access(d, b, (e || 0) + 1) }, teardown: function () { var d = this.ownerDocument || this, e = ra.access(d, b) - 1; e ? ra.access(d, b, e) : (d.removeEventListener(a, c, !0), ra.remove(d, b)) } } }), _.fn.extend({ on: function (a, b, c, d, e) { var f, g; if ("object" == typeof a) { "string" != typeof b && (c = c || b, b = void 0); for (g in a) this.on(g, b, c, a[g], e); return this } if (null == c && null == d ? (d = b, c = b = void 0) : null == d && ("string" == typeof b ? (d = c, c = void 0) : (d = c, c = b, b = void 0)), d === !1) d = k; else if (!d) return this; return 1 === e && (f = d, d = function (a) { return _().off(a), f.apply(this, arguments) }, d.guid = f.guid || (f.guid = _.guid++)), this.each(function () { _.event.add(this, a, d, c, b) }) }, one: function (a, b, c, d) { return this.on(a, b, c, d, 1) }, off: function (a, b, c) { var d, e; if (a && a.preventDefault && a.handleObj) return d = a.handleObj, _(a.delegateTarget).off(d.namespace ? d.origType + "." + d.namespace : d.origType, d.selector, d.handler), this; if ("object" == typeof a) { for (e in a) this.off(e, b, a[e]); return this } return (b === !1 || "function" == typeof b) && (c = b, b = void 0), c === !1 && (c = k), this.each(function () { _.event.remove(this, a, c, b) }) }, trigger: function (a, b) { return this.each(function () { _.event.trigger(a, b, this) }) }, triggerHandler: function (a, b) { var c = this[0]; return c ? _.event.trigger(a, b, c, !0) : void 0 } }); var Ea = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi, Fa = /<([\w:]+)/, Ga = /<|&#?\w+;/, Ha = /<(?:script|style|link)/i, Ia = /checked\s*(?:[^=]|=\s*.checked.)/i, Ja = /^$|\/(?:java|ecma)script/i, Ka = /^true\/(.*)/, La = /^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g, Ma = { option: [1, "<select multiple='multiple'>", "</select>"], thead: [1, "<table>", "</table>"], col: [2, "<table><colgroup>", "</colgroup></table>"], tr: [2, "<table><tbody>", "</tbody></table>"], td: [3, "<table><tbody><tr>", "</tr></tbody></table>"], _default: [0, "", ""] }; Ma.optgroup = Ma.option, Ma.tbody = Ma.tfoot = Ma.colgroup = Ma.caption = Ma.thead, Ma.th = Ma.td, _.extend({ clone: function (a, b, c) { var d, e, f, g, h = a.cloneNode(!0), i = _.contains(a.ownerDocument, a); if (!(Y.noCloneChecked || 1 !== a.nodeType && 11 !== a.nodeType || _.isXMLDoc(a))) for (g = r(h), f = r(a), d = 0, e = f.length; e > d; d++)s(f[d], g[d]); if (b) if (c) for (f = f || r(a), g = g || r(h), d = 0, e = f.length; e > d; d++)q(f[d], g[d]); else q(a, h); return g = r(h, "script"), g.length > 0 && p(g, !i && r(a, "script")), h }, buildFragment: function (a, b, c, d) { for (var e, f, g, h, i, j, k = b.createDocumentFragment(), l = [], m = 0, n = a.length; n > m; m++)if (e = a[m], e || 0 === e) if ("object" === _.type(e)) _.merge(l, e.nodeType ? [e] : e); else if (Ga.test(e)) { for (f = f || k.appendChild(b.createElement("div")), g = (Fa.exec(e) || ["", ""])[1].toLowerCase(), h = Ma[g] || Ma._default, f.innerHTML = h[1] + e.replace(Ea, "<$1></$2>") + h[2], j = h[0]; j--;)f = f.lastChild; _.merge(l, f.childNodes), f = k.firstChild, f.textContent = "" } else l.push(b.createTextNode(e)); for (k.textContent = "", m = 0; e = l[m++];)if ((!d || -1 === _.inArray(e, d)) && (i = _.contains(e.ownerDocument, e), f = r(k.appendChild(e), "script"), i && p(f), c)) for (j = 0; e = f[j++];)Ja.test(e.type || "") && c.push(e); return k }, cleanData: function (a) { for (var b, c, d, e, f = _.event.special, g = 0; void 0 !== (c = a[g]); g++) { if (_.acceptData(c) && (e = c[ra.expando], e && (b = ra.cache[e]))) { if (b.events) for (d in b.events) f[d] ? _.event.remove(c, d) : _.removeEvent(c, d, b.handle); ra.cache[e] && delete ra.cache[e] } delete sa.cache[c[sa.expando]] } } }), _.fn.extend({ text: function (a) { return qa(this, function (a) { return void 0 === a ? _.text(this) : this.empty().each(function () { (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) && (this.textContent = a) }) }, null, a, arguments.length) }, append: function () { return this.domManip(arguments, function (a) { if (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) { var b = m(this, a); b.appendChild(a) } }) }, prepend: function () { return this.domManip(arguments, function (a) { if (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) { var b = m(this, a); b.insertBefore(a, b.firstChild) } }) }, before: function () { return this.domManip(arguments, function (a) { this.parentNode && this.parentNode.insertBefore(a, this) }) }, after: function () { return this.domManip(arguments, function (a) { this.parentNode && this.parentNode.insertBefore(a, this.nextSibling) }) }, remove: function (a, b) { for (var c, d = a ? _.filter(a, this) : this, e = 0; null != (c = d[e]); e++)b || 1 !== c.nodeType || _.cleanData(r(c)), c.parentNode && (b && _.contains(c.ownerDocument, c) && p(r(c, "script")), c.parentNode.removeChild(c)); return this }, empty: function () { for (var a, b = 0; null != (a = this[b]); b++)1 === a.nodeType && (_.cleanData(r(a, !1)), a.textContent = ""); return this }, clone: function (a, b) { return a = null != a && a, b = null == b ? a : b, this.map(function () { return _.clone(this, a, b) }) }, html: function (a) { return qa(this, function (a) { var b = this[0] || {}, c = 0, d = this.length; if (void 0 === a && 1 === b.nodeType) return b.innerHTML; if ("string" == typeof a && !Ha.test(a) && !Ma[(Fa.exec(a) || ["", ""])[1].toLowerCase()]) { a = a.replace(Ea, "<$1></$2>"); try { for (; d > c; c++)b = this[c] || {}, 1 === b.nodeType && (_.cleanData(r(b, !1)), b.innerHTML = a); b = 0 } catch (a) { } } b && this.empty().append(a) }, null, a, arguments.length) }, replaceWith: function () { var a = arguments[0]; return this.domManip(arguments, function (b) { a = this.parentNode, _.cleanData(r(this)), a && a.replaceChild(b, this) }), a && (a.length || a.nodeType) ? this : this.remove() }, detach: function (a) { return this.remove(a, !0) }, domManip: function (a, b) { a = S.apply([], a); var c, d, e, f, g, h, i = 0, j = this.length, k = this, l = j - 1, m = a[0], p = _.isFunction(m); if (p || j > 1 && "string" == typeof m && !Y.checkClone && Ia.test(m)) return this.each(function (c) { var d = k.eq(c); p && (a[0] = m.call(this, c, d.html())), d.domManip(a, b) }); if (j && (c = _.buildFragment(a, this[0].ownerDocument, !1, this), d = c.firstChild, 1 === c.childNodes.length && (c = d), d)) { for (e = _.map(r(c, "script"), n), f = e.length; j > i; i++)g = c, i !== l && (g = _.clone(g, !0, !0), f && _.merge(e, r(g, "script"))), b.call(this[i], g, i); if (f) for (h = e[e.length - 1].ownerDocument, _.map(e, o), i = 0; f > i; i++)g = e[i], Ja.test(g.type || "") && !ra.access(g, "globalEval") && _.contains(h, g) && (g.src ? _._evalUrl && _._evalUrl(g.src) : _.globalEval(g.textContent.replace(La, ""))) } return this } }), _.each({ appendTo: "append", prependTo: "prepend", insertBefore: "before", insertAfter: "after", replaceAll: "replaceWith" }, function (a, b) { _.fn[a] = function (a) { for (var c, d = [], e = _(a), f = e.length - 1, g = 0; f >= g; g++)c = g === f ? this : this.clone(!0), _(e[g])[b](c), T.apply(d, c.get()); return this.pushStack(d) } }); var Na, Oa = {}, Pa = /^margin/, Qa = new RegExp("^(" + va + ")(?!px)[a-z%]+$", "i"), Ra = function (a) { return a.ownerDocument.defaultView.getComputedStyle(a, null) }; !function () {
        function b() {
            g.style.cssText = "-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",
            g.innerHTML = "", e.appendChild(f); var b = a.getComputedStyle(g, null); c = "1%" !== b.top, d = "4px" === b.width, e.removeChild(f)
        } var c, d, e = Z.documentElement, f = Z.createElement("div"), g = Z.createElement("div"); g.style && (g.style.backgroundClip = "content-box", g.cloneNode(!0).style.backgroundClip = "", Y.clearCloneStyle = "content-box" === g.style.backgroundClip, f.style.cssText = "border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute", f.appendChild(g), a.getComputedStyle && _.extend(Y, { pixelPosition: function () { return b(), c }, boxSizingReliable: function () { return null == d && b(), d }, reliableMarginRight: function () { var b, c = g.appendChild(Z.createElement("div")); return c.style.cssText = g.style.cssText = "-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0", c.style.marginRight = c.style.width = "0", g.style.width = "1px", e.appendChild(f), b = !parseFloat(a.getComputedStyle(c, null).marginRight), e.removeChild(f), b } }))
    }(), _.swap = function (a, b, c, d) { var e, f, g = {}; for (f in b) g[f] = a.style[f], a.style[f] = b[f]; e = c.apply(a, d || []); for (f in b) a.style[f] = g[f]; return e }; var Sa = /^(none|table(?!-c[ea]).+)/, Ta = new RegExp("^(" + va + ")(.*)$", "i"), Ua = new RegExp("^([+-])=(" + va + ")", "i"), Va = { position: "absolute", visibility: "hidden", display: "block" }, Wa = { letterSpacing: "0", fontWeight: "400" }, Xa = ["Webkit", "O", "Moz", "ms"]; _.extend({ cssHooks: { opacity: { get: function (a, b) { if (b) { var c = v(a, "opacity"); return "" === c ? "1" : c } } } }, cssNumber: { columnCount: !0, fillOpacity: !0, flexGrow: !0, flexShrink: !0, fontWeight: !0, lineHeight: !0, opacity: !0, order: !0, orphans: !0, widows: !0, zIndex: !0, zoom: !0 }, cssProps: { float: "cssFloat" }, style: function (a, b, c, d) { if (a && 3 !== a.nodeType && 8 !== a.nodeType && a.style) { var e, f, g, h = _.camelCase(b), i = a.style; return b = _.cssProps[h] || (_.cssProps[h] = x(i, h)), g = _.cssHooks[b] || _.cssHooks[h], void 0 === c ? g && "get" in g && void 0 !== (e = g.get(a, !1, d)) ? e : i[b] : (f = typeof c, "string" === f && (e = Ua.exec(c)) && (c = (e[1] + 1) * e[2] + parseFloat(_.css(a, b)), f = "number"), void (null != c && c === c && ("number" !== f || _.cssNumber[h] || (c += "px"), Y.clearCloneStyle || "" !== c || 0 !== b.indexOf("background") || (i[b] = "inherit"), g && "set" in g && void 0 === (c = g.set(a, c, d)) || (i[b] = c)))) } }, css: function (a, b, c, d) { var e, f, g, h = _.camelCase(b); return b = _.cssProps[h] || (_.cssProps[h] = x(a.style, h)), g = _.cssHooks[b] || _.cssHooks[h], g && "get" in g && (e = g.get(a, !0, c)), void 0 === e && (e = v(a, b, d)), "normal" === e && b in Wa && (e = Wa[b]), "" === c || c ? (f = parseFloat(e), c === !0 || _.isNumeric(f) ? f || 0 : e) : e } }), _.each(["height", "width"], function (a, b) { _.cssHooks[b] = { get: function (a, c, d) { return c ? Sa.test(_.css(a, "display")) && 0 === a.offsetWidth ? _.swap(a, Va, function () { return A(a, b, d) }) : A(a, b, d) : void 0 }, set: function (a, c, d) { var e = d && Ra(a); return y(a, c, d ? z(a, b, d, "border-box" === _.css(a, "boxSizing", !1, e), e) : 0) } } }), _.cssHooks.marginRight = w(Y.reliableMarginRight, function (a, b) { return b ? _.swap(a, { display: "inline-block" }, v, [a, "marginRight"]) : void 0 }), _.each({ margin: "", padding: "", border: "Width" }, function (a, b) { _.cssHooks[a + b] = { expand: function (c) { for (var d = 0, e = {}, f = "string" == typeof c ? c.split(" ") : [c]; 4 > d; d++)e[a + wa[d] + b] = f[d] || f[d - 2] || f[0]; return e } }, Pa.test(a) || (_.cssHooks[a + b].set = y) }), _.fn.extend({ css: function (a, b) { return qa(this, function (a, b, c) { var d, e, f = {}, g = 0; if (_.isArray(b)) { for (d = Ra(a), e = b.length; e > g; g++)f[b[g]] = _.css(a, b[g], !1, d); return f } return void 0 !== c ? _.style(a, b, c) : _.css(a, b) }, a, b, arguments.length > 1) }, show: function () { return B(this, !0) }, hide: function () { return B(this) }, toggle: function (a) { return "boolean" == typeof a ? a ? this.show() : this.hide() : this.each(function () { xa(this) ? _(this).show() : _(this).hide() }) } }), _.Tween = C, C.prototype = { constructor: C, init: function (a, b, c, d, e, f) { this.elem = a, this.prop = c, this.easing = e || "swing", this.options = b, this.start = this.now = this.cur(), this.end = d, this.unit = f || (_.cssNumber[c] ? "" : "px") }, cur: function () { var a = C.propHooks[this.prop]; return a && a.get ? a.get(this) : C.propHooks._default.get(this) }, run: function (a) { var b, c = C.propHooks[this.prop]; return this.pos = b = this.options.duration ? _.easing[this.easing](a, this.options.duration * a, 0, 1, this.options.duration) : a, this.now = (this.end - this.start) * b + this.start, this.options.step && this.options.step.call(this.elem, this.now, this), c && c.set ? c.set(this) : C.propHooks._default.set(this), this } }, C.prototype.init.prototype = C.prototype, C.propHooks = { _default: { get: function (a) { var b; return null == a.elem[a.prop] || a.elem.style && null != a.elem.style[a.prop] ? (b = _.css(a.elem, a.prop, ""), b && "auto" !== b ? b : 0) : a.elem[a.prop] }, set: function (a) { _.fx.step[a.prop] ? _.fx.step[a.prop](a) : a.elem.style && (null != a.elem.style[_.cssProps[a.prop]] || _.cssHooks[a.prop]) ? _.style(a.elem, a.prop, a.now + a.unit) : a.elem[a.prop] = a.now } } }, C.propHooks.scrollTop = C.propHooks.scrollLeft = { set: function (a) { a.elem.nodeType && a.elem.parentNode && (a.elem[a.prop] = a.now) } }, _.easing = { linear: function (a) { return a }, swing: function (a) { return .5 - Math.cos(a * Math.PI) / 2 } }, _.fx = C.prototype.init, _.fx.step = {}; var Ya, Za, $a = /^(?:toggle|show|hide)$/, _a = new RegExp("^(?:([+-])=|)(" + va + ")([a-z%]*)$", "i"), ab = /queueHooks$/, bb = [G], cb = { "*": [function (a, b) { var c = this.createTween(a, b), d = c.cur(), e = _a.exec(b), f = e && e[3] || (_.cssNumber[a] ? "" : "px"), g = (_.cssNumber[a] || "px" !== f && +d) && _a.exec(_.css(c.elem, a)), h = 1, i = 20; if (g && g[3] !== f) { f = f || g[3], e = e || [], g = +d || 1; do h = h || ".5", g /= h, _.style(c.elem, a, g + f); while (h !== (h = c.cur() / d) && 1 !== h && --i) } return e && (g = c.start = +g || +d || 0, c.unit = f, c.end = e[1] ? g + (e[1] + 1) * e[2] : +e[2]), c }] }; _.Animation = _.extend(I, { tweener: function (a, b) { _.isFunction(a) ? (b = a, a = ["*"]) : a = a.split(" "); for (var c, d = 0, e = a.length; e > d; d++)c = a[d], cb[c] = cb[c] || [], cb[c].unshift(b) }, prefilter: function (a, b) { b ? bb.unshift(a) : bb.push(a) } }), _.speed = function (a, b, c) { var d = a && "object" == typeof a ? _.extend({}, a) : { complete: c || !c && b || _.isFunction(a) && a, duration: a, easing: c && b || b && !_.isFunction(b) && b }; return d.duration = _.fx.off ? 0 : "number" == typeof d.duration ? d.duration : d.duration in _.fx.speeds ? _.fx.speeds[d.duration] : _.fx.speeds._default, (null == d.queue || d.queue === !0) && (d.queue = "fx"), d.old = d.complete, d.complete = function () { _.isFunction(d.old) && d.old.call(this), d.queue && _.dequeue(this, d.queue) }, d }, _.fn.extend({ fadeTo: function (a, b, c, d) { return this.filter(xa).css("opacity", 0).show().end().animate({ opacity: b }, a, c, d) }, animate: function (a, b, c, d) { var e = _.isEmptyObject(a), f = _.speed(b, c, d), g = function () { var b = I(this, _.extend({}, a), f); (e || ra.get(this, "finish")) && b.stop(!0) }; return g.finish = g, e || f.queue === !1 ? this.each(g) : this.queue(f.queue, g) }, stop: function (a, b, c) { var d = function (a) { var b = a.stop; delete a.stop, b(c) }; return "string" != typeof a && (c = b, b = a, a = void 0), b && a !== !1 && this.queue(a || "fx", []), this.each(function () { var b = !0, e = null != a && a + "queueHooks", f = _.timers, g = ra.get(this); if (e) g[e] && g[e].stop && d(g[e]); else for (e in g) g[e] && g[e].stop && ab.test(e) && d(g[e]); for (e = f.length; e--;)f[e].elem !== this || null != a && f[e].queue !== a || (f[e].anim.stop(c), b = !1, f.splice(e, 1)); (b || !c) && _.dequeue(this, a) }) }, finish: function (a) { return a !== !1 && (a = a || "fx"), this.each(function () { var b, c = ra.get(this), d = c[a + "queue"], e = c[a + "queueHooks"], f = _.timers, g = d ? d.length : 0; for (c.finish = !0, _.queue(this, a, []), e && e.stop && e.stop.call(this, !0), b = f.length; b--;)f[b].elem === this && f[b].queue === a && (f[b].anim.stop(!0), f.splice(b, 1)); for (b = 0; g > b; b++)d[b] && d[b].finish && d[b].finish.call(this); delete c.finish }) } }), _.each(["toggle", "show", "hide"], function (a, b) { var c = _.fn[b]; _.fn[b] = function (a, d, e) { return null == a || "boolean" == typeof a ? c.apply(this, arguments) : this.animate(E(b, !0), a, d, e) } }), _.each({ slideDown: E("show"), slideUp: E("hide"), slideToggle: E("toggle"), fadeIn: { opacity: "show" }, fadeOut: { opacity: "hide" }, fadeToggle: { opacity: "toggle" } }, function (a, b) { _.fn[a] = function (a, c, d) { return this.animate(b, a, c, d) } }), _.timers = [], _.fx.tick = function () { var a, b = 0, c = _.timers; for (Ya = _.now(); b < c.length; b++)a = c[b], a() || c[b] !== a || c.splice(b--, 1); c.length || _.fx.stop(), Ya = void 0 }, _.fx.timer = function (a) { _.timers.push(a), a() ? _.fx.start() : _.timers.pop() }, _.fx.interval = 13, _.fx.start = function () { Za || (Za = setInterval(_.fx.tick, _.fx.interval)) }, _.fx.stop = function () { clearInterval(Za), Za = null }, _.fx.speeds = { slow: 600, fast: 200, _default: 400 }, _.fn.delay = function (a, b) { return a = _.fx ? _.fx.speeds[a] || a : a, b = b || "fx", this.queue(b, function (b, c) { var d = setTimeout(b, a); c.stop = function () { clearTimeout(d) } }) }, function () { var a = Z.createElement("input"), b = Z.createElement("select"), c = b.appendChild(Z.createElement("option")); a.type = "checkbox", Y.checkOn = "" !== a.value, Y.optSelected = c.selected, b.disabled = !0, Y.optDisabled = !c.disabled, a = Z.createElement("input"), a.value = "t", a.type = "radio", Y.radioValue = "t" === a.value }(); var db, eb, fb = _.expr.attrHandle; _.fn.extend({ attr: function (a, b) { return qa(this, _.attr, a, b, arguments.length > 1) }, removeAttr: function (a) { return this.each(function () { _.removeAttr(this, a) }) } }), _.extend({ attr: function (a, b, c) { var d, e, f = a.nodeType; if (a && 3 !== f && 8 !== f && 2 !== f) return typeof a.getAttribute === za ? _.prop(a, b, c) : (1 === f && _.isXMLDoc(a) || (b = b.toLowerCase(), d = _.attrHooks[b] || (_.expr.match.bool.test(b) ? eb : db)), void 0 === c ? d && "get" in d && null !== (e = d.get(a, b)) ? e : (e = _.find.attr(a, b), null == e ? void 0 : e) : null !== c ? d && "set" in d && void 0 !== (e = d.set(a, c, b)) ? e : (a.setAttribute(b, c + ""), c) : void _.removeAttr(a, b)) }, removeAttr: function (a, b) { var c, d, e = 0, f = b && b.match(na); if (f && 1 === a.nodeType) for (; c = f[e++];)d = _.propFix[c] || c, _.expr.match.bool.test(c) && (a[d] = !1), a.removeAttribute(c) }, attrHooks: { type: { set: function (a, b) { if (!Y.radioValue && "radio" === b && _.nodeName(a, "input")) { var c = a.value; return a.setAttribute("type", b), c && (a.value = c), b } } } } }), eb = { set: function (a, b, c) { return b === !1 ? _.removeAttr(a, c) : a.setAttribute(c, c), c } }, _.each(_.expr.match.bool.source.match(/\w+/g), function (a, b) { var c = fb[b] || _.find.attr; fb[b] = function (a, b, d) { var e, f; return d || (f = fb[b], fb[b] = e, e = null != c(a, b, d) ? b.toLowerCase() : null, fb[b] = f), e } }); var gb = /^(?:input|select|textarea|button)$/i; _.fn.extend({ prop: function (a, b) { return qa(this, _.prop, a, b, arguments.length > 1) }, removeProp: function (a) { return this.each(function () { delete this[_.propFix[a] || a] }) } }), _.extend({ propFix: { for: "htmlFor", class: "className" }, prop: function (a, b, c) { var d, e, f, g = a.nodeType; if (a && 3 !== g && 8 !== g && 2 !== g) return f = 1 !== g || !_.isXMLDoc(a), f && (b = _.propFix[b] || b, e = _.propHooks[b]), void 0 !== c ? e && "set" in e && void 0 !== (d = e.set(a, c, b)) ? d : a[b] = c : e && "get" in e && null !== (d = e.get(a, b)) ? d : a[b] }, propHooks: { tabIndex: { get: function (a) { return a.hasAttribute("tabindex") || gb.test(a.nodeName) || a.href ? a.tabIndex : -1 } } } }), Y.optSelected || (_.propHooks.selected = { get: function (a) { var b = a.parentNode; return b && b.parentNode && b.parentNode.selectedIndex, null } }), _.each(["tabIndex", "readOnly", "maxLength", "cellSpacing", "cellPadding", "rowSpan", "colSpan", "useMap", "frameBorder", "contentEditable"], function () { _.propFix[this.toLowerCase()] = this }); var hb = /[\t\r\n\f]/g; _.fn.extend({ addClass: function (a) { var b, c, d, e, f, g, h = "string" == typeof a && a, i = 0, j = this.length; if (_.isFunction(a)) return this.each(function (b) { _(this).addClass(a.call(this, b, this.className)) }); if (h) for (b = (a || "").match(na) || []; j > i; i++)if (c = this[i], d = 1 === c.nodeType && (c.className ? (" " + c.className + " ").replace(hb, " ") : " ")) { for (f = 0; e = b[f++];)d.indexOf(" " + e + " ") < 0 && (d += e + " "); g = _.trim(d), c.className !== g && (c.className = g) } return this }, removeClass: function (a) { var b, c, d, e, f, g, h = 0 === arguments.length || "string" == typeof a && a, i = 0, j = this.length; if (_.isFunction(a)) return this.each(function (b) { _(this).removeClass(a.call(this, b, this.className)) }); if (h) for (b = (a || "").match(na) || []; j > i; i++)if (c = this[i], d = 1 === c.nodeType && (c.className ? (" " + c.className + " ").replace(hb, " ") : "")) { for (f = 0; e = b[f++];)for (; d.indexOf(" " + e + " ") >= 0;)d = d.replace(" " + e + " ", " "); g = a ? _.trim(d) : "", c.className !== g && (c.className = g) } return this }, toggleClass: function (a, b) { var c = typeof a; return "boolean" == typeof b && "string" === c ? b ? this.addClass(a) : this.removeClass(a) : this.each(_.isFunction(a) ? function (c) { _(this).toggleClass(a.call(this, c, this.className, b), b) } : function () { if ("string" === c) for (var b, d = 0, e = _(this), f = a.match(na) || []; b = f[d++];)e.hasClass(b) ? e.removeClass(b) : e.addClass(b); else (c === za || "boolean" === c) && (this.className && ra.set(this, "__className__", this.className), this.className = this.className || a === !1 ? "" : ra.get(this, "__className__") || "") }) }, hasClass: function (a) { for (var b = " " + a + " ", c = 0, d = this.length; d > c; c++)if (1 === this[c].nodeType && (" " + this[c].className + " ").replace(hb, " ").indexOf(b) >= 0) return !0; return !1 } }); var ib = /\r/g; _.fn.extend({ val: function (a) { var b, c, d, e = this[0]; return arguments.length ? (d = _.isFunction(a), this.each(function (c) { var e; 1 === this.nodeType && (e = d ? a.call(this, c, _(this).val()) : a, null == e ? e = "" : "number" == typeof e ? e += "" : _.isArray(e) && (e = _.map(e, function (a) { return null == a ? "" : a + "" })), b = _.valHooks[this.type] || _.valHooks[this.nodeName.toLowerCase()], b && "set" in b && void 0 !== b.set(this, e, "value") || (this.value = e)) })) : e ? (b = _.valHooks[e.type] || _.valHooks[e.nodeName.toLowerCase()], b && "get" in b && void 0 !== (c = b.get(e, "value")) ? c : (c = e.value, "string" == typeof c ? c.replace(ib, "") : null == c ? "" : c)) : void 0 } }), _.extend({ valHooks: { option: { get: function (a) { var b = _.find.attr(a, "value"); return null != b ? b : _.trim(_.text(a)) } }, select: { get: function (a) { for (var b, c, d = a.options, e = a.selectedIndex, f = "select-one" === a.type || 0 > e, g = f ? null : [], h = f ? e + 1 : d.length, i = 0 > e ? h : f ? e : 0; h > i; i++)if (c = d[i], !(!c.selected && i !== e || (Y.optDisabled ? c.disabled : null !== c.getAttribute("disabled")) || c.parentNode.disabled && _.nodeName(c.parentNode, "optgroup"))) { if (b = _(c).val(), f) return b; g.push(b) } return g }, set: function (a, b) { for (var c, d, e = a.options, f = _.makeArray(b), g = e.length; g--;)d = e[g], (d.selected = _.inArray(d.value, f) >= 0) && (c = !0); return c || (a.selectedIndex = -1), f } } } }), _.each(["radio", "checkbox"], function () { _.valHooks[this] = { set: function (a, b) { return _.isArray(b) ? a.checked = _.inArray(_(a).val(), b) >= 0 : void 0 } }, Y.checkOn || (_.valHooks[this].get = function (a) { return null === a.getAttribute("value") ? "on" : a.value }) }), _.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "), function (a, b) { _.fn[b] = function (a, c) { return arguments.length > 0 ? this.on(b, null, a, c) : this.trigger(b) } }), _.fn.extend({ hover: function (a, b) { return this.mouseenter(a).mouseleave(b || a) }, bind: function (a, b, c) { return this.on(a, null, b, c) }, unbind: function (a, b) { return this.off(a, null, b) }, delegate: function (a, b, c, d) { return this.on(b, a, c, d) }, undelegate: function (a, b, c) { return 1 === arguments.length ? this.off(a, "**") : this.off(b, a || "**", c) } }); var jb = _.now(), kb = /\?/; _.parseJSON = function (a) { return JSON.parse(a + "") }, _.parseXML = function (a) { var b, c; if (!a || "string" != typeof a) return null; try { c = new DOMParser, b = c.parseFromString(a, "text/xml") } catch (a) { b = void 0 } return (!b || b.getElementsByTagName("parsererror").length) && _.error("Invalid XML: " + a), b }; var lb, mb, nb = /#.*$/, ob = /([?&])_=[^&]*/, pb = /^(.*?):[ \t]*([^\r\n]*)$/gm, qb = /^(?:about|app|app-storage|.+-extension|file|res|widget):$/, rb = /^(?:GET|HEAD)$/, sb = /^\/\//, tb = /^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/, ub = {}, vb = {}, wb = "*/".concat("*"); try { mb = location.href } catch (a) { mb = Z.createElement("a"), mb.href = "", mb = mb.href } lb = tb.exec(mb.toLowerCase()) || [], _.extend({ active: 0, lastModified: {}, etag: {}, ajaxSettings: { url: mb, type: "GET", isLocal: qb.test(lb[1]), global: !0, processData: !0, async: !0, contentType: "application/x-www-form-urlencoded; charset=UTF-8", accepts: { "*": wb, text: "text/plain", html: "text/html", xml: "application/xml, text/xml", json: "application/json, text/javascript" }, contents: { xml: /xml/, html: /html/, json: /json/ }, responseFields: { xml: "responseXML", text: "responseText", json: "responseJSON" }, converters: { "* text": String, "text html": !0, "text json": _.parseJSON, "text xml": _.parseXML }, flatOptions: { url: !0, context: !0 } }, ajaxSetup: function (a, b) { return b ? L(L(a, _.ajaxSettings), b) : L(_.ajaxSettings, a) }, ajaxPrefilter: J(ub), ajaxTransport: J(vb), ajax: function (a, b) { function c(a, b, c, g) { var i, k, r, s, u, w = b; 2 !== t && (t = 2, h && clearTimeout(h), d = void 0, f = g || "", v.readyState = a > 0 ? 4 : 0, i = a >= 200 && 300 > a || 304 === a, c && (s = M(l, v, c)), s = N(l, s, v, i), i ? (l.ifModified && (u = v.getResponseHeader("Last-Modified"), u && (_.lastModified[e] = u), u = v.getResponseHeader("etag"), u && (_.etag[e] = u)), 204 === a || "HEAD" === l.type ? w = "nocontent" : 304 === a ? w = "notmodified" : (w = s.state, k = s.data, r = s.error, i = !r)) : (r = w, (a || !w) && (w = "error", 0 > a && (a = 0))), v.status = a, v.statusText = (b || w) + "", i ? o.resolveWith(m, [k, w, v]) : o.rejectWith(m, [v, w, r]), v.statusCode(q), q = void 0, j && n.trigger(i ? "ajaxSuccess" : "ajaxError", [v, l, i ? k : r]), p.fireWith(m, [v, w]), j && (n.trigger("ajaxComplete", [v, l]), --_.active || _.event.trigger("ajaxStop"))) } "object" == typeof a && (b = a, a = void 0), b = b || {}; var d, e, f, g, h, i, j, k, l = _.ajaxSetup({}, b), m = l.context || l, n = l.context && (m.nodeType || m.jquery) ? _(m) : _.event, o = _.Deferred(), p = _.Callbacks("once memory"), q = l.statusCode || {}, r = {}, s = {}, t = 0, u = "canceled", v = { readyState: 0, getResponseHeader: function (a) { var b; if (2 === t) { if (!g) for (g = {}; b = pb.exec(f);)g[b[1].toLowerCase()] = b[2]; b = g[a.toLowerCase()] } return null == b ? null : b }, getAllResponseHeaders: function () { return 2 === t ? f : null }, setRequestHeader: function (a, b) { var c = a.toLowerCase(); return t || (a = s[c] = s[c] || a, r[a] = b), this }, overrideMimeType: function (a) { return t || (l.mimeType = a), this }, statusCode: function (a) { var b; if (a) if (2 > t) for (b in a) q[b] = [q[b], a[b]]; else v.always(a[v.status]); return this }, abort: function (a) { var b = a || u; return d && d.abort(b), c(0, b), this } }; if (o.promise(v).complete = p.add, v.success = v.done, v.error = v.fail, l.url = ((a || l.url || mb) + "").replace(nb, "").replace(sb, lb[1] + "//"), l.type = b.method || b.type || l.method || l.type, l.dataTypes = _.trim(l.dataType || "*").toLowerCase().match(na) || [""], null == l.crossDomain && (i = tb.exec(l.url.toLowerCase()), l.crossDomain = !(!i || i[1] === lb[1] && i[2] === lb[2] && (i[3] || ("http:" === i[1] ? "80" : "443")) === (lb[3] || ("http:" === lb[1] ? "80" : "443")))), l.data && l.processData && "string" != typeof l.data && (l.data = _.param(l.data, l.traditional)), K(ub, l, b, v), 2 === t) return v; j = l.global, j && 0 === _.active++ && _.event.trigger("ajaxStart"), l.type = l.type.toUpperCase(), l.hasContent = !rb.test(l.type), e = l.url, l.hasContent || (l.data && (e = l.url += (kb.test(e) ? "&" : "?") + l.data, delete l.data), l.cache === !1 && (l.url = ob.test(e) ? e.replace(ob, "$1_=" + jb++) : e + (kb.test(e) ? "&" : "?") + "_=" + jb++)), l.ifModified && (_.lastModified[e] && v.setRequestHeader("If-Modified-Since", _.lastModified[e]), _.etag[e] && v.setRequestHeader("If-None-Match", _.etag[e])), (l.data && l.hasContent && l.contentType !== !1 || b.contentType) && v.setRequestHeader("Content-Type", l.contentType), v.setRequestHeader("Accept", l.dataTypes[0] && l.accepts[l.dataTypes[0]] ? l.accepts[l.dataTypes[0]] + ("*" !== l.dataTypes[0] ? ", " + wb + "; q=0.01" : "") : l.accepts["*"]); for (k in l.headers) v.setRequestHeader(k, l.headers[k]); if (l.beforeSend && (l.beforeSend.call(m, v, l) === !1 || 2 === t)) return v.abort(); u = "abort"; for (k in { success: 1, error: 1, complete: 1 }) v[k](l[k]); if (d = K(vb, l, b, v)) { v.readyState = 1, j && n.trigger("ajaxSend", [v, l]), l.async && l.timeout > 0 && (h = setTimeout(function () { v.abort("timeout") }, l.timeout)); try { t = 1, d.send(r, c) } catch (a) { if (!(2 > t)) throw a; c(-1, a) } } else c(-1, "No Transport"); return v }, getJSON: function (a, b, c) { return _.get(a, b, c, "json") }, getScript: function (a, b) { return _.get(a, void 0, b, "script") } }), _.each(["get", "post"], function (a, b) { _[b] = function (a, c, d, e) { return _.isFunction(c) && (e = e || d, d = c, c = void 0), _.ajax({ url: a, type: b, dataType: e, data: c, success: d }) } }), _.each(["ajaxStart", "ajaxStop", "ajaxComplete", "ajaxError", "ajaxSuccess", "ajaxSend"], function (a, b) { _.fn[b] = function (a) { return this.on(b, a) } }), _._evalUrl = function (a) { return _.ajax({ url: a, type: "GET", dataType: "script", async: !1, global: !1, throws: !0 }) }, _.fn.extend({ wrapAll: function (a) { var b; return _.isFunction(a) ? this.each(function (b) { _(this).wrapAll(a.call(this, b)) }) : (this[0] && (b = _(a, this[0].ownerDocument).eq(0).clone(!0), this[0].parentNode && b.insertBefore(this[0]), b.map(function () { for (var a = this; a.firstElementChild;)a = a.firstElementChild; return a }).append(this)), this) }, wrapInner: function (a) { return this.each(_.isFunction(a) ? function (b) { _(this).wrapInner(a.call(this, b)) } : function () { var b = _(this), c = b.contents(); c.length ? c.wrapAll(a) : b.append(a) }) }, wrap: function (a) { var b = _.isFunction(a); return this.each(function (c) { _(this).wrapAll(b ? a.call(this, c) : a) }) }, unwrap: function () { return this.parent().each(function () { _.nodeName(this, "body") || _(this).replaceWith(this.childNodes) }).end() } }), _.expr.filters.hidden = function (a) { return a.offsetWidth <= 0 && a.offsetHeight <= 0 }, _.expr.filters.visible = function (a) { return !_.expr.filters.hidden(a) }; var xb = /%20/g, yb = /\[\]$/, zb = /\r?\n/g, Ab = /^(?:submit|button|image|reset|file)$/i, Bb = /^(?:input|select|textarea|keygen)/i; _.param = function (a, b) { var c, d = [], e = function (a, b) { b = _.isFunction(b) ? b() : null == b ? "" : b, d[d.length] = encodeURIComponent(a) + "=" + encodeURIComponent(b) }; if (void 0 === b && (b = _.ajaxSettings && _.ajaxSettings.traditional), _.isArray(a) || a.jquery && !_.isPlainObject(a)) _.each(a, function () { e(this.name, this.value) }); else for (c in a) O(c, a[c], b, e); return d.join("&").replace(xb, "+") }, _.fn.extend({ serialize: function () { return _.param(this.serializeArray()) }, serializeArray: function () { return this.map(function () { var a = _.prop(this, "elements"); return a ? _.makeArray(a) : this }).filter(function () { var a = this.type; return this.name && !_(this).is(":disabled") && Bb.test(this.nodeName) && !Ab.test(a) && (this.checked || !ya.test(a)) }).map(function (a, b) { var c = _(this).val(); return null == c ? null : _.isArray(c) ? _.map(c, function (a) { return { name: b.name, value: a.replace(zb, "\r\n") } }) : { name: b.name, value: c.replace(zb, "\r\n") } }).get() } }), _.ajaxSettings.xhr = function () { try { return new XMLHttpRequest } catch (a) { } }; var Cb = 0, Db = {}, Eb = { 0: 200, 1223: 204 }, Fb = _.ajaxSettings.xhr(); a.ActiveXObject && _(a).on("unload", function () { for (var a in Db) Db[a]() }), Y.cors = !!Fb && "withCredentials" in Fb, Y.ajax = Fb = !!Fb, _.ajaxTransport(function (a) { var b; return Y.cors || Fb && !a.crossDomain ? { send: function (c, d) { var e, f = a.xhr(), g = ++Cb; if (f.open(a.type, a.url, a.async, a.username, a.password), a.xhrFields) for (e in a.xhrFields) f[e] = a.xhrFields[e]; a.mimeType && f.overrideMimeType && f.overrideMimeType(a.mimeType), a.crossDomain || c["X-Requested-With"] || (c["X-Requested-With"] = "XMLHttpRequest"); for (e in c) f.setRequestHeader(e, c[e]); b = function (a) { return function () { b && (delete Db[g], b = f.onload = f.onerror = null, "abort" === a ? f.abort() : "error" === a ? d(f.status, f.statusText) : d(Eb[f.status] || f.status, f.statusText, "string" == typeof f.responseText ? { text: f.responseText } : void 0, f.getAllResponseHeaders())) } }, f.onload = b(), f.onerror = b("error"), b = Db[g] = b("abort"); try { f.send(a.hasContent && a.data || null) } catch (a) { if (b) throw a } }, abort: function () { b && b() } } : void 0 }), _.ajaxSetup({ accepts: { script: "text/javascript, application/javascript, application/ecmascript, application/x-ecmascript" }, contents: { script: /(?:java|ecma)script/ }, converters: { "text script": function (a) { return _.globalEval(a), a } } }), _.ajaxPrefilter("script", function (a) { void 0 === a.cache && (a.cache = !1), a.crossDomain && (a.type = "GET") }), _.ajaxTransport("script", function (a) { if (a.crossDomain) { var b, c; return { send: function (d, e) { b = _("<script>").prop({ async: !0, charset: a.scriptCharset, src: a.url }).on("load error", c = function (a) { b.remove(), c = null, a && e("error" === a.type ? 404 : 200, a.type) }), Z.head.appendChild(b[0]) }, abort: function () { c && c() } } } }); var Gb = [], Hb = /(=)\?(?=&|$)|\?\?/; _.ajaxSetup({ jsonp: "callback", jsonpCallback: function () { var a = Gb.pop() || _.expando + "_" + jb++; return this[a] = !0, a } }), _.ajaxPrefilter("json jsonp", function (b, c, d) { var e, f, g, h = b.jsonp !== !1 && (Hb.test(b.url) ? "url" : "string" == typeof b.data && !(b.contentType || "").indexOf("application/x-www-form-urlencoded") && Hb.test(b.data) && "data"); return h || "jsonp" === b.dataTypes[0] ? (e = b.jsonpCallback = _.isFunction(b.jsonpCallback) ? b.jsonpCallback() : b.jsonpCallback, h ? b[h] = b[h].replace(Hb, "$1" + e) : b.jsonp !== !1 && (b.url += (kb.test(b.url) ? "&" : "?") + b.jsonp + "=" + e), b.converters["script json"] = function () { return g || _.error(e + " was not called"), g[0] }, b.dataTypes[0] = "json", f = a[e], a[e] = function () { g = arguments }, d.always(function () { a[e] = f, b[e] && (b.jsonpCallback = c.jsonpCallback, Gb.push(e)), g && _.isFunction(f) && f(g[0]), g = f = void 0 }), "script") : void 0 }), _.parseHTML = function (a, b, c) { if (!a || "string" != typeof a) return null; "boolean" == typeof b && (c = b, b = !1), b = b || Z; var d = ga.exec(a), e = !c && []; return d ? [b.createElement(d[1])] : (d = _.buildFragment([a], b, e), e && e.length && _(e).remove(), _.merge([], d.childNodes)) }; var Ib = _.fn.load; _.fn.load = function (a, b, c) { if ("string" != typeof a && Ib) return Ib.apply(this, arguments); var d, e, f, g = this, h = a.indexOf(" "); return h >= 0 && (d = _.trim(a.slice(h)), a = a.slice(0, h)), _.isFunction(b) ? (c = b, b = void 0) : b && "object" == typeof b && (e = "POST"), g.length > 0 && _.ajax({ url: a, type: e, dataType: "html", data: b }).done(function (a) { f = arguments, g.html(d ? _("<div>").append(_.parseHTML(a)).find(d) : a) }).complete(c && function (a, b) { g.each(c, f || [a.responseText, b, a]) }), this }, _.expr.filters.animated = function (a) { return _.grep(_.timers, function (b) { return a === b.elem }).length }; var Jb = a.document.documentElement; _.offset = { setOffset: function (a, b, c) { var d, e, f, g, h, i, j, k = _.css(a, "position"), l = _(a), m = {}; "static" === k && (a.style.position = "relative"), h = l.offset(), f = _.css(a, "top"), i = _.css(a, "left"), j = ("absolute" === k || "fixed" === k) && (f + i).indexOf("auto") > -1, j ? (d = l.position(), g = d.top, e = d.left) : (g = parseFloat(f) || 0, e = parseFloat(i) || 0), _.isFunction(b) && (b = b.call(a, c, h)), null != b.top && (m.top = b.top - h.top + g), null != b.left && (m.left = b.left - h.left + e), "using" in b ? b.using.call(a, m) : l.css(m) } }, _.fn.extend({ offset: function (a) { if (arguments.length) return void 0 === a ? this : this.each(function (b) { _.offset.setOffset(this, a, b) }); var b, c, d = this[0], e = { top: 0, left: 0 }, f = d && d.ownerDocument; return f ? (b = f.documentElement, _.contains(b, d) ? (typeof d.getBoundingClientRect !== za && (e = d.getBoundingClientRect()), c = P(f), { top: e.top + c.pageYOffset - b.clientTop, left: e.left + c.pageXOffset - b.clientLeft }) : e) : void 0 }, position: function () { if (this[0]) { var a, b, c = this[0], d = { top: 0, left: 0 }; return "fixed" === _.css(c, "position") ? b = c.getBoundingClientRect() : (a = this.offsetParent(), b = this.offset(), _.nodeName(a[0], "html") || (d = a.offset()), d.top += _.css(a[0], "borderTopWidth", !0), d.left += _.css(a[0], "borderLeftWidth", !0)), { top: b.top - d.top - _.css(c, "marginTop", !0), left: b.left - d.left - _.css(c, "marginLeft", !0) } } }, offsetParent: function () { return this.map(function () { for (var a = this.offsetParent || Jb; a && !_.nodeName(a, "html") && "static" === _.css(a, "position");)a = a.offsetParent; return a || Jb }) } }), _.each({ scrollLeft: "pageXOffset", scrollTop: "pageYOffset" }, function (b, c) { var d = "pageYOffset" === c; _.fn[b] = function (e) { return qa(this, function (b, e, f) { var g = P(b); return void 0 === f ? g ? g[c] : b[e] : void (g ? g.scrollTo(d ? a.pageXOffset : f, d ? f : a.pageYOffset) : b[e] = f) }, b, e, arguments.length, null) } }), _.each(["top", "left"], function (a, b) { _.cssHooks[b] = w(Y.pixelPosition, function (a, c) { return c ? (c = v(a, b), Qa.test(c) ? _(a).position()[b] + "px" : c) : void 0 }) }), _.each({ Height: "height", Width: "width" }, function (a, b) { _.each({ padding: "inner" + a, content: b, "": "outer" + a }, function (c, d) { _.fn[d] = function (d, e) { var f = arguments.length && (c || "boolean" != typeof d), g = c || (d === !0 || e === !0 ? "margin" : "border"); return qa(this, function (b, c, d) { var e; return _.isWindow(b) ? b.document.documentElement["client" + a] : 9 === b.nodeType ? (e = b.documentElement, Math.max(b.body["scroll" + a], e["scroll" + a], b.body["offset" + a], e["offset" + a], e["client" + a])) : void 0 === d ? _.css(b, c, g) : _.style(b, c, d, g) }, b, f ? d : void 0, f, null) } }) }), _.fn.size = function () { return this.length }, _.fn.andSelf = _.fn.addBack, "function" == typeof define && define.amd && define("jquery", [], function () { return _ }); var Kb = a.jQuery, Lb = a.$; return _.noConflict = function (b) { return a.$ === _ && (a.$ = Lb), b && a.jQuery === _ && (a.jQuery = Kb), _ }, typeof b === za && (a.jQuery = a.$ = _), _
}); var isIEMobile = /IEMobile/.test(navigator.userAgent), isAndroid = /Android|\bSilk\b/.test(navigator.userAgent), isiOS = /iP(ad|hone|od)/.test(navigator.userAgent), isFireFoxOS = /^.*?\Mobile\b.*?\Firefox\b.*?$/m.test(navigator.userAgent), isFireFox = /Firefox/.test(navigator.userAgent), isWinApp = /MSAppHost/.test(navigator.userAgent), isBB10 = /BB10/.test(navigator.userAgent), isOSXApp = isOSXApp || !1, isChromeApp = "object" == typeof chrome && "object" == typeof chrome.storage, isFileCapable = !isiOS && !isAndroid && !isIEMobile && !isOSXApp && !isFireFoxOS && !isWinApp && !isBB10 && window.FileReader, isTouchCapable = "ontouchstart" in window || "onmsgesturechange" in window, storage = { get: function (a, b) { if (b = b || function () { }, isChromeApp) chrome.storage.local.get(a, b); else { var c, d = {}; "string" == typeof a && (a = [a]); for (c in a) a.hasOwnProperty(c) && (d[a[c]] = localStorage.getItem(a[c])); b(d) } }, set: function (a, b) { if (b = b || function () { }, isChromeApp) chrome.storage.local.set(a, b); else { var c; if ("object" == typeof a) for (c in a) a.hasOwnProperty(c) && localStorage.setItem(c, a[c]); b(!0) } }, remove: function (a, b) { if (b = b || function () { }, isChromeApp) chrome.storage.local.remove(a, b); else { var c; "string" == typeof a && (a = [a]); for (c in a) a.hasOwnProperty(c) && localStorage.removeItem(a[c]); b(!0) } } }, regex = { gps: /^[-+]?([1-8]?\d(\.\d+)?|90(\.0+)?),\s*[-+]?(180(\.0+)?|((1[0-7]\d)|([1-9]?\d))(\.\d+)?)$/ }, statusBarPrimary = isAndroid ? "#121212" : "#1D1D1D", statusBarOverlay = isAndroid ? "#151515" : "#202020", retryCount = 2, controller = {}, switching = !1, currentCoordinates = [0, 0], pageHistoryCount = -1, goingBack = !1, notifications = [], timers = {}, isWUDataValid = !1, curr183, currIp, currPrefix, currAuth, currPass, currAuthUser, currAuthPass, currLocal, currLang, language, deviceip, errorTimeout, weather, weatherKeyFail, openPanel; if (isWinApp && $(window).on("error", function (a, b, c) { return window.console.log(a, b, c), !0 }), window.MSApp) { if (window.Windows && Windows.UI && Windows.UI.ApplicationSettings && Windows.UI.ApplicationSettings.SettingsPane) { var settingsPane = Windows.UI.ApplicationSettings.SettingsPane.getForCurrentView(); settingsPane.addEventListener("commandsrequested", function (a) { var b = a.request.applicationCommands, c = new Windows.UI.ApplicationSettings.SettingsCommand("privacy", "Privacy Policy", function () { window.open("https://albahra.com/journal/privacy-policy") }); b.append(c) }) } MSApp.execUnsafeLocalFunction && ($.fn.oldDomManIp = $.fn.domManip, $.fn.domManip = function (a, b, c) { var d = this; return MSApp.execUnsafeLocalFunction(function () { return d.oldDomManIp(a, b, c) }) }) } $(document).one("deviceready", function () { try { StatusBar.overlaysWebView(!1), StatusBar.styleLightContent(), StatusBar.backgroundColorByHexString(statusBarPrimary), $.mobile.window.on("statusTap", function () { $("body, html").animate({ scrollTop: 0 }, 700) }) } catch (a) { } setTimeout(function () { try { navigator.splashscreen.hide() } catch (a) { } }, 500), $.mobile.document.on("backbutton", function () { return (!isIEMobile || !$.mobile.document.data("iabOpen")) && (checkChangesBeforeBack(), !1) }), updateDeviceIP(), isiOS && ThreeDeeTouch.isAvailable(function (a) { a && (ThreeDeeTouch.enableLinkPreview(), ThreeDeeTouch.configureQuickActions([{ type: "sites", title: _("Manage Sites"), iconType: "Location" }, { type: "addprogram", title: _("Add Program"), iconType: "Add" }, { type: "stopall", title: _("Stop All Stations"), iconType: "Pause" }]), ThreeDeeTouch.onHomeIconPressed = function (a) { "sites" === a.type ? changePage("#site-control") : "addprogram" === a.type ? changePage("#addprogram") : "stopall" === a.type && stopAllStations() }) }) }).one("mobileinit", function () { (isChromeApp || "file:" === window.location.protocol) && ($.mobile.hashListeningEnabled = !1), $.support.cors = !0, $.mobile.allowCrossDomainPages = !0 }).on("pagebeforechange", function (a, b) { var c, d = b.toPage, e = $(".ui-page-active"); "string" == typeof b.toPage && (c = $.mobile.path.parseUrl(d).hash, e.length > 0 && c === "#" + e.attr("id") || ("popup" === b.options.role || $(".ui-popup-active").length || $.mobile.silentScroll(0), "#programs" === c ? getPrograms(b.options.programToExpand) : "#addprogram" === c ? addProgram(b.options.copyID) : "#manual" === c ? getManual() : "#about" === c ? showAbout() : "#runonce" === c ? getRunonce() : "#os-options" === c ? showOptions(b.options.expandItem) : "#preview" === c ? getPreview() : "#logs" === c ? getLogs() : "#forecast" === c ? showForecast() : "#loadingPage" === c ? checkConfigured(!0) : "#start" === c ? showStart() : "#site-control" === c ? showSites() : "#sprinklers" === c && (0 === $(c).length ? showHome(b.options.firstLoad) : $(c).one("pageshow", refreshStatus)))) }).on("resume", function () { void 0 !== currIp && (cloudSync(), showLoading("#weather,#footer-running"), updateController(updateWeather, networkFail)) }).on("pause", function () { }).on("pagebeforeshow", function (a) { var b = "#" + a.target.id; "#start" === b || "#loadingPage" === b ? $("#header,#footer,#footer-menu").hide() : $("#header,#footer,#footer-menu").show() }).on("pageshow", function (a) {
    var b = "#" + a.target.id, c = $(b); if (goingBack ? goingBack = !1 : pageHistoryCount++ ,
        fixInputClick(c), isControllerConnected() && "#site-control" !== b && "#start" !== b && "#loadingPage" !== b) { var d, e = setInterval(refreshStatus, 5e3); checkOSVersion(216) || (d = setInterval(refreshData, 2e4)), c.one("pagehide", function () { clearInterval(e), clearInterval(d) }) }
}).on("popupafteropen", function () { if ($(".ui-overlay-b:not(.ui-screen-hidden)").length) try { StatusBar.backgroundColorByHexString(statusBarOverlay) } catch (a) { } }).on("popupafterclose", function () { isBB10 || $(".ui-page-active").children().add("#sprinklers-settings").removeClass("blur-filter"); try { StatusBar.backgroundColorByHexString(statusBarPrimary) } catch (a) { } }).on("popupbeforeposition", function () { isBB10 || $(".ui-page-active").children().add("#sprinklers-settings").addClass("blur-filter") }).on("popupbeforeposition", "#localization", checkCurrLang).one("pagebeforeshow", "#loadingPage", initApp); var showSites = function () { function a() { storage.get(["sites", "current_site", "cloudToken"], function (b) { if (c = parseSites(b.sites), $.isEmptyObject(c)) { if ("string" != typeof b.cloudToken) return void changePage("#start"); g(), f.find(".ui-content").html("<p class='center'>" + _("Please add a site by tapping the 'Add' button in the top right corner.") + "</p>") } else { var d = "<div data-role='collapsible-set'>", h = [], i = 0; e = Object.keys(c).length, isControllerConnected() && e && b.current_site in c || g(), c = sortObj(c), $.each(c, function (a, b) { h.push(a), a = htmlEscape(a), d += "<fieldset " + (1 === e ? "data-collapsed='false'" : "") + " id='site-" + i + "' data-role='collapsible'><h3><a class='ui-btn ui-btn-corner-all connectnow yellow' data-site='" + i + "' href='#'>" + _("connect") + "</a>" + a + "</h3><form data-site='" + i + "' novalidate><div class='ui-field-contain'><label for='cnm-" + i + "'>" + _("Change Name") + "</label><input id='cnm-" + i + "' type='text' value='" + a + "'></div><div class='ui-field-contain'><label for='cip-" + i + "'>" + _("Change IP") + "</label><input id='cip-" + i + "' type='url' value='" + b.os_ip + "' autocomplete='off' autocorrect='off' autocapitalize='off' pattern='' spellcheck='false'></div><div class='ui-field-contain'><label for='cpw-" + i + "'>" + _("Change Password") + "</label><input id='cpw-" + i + "' type='password'></div><fieldset data-mini='true' data-role='collapsible'><h3><span style='line-height:23px'>" + _("Advanced") + "</span><button data-helptext='" + _("These options are only for an OpenSprinkler behind a proxy capable of SSL and/or Basic Authentication.") + "' class='collapsible-button-right help-icon btn-no-border ui-btn ui-icon-info ui-btn-icon-notext'></button></h3><label for='usessl-" + i + "'><input data-mini='true' type='checkbox' id='usessl-" + i + "' name='usessl-" + i + "'" + ("undefined" != typeof b.ssl && "1" === b.ssl ? " checked='checked'" : "") + ">" + _("Use SSL") + "</label><label for='useauth-" + i + "'><input class='useauth' data-user='" + b.auth_user + "' data-pw='" + b.auth_pw + "' data-mini='true' type='checkbox' id='useauth-" + i + "' name='useauth-" + i + "'" + ("undefined" != typeof b.auth_user && "undefined" != typeof b.auth_pw ? " checked='checked'" : "") + ">" + _("Use Auth") + "</label></fieldset><input class='submit' type='submit' value='" + _("Save Changes to") + " " + a + "'><a data-role='button' class='deletesite' data-site='" + i + "' href='#' data-theme='b'>" + _("Delete") + " " + a + "</a></form></fieldset>", testSite(b, i, function (a, b) { f.find("#site-" + a + " .connectnow").removeClass("yellow").addClass(b ? "green" : "red") }), i++ }), d = $(d + "</div>"), d.find("form").one("change input", function () { $(this).find(".submit").addClass("hasChanges") }), d.find(".connectnow").on("click", function () { return updateSite(h[$(this).data("site")]), !1 }), d.find(".help-icon").on("click", showHelpText), d.find(".useauth").on("change", function () { var a = $(this); if (a.is(":checked")) { var b = $("<div data-role='popup' data-theme='a'><form method='post' class='ui-content' novalidate><label for='auth_user'>" + _("Username:") + "</label><input autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' type='text' name='auth_user' id='auth_user'><label for='auth_pw'>" + _("Password:") + "</label><input type='password' name='auth_pw' id='auth_pw'><input type='submit' class='submit' value='" + _("Submit") + "'></form></div>").enhanceWithin(), c = !1; b.find(".submit").on("click", function () { return a.data({ user: b.find("#auth_user").val(), pw: b.find("#auth_pw").val() }), c = !0, b.popup("close"), !1 }), b.one("popupafterclose", function () { c || a.attr("checked", !1).checkboxradio("refresh") }), openPopup(b) } else a.data({ user: "", pw: "" }) }), d.find("form").on("submit", function () { var e = $(this), f = e.data("site"), g = h[f], i = d.find("#cip-" + f).val(), j = d.find("#cpw-" + f).val(), k = d.find("#cnm-" + f).val(), l = d.find("#useauth-" + f).is(":checked"), m = d.find("#usessl-" + f).is(":checked") ? "1" : void 0, n = d.find("#useauth-" + f).data("user"), o = d.find("#useauth-" + f).data("pw"), p = "" !== i && i !== c[g].os_ip || m !== c[g].ssl || n !== c[g].auth_user || o !== c[g].auth_pw, q = g === b.current_site, r = "" !== k && k !== g; return e.find(".submit").removeClass("hasChanges"), l ? (c[g].auth_user = n, c[g].auth_pw = o) : (delete c[g].auth_user, delete c[g].auth_pw), "1" === m ? c[g].ssl = m : delete c[g].ssl, "" !== i && i !== c[g].os_ip && (c[g].os_ip = i), "" !== j && j !== c[g].os_pw && (isMD5(c[g].os_pw) && (j = md5(j)), c[g].os_pw = j), r && (c[k] = c[g], delete c[g], g = k, q && (storage.set({ current_site: g }), b.current_site = g), updateSiteList(Object.keys(c), b.current_site)), storage.set({ sites: JSON.stringify(c) }, cloudSaveSites), showerror(_("Site updated successfully")), g === b.current_site && ("" !== j && (currPass = j), p && checkConfigured()), r && !e.find(".submit").hasClass("preventUpdate") && a(), !1 }), d.find(".deletesite").on("click", function () { var d = h[$(this).data("site")]; return $("#site-selector").val() === d && g(), delete c[d], storage.set({ sites: JSON.stringify(c) }, function () { return cloudSaveSites(), updateSiteList(Object.keys(c), b.current_site), $.isEmptyObject(c) ? storage.get("cloudToken", function () { if (null === b.cloudToken || void 0 === b.cloudToken) return currIp = "", currPass = "", void changePage("#start") }) : (a(), showerror(_("Site deleted successfully"))), !1 }), !1 }), f.find(".ui-content").html(d.enhanceWithin()) } "string" == typeof b.cloudToken && f.find(".ui-content").prepend(addSyncStatus(b.cloudToken)) }) } function b() { d = changeHeader({ title: _("Manage Sites"), animate: !!isControllerConnected(), leftBtn: { icon: "carat-l", text: _("Back"), class: "ui-toolbar-back-btn", on: function () { f.find(".hasChanges").addClass("preventUpdate"), checkChangesBeforeBack() } }, rightBtn: { icon: "plus", text: _("Add"), on: function () { "undefined" == typeof deviceip ? showAddNew() : h.popup("open").popup("reposition", { positionTo: d.eq(2) }) } } }), a(), $.mobile.pageContainer.append(h), h.popup({ history: !1, positionTo: d.eq(2) }).enhanceWithin(), $("#site-control").remove(), $.mobile.pageContainer.append(f) } var c, d, e, f = $("<div data-role='page' id='site-control'><div class='ui-content'></div></div>"), g = function () { var a = function () { d.eq(0).hide(), $("#header").show(), $("#footer, #footer-menu").hide() }; f.hasClass("ui-page-active") ? a() : f.one("pagebeforeshow", function (b) { b.stopImmediatePropagation(), a() }), f.on("swiperight swipeleft", function (a) { a.stopImmediatePropagation() }), document.title = "OpenSprinkler" }, h = $("<div data-role='popup' id='addsite' data-theme='b'><ul data-role='listview'><li data-icon='false'><a href='#' id='site-add-scan'>" + _("Scan For Device") + "</a></li><li data-icon='false'><a href='#' id='site-add-manual'>" + _("Manually Add Device") + "</a></li></ul></div>"); return h.find("#site-add-scan").on("click", function () { return h.popup("close"), startScan(), !1 }), h.find("#site-add-manual").on("click", function () { return showAddNew(!1, !0), !1 }), f.on("pagehide", function () { h.popup("destroy").detach(), f.detach() }), $("html").on("siterefresh", function () { f.hasClass("ui-page-active") && a() }), b }(), showHomeMenu = function () { function a() { c = $(".ui-page-active"), d = c.attr("id"), e = c.hasClass("show-hidden"), f = $("<div data-role='popup' data-theme='a' id='mainMenu'><ul data-role='listview' data-inset='true' data-corners='false'><li data-role='list-divider'>" + _("Information") + "</li><li><a href='#preview' class='squeeze'>" + _("Preview Programs") + "</a></li>" + (checkOSVersion(206) || checkOSPiVersion("1.9") ? "<li><a href='#logs'>" + _("View Logs") + "</a></li>" : "") + "<li data-role='list-divider'>" + _("Programs and Settings") + "</li><li><a href='#raindelay'>" + _("Change Rain Delay") + "</a></li><li><a href='#runonce'>" + _("Run-Once Program") + "</a></li><li><a href='#programs'>" + _("Edit Programs") + "</a></li><li><a href='#os-options'>" + _("Edit Options") + "</a></li>" + (checkOSVersion(210) ? "" : "<li><a href='#manual'>" + _("Manual Control") + "</a></li>") + ("sprinklers" === d || "runonce" === d || "programs" === d || "manual" === d || "addprogram" === d ? "</ul><div class='ui-grid-a ui-mini tight'><div class='ui-block-a'><a class='ui-btn tight' href='#show-hidden'>" + _(e ? "Hide" : "Show") + " " + _("Disabled") + "</a></div><div class='ui-block-b'><a class='ui-btn red tight' href='#stop-all'>" + _("Stop All Stations") + "</a></div></div>" : "<li><a class='ui-btn red' href='#stop-all'>" + _("Stop All Stations") + "</a></li></ul>") + "</div>") } function b(b) { b = b instanceof $ ? b : $(b), $(".ui-popup-active").find("[data-role='popup']").popup("close"), a(), f.on("click", "a", function () { var a = $(this), b = a.attr("href"); return f.popup("close"), "#stop-all" === b ? stopAllStations() : "#show-hidden" === b ? e ? ($(".station-hidden").hide(), c.removeClass("show-hidden")) : ($(".station-hidden").show(), c.addClass("show-hidden")) : "#raindelay" === b ? showRainDelay() : checkChanges(function () { changePage(b) }), !1 }), $("#mainMenu").remove(), f.one("popupafterclose", function () { b.show() }), openPopup(f, { positionTo: b }), b.hide() } var c, d, e, f; return b }(), showHome = function () { function a(a) { return !!isControllerConnected() && (b = !!controller.options.mas, c = !!controller.options.mas2, d = "object" == typeof controller.stations.ignore_rain, e = "object" == typeof controller.stations.act_relay, f = "object" == typeof controller.stations.stn_dis, g = "object" == typeof controller.stations.stn_seq, h = "object" == typeof controller.stations.stn_spe, i = "", j = $("#site-selector"), v(function () { for (l = 0; l < controller.stations.snames.length; l++)p(l); n.find("#os-stations-list").html(i), t() }), n.find(".sitename").toggleClass("hidden", !!currLocal).text(j.val()), n.find(".waterlevel").text(controller.options.wl), s(), n.on("click", ".station-settings", q), n.on("click", ".home-info", function () { return changePage("#os-options", { expandItem: "weather" }), !1 }), n.on("click", ".card", function () { if (!checkOSVersion(210)) return !1; var a, b = $(this), c = b.data("station"), d = controller.status[c], e = controller.stations.snames[c]; if (isStationMaster(c)) return !1; if (d) a = _("Do you want to stop the selected station?"); else { if (!b.find("span.nobr").length) return void showDurationBox({ title: e, incrementalUpdate: !1, maximum: 65535, seconds: m[k].lastRunTime[c] > 0 ? m[k].lastRunTime[c] : 0, helptext: _("Enter a duration to manually run " + e), callback: function (a) { sendToOS("/cm?sid=" + c + "&en=1&t=" + a + "&pw=", "json").done(function () { controller.settings.ps[c][0] = 99, controller.settings.ps[c][1] = a, refreshStatus(), showerror(_("Station has been queued")), m[k].lastRunTime[c] = a, storage.set({ sites: JSON.stringify(m) }, cloudSaveSites) }) } }); a = _("Do you want to unschedule the selected station?") } areYouSure(a, controller.stations.snames[c], function () { sendToOS("/cm?sid=" + c + "&en=0&pw=").done(function () { controller.settings.ps[c][0] = 0, controller.settings.ps[c][1] = 0, controller.status[l] = 0, delete timers["station-" + c], refreshStatus(), showerror(_("Station has been stopped")) }) }) }).on("click", "img", function () { var a = $(this), b = a.parents(".card").data("station"), c = a.attr("src").indexOf("data:image/jpeg;base64") !== -1; return c ? areYouSure(_("Do you want to delete the current image?"), "", function () { delete m[k].images[b], storage.set({ sites: JSON.stringify(m) }, cloudSaveSites), u() }) : takePicture(function (a) { m[k].images[b] = a, storage.set({ sites: JSON.stringify(m) }, cloudSaveSites), u() }), !1 }).on({ pagebeforeshow: function () { var b = changeHeader({ class: "logo", leftBtn: { icon: "bullets", on: function () { return openPanel(), !1 } }, rightBtn: { icon: "bell", class: "notifications", text: "<span class='notificationCount ui-li-count ui-btn-corner-all'>" + notifications.length + "</span>", on: function () { return showNotifications(), !1 } }, animate: !a }); 0 === notifications.length && $(b[2]).hide() } }), $("#sprinklers").remove(), $.mobile.pageContainer.append(n), void ($.isEmptyObject(weather) || updateWeatherBox())) } var b, c, d, e, f, g, h, i, j, k, l, m, n = $("<div data-role='page' id='sprinklers'><div class='ui-panel-wrapper'><div class='ui-content' role='main'><div class='ui-grid-a ui-body ui-corner-all info-card noweather'><div class='ui-block-a'><div id='weather' class='pointer'></div></div><div class='ui-block-b center home-info pointer'><div class='sitename bold'></div><div id='clock-s' class='nobr'></div>" + _("Water Level") + ": <span class='waterlevel'></span>%</div></div><div id='os-running-stations'></div><hr style='display:none' class='content-divider'><div id='os-stations-list' class='card-group center'></div></div></div></div>"), o = function (a, b) { timers["station-" + a] = { val: b, station: a, update: function () { n.find("#countdown-" + a).text("(" + sec2hms(this.val) + " " + _("remaining") + ")") }, done: function () { n.find("#countdown-" + a).parent("p").empty().siblings(".station-status").removeClass("on").addClass("off") } } }, p = function (a) { var j = controller.stations.snames[a], l = controller.settings.ps[a][0] > 0, n = controller.status[a] > 0, p = l ? pidname(controller.settings.ps[a][0]) : "", q = controller.settings.ps[a][1], r = !!m[k].images[a]; controller.status[a] && q > 0 && o(a, q), i += "<div data-station='" + a + "' class='ui-corner-all card" + (isStationDisabled(a) ? " station-hidden' style='display:none" : "") + "'>", i += "<div class='ui-body ui-body-a center'>", i += "<img src='" + (r ? "data:image/jpeg;base64," + m[k].images[a] : getAppURLPath() + "img/placeholder.png") + "' />", i += "<p class='station-name center inline-icon' id='station_" + a + "'>" + j + "</p>", i += "<span class='btn-no-border ui-btn ui-btn-icon-notext ui-corner-all card-icon station-status " + (n ? "on" : l ? "wait" : "off") + "'></span>", i += "<span class='btn-no-border ui-btn ui-btn-icon-notext ui-icon-wifi card-icon special-station " + (isStationSpecial(a) ? "" : "hidden") + "'></span>", i += "<span class='btn-no-border ui-btn " + (isStationMaster(a) ? "ui-icon-master" : "ui-icon-gear") + " card-icon ui-btn-icon-notext station-settings' data-station='" + a + "' id='attrib-" + a + "' " + (b ? "data-um='" + (controller.stations.masop[parseInt(a / 8)] & 1 << a % 8 ? 1 : 0) + "' " : "") + (c ? "data-um2='" + (controller.stations.masop2[parseInt(a / 8)] & 1 << a % 8 ? 1 : 0) + "' " : "") + (d ? "data-ir='" + (controller.stations.ignore_rain[parseInt(a / 8)] & 1 << a % 8 ? 1 : 0) + "' " : "") + (e ? "data-ar='" + (controller.stations.act_relay[parseInt(a / 8)] & 1 << a % 8 ? 1 : 0) + "' " : "") + (f ? "data-sd='" + (controller.stations.stn_dis[parseInt(a / 8)] & 1 << a % 8 ? 1 : 0) + "' " : "") + (g ? "data-us='" + (controller.stations.stn_seq[parseInt(a / 8)] & 1 << a % 8 ? 1 : 0) + "' " : "") + (h ? "data-hs='" + (controller.stations.stn_spe[parseInt(a / 8)] & 1 << a % 8 ? 1 : 0) + "' " : "") + "></span>", isStationMaster(a) || (l || n) && (i += "<p class='rem center'>" + (n ? _("Running") + " " + p : _("Scheduled") + " " + (controller.settings.ps[a][2] ? _("for") + " " + dateToString(new Date(1e3 * controller.settings.ps[a][2])) : p)), q > 0 && (i += " <span id='countdown-" + a + "' class='nobr'>(" + sec2hms(q) + " " + _("remaining") + ")</span>"), i += "</p>"), i += "</div></div>" }, q = function () { $("#stn_attrib").popup("destroy").remove(); var a = $(this), i = a.data("station"), j = a.siblings("[id='station_" + i + "']"), l = function (a) { var b = p.find("#specialOpts"), c = controller.special && controller.special.hasOwnProperty(i) ? controller.special[i].sd : "", d = controller.special && controller.special.hasOwnProperty(i) ? controller.special[i].st : 0; if (b.empty(), 0 === a) b.append("<p class='special-desc center small'>" + _("Select the station type using the dropdown selector above and configure the station properties.") + "</p>").enhanceWithin(); else if (1 === a) c = d === a ? c : "0000000000000000", b.append("<div class='ui-bar-a ui-bar'>" + _("RF Code") + ":</div><input class='center' data-corners='false' data-wrapper-class='tight ui-btn stn-name' id='rf-code' required='true' type='text' value='" + c + "'>").enhanceWithin(); else if (2 === a) c = parseRemoteStationData(d === a ? c : "00000000005000"), b.append("<div class='ui-bar-a ui-bar'>" + _("Remote Address") + ":</div><input class='center' data-corners='false' data-wrapper-class='tight ui-btn stn-name' id='remote-address' required='true' type='text' pattern='^(?:[0-9]{1,3}.){3}[0-9]{1,3}$' value='" + c.ip + "'><div class='ui-bar-a ui-bar'>" + _("Remote Port") + ":</div><input class='center' data-corners='false' data-wrapper-class='tight ui-btn stn-name' id='remote-port' required='true' type='number' placeholder='80' min='0' max='65535' value='" + c.port + "'><div class='ui-bar-a ui-bar'>" + _("Remote Station (index)") + ":</div><input class='center' data-corners='false' data-wrapper-class='tight ui-btn stn-name' id='remote-station' required='true' type='number' min='1' max='48' placeholder='1' value='" + (c.station + 1) + "'>").enhanceWithin(); else if (3 === a) { var e, f, g = 5, h = 1; "OSPi" === getHWVersion() ? e = [5, 6, 7, 8, 9, 10, 11, 12, 13, 16, 18, 19, 20, 21, 23, 24, 25, 26] : "2.3" === getHWVersion() && (e = [2, 10, 12, 13, 14, 15, 18, 19]), d === a && (c = c.split(""), g = parseInt(c[0] + c[1]), h = parseInt(c[2])), f = "<div class='ui-bar-a ui-bar'>" + _("GPIO Pin") + ":</div><select class='center' data-corners='false' data-wrapper-class='tight ui-btn stn-name' id='gpio-pin'>"; for (var j = 0; j < e.length; j++)f += "<option value='" + e[j] + "' " + (e[j] === g ? "selected='selected'" : "") + ">" + e[j]; f += "</select>", f += "<div class='ui-bar-a ui-bar'>" + _("Active State") + ":</div><select class='center' data-corners='false' data-wrapper-class='tight ui-btn stn-name' id='active-state'><option value='1' " + (1 === h ? "selected='selected'" : "") + ">" + _("HIGH") + "<option value='0' " + (0 === h ? "selected='selected'" : "") + ">" + _("LOW") + "</select>", b.append(f).enhanceWithin() } else 4 === a && (c = d === a ? c.split(",") : ["server", "80", "On", "Off"], b.append("<div class='ui-bar-a ui-bar'>" + _("Server Name") + ":</div><input class='center  validate-length' data-corners='false' data-wrapper-class='tight ui-btn stn-name' id='http-server' required='true' type='text' value='" + c[0] + "'><div class='ui-bar-a ui-bar'>" + _("Server Port") + ":</div><input class='center  validate-length' data-corners='false' data-wrapper-class='tight ui-btn stn-name' id='http-port' required='true' type='number' min='0' max='65535' value='" + parseInt(c[1]) + "'><div class='ui-bar-a ui-bar'>" + _("On Command") + ":</div><input class='center validate-length' data-corners='false' data-wrapper-class='tight ui-btn stn-name' id='http-on' required='true' type='text' value='" + c[2] + "'><div class='ui-bar-a ui-bar'>" + _("Off Command") + ":</div><input class='center validate-length' data-corners='false' data-wrapper-class='tight ui-btn stn-name' id='http-off' required='true' type='text' value='" + c[3] + "'><div class='center smaller' id='character-tracking' style='color:#999;'><p>" + _("Note: There is a limit on the number of character used to configure this station type.") + "</p><span>" + _("Characters remaining") + ": </span><span id='character-count'>placeholder</span></div>").enhanceWithin(), n(), $(".validate-length").on("input", n)) }, n = function () { var a = 240, b = p.find("#http-server").val() + "," + p.find("#http-port").val() + "," + p.find("#http-on").val() + "," + p.find("#http-off").val(), c = encodeURIComponent(b).length; p.find("#character-count").text(a - c), c > a ? (p.find(".attrib-submit").addClass("ui-disabled"), p.find("#character-tracking").addClass("red-text bold")) : (p.find(".attrib-submit").removeClass("ui-disabled"), p.find("#character-tracking").removeClass("red-text bold")) }, o = function (b) { var c = parseInt(p.find("#hs").val()); if (a.data("hs", c), 1 === c) a.data("specialData", p.find("#rf-code").val()); else if (2 === c) { for (var d = p.find("#remote-address").val().split("."), e = parseInt(p.find("#remote-port").val()) || 80, f = (p.find("#remote-station").val() || 1) - 1, g = "", h = 0; h < 4; h++)g += pad(parseInt(d[h]).toString(16)); if (g += (e < 256 ? "00" : "") + pad(e.toString(16)), g += pad(f.toString(16)), b !== !0) return $.mobile.loading("show"), p.find(".attrib-submit").addClass("ui-disabled"), void verifyRemoteStation(g, function (a) { var b; if (a === !0) return void o(!0); a === !1 || a === -1 ? b = _("Unable to reach the remote station.") : a === -2 ? b = _("Password on remote controller does not match the password on this controller.") : a === -3 && (b = _("Remote controller is not configured as an extender. Would you like to do this now?")), p.one("popupafterclose", function () { $.mobile.loading("hide"), c.css("opacity", "") }), $.mobile.loading("show", { html: "<h1>" + b + "</h1><button class='ui-btn cancel'>" + _("Cancel") + "</button><button class='ui-btn continue'>" + _("Continue") + "</button>", textVisible: !0, theme: "b" }); var c = $(".ui-loader"); c.css("opacity", ".96"), c.find(".cancel").one("click", function () { $.mobile.loading("hide"), c.css("opacity", "") }), c.find(".continue").one("click", function () { $.mobile.loading("hide"), c.css("opacity", ""), a === -3 && convertRemoteToExtender(g), o(!0) }), p.find(".attrib-submit").removeClass("ui-disabled") }); a.data("specialData", g) } else if (3 === c) { var l = pad(p.find("#gpio-pin").val() || "05"); l += p.find("#active-state").val() || "1", a.data("specialData", l) } else if (4 === c) { var n = p.find("#http-server").val(); n += "," + p.find("#http-port").val(), n += "," + p.find("#http-on").val(), n += "," + p.find("#http-off").val(), a.data("specialData", n) } a.data("um", p.find("#um").is(":checked") ? 1 : 0), a.data("um2", p.find("#um2").is(":checked") ? 1 : 0), a.data("ir", p.find("#ir").is(":checked") ? 1 : 0), a.data("ar", p.find("#ar").is(":checked") ? 1 : 0), a.data("sd", p.find("#sd").is(":checked") ? 1 : 0), a.data("us", p.find("#us").is(":checked") ? 1 : 0), j.html(p.find("#stn-name").val()), m[k].notes[i] = p.find("#stn-notes").val(), storage.set({ sites: JSON.stringify(m) }, cloudSaveSites), r(i), p.popup("destroy").remove() }, p = "<div data-overlay-theme='b' data-role='popup' data-theme='a' id='stn_attrib'><fieldset style='margin:0' data-mini='true' data-corners='false' data-role='controlgroup'><form><div id='station-tabs'>"; if ("number" != typeof i) return !1; h && (p += "<ul class='tabs'><li class='current' data-tab='tab-basic'>Basic</li><li data-tab='tab-advanced'>Advanced</li></ul>"), p += "<div id='tab-basic' class='tab-content current'>", p += "<div class='ui-bar-a ui-bar'>" + _("Station Name") + ":</div><input class='bold center' data-corners='false' data-wrapper-class='tight stn-name ui-btn' id='stn-name' type='text' value='" + j.text() + "'>", "undefined" != typeof navigator.camera && "function" == typeof navigator.camera.getPicture && (p += "<button class='changeBackground'>" + _("string" != typeof m[k].images[i] ? "Add" : "Change") + " " + _("Image") + "</button>"), isStationMaster(i) || (b && (p += "<label for='um'><input class='needsclick' data-iconpos='right' id='um' type='checkbox' " + (1 === a.data("um") ? "checked='checked'" : "") + ">" + _("Use Master") + " " + (c ? "1" : "") + "</label>"), c && (p += "<label for='um2'><input class='needsclick' data-iconpos='right' id='um2' type='checkbox' " + (1 === a.data("um2") ? "checked='checked'" : "") + ">" + _("Use Master") + " 2</label>"), d && (p += "<label for='ir'><input class='needsclick' data-iconpos='right' id='ir' type='checkbox' " + (1 === a.data("ir") ? "checked='checked'" : "") + ">" + _("Ignore Rain") + "</label>"), e && (p += "<label for='ar'><input class='needsclick' data-iconpos='right' id='ar' type='checkbox' " + (1 === a.data("ar") ? "checked='checked'" : "") + ">" + _("Activate Relay") + "</label>"), f && (p += "<label for='sd'><input class='needsclick' data-iconpos='right' id='sd' type='checkbox' " + (1 === a.data("sd") ? "checked='checked'" : "") + ">" + _("Disable") + "</label>"), g && (p += "<label for='us'><input class='needsclick' data-iconpos='right' id='us' type='checkbox' " + (1 === a.data("us") ? "checked='checked'" : "") + ">" + _("Sequential") + "</label>")), p += "<div class='ui-bar-a ui-bar'>" + _("Station Notes") + ":</div><textarea data-corners='false' class='tight stn-notes' id='stn-notes'>" + (m[k].notes[i] ? m[k].notes[i] : "") + "</textarea>", p += "</div>", h && (p += "<div id='tab-advanced' class='tab-content'><div class='ui-bar-a ui-bar'>" + _("Station Type") + ":</div><select data-mini='true' id='hs'" + (isStationSpecial(i) ? " class='ui-disabled'" : "") + "><option data-hs='0' value='0'" + (isStationSpecial(i) ? "" : "selected") + ">" + _("Standard") + "</option><option data-hs='1' value='1'>" + _("RF") + "</option><option data-hs='2' value='2'>" + _("Remote") + "</option><option data-hs='3' value='3'" + (checkOSVersion(217) ? ">" : " disabled>") + _("GPIO") + "</option><option data-hs='4' value='4'" + (checkOSVersion(217) ? ">" : " disabled>") + _("HTTP") + "</option></select><div id='specialOpts'></div></div></div>"), p += "<input data-wrapper-class='attrib-submit' data-theme='b' type='submit' value='" + _("Submit") + "' /></form></fieldset></div>", p = $(p).enhanceWithin().on("submit", "form", function () { return o(i), !1 }), p.find("ul.tabs li").click(function () { var a = $(this).attr("data-tab"); $("ul.tabs li").removeClass("current"), $(".tab-content").removeClass("current"), $(this).addClass("current"), $("#" + a).addClass("current") }), p.find("#hs").on("change", function () { var a = parseInt($(this).val()); return l(a), !1 }), isStationSpecial(i) ? updateControllerStationSpecial(function () { p.find("#hs").removeClass("ui-disabled").find("option[data-hs='" + controller.special[i].st + "']").prop("selected", !0), p.find("#hs").change() }) : (p.find("#hs").removeClass("ui-disabled"), p.find("option[data-hs='0']").prop("selected", !0), p.find("#hs").change()), p.find(".changeBackground").on("click", function (a) { a.preventDefault(); var b = this; takePicture(function (a) { m[k].images[i] = a, storage.set({ sites: JSON.stringify(m) }, cloudSaveSites), u(), b.innerHTML = _("Change") + " " + _("Image") }) }), $.mobile.pageContainer.append(p); var q = { history: !1 }; if (isiOS) { var s = getPageTop(); q.x = s.x, q.y = s.y } else q.positionTo = "window"; p.popup(q).popup("open") }, r = function (a) { var i, j, k, l, m = checkOSVersion(208) === !0, o = {}, p = {}, q = {}, r = {}, s = {}, t = {}, u = {}, v = {}; for (j = 0; j < controller.settings.nbrd; j++)for (b && (o["m" + j] = 0), c && (p["n" + j] = 0), g && (q["q" + j] = 0), h && (r["p" + j] = 0), d && (s["i" + j] = 0), e && (t["a" + j] = 0), f && (u["d" + j] = 0), l = 0; l < 8; l++)k = 8 * j + l, i = n.find("#attrib-" + k), b && (o["m" + j] = o["m" + j] + (i.data("um") << l)), c && (p["n" + j] = p["n" + j] + (i.data("um2") << l)), g && (q["q" + j] = q["q" + j] + (i.data("us") << l)), h && (r["p" + j] = r["p" + j] + ((i.data("hs") ? 1 : 0) << l)), d && (s["i" + j] = s["i" + j] + (i.data("ir") << l)), e && (t["a" + j] = t["a" + j] + (i.data("ar") << l)), f && (u["d" + j] = u["d" + j] + (i.data("sd") << l)), k === a && (m ? v["s" + k] = n.find("#station_" + k).text().replace(/\s/g, "_") : v["s" + k] = n.find("#station_" + k).text(), h && i.data("hs") && (r.st = i.data("hs"), r.sd = i.data("specialData"), r.sid = a)); $.mobile.loading("show"), sendToOS("/cs?pw=&" + $.param(v) + (b ? "&" + $.param(o) : "") + (c ? "&" + $.param(p) : "") + (g ? "&" + $.param(q) : "") + (h ? "&" + $.param(r) : "") + (d ? "&" + $.param(s) : "") + (e ? "&" + $.param(t) : "") + (f ? "&" + $.param(u) : "")).done(function () { showerror(_("Stations have been updated")), updateController(function () { $("html").trigger("datarefresh") }) }) }, s = function () { timers.clock = { val: controller.settings.devt, update: function () { n.find("#clock-s").text(dateToString(new Date(1e3 * this.val), null, !0)) } } }, t = function () { var a = n.find("#os-stations-list"), b = n.find("#os-running-stations"), c = n.find(".content-divider"), d = function (a, b) { return a = $(a).data("station"), b = $(b).data("station"), a < b ? -1 : a > b ? 1 : 0 }; a.find(".station-status.on").parents(".card").appendTo(b), b.find(".station-status.off").parents(".card").appendTo(a), a.children().sort(d).detach().appendTo(a), b.children().sort(d).detach().appendTo(b), 0 === b.children().length ? c.hide() : c.show() }, u = function () { var a, l, q, r, u, w, x, y = n.find("#os-stations-list"), z = y.children(), A = n.find("#os-running-stations").children(); if (n.hasClass("ui-page-active")) { s(), v(), z.length + A.length > controller.stations.snames.length && (A.detach().appendTo(y), z = y.children(), z.each(function () { var a = $(this); a.data("station") >= controller.stations.snames.length && a.remove() })), n.find(".waterlevel").text(controller.options.wl), n.find(".sitename").text(j.val()), b = !!controller.options.mas, c = !!controller.options.mas2, d = "object" == typeof controller.stations.ignore_rain, e = "object" == typeof controller.stations.act_relay, f = "object" == typeof controller.stations.stn_dis, g = "object" == typeof controller.stations.stn_seq, h = "object" == typeof controller.stations.stn_spe; for (var B = 0; B < controller.stations.snames.length; B++)a = controller.settings.ps[B][0] > 0, l = controller.status[B] > 0, q = a ? pidname(controller.settings.ps[B][0]) : "", r = controller.settings.ps[B][1], x = !!m[k].images[B], u = z.filter("[data-station='" + B + "']"), 0 === u.length && (u = A.filter("[data-station='" + B + "']")), 0 === u.length ? (i = "", p(B), y.append(i)) : (u.find(".ui-body > img").attr("src", x ? "data:image/jpeg;base64," + m[k].images[B] : getAppURLPath() + "img/placeholder.png"), isStationDisabled(B) ? (n.hasClass("show-hidden") || u.hide(), u.addClass("station-hidden")) : u.show().removeClass("station-hidden"), u.find("#station_" + B).text(controller.stations.snames[B]), u.find(".special-station").removeClass("hidden").addClass(isStationSpecial(B) ? "" : "hidden"), u.find(".station-status").removeClass("on off wait").addClass(l ? "on" : a ? "wait" : "off"), isStationMaster(B) ? u.find(".station-settings").removeClass("ui-icon-gear").addClass("ui-icon-master") : u.find(".station-settings").removeClass("ui-icon-master").addClass("ui-icon-gear"), u.find(".station-settings").data({ um: b ? controller.stations.masop[parseInt(B / 8)] & 1 << B % 8 ? 1 : 0 : void 0, um2: c ? controller.stations.masop2[parseInt(B / 8)] & 1 << B % 8 ? 1 : 0 : void 0, ir: d ? controller.stations.ignore_rain[parseInt(B / 8)] & 1 << B % 8 ? 1 : 0 : void 0, ar: e ? controller.stations.act_relay[parseInt(B / 8)] & 1 << B % 8 ? 1 : 0 : void 0, sd: f ? controller.stations.stn_dis[parseInt(B / 8)] & 1 << B % 8 ? 1 : 0 : void 0, us: g ? controller.stations.stn_seq[parseInt(B / 8)] & 1 << B % 8 ? 1 : 0 : void 0, hs: h ? controller.stations.stn_spe[parseInt(B / 8)] & 1 << B % 8 ? 1 : 0 : void 0 }), isStationMaster(B) || !a && !l ? u.find(".rem").remove() : (w = l ? _("Running") + " " + q : _("Scheduled") + " " + (controller.settings.ps[B][2] ? _("for") + " " + dateToString(new Date(1e3 * controller.settings.ps[B][2])) : q), r > 0 && (w += " <span id='countdown-" + B + "' class='nobr'>(" + sec2hms(r) + " " + _("remaining") + ")</span>", controller.status[B] && o(B, r)), 0 === u.find(".rem").length ? u.find(".ui-body").append("<p class='rem center'>" + w + "</p>") : u.find(".rem").html(w))); t() } }, v = function (a) { a = a || function () { }, k = j.val(), storage.get("sites", function (b) { m = parseSites(b.sites), "object" != typeof m[k].images || $.isEmptyObject(m[k].images) ? (m[k].images = {}, n.removeClass("has-images")) : n.addClass("has-images"), "object" != typeof m[k].notes && (m[k].notes = {}), "object" != typeof m[k].lastRunTime && (m[k].lastRunTime = {}), a() }) }; return n.one("pageshow", function () { $("html").on("datarefresh", u) }), a }(), showStart = function () { function a() { return !isControllerConnected() && ($("#start").remove(), $.mobile.pageContainer.append(b), void c()) } var b = $("<div data-role='page' id='start'><ul data-role='none' id='welcome_list' class='ui-listview ui-listview-inset ui-corner-all'><li><div class='logo' id='welcome_logo'></div></li><li class='ui-li-static ui-body-inherit ui-first-child ui-last-child ui-li-separate'><p class='rain-desc'>" + _("Welcome to the OpenSprinkler application. This app only works with the OpenSprinkler controller which must be installed and setup on your home network.") + "</p><a class='iab iabNoScale ui-btn ui-mini center' target='_blank' href='https://opensprinkler.com/product/opensprinkler/'>" + _("Purchase OpenSprinkler") + "</a></li><li class='ui-first-child ui-last-child'><a href='#' class='ui-btn center cloud-login'>" + _("OpenSprinkler.com Login") + "</a></li><hr class='content-divider'><li id='auto-scan' class='ui-first-child'><a href='#' class='ui-btn ui-btn-icon-right ui-icon-carat-r'>" + _("Scan For Device") + "</a></li><li class='ui-first-child ui-last-child'><a class='ui-btn ui-btn-icon-right ui-icon-carat-r' data-rel='popup' href='#addnew'>" + _("Add Controller") + "</a></li></ul></div>"), c = function () { updateDeviceIP(function (a) { return void 0 === a ? void d() : isLocalIP(a) ? (f.removeClass("ui-first-child").find("a.ui-btn").text(_("Manually Add Device")), void e.show()) : void d() }) }, d = function () { f.addClass("ui-first-child").find("a.ui-btn").text(_("Add Controller")), e.hide() }, e = b.find("#auto-scan"), f = e.next(); return b.find("#auto-scan").find("a").on("click", function () { return startScan(), !1 }), b.find("a[href='#addnew']").on("click", function () { showAddNew() }), b.find(".cloud-login").on("click", function () { return requestCloudAuth(), !1 }), b.on("pagehide", function () { b.detach() }), a }(), getManual = function () {
    function a() {
        var a = "<li data-role='list-divider' data-theme='a'>" + _("Sprinkler Stations") + "</li>"; e.find("#mmm").prop("checked", !!controller.settings.mm), $.each(controller.stations.snames, function (b, c) {
            a += isStationMaster(b) ? "<li data-icon='false' class='center" + (controller.status[b] ? " green" : "") + (isStationDisabled(b) ? " station-hidden' style='display:none" : "") + "'>" + c + " (" + _("Master") + ")</li>" : "<li data-icon='false'><a class='mm_station center" + (controller.status[b] ? " green" : "") + (isStationDisabled(b) ? " station-hidden' style='display:none" : "") + "'>" + c + "</a></li>"
        }), c = $("<ul data-role='listview' data-inset='true' id='mm_list'>" + a + "</ul>"), d = c.children("li").slice(1), c.find(".mm_station").on("vclick", g), e.find("#manual-station-list").html(c).enhanceWithin(), changeHeader({ title: _("Manual Control"), leftBtn: { icon: "carat-l", text: _("Back"), class: "ui-toolbar-back-btn", on: goBack } }), $("#manual").remove(), $.mobile.pageContainer.append(e)
    } var b, c, d, e = $("<div data-role='page' id='manual'><div class='ui-content' role='main'><p class='center'>" + _("With manual mode turned on, tap a station to toggle it.") + "</p><fieldset data-role='collapsible' data-collapsed='false' data-mini='true'><legend>" + _("Options") + "</legend><div class='ui-field-contain'><label for='mmm'><b>" + _("Manual Mode") + "</b></label><input type='checkbox' data-on-text='On' data-off-text='Off' data-role='flipswitch' name='mmm' id='mmm'></div><p class='rain-desc smaller center' style='padding-top:5px'>" + _("Station timer prevents a station from running indefinitely and will automatically turn it off after the set duration (or when toggled off)") + "</p><div class='ui-field-contain duration-input'><label for='auto-off'><b>" + _("Station Timer") + "</b></label><button data-mini='true' name='auto-off' id='auto-off' value='3600'>1h</button></div></fieldset><div id='manual-station-list'></div></div></div>"), f = function (a) { updateControllerStatus().done(function () { var b = d.eq(a).find("a"); controller.options.mas && (controller.status[controller.options.mas - 1] ? d.eq(controller.options.mas - 1).addClass("green") : d.eq(controller.options.mas - 1).removeClass("green")), b.text(controller.stations.snames[a]), controller.status[a] ? b.removeClass("yellow").addClass("green") : b.removeClass("green yellow") }) }, g = function () { if (!controller.settings.mm) return showerror(_("Manual mode is not enabled. Please enable manual mode then try again.")), !1; var a = $(this), c = a.closest("li"), e = d.index(c), g = e + 1, i = h.val(); return !a.hasClass("yellow") && (b = controller.status[e] ? checkOSPiVersion("2.1") ? "/sn?sid=" + g + "&set_to=0&pw=" : "/sn" + g + "=0" : checkOSPiVersion("2.1") ? "/sn?sid=" + g + "&set_to=1&set_time=" + i + "&pw=" : "/sn" + g + "=1&t=" + i, a.removeClass("green").addClass("yellow"), a.html("<p class='ui-icon ui-icon-loading mini-load'></p>"), sendToOS(b).always(function () { setTimeout(f, 1e3, e) }), !1) }, h = e.find("#auto-off"); return e.on("pagehide", function () { e.detach() }), storage.get("autoOff", function (a) { a.autoOff && (h.val(a.autoOff), h.text(dhms2str(sec2dhms(a.autoOff)))) }), h.on("click", function () { var a = $(this), b = e.find("label[for='" + a.attr("id") + "']").text(); return showDurationBox({ seconds: a.val(), title: b, callback: function (b) { a.val(b), a.text(dhms2str(sec2dhms(b))), storage.set({ autoOff: b }) }, maximum: 32768 }), !1 }), e.find("#mmm").on("change", flipSwitched), a
}(), getRunonce = function () { function a() { if (c = "<p class='center'>" + _("Zero value excludes the station from the run-once program.") + "</p>", e = [], controller.programs.pd.length) for (g = 0; g < controller.programs.pd.length; g++) { h = readProgram(controller.programs.pd[g]); var a = []; if (checkOSVersion(210)) a = h.stations; else { var n = h.stations.split(""); for (b = 0; b < controller.stations.snames.length; b++)a.push(parseInt(n[b]) ? h.duration : 0) } e.push(a) } for (f = e, d = "<select data-mini='true' name='rprog' id='rprog'><option value='t'>" + _("Test All Stations") + "</option><option value='s' selected='selected'>" + _("Quick Programs") + "</option>", b = 0; b < e.length; b++)i = checkOSVersion(210) ? controller.programs.pd[b][5] : _("Program") + " " + (b + 1), d += "<option value='" + b + "'>" + i + "</option>"; if (d += "</select>", c += d + "<form>", $.each(controller.stations.snames, function (a, b) { c += isStationMaster(a) ? "<div class='ui-field-contain duration-input" + (isStationDisabled(a) ? " station-hidden' style='display:none" : "") + "'><label for='zone-" + a + "'>" + b + ":</label><button disabled='true' data-mini='true' name='zone-" + a + "' id='zone-" + a + "' value='0'>Master</button></div>" : "<div class='ui-field-contain duration-input" + (isStationDisabled(a) ? " station-hidden' style='display:none" : "") + "'><label for='zone-" + a + "'>" + b + ":</label><button data-mini='true' name='zone-" + a + "' id='zone-" + a + "' value='0'>0s</button></div>" }), c += "</form><a class='ui-btn ui-corner-all ui-shadow rsubmit' href='#'>" + _("Submit") + "</a><a class='ui-btn ui-btn-b ui-corner-all ui-shadow rreset' href='#'>" + _("Reset") + "</a>", j.find(".ui-content").html(c).enhanceWithin(), "object" == typeof controller.settings.rodur) { var o = 0; for (b = 0; b < controller.settings.rodur.length; b++)o += controller.settings.rodur[b]; 0 !== o && k(controller.settings.rodur) } else storage.get("runonce", function (a) { a = a.runonce, a && (a = JSON.parse(a), k(a)) }); j.find("#rprog").on("change", function () { var a = $(this).val(); return "s" === a ? void l() : "t" === a ? void m(Array.apply(null, Array(controller.stations.snames.length)).map(function () { return 60 })) : void ("undefined" != typeof f[a] && m(f[a])) }), j.on("click", ".rsubmit", submitRunonce).on("click", ".rreset", l), j.find("[id^='zone-']").on("click", function () { var a = $(this), b = j.find("label[for='" + a.attr("id") + "']").text().slice(0, -1); return showDurationBox({ seconds: a.val(), title: b, callback: function (b) { a.val(b), a.text(getDurationText(b)), b > 0 ? a.addClass("green") : a.removeClass("green") }, maximum: 65535, showSun: !!checkOSVersion(214) }), !1 }), changeHeader({ title: _("Run-Once"), leftBtn: { icon: "carat-l", text: _("Back"), class: "ui-toolbar-back-btn", on: goBack }, rightBtn: { icon: "check", text: _("Submit"), on: submitRunonce } }), $("#runonce").remove(), $.mobile.pageContainer.append(j) } var b, c, d, e, f, g, h, i, j = $("<div data-role='page' id='runonce'><div class='ui-content' role='main' id='runonce_list'></div></div>"), k = function (a) { f.l = a, $("<option value='l' selected='selected'>" + _("Last Used Program") + "</option>").insertAfter(j.find("#rprog").find("option[value='t']")), m(a) }, l = function () { return j.find("[id^='zone-']").val(0).text("0s").removeClass("green"), !1 }, m = function (a) { j.find("[id^='zone-']").each(function (b, c) { if (!isStationMaster(b)) { var d = $(c); d.val(a[b]).text(getDurationText(a[b])), a[b] > 0 ? d.addClass("green") : d.removeClass("green") } }) }; return j.on("pagehide", function () { j.detach() }), a }(), getPreview = function () { function a() { q = checkOSVersion(210), r = checkOSVersion(211), s = checkOSVersion(216), "" === t.find("#preview_date").val() && (p = new Date(1e3 * controller.settings.devt), n = p.toISOString().slice(0, 10).split("-"), o = new Date(n[0], n[1] - 1, n[2]), t.find("#preview_date").val(n.join("-"))), changeHeader({ title: _("Program Preview"), leftBtn: { icon: "carat-l", text: _("Back"), class: "ui-toolbar-back-btn", on: goBack } }), $("#preview").remove(), $.mobile.pageContainer.append(t) } var b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t = $("<div data-role='page' id='preview'><div class='ui-content' role='main'><div id='preview_header' class='input_with_buttons'><button class='preview-minus ui-btn ui-btn-icon-notext ui-icon-carat-l btn-no-border'></button><input class='center' type='date' name='preview_date' id='preview_date'><button class='preview-plus ui-btn ui-btn-icon-notext ui-icon-carat-r btn-no-border'></button></div><div id='timeline'></div><div data-role='controlgroup' data-type='horizontal' id='timeline-navigation'><a class='ui-btn ui-corner-all ui-icon-plus ui-btn-icon-notext btn-no-border' title='" + _("Zoom in") + "'></a><a class='ui-btn ui-corner-all ui-icon-minus ui-btn-icon-notext btn-no-border' title='" + _("Zoom out") + "'></a><a class='ui-btn ui-corner-all ui-icon-carat-l ui-btn-icon-notext btn-no-border' title='" + _("Move left") + "'></a><a class='ui-btn ui-corner-all ui-icon-carat-r ui-btn-icon-notext btn-no-border' title='" + _("Move right") + "'></a></div></div></div>"), u = t.find("#timeline"), v = t.find("#timeline-navigation"); return t.find("#preview_date").on("change", function () { n = this.value.split("-"), o = new Date(n[0], n[1] - 1, n[2]), m() }), t.one("pagebeforeshow", function () { holdButton(t.find(".preview-plus"), function () { l(1) }), holdButton(t.find(".preview-minus"), function () { l(-1) }) }), t.on({ pagehide: function () { t.detach() }, pageshow: function () { m() } }), c = function (a, c, e) { b = []; var f, g, h, k, l, m, n, o, p, t, u, v = Math.floor(controller.settings.devt / 86400), w = 0, x = Date.UTC(e, a - 1, c, 0, 0, 0, 0), y = x / 1e3 / 3600 / 24 >> 0, z = 8 * controller.settings.nbrd, A = new Array(z), B = new Array(z), C = new Array(z), D = new Array(z), E = [], F = new Array(z), G = 0, H = 0; for (k = 0; k < z; k++)A[k] = -1, B[k] = 0, C[k] = 0, D[k] = 0, F[k] = 255; do { f = 0, g = 0; for (var I = 0; I < controller.programs.pd.length; I++)if (h = controller.programs.pd[I], d(h, w, x, y, v)) for (k = 0; k < z; k++)if (o = k >> 3, t = k % 8, !isStationMaster(k)) if (q) { if (controller.stations.stn_dis[o] & 1 << t) continue; if (h[4][k] && 0 === C[k]) { var J = 0; J = 2 & h[0] && (controller.options.uwt > 0 && y === v || 0 === controller.options.uwt) ? getStationDuration(h[4][k], x) * controller.options.wl / 100 >> 0 : getStationDuration(h[4][k], x), J > 0 && (s ? E.length < z && E.push({ st: -1, dur: J, sid: k, pid: I + 1, pl: 1 }) : (C[k] = J, B[k] = I + 1), g = 1) } } else h[7 + o] & 1 << t && (C[k] = h[6] * controller.options.wl / 100 >> 0, B[k] = I + 1, g = 1); if (g) { var K = 60 * w, L = K; if (r) if (H > K && (L = H + controller.options.sdt), s) for (l = 0; l < E.length; l++)m = E[l], m.st >= 0 || 0 === m.dur || (k = m.sid, p = k >> 3, u = 7 & k, controller.stations.stn_seq[p] & 1 << u ? (m.st = L, L += m.dur, L += controller.options.sdt) : (m.st = K, K++), f = 1); else for (k = 0; k < z; k++)p = k >> 3, u = 7 & k, 0 === C[k] || A[k] >= 0 || (controller.stations.stn_seq[p] & 1 << u ? (A[k] = L, L += C[k], C[k] = L, L += controller.options.sdt, D[k] = 1) : (A[k] = K, C[k] = K + C[k], D[k] = 1), f = 1); else if (q && controller.options.seq && G > K && (K = G + controller.options.sdt), controller.options.seq) for (k = 0; k < 8 * controller.settings.nbrd; k++)0 !== C[k] && 0 !== B[k] && (A[k] = K, K += C[k], C[k] = K, K += controller.options.sdt, f = 1); else for (k = 0; k < 8 * controller.settings.nbrd; k++)0 !== C[k] && 0 !== B[k] && (A[k] = K, C[k] = K + C[k], f = 1) } if (s) { for (l = 0; l < E.length; l++)m = E[l], k = m.sid, n = F[k], n < 255 && E[n].st < m.st || (F[k] = l); for (j(60 * w, E, F, x), w++ , k = 0; k < 8 * controller.settings.nbrd; k++)if (n = F[k], 255 !== n && (m = E[n], m.st >= 0 && 60 * w >= m.st + m.dur)) { var M = E.length; n < M - 1 && (E[n] = E[M - 1], F[E[n].sid] === M - 1 && (F[E[n].sid] = n)), E.pop(), F[k] = 255 } for (H = 0, l = 0; l < E.length; l++) { m = E[l], k = m.sid, p = k >> 3, u = 7 & k; var N = m.st + m.dur; controller.stations.stn_seq[p] & 1 << u && N > H && (H = N) } } else if (f) if (r) for (H = i(60 * w, A, B, C, D, x), w++ , k = 0; k < 8 * controller.settings.nbrd; k++)B[k] > 0 && 60 * w >= C[k] && (A[k] = -1, B[k] = 0, C[k] = 0, D[k] = 0); else if (q) for (G = i(60 * w, A, B, C, D, x), w++ , k = 0; k < 8 * controller.settings.nbrd; k++)A[k] = -1, B[k] = 0, C[k] = 0; else { var O = i(60 * w, A, B, C, D, x) / 60 >> 0; for (controller.options.seq && w !== O ? w = O : w++ , k = 0; k < 8 * controller.settings.nbrd; k++)A[k] = -1, B[k] = 0, C[k] = 0 } else if (w++ , r) for (k = 0; k < 8 * controller.settings.nbrd; k++)B[k] > 0 && 60 * w >= C[k] && (A[k] = -1, B[k] = 0, C[k] = 0, D[k] = 0) } while (w < 1440) }, j = function (a, c, d, e) { for (var f = 0; f < 8 * controller.settings.nbrd; f++) { var g = d[f]; if (255 !== g) { var h = c[g]; if (h.pl) { var i = "undefined" != typeof controller.options.mas2, j = controller.stations.masop[f >> 3] & 1 << f % 8, l = !!i && controller.stations.masop2[f >> 3] & 1 << f % 8; isStationMaster(f) || (controller.options.mas > 0 && j && b.push({ start: h.st + controller.options.mton, end: h.st + h.dur + controller.options.mtof, content: "", className: "master", shortname: "M" + (i ? "1" : ""), group: "Master", station: f }), i && controller.options.mas2 > 0 && l && b.push({ start: h.st + controller.options.mton2, end: h.st + h.dur + controller.options.mtof2, content: "", className: "master", shortname: "M2", group: "Master 2", station: f })), k(f, h.st, h.pid, h.st + h.dur, e), h.pl = 0 } } } }, i = function (a, c, d, e, f, g) { for (var h = a, i = 0; i < 8 * controller.settings.nbrd; i++)if (d[i]) if (r) { if (f[i]) { var j = "undefined" != typeof controller.options.mas2, l = controller.stations.masop[i >> 3] & 1 << i % 8, m = !!j && controller.stations.masop2[i >> 3] & 1 << i % 8; isStationMaster(i) || (controller.options.mas > 0 && l && b.push({ start: c[i] + controller.options.mton, end: e[i] + controller.options.mtof, content: "", className: "master", shortname: "M" + (j ? "1" : ""), group: "Master", station: i }), j && controller.options.mas2 > 0 && m && b.push({ start: c[i] + controller.options.mton2, end: e[i] + controller.options.mtof2, content: "", className: "master", shortname: "M2", group: "Master 2", station: i })), k(i, c[i], d[i], e[i], g), f[i] = 0, controller.stations.stn_seq[i >> 3] & 1 << (7 & i) && (h = h > e[i] ? h : e[i]) } } else 1 === controller.options.seq ? (isStationMaster(i) && controller.stations.masop[i >> 3] & 1 << i % 8 && b.push({ start: c[i] + controller.options.mton, end: e[i] + controller.options.mtof, content: "", className: "master", shortname: "M", group: "Master", station: i }), k(i, c[i], d[i], e[i], g), h = e[i]) : (k(i, a, d[i], e[i], g), isStationMaster(i) && controller.stations.masop[i >> 3] & 1 << i % 8 && (h = h > e[i] ? h : e[i])); return r || 0 === controller.options.seq && controller.options.mas > 0 && b.push({ start: a, end: h, content: "", className: "master", shortname: "M", group: "Master", station: i }), h }, k = function (a, c, d, e, f) { var g = "program-" + (d + 3) % 4, h = "P" + d; (0 !== controller.settings.rd && f + c + 900 * (controller.options.tz - 48) <= 1e3 * controller.settings.rdst || 1 === controller.options.urs && 1 === controller.settings.rs) && "object" == typeof controller.stations.ignore_rain && 0 === (controller.stations.ignore_rain[parseInt(a / 8)] & 1 << a % 8) && (g = "delayed"), checkOSVersion(210) && (h = controller.programs.pd[d - 1][5]), b.push({ start: c, end: e, className: g, content: h, pid: d - 1, shortname: "S" + (a + 1), group: controller.stations.snames[a], station: a }) }, d = function (a, b, c, d, g) { return s ? h(a, b, c, d, g) : q ? f(a, b, c, d, g) : e(a, b, c, d, g) }, e = function (a, b, c, d, e) { if (0 === a[0]) return 0; if (128 & a[1] && a[2] > 1) { var f = a[2], g = 127 & a[1]; if (d % f !== (e + g) % f) return 0 } else { var h = new Date(c), i = (h.getUTCDay() + 6) % 7; if (0 === (a[1] & 1 << i)) return 0; var j = h.getUTCDate(); if (128 & a[1] && 0 === a[2] && j % 2 !== 0) return 0; if (128 & a[1] && 1 === a[2] && (31 === j || 29 === j && 1 === h.getUTCMonth() || j % 2 !== 1)) return 0 } return b < a[3] || b > a[4] || isOSPi() && b >= a[4] ? 0 : 0 === a[5] ? 0 : ((b - a[3]) / a[5] >> 0) * a[5] === b - a[3] ? 1 : 0 }, g = function (a, b, c, d) { var e = a[0] >> 2 & 3, f = a[0] >> 4 & 3, g = new Date(b); if (3 === f) { var h = a[2], i = a[1]; if (c % h !== (d + i) % h) return 0 } else { if (0 !== f) return 0; var j = (g.getUTCDay() + 6) % 7; if (0 === (a[1] & 1 << j)) return 0 } var k = g.getUTCDate(); if (2 === e) { if (k % 2 !== 0) return 0 } else if (1 === e && (31 === k || 29 === k && 1 === g.getUTCMonth() || k % 2 !== 1)) return 0; return 1 }, f = function (a, b, c, d, e) { var f = 1 & a[0], h = a[0] >> 6 & 1, i = new Date(c); if (0 === f) return 0; if (!g(a, c, d, e)) return 0; if (0 === h) { var j = getStartTime(a[3][0], i), k = a[3][1], l = a[3][2]; if (b < j) return 0; if (0 === k) return b === j ? 1 : 0; if (0 === l) return 0; var m = Math.round((b - j) / l); if (m * l === b - j && m <= k) return 1 } else for (var n = a[3], o = 0; o < 4; o++)if (b === getStartTime(n[o], i)) return 1; return 0 }, h = function (a, b, c, d, e) { var f = 1 & a[0], h = a[0] >> 6 & 1, i = new Date(c); if (0 === f) return 0; var j, k = getStartTime(a[3][0], i), l = a[3][1], m = a[3][2]; if (g(a, c, d, e)) { if (0 !== h) { for (var n = a[3], o = 0; o < 4; o++)if (b === getStartTime(n[o], i)) return 1; return 0 } if (b === k) return 1; if (b > k && m && (j = Math.round((b - k) / m), j * m === b - k && j <= l)) return 1 } return h || !m ? 0 : g(a, c - 864e5, d - 1, e) && (j = Math.round((b - k + 1440) / m), j * m === b - k + 1440 && j <= l) ? 1 : 0 }, l = function (a) { o.setDate(o.getDate() + a); var b = pad(o.getMonth() + 1), c = pad(o.getDate()), d = o.getFullYear(); n = [d, b, c], t.find("#preview_date").val(n.join("-")), m() }, m = function () { if (c(n[1], n[2], n[0]), v.hide(), !b.length) return void t.find("#timeline").html("<p align='center'>" + _("No stations set to run on this day.") + "</p>"); b.sort(sortByStation); var a = [], d = new Date(n[0], n[1] - 1, n[2], 24); $.each(b, function () { var b = this.start + this.end; if (this.start = new Date(n[0], n[1] - 1, n[2], 0, 0, this.start), b > 86400) { var c = Math.floor(this.end / 86400); this.end = new Date(n[0], n[1] - 1, parseInt(n[2]) + c, 0, 0, this.end % 86400), d = d > this.end ? d : this.end } else this.end = new Date(n[0], n[1] - 1, n[2], 0, 0, this.end); a[this.group] = this.shortname }); var e = { width: "100%", editable: !1, axisOnTop: !0, eventMargin: 10, eventMarginAxis: 0, min: new Date(n[0], n[1] - 1, n[2], 0), max: d, selectable: !0, showMajorLabels: !1, zoomMax: 864e5, zoomMin: 36e5, groupsChangeable: !1, showNavigation: !1, groupsOrder: "none", groupMinHeight: 20 }, f = function () { g.redraw() }, g = new links.Timeline(u[0], e), h = new Date(p); h.setMinutes(h.getMinutes() + h.getTimezoneOffset()), g.setCurrentTime(h), links.events.addListener(g, "select", function () { var a = g.getSelection(); a.length && "undefined" != typeof a[0].row && changePage("#programs", { programToExpand: parseInt(g.getItem(a[0].row).pid) }) }), $.mobile.window.on("resize", f), t.one("pagehide", function () { $.mobile.window.off("resize", f) }), g.draw(b), t.find(".timeline-groups-text").each(function () { var b = $(this), c = a[b.text()]; b.attr("data-shortname", c) }), t.find(".timeline-groups-axis").children().first().html("<div class='timeline-axis-text center dayofweek' data-shortname='" + getDayName(o, "short") + "'>" + getDayName(o) + "</div>"), isAndroid ? (v.find(".ui-icon-plus").off("click").on("click", function () { return g.zoom(.4), !1 }), v.find(".ui-icon-minus").off("click").on("click", function () { return g.zoom(-.4), !1 }), v.find(".ui-icon-carat-l").off("click").on("click", function () { return g.move(-.2), !1 }), v.find(".ui-icon-carat-r").off("click").on("click", function () { return g.move(.2), !1 }), v.show()) : v.hide(), u.on("swiperight swipeleft", function (a) { a.stopImmediatePropagation() }) }, a }(), getLogs = function () { function a() { if (b = $.merge($.merge([], controller.stations.snames), [_("Rain Sensor"), _("Rain Delay")]), e.find(".clear_logs").toggleClass("hidden", !isOSPi() && !checkOSVersion(210)), "" === y.val() || "" === z.val()) { var a = new Date(1e3 * controller.settings.devt); y.val(new Date(a.getTime() - 6048e5).toISOString().slice(0, 10)), z.val(a.toISOString().slice(0, 10)) } changeHeader({ title: _("Logs"), leftBtn: { icon: "carat-l", text: _("Back"), class: "ui-toolbar-back-btn", on: goBack }, rightBtn: { icon: "refresh", text: _("Refresh"), on: w } }), $("#logs").remove(), $.mobile.pageContainer.append(e) } var b, c, d, e = $("<div data-role='page' id='logs'><div class='ui-content' role='main'><fieldset data-role='controlgroup' data-type='horizontal' data-mini='true' class='log_type'><input data-mini='true' type='radio' name='log_type' id='log_timeline' value='timeline'><label for='log_timeline'>" + _("Timeline") + "</label><input data-mini='true' type='radio' name='log_type' id='log_table' value='table'><label for='log_table'>" + _("Table") + "</label></fieldset><fieldset data-role='collapsible' data-mini='true' id='log_options' class='center'><legend>" + _("Options") + "</legend><fieldset data-role='controlgroup' data-type='horizontal' id='table_sort'><p class='tight'>" + _("Grouping:") + "</p><input data-mini='true' type='radio' name='table-group' id='table-sort-day' value='day' checked='checked'><label for='table-sort-day'>" + _("Day") + "</label><input data-mini='true' type='radio' name='table-group' id='table-sort-station' value='station'><label for='table-sort-station'>" + _("Station") + "</label></fieldset><div class='ui-field-contain'><label for='log_start'>" + _("Start:") + "</label><input data-mini='true' type='date' id='log_start'><label for='log_end'>" + _("End:") + "</label><input data-mini='true' type='date' id='log_end'></div><a data-role='button' data-icon='action' class='export_logs' href='#' data-mini='true'>" + _("Export") + "</a><a data-role='button' class='red clear_logs' href='#' data-mini='true' data-icon='alert'>" + _("Clear Logs") + "</a></fieldset><div id='logs_list' class='center'></div></div></div>"), f = e.find("#logs_list"), g = e.find("#table_sort"), h = e.find("#log_options"), i = [], j = [], k = [], l = function (a, c) { var e = [], f = { totalRuntime: 0, totalCount: 0 }; if ("table" === a && "station" === c) for (d = 0; d < b.length; d++)e[d] = []; return $.each(i, function () { var d = this[1], g = parseInt(this[2]); g < 0 && (g += 65536); var h = new Date(parseInt(1e3 * this[3]) - 1e3 * g), i = new Date(h.getUTCFullYear(), h.getUTCMonth(), h.getUTCDate(), h.getUTCHours(), h.getUTCMinutes(), h.getUTCSeconds()); if ("string" == typeof d) if ("rs" === d) d = b.length - 2; else { if ("rd" !== d) return; d = b.length - 1 } else if ("number" == typeof d) { if (d > b.length - 2 || isStationMaster(d)) return; f.totalRuntime += g, f.totalCount++ } if ("table" === a) switch (c) { case "station": e[d].push([i, dhms2str(sec2dhms(g))]); break; case "day": var j = Math.floor(h.getTime() / 1e3 / 60 / 60 / 24), k = [i, dhms2str(sec2dhms(g)), d]; "object" != typeof e[j] ? e[j] = [k] : e[j].push(k) } else if ("timeline" === a) { var l, m, n, o, p = parseInt(this[0]); if ("rs" === this[1]) l = "delayed", m = _("Rain Sensor"), n = m, o = _("RS"); else if ("rd" === this[1]) l = "delayed", m = _("Rain Delay"), n = m, o = _("RD"); else { if (0 === p) return; l = "program-" + (p + 3) % 4, m = pidname(p), n = controller.stations.snames[d], o = "S" + (d + 1) } e.push({ start: i, end: new Date(i.getTime() + 1e3 * g), className: l, content: m, pid: p - 1, shortname: o, group: n, station: d }) } }), "timeline" === a && e.sort(sortByStation), [e, f] }, m = function (a, b) { var c = [], d = []; return j.length && (a.avgWaterLevel = 0, $.each(j, function () { c[Math.floor(this[3] / 60 / 60 / 24)] = this[2], a.avgWaterLevel += this[2] }), a.avgWaterLevel = parseFloat((a.avgWaterLevel / j.length).toFixed(2))), k.length && (a.totalVolume = 0, $.each(k, function () { var c = flowCountToVolume(this[0]); if ("timeline" === b) { var e = new Date(parseInt(1e3 * this[3])), f = new Date(e.getUTCFullYear(), e.getUTCMonth(), e.getUTCDate(), e.getUTCHours(), e.getUTCMinutes(), e.getUTCSeconds()); d.push({ start: new Date(f.getTime() - parseInt(1e3 * this[2])), end: f, className: "", content: c + " L", shortname: _("FS"), group: _("Flow Sensor") }) } else { var g = Math.floor(this[3] / 60 / 60 / 24); d[g] = d[g] ? d[g] + c : c } a.totalVolume += c })), [c, d, a] }, n = function (a, b, c) { if ("object" != typeof a || a.length < 1 || a.result && 32 === a.result) return $.mobile.loading("hide"), void s(); try { k = JSON.parse(k.replace(/,\s*inf/g, "")) } catch (a) { k = [] } i = a, j = $.isEmptyObject(b) ? [] : b, k = $.isEmptyObject(c) ? [] : c, o(), exportObj(".export_logs", i), $.mobile.loading("hide") }, o = function () { e.find("#log_table").prop("checked") ? q() : e.find("#log_timeline").prop("checked") && p() }, p = function () { if (i.length < 1) return void s(); g.hide(), f.show(), h.collapsible("collapse"); var a = l("timeline"), b = m(a[1], "timeline"), c = a[0].concat(b[1]), d = b[2], j = { width: "100%", editable: !1, axisOnTop: !0, eventMargin: 10, eventMarginAxis: 0, min: u().start, max: new Date(u().end.getTime() + 8634e4), selectable: !1, showMajorLabels: !1, groupsChangeable: !1, showNavigation: !1, groupsOrder: "none", groupMinHeight: 20, zoomMin: 6e4 }, k = function () { p.redraw() }, n = function () { $.mobile.window.off("resize", k) }, o = []; f.on("swiperight swipeleft", function (a) { a.stopImmediatePropagation() }), $.each(c, function () { o[this.group] = this.shortname }); var p = new links.Timeline(f.get(0), j); $.mobile.window.on("resize", k), e.one("pagehide", n), e.find("input:radio[name='log_type']").one("change", n), p.draw(c), f.find(".timeline-groups-text").each(function () { this.setAttribute("data-shortname", o[this.textContent]) }), f.prepend(r(d)) }, q = function () { if (i.length < 1) return void s(); g.show(), f.show(); var a, c, d, j = e.find("input:radio[name='table-group']:checked").val(), k = l("table", j), n = k[0], o = m(k[1]), p = [], q = o[0], t = o[1], u = o[2], v = "<table><thead><tr><th data-priority='1'>" + _("Runtime") + "</th><th data-priority='2'>" + ("station" === j ? _("Date/Time") : _("Time") + "</th><th>" + _("Station")) + "</th></tr></thead><tbody>", x = r(u) + "<div data-role='collapsible-set' data-inset='true' data-theme='b' data-collapsed-icon='arrow-d' data-expanded-icon='arrow-u'>", y = 0; for (a in n) if (n.hasOwnProperty(a)) { if (c = n[a].length, 0 === c) continue; for (p[y] = "<div data-role='collapsible' data-collapsed='true'><h2>" + (checkOSVersion(210) && "day" === j ? "<a class='ui-btn red ui-btn-corner-all delete-day day-" + a + "'>" + _("delete") + "</a>" : "") + "<div class='ui-btn-up-c ui-btn-corner-all custom-count-pos'>" + c + " " + _(1 === c ? "run" : "runs") + "</div>" + ("station" === j ? b[a] : dateToString(new Date(1e3 * a * 60 * 60 * 24)).slice(0, -9)) + "</h2>", q[a] && (p[y] += "<span style='border:none' class='" + (100 !== q[a] ? q[a] < 100 ? "green " : "red " : "") + "ui-body ui-body-a'>" + _("Average") + " " + _("Water Level") + ": " + q[a] + "%</span>"), t[a] && (p[y] += "<span style='border:none' class='ui-body ui-body-a'>" + _("Total Water Used") + ": " + t[a] + " L</span>"), p[y] += v, d = 0; d < n[a].length; d++) { var z = new Date(n[a][d][0]); p[y] += "<tr><td>" + n[a][d][1] + "</td><td>" + ("station" === j ? dateToString(z, !1) : pad(z.getHours()) + ":" + pad(z.getMinutes()) + ":" + pad(z.getSeconds()) + "</td><td>" + b[n[a][d][2]]) + "</td></tr>" } p[y] += "</tbody></table></div>", y++ } "day" === j && p.reverse(), h.collapsible("collapse"), f.html(x + p.join("") + "</div>").enhanceWithin(), f.find(".delete-day").on("click", function () { var a, b; return $.each(this.className.split(" "), function () { if (0 === this.indexOf("day-")) return a = this.split("day-")[1], !1 }), b = dateToString(new Date(1e3 * a * 60 * 60 * 24)).slice(0, -9), areYouSure(_("Are you sure you want to ") + _("delete") + " " + b + "?", "", function () { $.mobile.loading("show"), sendToOS("/dl?pw=&day=" + a).done(function () { w(), showerror(b + " " + _("deleted")) }) }), !1 }), fixInputClick(f) }, r = function (a) { if (0 === a.totalCount || 0 === a.totalRuntime) return ""; var b = "undefined" != typeof a.avgWaterLevel; return "<div class='ui-body-a smaller' id='logs_summary'><div><span class='bold'>" + _("Total Station Events") + "</span>: " + a.totalCount + "</div><div><span class='bold'>" + _("Total Runtime") + "</span>: " + dhms2str(sec2dhms(a.totalRuntime)) + "</div>" + (b ? "<div><span class='bold'>" + _("Average") + " " + _("Water Level") + "</span>: <span class='" + (100 !== a.avgWaterLevel ? a.avgWaterLevel < 100 ? "green-text" : "red-text" : "") + "'>" + a.avgWaterLevel + "%</span></div>" : "") + ("undefined" != typeof a.totalVolume && a.totalVolume > 0 ? "<div><span class='bold'>" + _("Total Water Used") + "</span>: " + a.totalVolume + " L" + (b && a.avgWaterLevel < 100 ? " (<span class='green-text'>" + (a.totalVolume - a.totalVolume * (a.avgWaterLevel / 100)).toFixed(2) + "L saved</span>)" : "") + "</div>" : "") + "</div>" }, s = function () { i = [], h.collapsible("expand"), g.hide(), f.show().html(_("No entries found in the selected date range")) }, t = function () { $.mobile.loading("hide"), g.empty().hide(), f.show().html(_("Error retrieving log data. Please refresh to try again.")) }, u = function () { var a = y.val().split("-"), b = z.val().split("-"); return { start: new Date(a[0], a[1] - 1, a[2]), end: new Date(b[0], b[1] - 1, b[2]) } }, v = function () { return "start=" + u().start.getTime() / 1e3 + "&end=" + (u().end.getTime() / 1e3 + 86340) }, w = function () { var a = u().end.getTime() / 1e3, b = u().start.getTime() / 1e3; if (a < b) return s(), void showerror(_("Start time cannot be greater than end time")); var c = 0; if ($.mobile.loading("show"), a - b > 3154e4) { showerror(_("The requested time span exceeds the maxiumum of 1 year and has been adjusted"), 3500); var d = u().start; d.setFullYear(d.getFullYear() + 1), $("#log_end").val(d.getFullYear() + "-" + pad(d.getMonth() + 1) + "-" + pad(d.getDate())), c = 500 } var e = $.Deferred().resolve(), f = $.Deferred().resolve(); checkOSVersion(211) && (e = sendToOS("/jl?pw=&type=wl&" + v(), "json")), checkOSVersion(216) && (f = sendToOS("/jl?pw=&type=fl&" + v())), setTimeout(function () { $.when(sendToOS("/jl?pw=&" + v(), "json"), e, f).then(n, t) }, c) }, x = window.innerWidth < 640, y = e.find("#log_start"), z = e.find("#log_end"); return e.find(".clear_logs").on("click", function () { return clearLogs(w), !1 }), isiOS ? y.add(z).on("blur", function () { e.hasClass("ui-page-active") && w() }) : y.add(z).change(function () { clearTimeout(c), c = setTimeout(w, 1e3) }), g.find("input[name='table-group']").change(function () { q() }), e.find("input:radio[name='log_type']").change(o), e.on({ pagehide: function () { e.detach() }, pageshow: w }), e.find("#log_timeline").prop("checked", !x), e.find("#log_table").prop("checked", x), a }(), getPrograms = function () { function a() { var a = $(makeAllPrograms()); a.find("[id^=program-]").on({ collapsiblecollapse: function () { $(this).find(".ui-collapsible-content").empty() }, collapsiblebeforecollapse: function (a) { var b = $(this), c = b.find(".hasChanges"); c.length && (areYouSure(_("Do you want to save your changes?"), "", function () { c.removeClass("hasChanges").click(), b.collapsible("collapse") }, function () { c.removeClass("hasChanges"), b.collapsible("collapse") }), a.preventDefault()) }, collapsibleexpand: function () { expandProgram($(this)) } }), checkOSVersion(210) && a.find(".move-up").removeClass("hidden").on("click", function () { var a = $(this).parents("fieldset"), b = parseInt(a.attr("id").split("-")[1]); return $.mobile.loading("show"), sendToOS("/up?pw=&pid=" + b).done(function () { updateControllerPrograms(function () { $.mobile.loading("hide"), d.trigger("programrefresh") }) }), !1 }), a.find(".program-copy").on("click", function () { var a = parseInt($(this).parents("fieldset").attr("id").split("-")[1]); return changePage("#addprogram", { copyID: a }), !1 }), d.find("#programs_list").html(a.enhanceWithin()) } function b(b) { c = b, changeHeader({ title: _("Programs"), leftBtn: { icon: "carat-l", text: _("Back"), class: "ui-toolbar-back-btn", on: checkChangesBeforeBack }, rightBtn: { icon: "plus", text: _("Add"), on: function () { checkChanges(function () { changePage("#addprogram") }) } } }), a(), $("#programs").remove(), $.mobile.pageContainer.append(d) } var c, d = $("<div data-role='page' id='programs'><div class='ui-content' role='main' id='programs_list'></div></div>"); return d.on("programrefresh", a).on("pagehide", function () { d.detach() }).on("pagebeforeshow", function () { updateProgramHeader(), "number" != typeof c && 1 === controller.programs.pd.length && (c = 0), "number" == typeof c && (d.find("fieldset[data-collapsed='false']").collapsible("collapse"), $("#program-" + c).collapsible("expand")) }), b }(), showAbout = function () { function a() { b = "undefined" == typeof controller.options.hwv, c.find(".hardware").toggleClass("hidden", b).text(getHWVersion() + getHWType()), c.find(".hardwareLabel").toggleClass("hidden", b), c.find(".firmware").text(getOSVersion() + getOSMinorVersion()), c.one("pagehide", function () { c.detach() }), changeHeader({ title: _("About"), leftBtn: { icon: "carat-l", text: _("Back"), class: "ui-toolbar-back-btn", on: goBack } }), $("#about").remove(), $.mobile.pageContainer.append(c) } var b, c = $("<div data-role='page' id='about'><div class='ui-content' role='main'><ul data-role='listview' data-inset='true'><li><p>" + _("User manual for OpenSprinkler is available at") + " <a class='iab' target='_blank' href='https://openthings.freshdesk.com/support/solutions/folders/5000147083'>https://support.openthings.io</a></p></li></ul><ul data-role='listview' data-inset='true'><li><p>" + _("This is open source software: source code and changelog for this application can be found at") + " <a class='iab squeeze' target='_blank' href='https://github.com/OpenSprinkler/OpenSprinkler-App/'>https://github.com/OpenSprinkler/OpenSprinkler-App/</a></p><p>" + _("Language localization is crowdsourced using Get Localization available at") + " <a class='iab squeeze' target='_blank' href='http://www.getlocalization.com/OpenSprinkler/'>http://www.getlocalization.com/OpenSprinkler/</a></p><p>" + _("Open source attributions") + ": <a class='iab iabNoScale squeeze' target='_blank' href='https://github.com/OpenSprinkler/OpenSprinkler-App/wiki/List-of-Integrated-Libraries'>https://github.com/OpenSprinkler/OpenSprinkler-App/wiki/List-of-Integrated-Libraries</a></p></li></ul><p class='smaller'>" + _("App Version") + ": 1.7.1<br>" + _("Firmware") + ": <span class='firmware'></span><br><span class='hardwareLabel'>" + _("Hardware Version") + ":</span> <span class='hardware'></span></p></div></div>"); return a }(); $.fn.focusInput = function () { if (this.get(0).setSelectionRange) this.focus(), this.get(0).setSelectionRange(0, this.val().length); else if (this.get(0).createTextRange) { var a = this.get(0).createTextRange(); a.collapse(!0), a.moveEnd("character", this.val().length), a.moveStart("character", 0), a.select() } return this }, Number.prototype.clamp = function (a, b) { return Math.min(Math.max(this, a), b) }, !function (a) { "use strict"; function b(a) { return a.state ? "pending" !== a.state() : a.isResolved() || a.isRejected() } var c = "__RETRY__" + (new Date).getTime(); a.ajaxPrefilter(function (d, e, f) { if (!d[c] && "undefined" != typeof d.shouldRetry) { e[c] = !0; var g, h, i = a.Deferred(), j = a.Deferred(), k = {}, l = 0, m = function (b, c, e) { var f, g = d.shouldRetry, h = typeof g; switch (h) { case "number": f = g > c; break; case "boolean": f = g; break; case "function": f = g(b, c, e) }return "object" == typeof f && "function" == typeof f.then ? a.Deferred(function (a) { f.then(a.resolve, function () { a.resolve(!1) }) }).promise() : a.when(f) }; g = a.extend({}, e, { success: a.noop, error: a.noop, complete: a.noop, statusCode: {} }), function b(c, d, e) { (d ? m(d, l++, c.type || "GET") : a.when(!0)).done(function (g) { g === !0 ? (d ? a.ajax(c) : f).then(function (a, b, c) { h = c.status, i.resolveWith(this, arguments), i.done(k[h]), j.resolveWith(this, [c, b]) }, function (a, d) { var e = arguments, f = this; b(c, a, function () { h = a.status, i.rejectWith(f, e), i.fail(k[h]), j.resolveWith(f, [a, d]) }) }) : e() }) }(g), f.complete && (f.complete = j.done, f.success = i.done, f.error = i.fail), a.extend(f, i.promise()), f.statusCode = function (a) { var c; if (a) if (b(i)) i.then(a[h], a[h]); else for (c in a) k[c] = [k[c], a[c]]; return this } } }) }(jQuery), !function () {
    "use strict"; function a(b, d) {
        function e(a, b) {
            return function () { return a.apply(b, arguments) };
        } var f; if (d = d || {}, this.trackingClick = !1, this.trackingClickStart = 0, this.targetElement = null, this.touchStartX = 0, this.touchStartY = 0, this.lastTouchIdentifier = 0, this.touchBoundary = d.touchBoundary || 10, this.layer = b, this.tapDelay = d.tapDelay || 200, this.tapTimeout = d.tapTimeout || 700, !a.notNeeded(b)) { for (var g = ["onMouse", "onClick", "onTouchStart", "onTouchMove", "onTouchEnd", "onTouchCancel"], h = this, i = 0, j = g.length; j > i; i++)h[g[i]] = e(h[g[i]], h); c && (b.addEventListener("mouseover", this.onMouse, !0), b.addEventListener("mousedown", this.onMouse, !0), b.addEventListener("mouseup", this.onMouse, !0)), b.addEventListener("click", this.onClick, !0), b.addEventListener("touchstart", this.onTouchStart, !1), b.addEventListener("touchmove", this.onTouchMove, !1), b.addEventListener("touchend", this.onTouchEnd, !1), b.addEventListener("touchcancel", this.onTouchCancel, !1), Event.prototype.stopImmediatePropagation || (b.removeEventListener = function (a, c, d) { var e = Node.prototype.removeEventListener; "click" === a ? e.call(b, a, c.hijacked || c, d) : e.call(b, a, c, d) }, b.addEventListener = function (a, c, d) { var e = Node.prototype.addEventListener; "click" === a ? e.call(b, a, c.hijacked || (c.hijacked = function (a) { a.propagationStopped || c(a) }), d) : e.call(b, a, c, d) }), "function" == typeof b.onclick && (f = b.onclick, b.addEventListener("click", function (a) { f(a) }, !1), b.onclick = null) }
    } var b = navigator.userAgent.indexOf("Windows Phone") >= 0, c = navigator.userAgent.indexOf("Android") > 0 && !b, d = /iP(ad|hone|od)/.test(navigator.userAgent) && !b, e = d && /OS 4_\d(_\d)?/.test(navigator.userAgent), f = d && /OS [6-7]_\d/.test(navigator.userAgent), g = navigator.userAgent.indexOf("BB10") > 0; a.prototype.needsClick = function (a) { switch (a.nodeName.toLowerCase()) { case "button": case "select": case "textarea": if (a.disabled) return !0; break; case "input": if (d && "file" === a.type || a.disabled) return !0; break; case "label": case "iframe": case "video": return !0 }return /\bneedsclick\b/.test(a.className) }, a.prototype.needsFocus = function (a) { switch (a.nodeName.toLowerCase()) { case "textarea": return !0; case "select": return !c; case "input": switch (a.type) { case "button": case "checkbox": case "file": case "image": case "radio": case "submit": return !1 }return !a.disabled && !a.readOnly; default: return /\bneedsfocus\b/.test(a.className) } }, a.prototype.sendClick = function (a, b) { var c, d; document.activeElement && document.activeElement !== a && document.activeElement.blur(), d = b.changedTouches[0], c = document.createEvent("MouseEvents"), c.initMouseEvent(this.determineEventType(a), !0, !0, window, 1, d.screenX, d.screenY, d.clientX, d.clientY, !1, !1, !1, !1, 0, null), c.forwardedTouchEvent = !0, a.dispatchEvent(c) }, a.prototype.determineEventType = function (a) { return c && "select" === a.tagName.toLowerCase() ? "mousedown" : "click" }, a.prototype.focus = function (a) { var b; d && a.setSelectionRange && 0 !== a.type.indexOf("date") && "time" !== a.type && "month" !== a.type ? (b = a.value.length, a.setSelectionRange(b, b)) : a.focus() }, a.prototype.updateScrollParent = function (a) { var b, c; if (b = a.fastClickScrollParent, !b || !b.contains(a)) { c = a; do { if (c.scrollHeight > c.offsetHeight) { b = c, a.fastClickScrollParent = c; break } c = c.parentElement } while (c) } b && (b.fastClickLastScrollTop = b.scrollTop) }, a.prototype.getTargetElementFromEventTarget = function (a) { return a.nodeType === Node.TEXT_NODE ? a.parentNode : a }, a.prototype.onTouchStart = function (a) { var b, c, f; if (a.targetTouches.length > 1) return !0; if (b = this.getTargetElementFromEventTarget(a.target), c = a.targetTouches[0], d) { if (f = window.getSelection(), f.rangeCount && !f.isCollapsed) return !0; if (!e) { if (c.identifier && c.identifier === this.lastTouchIdentifier) return a.preventDefault(), !1; this.lastTouchIdentifier = c.identifier, this.updateScrollParent(b) } } return this.trackingClick = !0, this.trackingClickStart = a.timeStamp, this.targetElement = b, this.touchStartX = c.pageX, this.touchStartY = c.pageY, a.timeStamp - this.lastClickTime < this.tapDelay && a.preventDefault(), !0 }, a.prototype.touchHasMoved = function (a) { var b = a.changedTouches[0], c = this.touchBoundary; return Math.abs(b.pageX - this.touchStartX) > c || Math.abs(b.pageY - this.touchStartY) > c }, a.prototype.onTouchMove = function (a) { return !this.trackingClick || ((this.targetElement !== this.getTargetElementFromEventTarget(a.target) || this.touchHasMoved(a)) && (this.trackingClick = !1, this.targetElement = null), !0) }, a.prototype.findControl = function (a) { return void 0 !== a.control ? a.control : a.htmlFor ? document.getElementById(a.htmlFor) : a.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea") }, a.prototype.onTouchEnd = function (a) { var b, g, h, i, j, k = this.targetElement; if (!this.trackingClick) return !0; if (a.timeStamp - this.lastClickTime < this.tapDelay) return this.cancelNextClick = !0, !0; if (a.timeStamp - this.trackingClickStart > this.tapTimeout) return !0; if (this.cancelNextClick = !1, this.lastClickTime = a.timeStamp, g = this.trackingClickStart, this.trackingClick = !1, this.trackingClickStart = 0, f && (j = a.changedTouches[0], k = document.elementFromPoint(j.pageX - window.pageXOffset, j.pageY - window.pageYOffset) || k, k.fastClickScrollParent = this.targetElement.fastClickScrollParent), h = k.tagName.toLowerCase(), "label" === h) { if (b = this.findControl(k)) { if (this.focus(k), c) return !1; k = b } } else if (this.needsFocus(k)) return a.timeStamp - g > 100 || d && window.top !== window && "input" === h ? (this.targetElement = null, !1) : (this.focus(k), this.sendClick(k, a), d && "select" === h || (this.targetElement = null, a.preventDefault()), !1); return !(!d || e || (i = k.fastClickScrollParent, !i || i.fastClickLastScrollTop === i.scrollTop)) || (this.needsClick(k) || (a.preventDefault(), this.sendClick(k, a)), !1) }, a.prototype.onTouchCancel = function () { this.trackingClick = !1, this.targetElement = null }, a.prototype.onMouse = function (a) { return !this.targetElement || (!!a.forwardedTouchEvent || (!(a.cancelable && (!this.needsClick(this.targetElement) || this.cancelNextClick)) || (a.stopImmediatePropagation ? a.stopImmediatePropagation() : a.propagationStopped = !0, a.stopPropagation(), a.preventDefault(), !1))) }, a.prototype.onClick = function (a) { var b; return this.trackingClick ? (this.targetElement = null, this.trackingClick = !1, !0) : "submit" === a.target.type && 0 === a.detail || (b = this.onMouse(a), b || (this.targetElement = null), b) }, a.prototype.destroy = function () { var a = this.layer; c && (a.removeEventListener("mouseover", this.onMouse, !0), a.removeEventListener("mousedown", this.onMouse, !0), a.removeEventListener("mouseup", this.onMouse, !0)), a.removeEventListener("click", this.onClick, !0), a.removeEventListener("touchstart", this.onTouchStart, !1), a.removeEventListener("touchmove", this.onTouchMove, !1), a.removeEventListener("touchend", this.onTouchEnd, !1), a.removeEventListener("touchcancel", this.onTouchCancel, !1) }, a.notNeeded = function (a) { var b, d, e, f; if ("undefined" == typeof window.ontouchstart) return !0; if (d = +(/Chrome\/([0-9]+)/.exec(navigator.userAgent) || [, 0])[1]) { if (!c) return !0; if (b = document.querySelector("meta[name=viewport]")) { if (-1 !== b.content.indexOf("user-scalable=no")) return !0; if (d > 31 && document.documentElement.scrollWidth <= window.outerWidth) return !0 } } if (g && (e = navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/), e[1] >= 10 && e[2] >= 3 && (b = document.querySelector("meta[name=viewport]")))) { if (-1 !== b.content.indexOf("user-scalable=no")) return !0; if (document.documentElement.scrollWidth <= window.outerWidth) return !0 } return "none" === a.style.msTouchAction || "manipulation" === a.style.touchAction || (f = +(/Firefox\/([0-9]+)/.exec(navigator.userAgent) || [, 0])[1], !!(f >= 27 && (b = document.querySelector("meta[name=viewport]"), b && (-1 !== b.content.indexOf("user-scalable=no") || document.documentElement.scrollWidth <= window.outerWidth))) || ("none" === a.style.touchAction || "manipulation" === a.style.touchAction)) }, a.attach = function (b, c) { return new a(b, c) }, "function" == typeof define && "object" == typeof define.amd && define.amd ? define(function () { return a }) : "undefined" != typeof module && module.exports ? (module.exports = a.attach, module.exports.FastClick = a) : window.FastClick = a
}(), "undefined" == typeof links && (links = {}), "undefined" == typeof google && (google = void 0), Array.prototype.indexOf || (Array.prototype.indexOf = function (a) { for (var b = 0; b < this.length; b++)if (this[b] == a) return b; return -1 }), Array.prototype.forEach || (Array.prototype.forEach = function (a, b) { for (var c = 0, d = this.length; d > c; ++c)a.call(b || this, this[c], c, this) }), links.Timeline = function (a, b) { if (a) { this.dom = {}, this.conversion = {}, this.eventParams = {}, this.groups = [], this.groupIndexes = {}, this.items = [], this.renderQueue = { show: [], hide: [], update: [] }, this.renderedItems = [], this.clusterGenerator = new links.Timeline.ClusterGenerator(this), this.currentClusters = [], this.selection = void 0, this.listeners = {}, this.size = { actualHeight: 0, axis: { characterMajorHeight: 0, characterMajorWidth: 0, characterMinorHeight: 0, characterMinorWidth: 0, height: 0, labelMajorTop: 0, labelMinorTop: 0, line: 0, lineMajorWidth: 0, lineMinorHeight: 0, lineMinorTop: 0, lineMinorWidth: 0, top: 0 }, contentHeight: 0, contentLeft: 0, contentWidth: 0, frameHeight: 0, frameWidth: 0, groupsLeft: 0, groupsWidth: 0, items: { top: 0 } }, this.dom.container = a, this.options = { width: "100%", height: "auto", minHeight: 0, groupMinHeight: 0, autoHeight: !0, eventMargin: 10, eventMarginAxis: 20, dragAreaWidth: 10, min: void 0, max: void 0, zoomMin: 10, zoomMax: 31536e10, moveable: !0, zoomable: !0, selectable: !0, unselectable: !0, editable: !1, snapEvents: !0, groupChangeable: !0, timeChangeable: !0, showCurrentTime: !0, showCustomTime: !1, showMajorLabels: !0, showMinorLabels: !0, showNavigation: !1, showButtonNew: !1, groupsOnRight: !1, groupsOrder: !0, axisOnTop: !1, stackEvents: !0, animate: !0, animateZoom: !0, cluster: !1, clusterMaxItems: 5, style: "box", customStackOrder: !1, locale: "en", MONTHS: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"], MONTHS_SHORT: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"], DAYS: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"], DAYS_SHORT: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"], ZOOM_IN: "Zoom in", ZOOM_OUT: "Zoom out", MOVE_LEFT: "Move left", MOVE_RIGHT: "Move right", NEW: "New", CREATE_NEW_EVENT: "Create new event" }, this.setOptions(b), this.clientTimeOffset = 0; for (var c = this.dom; c.container.hasChildNodes();)c.container.removeChild(c.container.firstChild); this.step = new links.Timeline.StepDate, this.itemTypes = { box: links.Timeline.ItemBox, range: links.Timeline.ItemRange, floatingRange: links.Timeline.ItemFloatingRange, dot: links.Timeline.ItemDot }, this.data = [], this.firstDraw = !0, this.setVisibleChartRange(void 0, void 0, !1), this.render(); var d = this; setTimeout(function () { d.trigger("ready") }, 0) } }, links.Timeline.prototype.draw = function (a, b) { b && console.log("WARNING: Passing options in draw() is deprecated. Pass options to the constructur or use setOptions() instead!"), this.setOptions(b), this.options.selectable && links.Timeline.addClassName(this.dom.frame, "timeline-selectable"), this.setData(a), b && (b.start || b.end) ? this.setVisibleChartRange(b.start, b.end) : this.firstDraw && this.setVisibleChartRangeAuto(), this.firstDraw = !1 }, links.Timeline.prototype.setOptions = function (a) { if (a) { for (var b in a) a.hasOwnProperty(b) && (this.options[b] = a[b]); if ("undefined" != typeof links.locales && "en" !== this.options.locale) { var c = links.locales[this.options.locale]; if (c) for (var d in c) c.hasOwnProperty(d) && (this.options[d] = c[d]) } void 0 != a.showButtonAdd && (this.options.showButtonNew = a.showButtonAdd, console.log("WARNING: Option showButtonAdd is deprecated. Use showButtonNew instead")), void 0 != a.intervalMin && (this.options.zoomMin = a.intervalMin, console.log("WARNING: Option intervalMin is deprecated. Use zoomMin instead")), void 0 != a.intervalMax && (this.options.zoomMax = a.intervalMax, console.log("WARNING: Option intervalMax is deprecated. Use zoomMax instead")), a.scale && a.step && this.step.setScale(a.scale, a.step) } this.options.autoHeight = "auto" === this.options.height }, links.Timeline.prototype.getOptions = function () { return this.options }, links.Timeline.prototype.addItemType = function (a, b) { this.itemTypes[a] = b }, links.Timeline.mapColumnIds = function (a) { for (var b = {}, c = a.getNumberOfColumns(), d = !0, e = 0; c > e; e++) { var f = a.getColumnId(e) || a.getColumnLabel(e); b[f] = e, ("start" == f || "end" == f || "content" == f || "group" == f || "className" == f || "editable" == f || "type" == f) && (d = !1) } return d && (b.start = 0, b.end = 1, b.content = 2, c > 3 && (b.group = 3), c > 4 && (b.className = 4), c > 5 && (b.editable = 5), c > 6 && (b.type = 6)), b }, links.Timeline.prototype.setData = function (a) { this.unselectItem(), a || (a = []), this.stackCancelAnimation(), this.clearItems(), this.data = a; var b = this.items; if (this.deleteGroups(), google && google.visualization && a instanceof google.visualization.DataTable) for (var c = links.Timeline.mapColumnIds(a), d = 0, e = a.getNumberOfRows(); e > d; d++)b.push(this.createItem({ start: void 0 != c.start ? a.getValue(d, c.start) : void 0, end: void 0 != c.end ? a.getValue(d, c.end) : void 0, content: void 0 != c.content ? a.getValue(d, c.content) : void 0, group: void 0 != c.group ? a.getValue(d, c.group) : void 0, className: void 0 != c.className ? a.getValue(d, c.className) : void 0, editable: void 0 != c.editable ? a.getValue(d, c.editable) : void 0, type: void 0 != c.type ? a.getValue(d, c.type) : void 0 })); else { if (!links.Timeline.isArray(a)) throw "Unknown data type. DataTable or Array expected."; for (var d = 0, e = a.length; e > d; d++) { var f = a[d], g = this.createItem(f); b.push(g) } } this.options.cluster && this.clusterGenerator.setData(this.items), this.render({ animate: !1 }) }, links.Timeline.prototype.getData = function () { return this.data }, links.Timeline.prototype.updateData = function (a, b) { var c, d = this.data; if (google && google.visualization && d instanceof google.visualization.DataTable) { var e = a + 1 - d.getNumberOfRows(); e > 0 && d.addRows(e); var f = links.Timeline.mapColumnIds(d); for (c in b) if (b.hasOwnProperty(c)) { var g = f[c]; if (void 0 == g) { var h = b[c], i = "string"; "number" == typeof h ? i = "number" : "boolean" == typeof h ? i = "boolean" : h instanceof Date && (i = "datetime"), g = d.addColumn(i, c) } d.setValue(a, g, b[c]) } } else { if (!links.Timeline.isArray(d)) throw "Cannot update data, unknown type of data"; var j = d[a]; void 0 == j && (j = {}, d[a] = j); for (c in b) b.hasOwnProperty(c) && (j[c] = b[c]) } }, links.Timeline.prototype.getItemIndex = function (a) { for (var b = a, c = this.dom, d = c.items.frame, e = this.items, f = void 0; b.parentNode && b.parentNode !== d;)b = b.parentNode; if (b.parentNode === d) for (var g = 0, h = e.length; h > g; g++)if (e[g].dom === b) { f = g; break } return f }, links.Timeline.prototype.getClusterIndex = function (a) { var b = a, c = this.dom, d = c.items.frame, e = this.clusters, f = void 0; if (this.clusters) { for (; b.parentNode && b.parentNode !== d;)b = b.parentNode; if (b.parentNode === d) for (var g = 0, h = e.length; h > g; g++)if (e[g].dom === b) { f = g; break } } return f }, links.Timeline.prototype.getVisibleItems = function (a, b) { var c = this.items, d = []; if (c) for (var e = 0, f = c.length; f > e; e++) { var g = c[e]; g.end ? a <= g.start && g.end <= b && d.push({ row: e }) : a <= g.start && g.start <= b && d.push({ row: e }) } return d }, links.Timeline.prototype.setSize = function (a, b) { a && (this.options.width = a, this.dom.frame.style.width = a), b && (this.options.height = b, this.options.autoHeight = "auto" === this.options.height, "auto" !== b && (this.dom.frame.style.height = b)), this.render({ animate: !1 }) }, links.Timeline.prototype.setVisibleChartRange = function (a, b, c) { var d = {}; a && b || (d = this.getDataRange(!0)), a || (b ? d.min && d.min.valueOf() < b.valueOf() ? a = d.min : (a = new Date(b.valueOf()), a.setDate(a.getDate() - 7)) : (a = new Date, a.setDate(a.getDate() - 3))), b || (d.max ? b = d.max : (b = new Date(a.valueOf()), b.setDate(b.getDate() + 7))), a >= b && (b = new Date(a.valueOf()), b.setDate(b.getDate() + 7)); var e = this.options.min ? this.options.min : void 0; void 0 != e && a.valueOf() < e.valueOf() && (a = new Date(e.valueOf())); var f = this.options.max ? this.options.max : void 0; void 0 != f && b.valueOf() > f.valueOf() && (b = new Date(f.valueOf())), this.applyRange(a, b), void 0 == c || 1 == c ? this.render({ animate: !1 }) : this.recalcConversion() }, links.Timeline.prototype.setVisibleChartRangeAuto = function () { var a = this.getDataRange(!0); this.setVisibleChartRange(a.min, a.max) }, links.Timeline.prototype.setVisibleChartRangeNow = function () { var a = new Date, b = this.end.valueOf() - this.start.valueOf(), c = new Date(a.valueOf() - b / 2), d = new Date(c.valueOf() + b); this.setVisibleChartRange(c, d) }, links.Timeline.prototype.getVisibleChartRange = function () { return { start: new Date(this.start.valueOf()), end: new Date(this.end.valueOf()) } }, links.Timeline.prototype.getDataRange = function (a) { var b = this.items, c = void 0, d = void 0; if (b) for (var e = 0, f = b.length; f > e; e++) { var g = b[e], h = void 0 != g.start ? g.start.valueOf() : void 0, i = void 0 != g.end ? g.end.valueOf() : h; void 0 != h && (c = void 0 != c ? Math.min(c.valueOf(), h.valueOf()) : h), void 0 != i && (d = void 0 != d ? Math.max(d.valueOf(), i.valueOf()) : i) } if (c && d && a) { var j = d - c; c -= .05 * j, d += .05 * j } return { min: void 0 != c ? new Date(c) : void 0, max: void 0 != d ? new Date(d) : void 0 } }, links.Timeline.prototype.render = function (a) { var b = (this.reflowFrame(), this.reflowAxis(), this.reflowGroups(), this.reflowItems(), this.options.animate); a && void 0 != a.animate && (b = a.animate), this.recalcConversion(), this.clusterItems(), this.filterItems(), this.stackItems(b), this.recalcItems(); var c = this.repaint(); if (c) { var d = a ? a.renderTimesLeft : void 0; void 0 == d && (d = 5), d > 0 && this.render({ animate: a ? a.animate : void 0, renderTimesLeft: d - 1 }) } }, links.Timeline.prototype.repaint = function () { var a = this.repaintFrame(), b = this.repaintAxis(), c = this.repaintGroups(), d = this.repaintItems(); return this.repaintCurrentTime(), this.repaintCustomTime(), a || b || c || d }, links.Timeline.prototype.reflowFrame = function () { var a = this.dom, b = (this.options, this.size), c = !1, d = a.frame ? a.frame.offsetWidth : 0, e = a.frame ? a.frame.clientHeight : 0; return c = c || b.frameWidth !== d, c = c || b.frameHeight !== e, b.frameWidth = d, b.frameHeight = e, c }, links.Timeline.prototype.repaintFrame = function () { var a = !1, b = this.dom, c = this.options, d = this.size; b.frame || (b.frame = document.createElement("DIV"), b.frame.className = "timeline-frame ui-widget ui-widget-content ui-corner-all", b.container.appendChild(b.frame), a = !0); var e = c.autoHeight ? d.actualHeight + "px" : c.height || "100%", f = c.width || "100%"; if (a = a || b.frame.style.height != e, a = a || b.frame.style.width != f, b.frame.style.height = e, b.frame.style.width = f, !b.content) { b.content = document.createElement("DIV"), b.content.className = "timeline-content", b.frame.appendChild(b.content); var g = document.createElement("DIV"); g.style.position = "absolute", g.style.left = "0px", g.style.top = "0px", g.style.height = "100%", g.style.width = "0px", b.content.appendChild(g), b.contentTimelines = g; var h = this.eventParams, i = this; h.onMouseDown || (h.onMouseDown = function (a) { i.onMouseDown(a) }, links.Timeline.addEventListener(b.content, "mousedown", h.onMouseDown)), h.onTouchStart || (h.onTouchStart = function (a) { i.onTouchStart(a) }, links.Timeline.addEventListener(b.content, "touchstart", h.onTouchStart)), h.onMouseWheel || (h.onMouseWheel = function (a) { i.onMouseWheel(a) }, links.Timeline.addEventListener(b.content, "mousewheel", h.onMouseWheel)), h.onDblClick || (h.onDblClick = function (a) { i.onDblClick(a) }, links.Timeline.addEventListener(b.content, "dblclick", h.onDblClick)), a = !0 } return b.content.style.left = d.contentLeft + "px", b.content.style.top = "0px", b.content.style.width = d.contentWidth + "px", b.content.style.height = d.frameHeight + "px", this.repaintNavigation(), a }, links.Timeline.prototype.reflowAxis = function () { var a = !1, b = this.dom, c = this.options, d = this.size, e = b.axis, f = e && e.characterMinor ? e.characterMinor.clientWidth : 0, g = e && e.characterMinor ? e.characterMinor.clientHeight : 0, h = e && e.characterMajor ? e.characterMajor.clientWidth : 0, i = e && e.characterMajor ? e.characterMajor.clientHeight : 0, j = (c.showMinorLabels ? g : 0) + (c.showMajorLabels ? i : 0), k = c.axisOnTop ? 0 : d.frameHeight - j, l = c.axisOnTop ? j : k; a = a || d.axis.top !== k, a = a || d.axis.line !== l, a = a || d.axis.height !== j, d.axis.top = k, d.axis.line = l, d.axis.height = j, d.axis.labelMajorTop = c.axisOnTop ? 0 : l + (c.showMinorLabels ? g : 0), d.axis.labelMinorTop = c.axisOnTop ? c.showMajorLabels ? i : 0 : l, d.axis.lineMinorTop = c.axisOnTop ? d.axis.labelMinorTop : 0, d.axis.lineMinorHeight = c.showMajorLabels ? d.frameHeight - i : d.frameHeight, d.axis.lineMinorWidth = e && e.minorLines && e.minorLines.length ? e.minorLines[0].offsetWidth : 1, d.axis.lineMajorWidth = e && e.majorLines && e.majorLines.length ? e.majorLines[0].offsetWidth : 1, a = a || d.axis.characterMinorWidth !== f, a = a || d.axis.characterMinorHeight !== g, a = a || d.axis.characterMajorWidth !== h, a = a || d.axis.characterMajorHeight !== i, d.axis.characterMinorWidth = f, d.axis.characterMinorHeight = g, d.axis.characterMajorWidth = h, d.axis.characterMajorHeight = i; var m = Math.max(d.frameHeight - j, 0); return d.contentLeft = c.groupsOnRight ? 0 : d.groupsWidth, d.contentWidth = Math.max(d.frameWidth - d.groupsWidth, 0), d.contentHeight = m, a }, links.Timeline.prototype.repaintAxis = function () { var a = !1, b = this.dom, c = this.options, d = this.size, e = this.step, f = b.axis; f || (f = {}, b.axis = f), d.axis.properties || (d.axis.properties = {}), f.minorTexts || (f.minorTexts = []), f.minorLines || (f.minorLines = []), f.majorTexts || (f.majorTexts = []), f.majorLines || (f.majorLines = []), f.frame || (f.frame = document.createElement("DIV"), f.frame.style.position = "absolute", f.frame.style.left = "0px", f.frame.style.top = "0px", b.content.appendChild(f.frame)), b.content.removeChild(f.frame), f.frame.style.width = d.contentWidth + "px", f.frame.style.height = d.axis.height + "px"; var g = this.screenToTime(0), h = this.screenToTime(d.contentWidth); d.axis.characterMinorWidth && (this.minimumStep = this.screenToTime(6 * d.axis.characterMinorWidth) - this.screenToTime(0), e.setRange(g, h, this.minimumStep)); var i = this.repaintAxisCharacters(); a = a || i, this.repaintAxisStartOverwriting(), e.start(); for (var j = void 0, k = 0; !e.end() && 1e3 > k;) { k++; var l = e.getCurrent(), m = this.timeToScreen(l), n = e.isMajor(); c.showMinorLabels && this.repaintAxisMinorText(m, e.getLabelMinor(c)), n && c.showMajorLabels ? (m > 0 && (void 0 == j && (j = m), this.repaintAxisMajorText(m, e.getLabelMajor(c))), this.repaintAxisMajorLine(m)) : this.repaintAxisMinorLine(m), e.next() } if (c.showMajorLabels) { var o = this.screenToTime(0), p = this.step.getLabelMajor(c, o), q = p.length * d.axis.characterMajorWidth + 10; (void 0 == j || j > q) && this.repaintAxisMajorText(0, p, o) } return this.repaintAxisEndOverwriting(), this.repaintAxisHorizontal(), b.content.insertBefore(f.frame, b.content.firstChild), a }, links.Timeline.prototype.repaintAxisCharacters = function () { var a, b = !1, c = this.dom, d = c.axis; if (!d.characterMinor) { a = document.createTextNode("0"); var e = document.createElement("DIV"); e.className = "timeline-axis-text timeline-axis-text-minor", e.appendChild(a), e.style.position = "absolute", e.style.visibility = "hidden", e.style.paddingLeft = "0px", e.style.paddingRight = "0px", d.frame.appendChild(e), d.characterMinor = e, b = !0 } if (!d.characterMajor) { a = document.createTextNode("0"); var f = document.createElement("DIV"); f.className = "timeline-axis-text timeline-axis-text-major", f.appendChild(a), f.style.position = "absolute", f.style.visibility = "hidden", f.style.paddingLeft = "0px", f.style.paddingRight = "0px", d.frame.appendChild(f), d.characterMajor = f, b = !0 } return b }, links.Timeline.prototype.repaintAxisStartOverwriting = function () { var a = this.size.axis.properties; a.minorTextNum = 0, a.minorLineNum = 0, a.majorTextNum = 0, a.majorLineNum = 0 }, links.Timeline.prototype.repaintAxisEndOverwriting = function () { var a, b = this.dom, c = this.size.axis.properties, d = this.dom.axis.frame, e = b.axis.minorTexts; for (a = c.minorTextNum; e.length > a;) { var f = e[a]; d.removeChild(f), e.splice(a, 1) } var g = b.axis.minorLines; for (a = c.minorLineNum; g.length > a;) { var h = g[a]; d.removeChild(h), g.splice(a, 1) } var i = b.axis.majorTexts; for (a = c.majorTextNum; i.length > a;) { var j = i[a]; d.removeChild(j), i.splice(a, 1) } var k = b.axis.majorLines; for (a = c.majorLineNum; k.length > a;) { var l = k[a]; d.removeChild(l), k.splice(a, 1) } }, links.Timeline.prototype.repaintAxisHorizontal = function () { var a = this.dom.axis, b = this.size, c = this.options, d = c.showMinorLabels || c.showMajorLabels; if (d) { if (!a.backgroundLine) { var e = document.createElement("DIV"); e.className = "timeline-axis", e.style.position = "absolute", e.style.left = "0px", e.style.width = "100%", e.style.border = "none", a.frame.insertBefore(e, a.frame.firstChild), a.backgroundLine = e } a.backgroundLine && (a.backgroundLine.style.top = b.axis.top + "px", a.backgroundLine.style.height = b.axis.height + "px") } else a.backgroundLine && (a.frame.removeChild(a.backgroundLine), delete a.backgroundLine); if (d) { if (a.line) { var f = a.frame.removeChild(a.line); a.frame.appendChild(f) } else { var f = document.createElement("DIV"); f.className = "timeline-axis", f.style.position = "absolute", f.style.left = "0px", f.style.width = "100%", f.style.height = "0px", a.frame.appendChild(f), a.line = f } a.line.style.top = b.axis.line + "px" } else a.line && a.line.parentElement && (a.frame.removeChild(a.line), delete a.line) }, links.Timeline.prototype.repaintAxisMinorText = function (a, b) { var c, d = this.size, e = this.dom, f = d.axis.properties, g = e.axis.frame, h = e.axis.minorTexts, i = f.minorTextNum; if (i < h.length) c = h[i]; else { var j = document.createTextNode(""); c = document.createElement("DIV"), c.appendChild(j), c.className = "timeline-axis-text timeline-axis-text-minor", c.style.position = "absolute", g.appendChild(c), h.push(c) } c.childNodes[0].nodeValue = b, c.style.left = a + "px", c.style.top = d.axis.labelMinorTop + "px", f.minorTextNum++ }, links.Timeline.prototype.repaintAxisMinorLine = function (a) { var b, c = this.size.axis, d = this.dom, e = c.properties, f = d.axis.frame, g = d.axis.minorLines, h = e.minorLineNum; h < g.length ? b = g[h] : (b = document.createElement("DIV"), b.className = "timeline-axis-grid timeline-axis-grid-minor", b.style.position = "absolute", b.style.width = "0px", f.appendChild(b), g.push(b)), b.style.top = c.lineMinorTop + "px", b.style.height = c.lineMinorHeight + "px", b.style.left = a - c.lineMinorWidth / 2 + "px", e.minorLineNum++ }, links.Timeline.prototype.repaintAxisMajorText = function (a, b) { var c, d = this.size, e = d.axis.properties, f = this.dom.axis.frame, g = this.dom.axis.majorTexts, h = e.majorTextNum; if (h < g.length) c = g[h]; else { var i = document.createTextNode(b); c = document.createElement("DIV"), c.className = "timeline-axis-text timeline-axis-text-major", c.appendChild(i), c.style.position = "absolute", c.style.top = "0px", f.appendChild(c), g.push(c) } c.childNodes[0].nodeValue = b, c.style.top = d.axis.labelMajorTop + "px", c.style.left = a + "px", e.majorTextNum++ }, links.Timeline.prototype.repaintAxisMajorLine = function (a) { var b, c = this.size, d = c.axis.properties, e = this.size.axis, f = this.dom.axis.frame, g = this.dom.axis.majorLines, h = d.majorLineNum; h < g.length ? b = g[h] : (b = document.createElement("DIV"), b.className = "timeline-axis-grid timeline-axis-grid-major", b.style.position = "absolute", b.style.top = "0px", b.style.width = "0px", f.appendChild(b), g.push(b)), b.style.left = a - e.lineMajorWidth / 2 + "px", b.style.height = c.frameHeight + "px", d.majorLineNum++ }, links.Timeline.prototype.reflowItems = function () { var a, b, c, d = !1, e = this.groups, f = this.renderedItems; for (e && e.forEach(function (a) { a.itemsHeight = 0 }), a = 0, b = f.length; b > a; a++) { var g = f[a], h = g.dom; if (c = g.group, h) { var i = h ? h.clientWidth : 0, j = h ? h.clientHeight : 0; d = d || g.width != i, d = d || g.height != j, g.width = i, g.height = j, g.reflow() } c && (c.itemsHeight = Math.max(this.options.groupMinHeight, c.itemsHeight ? Math.max(c.itemsHeight, g.height) : g.height)) } return d }, links.Timeline.prototype.recalcItems = function () { var a, b, c, d, e, f, g = !1, h = this.groups, i = this.size, j = this.options, k = this.renderedItems, l = 0; if (0 == h.length) { if (j.autoHeight || j.cluster) { var m = 0, n = 0; if (this.stack && this.stack.finalItems) for (e = this.stack.finalItems, d = e[0], d && d.top && (m = d.top, n = d.top + d.height), a = 1, b = e.length; b > a; a++)d = e[a], m = Math.min(m, d.top), n = Math.max(n, d.top + d.height); else for (c = k[0], c && c.top && (m = c.top, n = c.top + c.height), a = 1, b = k.length; b > a; a++)c = k[a], c.top && (m = Math.min(m, c.top), n = Math.max(n, c.top + c.height)); if (l = n - m + 2 * j.eventMarginAxis + i.axis.height, l < j.minHeight && (l = j.minHeight), i.actualHeight != l && j.autoHeight && !j.axisOnTop) { var o = l - i.actualHeight; if (this.stack && this.stack.finalItems) for (e = this.stack.finalItems, a = 0, b = e.length; b > a; a++)e[a].top += o, e[a].item.top += o; else for (a = 0, b = k.length; b > a; a++)k[a].top += o } } } else { for (l = i.axis.height + 2 * j.eventMarginAxis, a = 0, b = h.length; b > a; a++) { f = h[a]; var p = f.itemsHeight; g = g || p != f.height, f.height = Math.max(p, j.groupMinHeight), l += h[a].height + j.eventMargin } var q = j.eventMargin, r = j.axisOnTop ? j.eventMarginAxis + q / 2 : i.contentHeight - j.eventMarginAxis + q / 2, s = i.axis.height; for (a = 0, b = h.length; b > a; a++)f = h[a], j.axisOnTop ? (f.top = r + s, f.labelTop = r + s + (f.height - f.labelHeight) / 2, f.lineTop = r + s + f.height + q / 2, r += f.height + q) : (r -= f.height + q, f.top = r, f.labelTop = r + (f.height - f.labelHeight) / 2, f.lineTop = r - q / 2); g = !0 } return l < j.minHeight && (l = j.minHeight), g = g || l != i.actualHeight, i.actualHeight = l, g }, links.Timeline.prototype.clearItems = function () { var a = this.renderQueue.hide; this.renderedItems.forEach(function (b) { a.push(b) }), this.clusterGenerator.clear(), this.items = [] }, links.Timeline.prototype.repaintItems = function () { var a, b, c = !1, d = this.dom, e = this.size, f = this, g = this.renderedItems; d.items || (d.items = {}); var h = d.items.frame; h || (h = document.createElement("DIV"), h.style.position = "relative", d.content.appendChild(h), d.items.frame = h), h.style.left = "0px", h.style.top = e.items.top + "px", h.style.height = "0px", d.content.removeChild(h); var i = this.renderQueue, j = []; for (c = c || i.show.length > 0 || i.update.length > 0 || i.hide.length > 0; a = i.show.shift();)a.showDOM(h), a.getImageUrls(j), g.push(a); for (; a = i.update.shift();)a.updateDOM(h), a.getImageUrls(j), b = this.renderedItems.indexOf(a), -1 == b && g.push(a); for (; a = i.hide.shift();)a.hideDOM(h), b = this.renderedItems.indexOf(a), -1 != b && g.splice(b, 1); if (g.forEach(function (a) { a.updatePosition(f) }), this.repaintDeleteButton(), this.repaintDragAreas(), d.content.appendChild(h), j.length) { var k = function () { f.render() }, l = !1; links.imageloader.loadAll(j, k, l) } return c }, links.Timeline.prototype.reflowGroups = function () { for (var a = !1, b = this.options, c = this.size, d = this.dom, e = 0, f = this.groups, g = this.dom.groups ? this.dom.groups.labels : [], h = 0, i = f.length; i > h; h++) { var j = f[h], k = g[h]; j.labelWidth = k ? k.clientWidth : 0, j.labelHeight = k ? k.clientHeight : 0, j.width = j.labelWidth, e = Math.max(e, j.width) } void 0 !== b.groupsWidth && (e = d.groups.frame ? d.groups.frame.clientWidth : 0), e += 1; var l = b.groupsOnRight ? c.frameWidth - e : 0; return a = a || c.groupsWidth !== e, a = a || c.groupsLeft !== l, c.groupsWidth = e, c.groupsLeft = l, a }, links.Timeline.prototype.repaintGroups = function () {
    var a = this.dom, b = this, c = this.options, d = this.size, e = this.groups; void 0 === a.groups && (a.groups = {}); var f = a.groups.labels; f || (f = [], a.groups.labels = f); var g = a.groups.labelLines; g || (g = [], a.groups.labelLines = g); var h = a.groups.itemLines; h || (h = [], a.groups.itemLines = h); var i = a.groups.frame; i || (i = document.createElement("DIV"), i.className = "timeline-groups-axis", i.style.position = "absolute", i.style.overflow = "hidden", i.style.top = "0px", i.style.height = "100%", a.frame.appendChild(i), a.groups.frame = i), i.style.left = d.groupsLeft + "px", i.style.width = void 0 !== c.groupsWidth ? c.groupsWidth : d.groupsWidth + "px", i.style.display = 0 == e.length ? "none" : ""; for (var j = f.length, k = e.length, l = 0, m = Math.min(j, k); m > l; l++) { var n = e[l], o = f[l]; o.innerHTML = this.getGroupName(n), o.style.display = "" } for (var l = j; k > l; l++) { var n = e[l], o = document.createElement("DIV"); o.className = "timeline-groups-text", o.style.position = "absolute", void 0 === c.groupsWidth && (o.style.whiteSpace = "nowrap"), o.innerHTML = this.getGroupName(n), i.appendChild(o), f[l] = o; var p = document.createElement("DIV"); p.className = "timeline-axis-grid timeline-axis-grid-minor", p.style.position = "absolute", p.style.left = "0px", p.style.width = "100%", p.style.height = "0px", p.style.borderTopStyle = "solid", i.appendChild(p), g[l] = p; var q = document.createElement("DIV"); q.className = "timeline-axis-grid timeline-axis-grid-minor", q.style.position = "absolute", q.style.left = "0px", q.style.width = "100%", q.style.height = "0px", q.style.borderTopStyle = "solid", a.content.insertBefore(q, a.content.firstChild), h[l] = q } for (var l = k; j > l; l++) { var o = f[l], p = g[l], q = h[l]; i.removeChild(o), i.removeChild(p), a.content.removeChild(q) } f.splice(k, j - k), g.splice(k, j - k), h.splice(k, j - k), links.Timeline.addClassName(i, c.groupsOnRight ? "timeline-groups-axis-onright" : "timeline-groups-axis-onleft"); for (var l = 0, m = e.length; m > l; l++) { var n = e[l], o = f[l], p = g[l], q = h[l]; o.style.top = n.labelTop + "px", p.style.top = n.lineTop + "px", q.style.top = n.lineTop + "px", q.style.width = d.contentWidth + "px" } if (!a.groups.background) { var r = document.createElement("DIV"); r.className = "timeline-axis", r.style.position = "absolute", r.style.left = "0px", r.style.width = "100%", r.style.border = "none", i.appendChild(r), a.groups.background = r } if (a.groups.background.style.top = d.axis.top + "px", a.groups.background.style.height = d.axis.height + "px", !a.groups.line) { var s = document.createElement("DIV"); s.className = "timeline-axis", s.style.position = "absolute", s.style.left = "0px", s.style.width = "100%", s.style.height = "0px", i.appendChild(s), a.groups.line = s } if (a.groups.line.style.top = d.axis.line + "px", a.groups.frame && e.length) {
        var t = []; if (links.imageloader.filterImageUrls(a.groups.frame, t), t.length) {
            var u = function () { b.render() }, v = !1; links.imageloader.loadAll(t, u, v);
        }
    }
}, links.Timeline.prototype.repaintCurrentTime = function () { var a = this.options, b = this.dom, c = this.size; if (!a.showCurrentTime) return void (b.currentTime && (b.contentTimelines.removeChild(b.currentTime), delete b.currentTime)); if (!b.currentTime) { var d = document.createElement("DIV"); d.className = "timeline-currenttime", d.style.position = "absolute", d.style.top = "0px", d.style.height = "100%", b.contentTimelines.appendChild(d), b.currentTime = d } var e = new Date, f = new Date(e.valueOf() + this.clientTimeOffset), g = this.timeToScreen(f), h = g > -c.contentWidth && g < 2 * c.contentWidth; b.currentTime.style.display = h ? "" : "none", b.currentTime.style.left = g + "px", b.currentTime.title = "Current time: " + f, void 0 != this.currentTimeTimer && (clearTimeout(this.currentTimeTimer), delete this.currentTimeTimer); var i = this, j = function () { i.repaintCurrentTime() }, k = 1 / this.conversion.factor / 2; 30 > k && (k = 30), this.currentTimeTimer = setTimeout(j, k) }, links.Timeline.prototype.repaintCustomTime = function () { var a = this.options, b = this.dom, c = this.size; if (!a.showCustomTime) return void (b.customTime && (b.contentTimelines.removeChild(b.customTime), delete b.customTime)); if (!b.customTime) { var d = document.createElement("DIV"); d.className = "timeline-customtime", d.style.position = "absolute", d.style.top = "0px", d.style.height = "100%"; var e = document.createElement("DIV"); e.style.position = "relative", e.style.top = "0px", e.style.left = "-10px", e.style.height = "100%", e.style.width = "20px", d.appendChild(e), b.contentTimelines.appendChild(d), b.customTime = d, this.customTime = new Date } var f = this.timeToScreen(this.customTime), g = f > -c.contentWidth && f < 2 * c.contentWidth; b.customTime.style.display = g ? "" : "none", b.customTime.style.left = f + "px", b.customTime.title = "Time: " + this.customTime }, links.Timeline.prototype.repaintDeleteButton = function () { var a = this.dom, b = a.items.frame, c = a.items.deleteButton; c || (c = document.createElement("DIV"), c.className = "timeline-navigation-delete", c.style.position = "absolute", b.appendChild(c), a.items.deleteButton = c); var d = this.selection && void 0 !== this.selection.index ? this.selection.index : -1, e = this.selection && void 0 !== this.selection.index ? this.items[d] : void 0; if (e && e.rendered && this.isEditable(e)) { var f = e.getRight(this), g = e.top; c.style.left = f + "px", c.style.top = g + "px", c.style.display = "", b.removeChild(c), b.appendChild(c) } else c.style.display = "none" }, links.Timeline.prototype.repaintDragAreas = function () { var a = this.options, b = this.dom, c = this.dom.items.frame, d = b.items.dragLeft; d || (d = document.createElement("DIV"), d.className = "timeline-event-range-drag-left", d.style.position = "absolute", c.appendChild(d), b.items.dragLeft = d); var e = b.items.dragRight; e || (e = document.createElement("DIV"), e.className = "timeline-event-range-drag-right", e.style.position = "absolute", c.appendChild(e), b.items.dragRight = e); var f = this.selection && void 0 !== this.selection.index ? this.selection.index : -1, g = this.selection && void 0 !== this.selection.index ? this.items[f] : void 0; if (g && g.rendered && this.isEditable(g) && (g instanceof links.Timeline.ItemRange || g instanceof links.Timeline.ItemFloatingRange)) { var h = g.getLeft(this), i = g.getRight(this), j = g.top, k = g.height; d.style.left = h + "px", d.style.top = j + "px", d.style.width = a.dragAreaWidth + "px", d.style.height = k + "px", d.style.display = "", c.removeChild(d), c.appendChild(d), e.style.left = i - a.dragAreaWidth + "px", e.style.top = j + "px", e.style.width = a.dragAreaWidth + "px", e.style.height = k + "px", e.style.display = "", c.removeChild(e), c.appendChild(e) } else d.style.display = "none", e.style.display = "none" }, links.Timeline.prototype.repaintNavigation = function () { var a = this, b = this.options, c = this.dom, d = c.frame, e = c.navBar; if (!e) { var f = b.showButtonNew && b.editable, g = b.showNavigation && (b.zoomable || b.moveable); if ((g || f) && (e = document.createElement("DIV"), e.style.position = "absolute", e.className = "timeline-navigation ui-widget ui-state-highlight ui-corner-all", b.groupsOnRight ? e.style.left = "10px" : e.style.right = "10px", b.axisOnTop ? e.style.bottom = "10px" : e.style.top = "10px", c.navBar = e, d.appendChild(e)), f) { e.addButton = document.createElement("DIV"), e.addButton.className = "timeline-navigation-new", e.addButton.title = b.CREATE_NEW_EVENT; var h = document.createElement("SPAN"); h.className = "ui-icon ui-icon-circle-plus", e.addButton.appendChild(h); var i = function (c) { links.Timeline.preventDefault(c), links.Timeline.stopPropagation(c); var d = a.size.contentWidth, e = d / 2, f = a.screenToTime(e); b.snapEvents && a.step.snap(f); var g = b.NEW, h = a.groups.length ? a.groups[0].content : void 0, i = !0; a.addItem({ start: f, content: g, group: h }, i); var j = a.items.length - 1; a.selectItem(j), a.applyAdd = !0, a.trigger("add"), a.applyAdd ? (a.render({ animate: !1 }), a.selectItem(j)) : a.deleteItem(j) }; links.Timeline.addEventListener(e.addButton, "mousedown", i), e.appendChild(e.addButton) } if (f && g && links.Timeline.addClassName(e.addButton, "timeline-navigation-new-line"), g) { if (b.zoomable) { e.zoomInButton = document.createElement("DIV"), e.zoomInButton.className = "timeline-navigation-zoom-in", e.zoomInButton.title = this.options.ZOOM_IN; var j = document.createElement("SPAN"); j.className = "ui-icon ui-icon-circle-zoomin", e.zoomInButton.appendChild(j); var k = function (b) { links.Timeline.preventDefault(b), links.Timeline.stopPropagation(b), a.zoom(.4), a.trigger("rangechange"), a.trigger("rangechanged") }; links.Timeline.addEventListener(e.zoomInButton, "mousedown", k), e.appendChild(e.zoomInButton), e.zoomOutButton = document.createElement("DIV"), e.zoomOutButton.className = "timeline-navigation-zoom-out", e.zoomOutButton.title = this.options.ZOOM_OUT; var l = document.createElement("SPAN"); l.className = "ui-icon ui-icon-circle-zoomout", e.zoomOutButton.appendChild(l); var m = function (b) { links.Timeline.preventDefault(b), links.Timeline.stopPropagation(b), a.zoom(-.4), a.trigger("rangechange"), a.trigger("rangechanged") }; links.Timeline.addEventListener(e.zoomOutButton, "mousedown", m), e.appendChild(e.zoomOutButton) } if (b.moveable) { e.moveLeftButton = document.createElement("DIV"), e.moveLeftButton.className = "timeline-navigation-move-left", e.moveLeftButton.title = this.options.MOVE_LEFT; var n = document.createElement("SPAN"); n.className = "ui-icon ui-icon-circle-arrow-w", e.moveLeftButton.appendChild(n); var o = function (b) { links.Timeline.preventDefault(b), links.Timeline.stopPropagation(b), a.move(-.2), a.trigger("rangechange"), a.trigger("rangechanged") }; links.Timeline.addEventListener(e.moveLeftButton, "mousedown", o), e.appendChild(e.moveLeftButton), e.moveRightButton = document.createElement("DIV"), e.moveRightButton.className = "timeline-navigation-move-right", e.moveRightButton.title = this.options.MOVE_RIGHT; var p = document.createElement("SPAN"); p.className = "ui-icon ui-icon-circle-arrow-e", e.moveRightButton.appendChild(p); var q = function (b) { links.Timeline.preventDefault(b), links.Timeline.stopPropagation(b), a.move(.2), a.trigger("rangechange"), a.trigger("rangechanged") }; links.Timeline.addEventListener(e.moveRightButton, "mousedown", q), e.appendChild(e.moveRightButton) } } } }, links.Timeline.prototype.setCurrentTime = function (a) { var b = new Date; this.clientTimeOffset = a.valueOf() - b.valueOf(), this.repaintCurrentTime() }, links.Timeline.prototype.getCurrentTime = function () { var a = new Date; return new Date(a.valueOf() + this.clientTimeOffset) }, links.Timeline.prototype.setCustomTime = function (a) { this.customTime = new Date(a.valueOf()), this.repaintCustomTime() }, links.Timeline.prototype.getCustomTime = function () { return new Date(this.customTime.valueOf()) }, links.Timeline.prototype.setScale = function (a, b) { this.step.setScale(a, b), this.render() }, links.Timeline.prototype.setAutoScale = function (a) { this.step.setAutoScale(a), this.render() }, links.Timeline.prototype.redraw = function () { this.setData(this.data) }, links.Timeline.prototype.checkResize = function () { this.render() }, links.Timeline.prototype.isEditable = function (a) { return !!a && (void 0 != a.editable ? a.editable : this.options.editable) }, links.Timeline.prototype.recalcConversion = function () { this.conversion.offset = this.start.valueOf(), this.conversion.factor = this.size.contentWidth / (this.end.valueOf() - this.start.valueOf()) }, links.Timeline.prototype.screenToTime = function (a) { var b = this.conversion; return new Date(a / b.factor + b.offset) }, links.Timeline.prototype.timeToScreen = function (a) { var b = this.conversion; return (a.valueOf() - b.offset) * b.factor }, links.Timeline.prototype.onTouchStart = function (a) { var b = this.eventParams, c = this; if (!b.touchDown) { b.touchDown = !0, b.zoomed = !1, this.onMouseDown(a), b.onTouchMove || (b.onTouchMove = function (a) { c.onTouchMove(a) }, links.Timeline.addEventListener(document, "touchmove", b.onTouchMove)), b.onTouchEnd || (b.onTouchEnd = function (a) { c.onTouchEnd(a) }, links.Timeline.addEventListener(document, "touchend", b.onTouchEnd)); var d = links.Timeline.getTarget(a), e = this.getItemIndex(d); b.doubleTapStartPrev = b.doubleTapStart, b.doubleTapStart = (new Date).valueOf(), b.doubleTapItemPrev = b.doubleTapItem, b.doubleTapItem = e, links.Timeline.preventDefault(a) } }, links.Timeline.prototype.onTouchMove = function (a) { var b = this.eventParams; if (a.scale && 1 !== a.scale && (b.zoomed = !0), b.zoomed) { if (this.options.zoomable) { b.zoomed = !0; var c = a.scale, d = b.end.valueOf() - b.start.valueOf(), e = d / c, f = e - d, g = new Date(parseInt(b.start.valueOf() - f / 2)), h = new Date(parseInt(b.end.valueOf() + f / 2)); this.setVisibleChartRange(g, h), this.trigger("rangechange") } } else this.onMouseMove(a); links.Timeline.preventDefault(a) }, links.Timeline.prototype.onTouchEnd = function (a) { var b = this.eventParams, c = this; b.touchDown = !1, b.zoomed && this.trigger("rangechanged"), b.onTouchMove && (links.Timeline.removeEventListener(document, "touchmove", b.onTouchMove), delete b.onTouchMove), b.onTouchEnd && (links.Timeline.removeEventListener(document, "touchend", b.onTouchEnd), delete b.onTouchEnd), this.onMouseUp(a); var d = 500, e = (new Date).valueOf(), f = links.Timeline.getTarget(a); this.getItemIndex(f), b.doubleTapStartPrev && e - b.doubleTapStartPrev < d && b.doubleTapItem == b.doubleTapItemPrev && (b.touchDown = !0, c.onDblClick(a), b.touchDown = !1), links.Timeline.preventDefault(a) }, links.Timeline.prototype.onMouseDown = function (a) { a = a || window.event; var b = this.eventParams, c = this.options, d = this.dom, e = a.which ? 1 == a.which : 1 == a.button; if (e || b.touchDown) { b.mouseX = links.Timeline.getPageX(a), b.mouseY = links.Timeline.getPageY(a), b.frameLeft = links.Timeline.getAbsoluteLeft(this.dom.content), b.frameTop = links.Timeline.getAbsoluteTop(this.dom.content), b.previousLeft = 0, b.previousOffset = 0, b.moved = !1, b.start = new Date(this.start.valueOf()), b.end = new Date(this.end.valueOf()), b.target = links.Timeline.getTarget(a); var f = d.items && d.items.dragLeft ? d.items.dragLeft : void 0, g = d.items && d.items.dragRight ? d.items.dragRight : void 0; if (b.itemDragLeft = b.target === f, b.itemDragRight = b.target === g, b.itemDragLeft || b.itemDragRight ? (b.itemIndex = this.selection && void 0 !== this.selection.index ? this.selection.index : void 0, delete b.clusterIndex) : (b.itemIndex = this.getItemIndex(b.target), b.clusterIndex = this.getClusterIndex(b.target)), b.customTime = b.target === d.customTime || b.target.parentNode === d.customTime ? this.customTime : void 0, b.addItem = c.editable && a.ctrlKey, b.addItem) { var h = b.mouseX - b.frameLeft, i = b.mouseY - b.frameTop, j = this.screenToTime(h); c.snapEvents && this.step.snap(j); var k = new Date(j.valueOf()), l = c.NEW, m = this.getGroupFromHeight(i); this.addItem({ start: j, end: k, content: l, group: this.getGroupName(m) }), b.itemIndex = this.items.length - 1, delete b.clusterIndex, this.selectItem(b.itemIndex), b.itemDragRight = !0 } var n = this.items[b.itemIndex], o = this.isSelected(b.itemIndex); if (b.editItem = o && this.isEditable(n), b.editItem ? (b.itemStart = n.start, b.itemEnd = n.end, b.itemGroup = n.group, b.itemLeft = n.getLeft(this), b.itemRight = n.getRight(this)) : this.dom.frame.style.cursor = "move", !b.touchDown) { var p = this; b.onMouseMove || (b.onMouseMove = function (a) { p.onMouseMove(a) }, links.Timeline.addEventListener(document, "mousemove", b.onMouseMove)), b.onMouseUp || (b.onMouseUp = function (a) { p.onMouseUp(a) }, links.Timeline.addEventListener(document, "mouseup", b.onMouseUp)), links.Timeline.preventDefault(a) } } }, links.Timeline.prototype.onMouseMove = function (a) { a = a || window.event; var b = this.eventParams, c = this.size, d = this.dom, e = this.options, f = links.Timeline.getPageX(a), g = links.Timeline.getPageY(a); void 0 == b.mouseX && (b.mouseX = f), void 0 == b.mouseY && (b.mouseY = g); var h = f - b.mouseX, i = g - b.mouseY; if (Math.abs(i) >= 1 && (newy = $.mobile.window.scrollTop(), $.mobile.window.scrollTop(newy - i)), Math.abs(h) >= 1 && (b.moved = !0), b.customTime) { var j = this.timeToScreen(b.customTime), k = j + h; this.customTime = this.screenToTime(k), this.repaintCustomTime(), this.trigger("timechange") } else if (b.editItem) { var l, m, n = this.items[b.itemIndex]; b.itemDragLeft && e.timeChangeable ? (l = b.itemLeft + h, m = b.itemRight, n.start = this.screenToTime(l), e.snapEvents && (this.step.snap(n.start), l = this.timeToScreen(n.start)), l > m && (l = m, n.start = this.screenToTime(l)), this.trigger("change")) : b.itemDragRight && e.timeChangeable ? (l = b.itemLeft, m = b.itemRight + h, n.end = this.screenToTime(m), e.snapEvents && (this.step.snap(n.end), m = this.timeToScreen(n.end)), l > m && (m = l, n.end = this.screenToTime(m)), this.trigger("change")) : e.timeChangeable && (l = b.itemLeft + h, n.start = this.screenToTime(l), e.snapEvents && (this.step.snap(n.start), l = this.timeToScreen(n.start)), n.end && (m = l + (b.itemRight - b.itemLeft), n.end = this.screenToTime(m)), this.trigger("change")), n.setPosition(l, m); var o = b.itemDragLeft || b.itemDragRight; if (this.groups.length && !o) { var p = g - b.frameTop, q = this.getGroupFromHeight(p); if (e.groupsChangeable && n.group !== q) { var r = this.items.indexOf(n); this.changeItem(r, { group: this.getGroupName(q) }) } else this.repaintDeleteButton(), this.repaintDragAreas() } else this.render() } else if (e.moveable) { var s = b.end.valueOf() - b.start.valueOf(), t = Math.round(-h / c.contentWidth * s), u = new Date(b.start.valueOf() + t), v = new Date(b.end.valueOf() + t); this.applyRange(u, v); var w = this.start.valueOf() - u.valueOf(); w && (t += w), this.recalcConversion(); var x = b.previousLeft || 0, y = parseFloat(d.items.frame.style.left) || 0, z = b.previousOffset || 0, A = z + (y - x), B = -t / s * c.contentWidth + A; d.items.frame.style.left = B + "px", b.previousOffset = A, b.previousLeft = parseFloat(d.items.frame.style.left) || B, this.repaintCurrentTime(), this.repaintCustomTime(), this.repaintAxis(), this.trigger("rangechange") } links.Timeline.preventDefault(a) }, links.Timeline.prototype.onMouseUp = function (a) { var b = this.eventParams, c = this.options; if (a = a || window.event, this.dom.frame.style.cursor = "auto", b.onMouseMove && (links.Timeline.removeEventListener(document, "mousemove", b.onMouseMove), delete b.onMouseMove), b.onMouseUp && (links.Timeline.removeEventListener(document, "mouseup", b.onMouseUp), delete b.onMouseUp), b.customTime) this.trigger("timechanged"); else if (b.editItem) { var d = this.items[b.itemIndex]; if (b.moved || b.addItem) { if (this.applyChange = !0, this.applyAdd = !0, this.updateData(b.itemIndex, { start: d.start, end: d.end }), this.trigger(b.addItem ? "add" : "changed"), d = this.items[b.itemIndex], b.addItem) this.applyAdd ? this.updateData(b.itemIndex, { start: d.start, end: d.end, content: d.content, group: this.getGroupName(d.group) }) : this.deleteItem(b.itemIndex); else if (this.applyChange) this.updateData(b.itemIndex, { start: d.start, end: d.end }); else { delete this.applyChange, delete this.applyAdd; var d = this.items[b.itemIndex]; d.dom, d.start = b.itemStart, d.end = b.itemEnd, d.group = b.itemGroup, d.setPosition(b.itemLeft, b.itemRight), this.updateData(b.itemIndex, { start: b.itemStart, end: b.itemEnd }) } this.options.cluster && this.clusterGenerator.updateData(), this.render() } } else b.moved || b.zoomed ? (this.render(), (b.moved && c.moveable || b.zoomed && c.zoomable) && this.trigger("rangechanged")) : b.target === this.dom.items.deleteButton ? this.selection && void 0 !== this.selection.index && this.confirmDeleteItem(this.selection.index) : c.selectable && (void 0 != b.itemIndex ? this.isSelected(b.itemIndex) || (this.selectItem(b.itemIndex), this.trigger("select")) : void 0 != b.clusterIndex ? (this.selectCluster(b.clusterIndex), this.trigger("select")) : c.unselectable && (this.unselectItem(), this.trigger("select"))) }, links.Timeline.prototype.onDblClick = function (a) { var b = this.eventParams, c = this.options, d = this.dom; if (this.size, a = a || window.event, void 0 != b.itemIndex) { var e = this.items[b.itemIndex]; e && this.isEditable(e) && this.trigger("edit") } else if (c.editable) { b.mouseX = links.Timeline.getPageX(a), b.mouseY = links.Timeline.getPageY(a); var f = b.mouseX - links.Timeline.getAbsoluteLeft(d.content), g = b.mouseY - links.Timeline.getAbsoluteTop(d.content), h = this.screenToTime(f); c.snapEvents && this.step.snap(h); var i = c.NEW, j = this.getGroupFromHeight(g), k = !0; this.addItem({ start: h, content: i, group: this.getGroupName(j) }, k), b.itemIndex = this.items.length - 1, this.selectItem(b.itemIndex), this.applyAdd = !0, this.trigger("add"), this.applyAdd ? (this.render({ animate: !1 }), this.selectItem(b.itemIndex)) : this.deleteItem(b.itemIndex) } links.Timeline.preventDefault(a) }, links.Timeline.prototype.onMouseWheel = function (a) { if (this.options.zoomable) { a || (a = window.event); var b = 0; if (a.wheelDelta ? b = a.wheelDelta / 120 : a.detail && (b = -a.detail / 3), b) { var c = this, d = function () { var d = b / 5, e = links.Timeline.getAbsoluteLeft(c.dom.content), f = links.Timeline.getPageX(a), g = void 0 != f && void 0 != e ? c.screenToTime(f - e) : void 0; c.zoom(d, g), c.trigger("rangechange"), c.trigger("rangechanged") }, e = function () { c.move(b * -.2), c.trigger("rangechange"), c.trigger("rangechanged") }; a.shiftKey ? e() : d() } links.Timeline.preventDefault(a) } }, links.Timeline.prototype.zoom = function (a, b) { void 0 == b && (b = new Date((this.start.valueOf() + this.end.valueOf()) / 2)), a >= 1 && (a = .9), -1 >= a && (a = -.9), 0 > a && (a /= 1 + a); var c = this.start.valueOf() - b, d = this.end.valueOf() - b, e = new Date(this.start.valueOf() - c * a), f = new Date(this.end.valueOf() - d * a), g = f.valueOf() - e.valueOf(), h = Number(this.options.zoomMin) || 10; 10 > h && (h = 10), g >= h && (this.applyRange(e, f, b), this.render({ animate: this.options.animate && this.options.animateZoom })) }, links.Timeline.prototype.move = function (a) { var b = this.end.valueOf() - this.start.valueOf(), c = new Date(this.start.valueOf() + b * a), d = new Date(this.end.valueOf() + b * a); this.applyRange(c, d), this.render() }, links.Timeline.prototype.applyRange = function (a, b, c) { var d = a.valueOf(), e = b.valueOf(), f = e - d, g = this.options, h = 31536e6, i = Number(g.zoomMin) || 10; 10 > i && (i = 10); var j = Number(g.zoomMax) || 1e4 * h; j > 1e4 * h && (j = 1e4 * h), i > j && (j = i); var k = g.min ? g.min.valueOf() : void 0, l = g.max ? g.max.valueOf() : void 0; if (void 0 != k && void 0 != l) { if (k >= l) { var m = 864e5; l = k + m } j > l - k && (j = l - k), i > l - k && (i = l - k) } if (d >= e && (e += 864e5), i > f) { var n = i - f, o = c ? (c.valueOf() - d) / f : .5; d -= Math.round(n * o), e += Math.round(n * (1 - o)) } if (f > j) { var n = f - j, o = c ? (c.valueOf() - d) / f : .5; d += Math.round(n * o), e -= Math.round(n * (1 - o)) } if (void 0 != k) { var n = d - k; 0 > n && (d -= n, e -= n) } if (void 0 != l) { var n = l - e; 0 > n && (d += n, e += n) } this.start = new Date(d), this.end = new Date(e) }, links.Timeline.prototype.confirmDeleteItem = function (a) { this.applyDelete = !0, this.isSelected(a) || this.selectItem(a), this.trigger("delete"), this.applyDelete && this.deleteItem(a), delete this.applyDelete }, links.Timeline.prototype.deleteItem = function (a, b) { if (a >= this.items.length) throw "Cannot delete row, index out of range"; this.selection && void 0 !== this.selection.index && (this.selection.index == a ? this.unselectItem() : this.selection.index > a && this.selection.index--); var c = this.items.splice(a, 1)[0]; if (this.renderQueue.hide.push(c), this.data) if (google && google.visualization && this.data instanceof google.visualization.DataTable) this.data.removeRow(a); else { if (!links.Timeline.isArray(this.data)) throw "Cannot delete row from data, unknown data type"; this.data.splice(a, 1) } this.options.cluster && this.clusterGenerator.updateData(), b || this.render() }, links.Timeline.prototype.deleteAllItems = function () { if (this.unselectItem(), this.clearItems(), this.deleteGroups(), this.data) if (google && google.visualization && this.data instanceof google.visualization.DataTable) this.data.removeRows(0, this.data.getNumberOfRows()); else { if (!links.Timeline.isArray(this.data)) throw "Cannot delete row from data, unknown data type"; this.data.splice(0, this.data.length) } this.options.cluster && this.clusterGenerator.updateData(), this.render() }, links.Timeline.prototype.getGroupFromHeight = function (a) { var b, c, d = this.groups; if (d.length) { if (this.options.axisOnTop) { for (b = d.length - 1; b >= 0; b--)if (c = d[b], a > c.top) return c } else for (b = 0; b < d.length; b++)if (c = d[b], a > c.top) return c; return c } }, links.Timeline.Item = function (a, b) { if (a && (this.start = a.start, this.end = a.end, this.content = a.content, this.className = a.className, this.editable = a.editable, this.group = a.group, this.type = a.type), this.top = 0, this.left = 0, this.width = 0, this.height = 0, this.lineWidth = 0, this.dotWidth = 0, this.dotHeight = 0, this.rendered = !1, b) for (var c in b) b.hasOwnProperty(c) && (this[c] = b[c]) }, links.Timeline.Item.prototype.reflow = function () { return !1 }, links.Timeline.Item.prototype.getImageUrls = function (a) { this.dom && links.imageloader.filterImageUrls(this.dom, a) }, links.Timeline.Item.prototype.select = function () { }, links.Timeline.Item.prototype.unselect = function () { }, links.Timeline.Item.prototype.createDOM = function () { }, links.Timeline.Item.prototype.showDOM = function () { }, links.Timeline.Item.prototype.hideDOM = function () { }, links.Timeline.Item.prototype.updateDOM = function () { }, links.Timeline.Item.prototype.updatePosition = function () { }, links.Timeline.Item.prototype.isRendered = function () { return this.rendered }, links.Timeline.Item.prototype.isVisible = function () { return !1 }, links.Timeline.Item.prototype.setPosition = function () { }, links.Timeline.Item.prototype.getLeft = function () { return 0 }, links.Timeline.Item.prototype.getRight = function () { return 0 }, links.Timeline.Item.prototype.getWidth = function () { return this.width || 0 }, links.Timeline.ItemBox = function (a, b) { links.Timeline.Item.call(this, a, b) }, links.Timeline.ItemBox.prototype = new links.Timeline.Item, links.Timeline.ItemBox.prototype.reflow = function () { var a = this.dom, b = a.dot.offsetHeight, c = a.dot.offsetWidth, d = a.line.offsetWidth, e = this.dotHeight != b || this.dotWidth != c || this.lineWidth != d; return this.dotHeight = b, this.dotWidth = c, this.lineWidth = d, e }, links.Timeline.ItemBox.prototype.select = function () { var a = this.dom; links.Timeline.addClassName(a, "timeline-event-selected ui-state-active"), links.Timeline.addClassName(a.line, "timeline-event-selected ui-state-active"), links.Timeline.addClassName(a.dot, "timeline-event-selected ui-state-active") }, links.Timeline.ItemBox.prototype.unselect = function () { var a = this.dom; links.Timeline.removeClassName(a, "timeline-event-selected ui-state-active"), links.Timeline.removeClassName(a.line, "timeline-event-selected ui-state-active"), links.Timeline.removeClassName(a.dot, "timeline-event-selected ui-state-active") }, links.Timeline.ItemBox.prototype.createDOM = function () { var a = document.createElement("DIV"); a.style.position = "absolute", a.style.left = this.left + "px", a.style.top = this.top + "px"; var b = document.createElement("DIV"); b.className = "timeline-event-content", b.innerHTML = this.content, a.appendChild(b); var c = document.createElement("DIV"); c.style.position = "absolute", c.style.width = "0px", a.line = c; var d = document.createElement("DIV"); return d.style.position = "absolute", d.style.width = "0px", d.style.height = "0px", a.dot = d, this.dom = a, this.updateDOM(), a }, links.Timeline.ItemBox.prototype.showDOM = function (a) { var b = this.dom; b || (b = this.createDOM()), b.parentNode != a && (b.parentNode && this.hideDOM(), a.appendChild(b), a.insertBefore(b.line, a.firstChild), a.appendChild(b.dot), this.rendered = !0) }, links.Timeline.ItemBox.prototype.hideDOM = function () { var a = this.dom; a && (a.parentNode && a.parentNode.removeChild(a), a.line && a.line.parentNode && a.line.parentNode.removeChild(a.line), a.dot && a.dot.parentNode && a.dot.parentNode.removeChild(a.dot), this.rendered = !1) }, links.Timeline.ItemBox.prototype.updateDOM = function () { var a = this.dom; if (a) { var b = a.line, c = a.dot; a.firstChild.innerHTML = this.content, a.className = "timeline-event timeline-event-box ui-widget ui-state-default", b.className = "timeline-event timeline-event-line ui-widget ui-state-default", c.className = "timeline-event timeline-event-dot ui-widget ui-state-default", this.isCluster && (links.Timeline.addClassName(a, "timeline-event-cluster ui-widget-header"), links.Timeline.addClassName(b, "timeline-event-cluster ui-widget-header"), links.Timeline.addClassName(c, "timeline-event-cluster ui-widget-header")), this.className && (links.Timeline.addClassName(a, this.className), links.Timeline.addClassName(b, this.className), links.Timeline.addClassName(c, this.className)) } }, links.Timeline.ItemBox.prototype.updatePosition = function (a) { var b = this.dom; if (b) { var c = a.timeToScreen(this.start), d = a.options.axisOnTop, e = a.size.axis.top, f = a.size.axis.height, g = a.options.box && a.options.box.align ? a.options.box.align : void 0; b.style.top = this.top + "px", b.style.left = "right" == g ? c - this.width + "px" : "left" == g ? c + "px" : c - this.width / 2 + "px"; var h = b.line, i = b.dot; h.style.left = c - this.lineWidth / 2 + "px", i.style.left = c - this.dotWidth / 2 + "px", d ? (h.style.top = f + "px", h.style.height = Math.max(this.top - f, 0) + "px", i.style.top = f - this.dotHeight / 2 + "px") : (h.style.top = this.top + this.height + "px", h.style.height = Math.max(e - this.top - this.height, 0) + "px", i.style.top = e - this.dotHeight / 2 + "px") } }, links.Timeline.ItemBox.prototype.isVisible = function (a, b) { return !this.cluster && (this.start > a && this.start < b) }, links.Timeline.ItemBox.prototype.setPosition = function (a) { var b = this.dom; b.style.left = a - this.width / 2 + "px", b.line.style.left = a - this.lineWidth / 2 + "px", b.dot.style.left = a - this.dotWidth / 2 + "px", this.group && (this.top = this.group.top, b.style.top = this.top + "px") }, links.Timeline.ItemBox.prototype.getLeft = function (a) { var b = a.options.box && a.options.box.align ? a.options.box.align : void 0, c = a.timeToScreen(this.start); return c -= "right" == b ? width : this.width / 2 }, links.Timeline.ItemBox.prototype.getRight = function (a) { var b, c = a.options.box && a.options.box.align ? a.options.box.align : void 0, d = a.timeToScreen(this.start); return b = "right" == c ? d : "left" == c ? d + this.width : d + this.width / 2 }, links.Timeline.ItemRange = function (a, b) { links.Timeline.Item.call(this, a, b) }, links.Timeline.ItemRange.prototype = new links.Timeline.Item, links.Timeline.ItemRange.prototype.select = function () { var a = this.dom; links.Timeline.addClassName(a, "timeline-event-selected ui-state-active") }, links.Timeline.ItemRange.prototype.unselect = function () { var a = this.dom; links.Timeline.removeClassName(a, "timeline-event-selected ui-state-active") }, links.Timeline.ItemRange.prototype.createDOM = function () { var a = document.createElement("DIV"); a.style.position = "absolute"; var b = document.createElement("DIV"); return b.className = "timeline-event-content", a.appendChild(b), this.dom = a, this.updateDOM(), a }, links.Timeline.ItemRange.prototype.showDOM = function (a) { var b = this.dom; b || (b = this.createDOM()), b.parentNode != a && (b.parentNode && this.hideDOM(), a.appendChild(b), this.rendered = !0) }, links.Timeline.ItemRange.prototype.hideDOM = function () { var a = this.dom; a && (a.parentNode && a.parentNode.removeChild(a), this.rendered = !1) }, links.Timeline.ItemRange.prototype.updateDOM = function () { var a = this.dom; a && (a.firstChild.innerHTML = this.content, a.className = "timeline-event timeline-event-range ui-widget ui-state-default", this.isCluster && links.Timeline.addClassName(a, "timeline-event-cluster ui-widget-header"), this.className && links.Timeline.addClassName(a, this.className)) }, links.Timeline.ItemRange.prototype.updatePosition = function (a) { var b = this.dom; if (b) { var c = a.size.contentWidth, d = a.timeToScreen(this.start), e = a.timeToScreen(this.end); -c > d && (d = -c), e > 2 * c && (e = 2 * c), b.style.top = this.top + "px", b.style.left = d + "px", b.style.width = Math.max(e - d, 1) + "px" } }, links.Timeline.ItemRange.prototype.isVisible = function (a, b) { return !this.cluster && (this.end > a && this.start < b) }, links.Timeline.ItemRange.prototype.setPosition = function (a, b) { var c = this.dom; c.style.left = a + "px", c.style.width = b - a + "px", this.group && (this.top = this.group.top, c.style.top = this.top + "px") }, links.Timeline.ItemRange.prototype.getLeft = function (a) { return a.timeToScreen(this.start) }, links.Timeline.ItemRange.prototype.getRight = function (a) { return a.timeToScreen(this.end) }, links.Timeline.ItemRange.prototype.getWidth = function (a) { return a.timeToScreen(this.end) - a.timeToScreen(this.start) }, links.Timeline.ItemFloatingRange = function (a, b) { links.Timeline.Item.call(this, a, b) }, links.Timeline.ItemFloatingRange.prototype = new links.Timeline.Item, links.Timeline.ItemFloatingRange.prototype.select = function () { var a = this.dom; links.Timeline.addClassName(a, "timeline-event-selected ui-state-active") }, links.Timeline.ItemFloatingRange.prototype.unselect = function () { var a = this.dom; links.Timeline.removeClassName(a, "timeline-event-selected ui-state-active") }, links.Timeline.ItemFloatingRange.prototype.createDOM = function () { var a = document.createElement("DIV"); a.style.position = "absolute"; var b = document.createElement("DIV"); return b.className = "timeline-event-content", a.appendChild(b), this.dom = a, this.updateDOM(), a }, links.Timeline.ItemFloatingRange.prototype.showDOM = function (a) { var b = this.dom; b || (b = this.createDOM()), b.parentNode != a && (b.parentNode && this.hideDOM(), a.appendChild(b), this.rendered = !0) }, links.Timeline.ItemFloatingRange.prototype.hideDOM = function () { var a = this.dom; a && (a.parentNode && a.parentNode.removeChild(a), this.rendered = !1) }, links.Timeline.ItemFloatingRange.prototype.updateDOM = function () { var a = this.dom; a && (a.firstChild.innerHTML = this.content, a.className = "timeline-event timeline-event-range ui-widget ui-state-default", this.isCluster && links.Timeline.addClassName(a, "timeline-event-cluster ui-widget-header"), this.className && links.Timeline.addClassName(a, this.className)) }, links.Timeline.ItemFloatingRange.prototype.updatePosition = function (a) { var b = this.dom; if (b) { var c = a.size.contentWidth, d = this.getLeft(a), e = this.getRight(a); -c > d && (d = -c), e > 2 * c && (e = 2 * c), b.style.top = this.top + "px", b.style.left = d + "px", b.style.width = Math.max(e - d, 1) + "px" } }, links.Timeline.ItemFloatingRange.prototype.isVisible = function (a, b) { return !this.cluster && (this.end && this.start ? this.end > a && this.start < b : this.start ? this.start < b : !this.end || this.end > a) }, links.Timeline.ItemFloatingRange.prototype.setPosition = function (a, b) { var c = this.dom; c.style.left = a + "px", c.style.width = b - a + "px", this.group && (this.top = this.group.top, c.style.top = this.top + "px") }, links.Timeline.ItemFloatingRange.prototype.getLeft = function (a) { return this.start ? a.timeToScreen(this.start) : 0 }, links.Timeline.ItemFloatingRange.prototype.getRight = function (a) { return this.end ? a.timeToScreen(this.end) : a.size.contentWidth }, links.Timeline.ItemFloatingRange.prototype.getWidth = function (a) { return this.getRight(a) - this.getLeft(a) }, links.Timeline.ItemDot = function (a, b) { links.Timeline.Item.call(this, a, b) }, links.Timeline.ItemDot.prototype = new links.Timeline.Item, links.Timeline.ItemDot.prototype.reflow = function () { var a = this.dom, b = a.dot.offsetHeight, c = a.dot.offsetWidth, d = a.content.offsetHeight, e = this.dotHeight != b || this.dotWidth != c || this.contentHeight != d; return this.dotHeight = b, this.dotWidth = c, this.contentHeight = d, e }, links.Timeline.ItemDot.prototype.select = function () { var a = this.dom; links.Timeline.addClassName(a, "timeline-event-selected ui-state-active") }, links.Timeline.ItemDot.prototype.unselect = function () { var a = this.dom; links.Timeline.removeClassName(a, "timeline-event-selected ui-state-active") }, links.Timeline.ItemDot.prototype.createDOM = function () { var a = document.createElement("DIV"); a.style.position = "absolute"; var b = document.createElement("DIV"); b.className = "timeline-event-content", a.appendChild(b); var c = document.createElement("DIV"); return c.style.position = "absolute", c.style.width = "0px", c.style.height = "0px", a.appendChild(c), a.content = b, a.dot = c, this.dom = a, this.updateDOM(), a }, links.Timeline.ItemDot.prototype.showDOM = function (a) { var b = this.dom; b || (b = this.createDOM()), b.parentNode != a && (b.parentNode && this.hideDOM(), a.appendChild(b), this.rendered = !0) }, links.Timeline.ItemDot.prototype.hideDOM = function () { var a = this.dom; a && (a.parentNode && a.parentNode.removeChild(a), this.rendered = !1) }, links.Timeline.ItemDot.prototype.updateDOM = function () { if (this.dom) { var a = this.dom, b = a.dot; a.firstChild.innerHTML = this.content, a.className = "timeline-event-dot-container", b.className = "timeline-event timeline-event-dot ui-widget ui-state-default", this.isCluster && (links.Timeline.addClassName(a, "timeline-event-cluster ui-widget-header"), links.Timeline.addClassName(b, "timeline-event-cluster ui-widget-header")), this.className && (links.Timeline.addClassName(a, this.className), links.Timeline.addClassName(b, this.className)) } }, links.Timeline.ItemDot.prototype.updatePosition = function (a) { var b = this.dom; if (b) { var c = a.timeToScreen(this.start); b.style.top = this.top + "px", b.style.left = c - this.dotWidth / 2 + "px", b.content.style.marginLeft = 1.5 * this.dotWidth + "px", b.dot.style.top = (this.height - this.dotHeight) / 2 + "px" } }, links.Timeline.ItemDot.prototype.isVisible = function (a, b) {
    return !this.cluster && (this.start > a && this.start < b)
}, links.Timeline.ItemDot.prototype.setPosition = function (a) { var b = this.dom; b.style.left = a - this.dotWidth / 2 + "px", this.group && (this.top = this.group.top, b.style.top = this.top + "px") }, links.Timeline.ItemDot.prototype.getLeft = function (a) { return a.timeToScreen(this.start) }, links.Timeline.ItemDot.prototype.getRight = function (a) { return a.timeToScreen(this.start) + this.width }, links.Timeline.prototype.getItem = function (a) { if (a >= this.items.length) throw "Cannot get item, index out of range"; var b, c = this.data; if (google && google.visualization && c instanceof google.visualization.DataTable) { var d = links.Timeline.mapColumnIds(c); b = {}; for (var e in d) d.hasOwnProperty(e) && (b[e] = this.data.getValue(a, d[e])) } else { if (!links.Timeline.isArray(this.data)) throw "Unknown data type. DataTable or Array expected."; b = links.Timeline.clone(this.data[a]) } var f = this.items[a]; return b.start = new Date(f.start.valueOf()), f.end && (b.end = new Date(f.end.valueOf())), b.content = f.content, f.group && (b.group = this.getGroupName(f.group)), f.className && (b.className = f.className), "undefined" != typeof f.editable && (b.editable = f.editable), f.type && (b.type = f.type), b }, links.Timeline.prototype.getCluster = function (a) { if (a >= this.clusters.length) throw "Cannot get cluster, index out of range"; var b = {}, c = this.clusters[a], d = c.items; b.start = new Date(c.start.valueOf()), c.type && (b.type = c.type), b.items = []; for (var e = 0; e < d.length; e++)for (var f = 0; f < this.items.length; f++)if (this.items[f] == d[e]) { b.items.push(this.getItem(f)); break } return b }, links.Timeline.prototype.addItem = function (a, b) { var c = [a]; this.addItems(c, b) }, links.Timeline.prototype.addItems = function (a, b) { var c = this, d = this.items; a.forEach(function (a) { var b = d.length; d.push(c.createItem(a)), c.updateData(b, a) }), this.options.cluster && this.clusterGenerator.updateData(), b || this.render({ animate: !1 }) }, links.Timeline.prototype.createItem = function (a) { var b = a.type || (a.end ? "range" : this.options.style), c = links.Timeline.clone(a); c.type = b, c.group = this.getGroup(a.group); var d, e = this.options; return d = e.axisOnTop ? this.size.axis.height + e.eventMarginAxis + e.eventMargin / 2 : this.size.contentHeight - e.eventMarginAxis - e.eventMargin / 2, b in this.itemTypes ? new this.itemTypes[b](c, { top: d }) : (console.log('ERROR: Unknown event type "' + b + '"'), new links.Timeline.Item(c, { top: d })) }, links.Timeline.prototype.changeItem = function (a, b, c) { var d = this.items[a]; if (!d) throw "Cannot change item, index out of range"; var e = this.createItem({ start: b.hasOwnProperty("start") ? b.start : d.start, end: b.hasOwnProperty("end") ? b.end : d.end, content: b.hasOwnProperty("content") ? b.content : d.content, group: b.hasOwnProperty("group") ? b.group : this.getGroupName(d.group), className: b.hasOwnProperty("className") ? b.className : d.className, editable: b.hasOwnProperty("editable") ? b.editable : d.editable, type: b.hasOwnProperty("type") ? b.type : d.type }); this.items[a] = e, this.renderQueue.hide.push(d), this.renderQueue.show.push(e), this.updateData(a, b), this.options.cluster && this.clusterGenerator.updateData(), c || (this.render({ animate: !1 }), this.selection && this.selection.index == a && e.select()) }, links.Timeline.prototype.deleteGroups = function () { this.groups = [], this.groupIndexes = {} }, links.Timeline.prototype.getGroup = function (a) { var b = this.groups, c = this.groupIndexes, d = void 0, e = c[a]; if (void 0 == e && void 0 != a) { d = { content: a, labelTop: 0, lineTop: 0 }, b.push(d), 1 == this.options.groupsOrder ? b = b.sort(function (a, b) { return a.content > b.content ? 1 : a.content < b.content ? -1 : 0 }) : "function" == typeof this.options.groupsOrder && (b = b.sort(this.options.groupsOrder)); for (var f = 0, g = b.length; g > f; f++)c[b[f].content] = f } else d = b[e]; return d }, links.Timeline.prototype.getGroupName = function (a) { return a ? a.content : void 0 }, links.Timeline.prototype.cancelChange = function () { this.applyChange = !1 }, links.Timeline.prototype.cancelDelete = function () { this.applyDelete = !1 }, links.Timeline.prototype.cancelAdd = function () { this.applyAdd = !1 }, links.Timeline.prototype.setSelection = function (a) { if (void 0 != a && a.length > 0) { if (void 0 != a[0].row) { var b = a[0].row; if (this.items[b]) { var c = this.items[b]; this.selectItem(b); var d, e = c.start, f = c.end; d = void 0 != f ? (f.valueOf() + e.valueOf()) / 2 : e.valueOf(); var g = this.end.valueOf() - this.start.valueOf(), h = new Date(d - g / 2), i = new Date(d + g / 2); return this.setVisibleChartRange(h, i), !0 } } } else this.unselectItem(); return !1 }, links.Timeline.prototype.getSelection = function () { var a = []; return this.selection && a.push(void 0 !== this.selection.index ? { row: this.selection.index } : { cluster: this.selection.cluster }), a }, links.Timeline.prototype.selectItem = function (a) { if (this.unselectItem(), this.selection = void 0, void 0 != this.items[a]) { var b = this.items[a]; b.dom, this.selection = { index: a }, b && b.dom && (this.isEditable(b) && (b.dom.style.cursor = "move"), b.select()), this.repaintDeleteButton(), this.repaintDragAreas() } }, links.Timeline.prototype.selectCluster = function (a) { this.unselectItem(), this.selection = void 0, void 0 != this.clusters[a] && (this.selection = { cluster: a }, this.repaintDeleteButton(), this.repaintDragAreas()) }, links.Timeline.prototype.isSelected = function (a) { return this.selection && this.selection.index == a }, links.Timeline.prototype.unselectItem = function () { if (this.selection && void 0 !== this.selection.index) { var a = this.items[this.selection.index]; if (a && a.dom) { var b = a.dom; b.style.cursor = "", a.unselect() } this.selection = void 0, this.repaintDeleteButton(), this.repaintDragAreas() } }, links.Timeline.prototype.stackItems = function (a) { void 0 == a && (a = !1); var b = this.stack; if (b || (b = {}, this.stack = b), b.sortedItems = this.stackOrder(this.renderedItems), b.finalItems = this.stackCalculateFinal(b.sortedItems), a || b.timer) { var c = this, d = function () { var a = c.stackMoveOneStep(b.sortedItems, b.finalItems); c.repaint(), a ? delete b.timer : b.timer = setTimeout(d, 30) }; b.timer || (b.timer = setTimeout(d, 30)) } else this.stackMoveToFinal(b.sortedItems, b.finalItems) }, links.Timeline.prototype.stackCancelAnimation = function () { this.stack && this.stack.timer && (clearTimeout(this.stack.timer), delete this.stack.timer) }, links.Timeline.prototype.getItemsByGroup = function (a) { for (var b = {}, c = 0; c < a.length; ++c) { var d = a[c], e = "undefined"; d.group && (e = d.group.content ? d.group.content : d.group), b[e] || (b[e] = []), b[e].push(d) } return b }, links.Timeline.prototype.stackOrder = function (a) { var b = a.concat([]), c = this.options.customStackOrder && "function" == typeof this.options.customStackOrder ? this.options.customStackOrder : function (a, b) { return (a instanceof links.Timeline.ItemRange || a instanceof links.Timeline.ItemFloatingRange) && !(b instanceof links.Timeline.ItemRange || b instanceof links.Timeline.ItemFloatingRange) ? -1 : a instanceof links.Timeline.ItemRange || a instanceof links.Timeline.ItemFloatingRange || !(b instanceof links.Timeline.ItemRange || b instanceof links.Timeline.ItemFloatingRange) ? a.left - b.left : 1 }; return b.sort(c), b }, links.Timeline.prototype.stackCalculateFinal = function (a) { var b, c, d = this.size, e = this.options, f = e.axisOnTop, g = e.eventMargin, h = e.eventMarginAxis, i = f ? d.axis.height + h + g / 2 : d.contentHeight - h - g / 2, k = []; for (b = this.getItemsByGroup(a), j = 0; j < this.groups.length; ++j) { var l = this.groups[j]; b[l.content] ? (c = this.finalItemsPosition(b[l.content], i, l), c.forEach(function (a) { k.push(a) }), f ? i += l.itemsHeight + g : i -= l.itemsHeight + g) : f ? i += e.groupMinHeight + g : i -= e.groupMinHeight + g } return b.undefined && (c = this.finalItemsPosition(b.undefined, i), c.forEach(function (a) { k.push(a) })), k }, links.Timeline.prototype.finalItemsPosition = function (a, b, c) { var d, e, f, g = this.options, h = g.axisOnTop, i = g.eventMargin; for (f = this.initialItemsPosition(a, b), d = 0, e = f.length; e > d; d++) { var j = f[d], k = null; if (this.options.stackEvents) do k = this.stackItemsCheckOverlap(f, d, 0, d - 1), null != k && (j.top = h ? k.top + k.height + i : k.top - j.height - i, j.bottom = j.top + j.height); while (k); c && (c.itemsHeight = h ? c.itemsHeight ? Math.max(c.itemsHeight, j.bottom - b) : j.height + i : c.itemsHeight ? Math.max(c.itemsHeight, b - j.top) : j.height + i) } return f }, links.Timeline.prototype.initialItemsPosition = function (a, b) { for (var c = this.options, d = c.axisOnTop, e = [], f = 0, g = a.length; g > f; ++f) { var h, i, j = a[f], k = j.height, l = j.getWidth(this), m = j.getRight(this), n = m - l; h = d ? b : b - k, i = h + k, e.push({ left: n, top: h, right: m, bottom: i, height: k, item: j }) } return e }, links.Timeline.prototype.stackMoveOneStep = function (a, b) { for (var c = !0, d = 0, e = b.length; e > d; d++) { var f = b[d], g = f.item, h = parseInt(g.top), i = parseInt(f.top), j = i - h; if (j) { var k = i == h ? 0 : i > h ? 1 : -1; Math.abs(j) > 4 && (k = j / 4); var l = parseInt(h + k); l != i && (c = !1), g.top = l, g.bottom = g.top + g.height } else g.top = f.top, g.bottom = f.bottom; g.left = f.left, g.right = f.right } return c }, links.Timeline.prototype.stackMoveToFinal = function (a, b) { for (var c = 0, d = b.length; d > c; c++) { var e = b[c], f = e.item; f.left = e.left, f.top = e.top, f.right = e.right, f.bottom = e.bottom } }, links.Timeline.prototype.stackItemsCheckOverlap = function (a, b, c, d) { for (var e = this.options.eventMargin, f = this.collision, g = a[b], h = d; h >= c; h--) { var i = a[h]; if (f(g, i, e) && h != b) return i } }, links.Timeline.prototype.collision = function (a, b, c) { return void 0 == c && (c = 0), a.left - c < b.right && a.right + c > b.left && a.top - c < b.bottom && a.bottom + c > b.top }, links.Timeline.prototype.trigger = function (a) { var b = null; switch (a) { case "rangechange": case "rangechanged": b = { start: new Date(this.start.valueOf()), end: new Date(this.end.valueOf()) }; break; case "timechange": case "timechanged": b = { time: new Date(this.customTime.valueOf()) } }links.events.trigger(this, a, b), google && google.visualization && google.visualization.events.trigger(this, a, b) }, links.Timeline.prototype.clusterItems = function () { if (this.options.cluster) { var a = this.clusterGenerator.getClusters(this.conversion.factor, this.options.clusterMaxItems); if (this.clusters != a) { var b = this.renderQueue; this.clusters && this.clusters.forEach(function (a) { b.hide.push(a), a.items.forEach(function (a) { a.cluster = void 0 }) }), a.forEach(function (a) { a.items.forEach(function (b) { b.cluster = a }) }), this.clusters = a } } }, links.Timeline.prototype.filterItems = function () { function a(a) { a.forEach(function (a) { var c = a.rendered, f = a.isVisible(d, e); c != f && (c && b.hide.push(a), f && -1 == b.show.indexOf(a) && b.show.push(a)) }) } var b = this.renderQueue, c = this.end - this.start, d = new Date(this.start.valueOf() - c), e = new Date(this.end.valueOf() + c); a(this.items), this.clusters && a(this.clusters) }, links.Timeline.ClusterGenerator = function (a) { this.timeline = a, this.clear() }, links.Timeline.ClusterGenerator.prototype.clear = function () { this.items = [], this.groups = {}, this.clearCache() }, links.Timeline.ClusterGenerator.prototype.clearCache = function () { this.cache = {}, this.cacheLevel = -1, this.cache[this.cacheLevel] = [] }, links.Timeline.ClusterGenerator.prototype.setData = function (a, b) { this.items = a || [], this.dataChanged = !0, this.applyOnChangedLevel = !0, b && b.applyOnChangedLevel && (this.applyOnChangedLevel = b.applyOnChangedLevel) }, links.Timeline.ClusterGenerator.prototype.updateData = function () { this.dataChanged = !0, this.applyOnChangedLevel = !1 }, links.Timeline.ClusterGenerator.prototype.filterData = function () { var a = this.items || [], b = {}; this.groups = b, a.forEach(function (a) { var c = a.group ? a.group.content : "", d = b[c]; d || (d = [], b[c] = d), d.push(a), a.start && (a.center = a.end ? (a.start.valueOf() + a.end.valueOf()) / 2 : a.start.valueOf()) }); for (var c in b) b.hasOwnProperty(c) && b[c].sort(function (a, b) { return a.center - b.center }); this.dataChanged = !1 }, links.Timeline.ClusterGenerator.prototype.getClusters = function (a, b) { var c = -1, d = 2, e = 0; if (a > 0 && (c = Math.round(Math.log(100 / a) / Math.log(d)), e = Math.pow(d, c)), this.dataChanged) { var f = c != this.cacheLevel, g = !this.applyOnChangedLevel || f; g && (this.clearCache(), this.filterData()) } this.cacheLevel = c; var h = this.cache[c]; if (!h) { h = []; for (var i in this.groups) if (this.groups.hasOwnProperty(i)) for (var j = this.groups[i], k = j.length, l = 0; k > l;) { for (var m = j[l], n = 1, o = l - 1; o >= 0 && m.center - j[o].center < e / 2;)j[o].cluster || n++ , o--; for (var p = l + 1; p < j.length && j[p].center - m.center < e / 2;)n++ , p++; for (var q = h.length - 1; q >= 0 && m.center - h[q].center < e / 2;)m.group == h[q].group && n++ , q--; if (n > b) { for (var r = n - b + 1, s = [], t = void 0, u = void 0, v = void 0, w = !1, x = 0, y = l; s.length < r && y < j.length;) { var z = j[y], A = z.start.valueOf(), B = z.end ? z.end.valueOf() : z.start.valueOf(); s.push(z), t = x ? x / (x + 1) * t + 1 / (x + 1) * z.center : z.center, u = void 0 != u ? Math.min(u, A) : A, v = void 0 != v ? Math.max(v, B) : B, w = w || z instanceof links.Timeline.ItemRange || z instanceof links.Timeline.ItemFloatingRange, x++ , y++ } var C, D = "Cluster containing " + x + " events. Zoom in to see the individual events.", E = '<div title="' + D + '">' + x + " events</div>", F = m.group ? m.group.content : void 0; C = this.timeline.createItem(w ? { start: new Date(u), end: new Date(v), content: E, group: F } : { start: new Date(t), content: E, group: F }), C.isCluster = !0, C.items = s, C.items.forEach(function (a) { a.cluster = C }), h.push(C), l += r } else delete m.cluster, l += 1 } this.cache[c] = h } return h }, links.events = links.events || { listeners: [], indexOf: function (a) { for (var b = this.listeners, c = 0, d = this.listeners.length; d > c; c++) { var e = b[c]; if (e && e.object == a) return c } return -1 }, addListener: function (a, b, c) { var d = this.indexOf(a), e = this.listeners[d]; e || (e = { object: a, events: {} }, this.listeners.push(e)); var f = e.events[b]; f || (f = [], e.events[b] = f), -1 == f.indexOf(c) && f.push(c) }, removeListener: function (a, b, c) { var d = this.indexOf(a), e = this.listeners[d]; if (e) { var f = e.events[b]; if (f) { var d = f.indexOf(c); -1 != d && f.splice(d, 1), 0 == f.length && delete e.events[b] } var g = 0, h = e.events; for (var i in h) h.hasOwnProperty(i) && g++; 0 == g && delete this.listeners[d] } }, removeAllListeners: function () { this.listeners = [] }, trigger: function (a, b, c) { var d = this.indexOf(a), e = this.listeners[d]; if (e) { var f = e.events[b]; if (f) for (var g = 0, h = f.length; h > g; g++)f[g](c) } } }, links.Timeline.StepDate = function (a, b, c) { this.current = new Date, this._start = new Date, this._end = new Date, this.autoScale = !0, this.scale = links.Timeline.StepDate.SCALE.DAY, this.step = 1, this.setRange(a, b, c) }, links.Timeline.StepDate.SCALE = { MILLISECOND: 1, SECOND: 2, MINUTE: 3, HOUR: 4, DAY: 5, WEEKDAY: 6, MONTH: 7, YEAR: 8 }, links.Timeline.StepDate.prototype.setRange = function (a, b, c) { a instanceof Date && b instanceof Date && (this._start = void 0 != a ? new Date(a.valueOf()) : new Date, this._end = void 0 != b ? new Date(b.valueOf()) : new Date, this.autoScale && this.setMinimumStep(c)) }, links.Timeline.StepDate.prototype.start = function () { this.current = new Date(this._start.valueOf()), this.roundToMinor() }, links.Timeline.StepDate.prototype.roundToMinor = function () { switch (this.scale) { case links.Timeline.StepDate.SCALE.YEAR: this.current.setFullYear(this.step * Math.floor(this.current.getFullYear() / this.step)), this.current.setMonth(0); case links.Timeline.StepDate.SCALE.MONTH: this.current.setDate(1); case links.Timeline.StepDate.SCALE.DAY: case links.Timeline.StepDate.SCALE.WEEKDAY: this.current.setHours(0); case links.Timeline.StepDate.SCALE.HOUR: this.current.setMinutes(0); case links.Timeline.StepDate.SCALE.MINUTE: this.current.setSeconds(0); case links.Timeline.StepDate.SCALE.SECOND: this.current.setMilliseconds(0) }if (1 != this.step) switch (this.scale) { case links.Timeline.StepDate.SCALE.MILLISECOND: this.current.setMilliseconds(this.current.getMilliseconds() - this.current.getMilliseconds() % this.step); break; case links.Timeline.StepDate.SCALE.SECOND: this.current.setSeconds(this.current.getSeconds() - this.current.getSeconds() % this.step); break; case links.Timeline.StepDate.SCALE.MINUTE: this.current.setMinutes(this.current.getMinutes() - this.current.getMinutes() % this.step); break; case links.Timeline.StepDate.SCALE.HOUR: this.current.setHours(this.current.getHours() - this.current.getHours() % this.step); break; case links.Timeline.StepDate.SCALE.WEEKDAY: case links.Timeline.StepDate.SCALE.DAY: this.current.setDate(this.current.getDate() - 1 - (this.current.getDate() - 1) % this.step + 1); break; case links.Timeline.StepDate.SCALE.MONTH: this.current.setMonth(this.current.getMonth() - this.current.getMonth() % this.step); break; case links.Timeline.StepDate.SCALE.YEAR: this.current.setFullYear(this.current.getFullYear() - this.current.getFullYear() % this.step) } }, links.Timeline.StepDate.prototype.end = function () { return this.current.valueOf() > this._end.valueOf() }, links.Timeline.StepDate.prototype.next = function () { var a = this.current.valueOf(); if (this.current.getMonth() < 6) switch (this.scale) { case links.Timeline.StepDate.SCALE.MILLISECOND: this.current = new Date(this.current.valueOf() + this.step); break; case links.Timeline.StepDate.SCALE.SECOND: this.current = new Date(this.current.valueOf() + 1e3 * this.step); break; case links.Timeline.StepDate.SCALE.MINUTE: this.current = new Date(this.current.valueOf() + 1e3 * this.step * 60); break; case links.Timeline.StepDate.SCALE.HOUR: this.current = new Date(this.current.valueOf() + 1e3 * this.step * 60 * 60); var b = this.current.getHours(); this.current.setHours(b - b % this.step); break; case links.Timeline.StepDate.SCALE.WEEKDAY: case links.Timeline.StepDate.SCALE.DAY: this.current.setDate(this.current.getDate() + this.step); break; case links.Timeline.StepDate.SCALE.MONTH: this.current.setMonth(this.current.getMonth() + this.step); break; case links.Timeline.StepDate.SCALE.YEAR: this.current.setFullYear(this.current.getFullYear() + this.step) } else switch (this.scale) { case links.Timeline.StepDate.SCALE.MILLISECOND: this.current = new Date(this.current.valueOf() + this.step); break; case links.Timeline.StepDate.SCALE.SECOND: this.current.setSeconds(this.current.getSeconds() + this.step); break; case links.Timeline.StepDate.SCALE.MINUTE: this.current.setMinutes(this.current.getMinutes() + this.step); break; case links.Timeline.StepDate.SCALE.HOUR: this.current.setHours(this.current.getHours() + this.step); break; case links.Timeline.StepDate.SCALE.WEEKDAY: case links.Timeline.StepDate.SCALE.DAY: this.current.setDate(this.current.getDate() + this.step); break; case links.Timeline.StepDate.SCALE.MONTH: this.current.setMonth(this.current.getMonth() + this.step); break; case links.Timeline.StepDate.SCALE.YEAR: this.current.setFullYear(this.current.getFullYear() + this.step) }if (1 != this.step) switch (this.scale) { case links.Timeline.StepDate.SCALE.MILLISECOND: this.current.getMilliseconds() < this.step && this.current.setMilliseconds(0); break; case links.Timeline.StepDate.SCALE.SECOND: this.current.getSeconds() < this.step && this.current.setSeconds(0); break; case links.Timeline.StepDate.SCALE.MINUTE: this.current.getMinutes() < this.step && this.current.setMinutes(0); break; case links.Timeline.StepDate.SCALE.HOUR: this.current.getHours() < this.step && this.current.setHours(0); break; case links.Timeline.StepDate.SCALE.WEEKDAY: case links.Timeline.StepDate.SCALE.DAY: this.current.getDate() < this.step + 1 && this.current.setDate(1); break; case links.Timeline.StepDate.SCALE.MONTH: this.current.getMonth() < this.step && this.current.setMonth(0); break; case links.Timeline.StepDate.SCALE.YEAR: }this.current.valueOf() == a && (this.current = new Date(this._end.valueOf())) }, links.Timeline.StepDate.prototype.getCurrent = function () { return this.current }, links.Timeline.StepDate.prototype.setScale = function (a, b) { this.scale = a, b > 0 && (this.step = b), this.autoScale = !1 }, links.Timeline.StepDate.prototype.setAutoScale = function (a) { this.autoScale = a }, links.Timeline.StepDate.prototype.setMinimumStep = function (a) { if (void 0 != a) { var b = 31104e6, c = 2592e6, d = 864e5, e = 36e5, f = 6e4, g = 1e3, h = 1; 1e3 * b > a && (this.scale = links.Timeline.StepDate.SCALE.YEAR, this.step = 1e3), 500 * b > a && (this.scale = links.Timeline.StepDate.SCALE.YEAR, this.step = 500), 100 * b > a && (this.scale = links.Timeline.StepDate.SCALE.YEAR, this.step = 100), 50 * b > a && (this.scale = links.Timeline.StepDate.SCALE.YEAR, this.step = 50), 10 * b > a && (this.scale = links.Timeline.StepDate.SCALE.YEAR, this.step = 10), 5 * b > a && (this.scale = links.Timeline.StepDate.SCALE.YEAR, this.step = 5), b > a && (this.scale = links.Timeline.StepDate.SCALE.YEAR, this.step = 1), 3 * c > a && (this.scale = links.Timeline.StepDate.SCALE.MONTH, this.step = 3), c > a && (this.scale = links.Timeline.StepDate.SCALE.MONTH, this.step = 1), 5 * d > a && (this.scale = links.Timeline.StepDate.SCALE.DAY, this.step = 5), 2 * d > a && (this.scale = links.Timeline.StepDate.SCALE.DAY, this.step = 2), d > a && (this.scale = links.Timeline.StepDate.SCALE.DAY, this.step = 1), d / 2 > a && (this.scale = links.Timeline.StepDate.SCALE.WEEKDAY, this.step = 1), 4 * e > a && (this.scale = links.Timeline.StepDate.SCALE.HOUR, this.step = 4), e > a && (this.scale = links.Timeline.StepDate.SCALE.HOUR, this.step = 1), 15 * f > a && (this.scale = links.Timeline.StepDate.SCALE.MINUTE, this.step = 15), 10 * f > a && (this.scale = links.Timeline.StepDate.SCALE.MINUTE, this.step = 10), 5 * f > a && (this.scale = links.Timeline.StepDate.SCALE.MINUTE, this.step = 5), f > a && (this.scale = links.Timeline.StepDate.SCALE.MINUTE, this.step = 1), 15 * g > a && (this.scale = links.Timeline.StepDate.SCALE.SECOND, this.step = 15), 10 * g > a && (this.scale = links.Timeline.StepDate.SCALE.SECOND, this.step = 10), 5 * g > a && (this.scale = links.Timeline.StepDate.SCALE.SECOND, this.step = 5), g > a && (this.scale = links.Timeline.StepDate.SCALE.SECOND, this.step = 1), 200 * h > a && (this.scale = links.Timeline.StepDate.SCALE.MILLISECOND, this.step = 200), 100 * h > a && (this.scale = links.Timeline.StepDate.SCALE.MILLISECOND, this.step = 100), 50 * h > a && (this.scale = links.Timeline.StepDate.SCALE.MILLISECOND, this.step = 50), 10 * h > a && (this.scale = links.Timeline.StepDate.SCALE.MILLISECOND, this.step = 10), 5 * h > a && (this.scale = links.Timeline.StepDate.SCALE.MILLISECOND, this.step = 5), h > a && (this.scale = links.Timeline.StepDate.SCALE.MILLISECOND, this.step = 1) } }, links.Timeline.StepDate.prototype.snap = function (a) { if (this.scale == links.Timeline.StepDate.SCALE.YEAR) { var b = a.getFullYear() + Math.round(a.getMonth() / 12); a.setFullYear(Math.round(b / this.step) * this.step), a.setMonth(0), a.setDate(0), a.setHours(0), a.setMinutes(0), a.setSeconds(0), a.setMilliseconds(0) } else if (this.scale == links.Timeline.StepDate.SCALE.MONTH) a.getDate() > 15 ? (a.setDate(1), a.setMonth(a.getMonth() + 1)) : a.setDate(1), a.setHours(0), a.setMinutes(0), a.setSeconds(0), a.setMilliseconds(0); else if (this.scale == links.Timeline.StepDate.SCALE.DAY || this.scale == links.Timeline.StepDate.SCALE.WEEKDAY) { switch (this.step) { case 5: case 2: a.setHours(24 * Math.round(a.getHours() / 24)); break; default: a.setHours(12 * Math.round(a.getHours() / 12)) }a.setMinutes(0), a.setSeconds(0), a.setMilliseconds(0) } else if (this.scale == links.Timeline.StepDate.SCALE.HOUR) { switch (this.step) { case 4: a.setMinutes(60 * Math.round(a.getMinutes() / 60)); break; default: a.setMinutes(30 * Math.round(a.getMinutes() / 30)) }a.setSeconds(0), a.setMilliseconds(0) } else if (this.scale == links.Timeline.StepDate.SCALE.MINUTE) { switch (this.step) { case 15: case 10: a.setMinutes(5 * Math.round(a.getMinutes() / 5)), a.setSeconds(0); break; case 5: a.setSeconds(60 * Math.round(a.getSeconds() / 60)); break; default: a.setSeconds(30 * Math.round(a.getSeconds() / 30)) }a.setMilliseconds(0) } else if (this.scale == links.Timeline.StepDate.SCALE.SECOND) switch (this.step) { case 15: case 10: a.setSeconds(5 * Math.round(a.getSeconds() / 5)), a.setMilliseconds(0); break; case 5: a.setMilliseconds(1e3 * Math.round(a.getMilliseconds() / 1e3)); break; default: a.setMilliseconds(500 * Math.round(a.getMilliseconds() / 500)) } else if (this.scale == links.Timeline.StepDate.SCALE.MILLISECOND) { var c = this.step > 5 ? this.step / 2 : 1; a.setMilliseconds(Math.round(a.getMilliseconds() / c) * c) } }, links.Timeline.StepDate.prototype.isMajor = function () { switch (this.scale) { case links.Timeline.StepDate.SCALE.MILLISECOND: return 0 == this.current.getMilliseconds(); case links.Timeline.StepDate.SCALE.SECOND: return 0 == this.current.getSeconds(); case links.Timeline.StepDate.SCALE.MINUTE: return 0 == this.current.getHours() && 0 == this.current.getMinutes(); case links.Timeline.StepDate.SCALE.HOUR: return 0 == this.current.getHours(); case links.Timeline.StepDate.SCALE.WEEKDAY: case links.Timeline.StepDate.SCALE.DAY: return 1 == this.current.getDate(); case links.Timeline.StepDate.SCALE.MONTH: return 0 == this.current.getMonth(); case links.Timeline.StepDate.SCALE.YEAR: return !1; default: return !1 } }, links.Timeline.StepDate.prototype.getLabelMinor = function (a, b) { switch (void 0 == b && (b = this.current), this.scale) { case links.Timeline.StepDate.SCALE.MILLISECOND: return String(b.getMilliseconds()); case links.Timeline.StepDate.SCALE.SECOND: return String(b.getSeconds()); case links.Timeline.StepDate.SCALE.MINUTE: return this.addZeros(b.getHours(), 2) + ":" + this.addZeros(b.getMinutes(), 2); case links.Timeline.StepDate.SCALE.HOUR: return this.addZeros(b.getHours(), 2) + ":" + this.addZeros(b.getMinutes(), 2); case links.Timeline.StepDate.SCALE.WEEKDAY: return a.DAYS_SHORT[b.getDay()] + " " + b.getDate(); case links.Timeline.StepDate.SCALE.DAY: return String(b.getDate()); case links.Timeline.StepDate.SCALE.MONTH: return a.MONTHS_SHORT[b.getMonth()]; case links.Timeline.StepDate.SCALE.YEAR: return String(b.getFullYear()); default: return "" } }, links.Timeline.StepDate.prototype.getLabelMajor = function (a, b) { switch (void 0 == b && (b = this.current), this.scale) { case links.Timeline.StepDate.SCALE.MILLISECOND: return this.addZeros(b.getHours(), 2) + ":" + this.addZeros(b.getMinutes(), 2) + ":" + this.addZeros(b.getSeconds(), 2); case links.Timeline.StepDate.SCALE.SECOND: return b.getDate() + " " + a.MONTHS[b.getMonth()] + " " + this.addZeros(b.getHours(), 2) + ":" + this.addZeros(b.getMinutes(), 2); case links.Timeline.StepDate.SCALE.MINUTE: return a.DAYS[b.getDay()] + " " + b.getDate() + " " + a.MONTHS[b.getMonth()] + " " + b.getFullYear(); case links.Timeline.StepDate.SCALE.HOUR: return a.DAYS[b.getDay()] + " " + b.getDate() + " " + a.MONTHS[b.getMonth()] + " " + b.getFullYear(); case links.Timeline.StepDate.SCALE.WEEKDAY: case links.Timeline.StepDate.SCALE.DAY: return a.MONTHS[b.getMonth()] + " " + b.getFullYear(); case links.Timeline.StepDate.SCALE.MONTH: return String(b.getFullYear()); default: return "" } }, links.Timeline.StepDate.prototype.addZeros = function (a, b) { for (var c = "" + a; c.length < b;)c = "0" + c; return c }, links.imageloader = function () { function a(a) { if (1 == f[a]) return !0; var b = new Image; return b.src = a, !!b.complete } function b(a) { return void 0 != g[a] } function c(c, d, e) { if (void 0 == e && (e = !0), a(c)) return void (e && d(c)); if (!b(c) || e) { var h = g[c]; if (!h) { var i = new Image; i.src = c, h = [], g[c] = h, i.onload = function () { f[c] = !0, delete g[c]; for (var a = 0; a < h.length; a++)h[a](c) } } -1 == h.indexOf(d) && h.push(d) } } function d(b, d, e) { var f = []; if (b.forEach(function (b) { a(b) || f.push(b) }), f.length) { var g = f.length; f.forEach(function (a) { c(a, function () { g-- , 0 == g && d() }, e) }) } else e && d() } function e(a, b) { for (var c = a.firstChild; c;) { if ("IMG" == c.tagName) { var d = c.src; -1 == b.indexOf(d) && b.push(d) } e(c, b), c = c.nextSibling } } var f = {}, g = {}; return { isLoaded: a, isLoading: b, load: c, loadAll: d, filterImageUrls: e } }(), links.Timeline.addEventListener = function (a, b, c, d) { a.addEventListener ? (void 0 === d && (d = !1), "mousewheel" === b && navigator.userAgent.indexOf("Firefox") >= 0 && (b = "DOMMouseScroll"), a.addEventListener(b, c, d)) : a.attachEvent("on" + b, c) }, links.Timeline.removeEventListener = function (a, b, c, d) { a.removeEventListener ? (void 0 === d && (d = !1), "mousewheel" === b && navigator.userAgent.indexOf("Firefox") >= 0 && (b = "DOMMouseScroll"), a.removeEventListener(b, c, d)) : a.detachEvent("on" + b, c) }, links.Timeline.getTarget = function (a) { a || (a = window.event); var b; return a.target ? b = a.target : a.srcElement && (b = a.srcElement), void 0 != b.nodeType && 3 == b.nodeType && (b = b.parentNode), b }, links.Timeline.stopPropagation = function (a) { a || (a = window.event), a.stopPropagation ? a.stopPropagation() : a.cancelBubble = !0 }, links.Timeline.preventDefault = function (a) { a || (a = window.event), a.preventDefault ? a.preventDefault() : a.returnValue = !1 }, links.Timeline.getAbsoluteLeft = function (a) { for (var b = document.documentElement, c = document.body, d = a.offsetLeft, e = a.offsetParent; null != e && e != c && e != b;)d += e.offsetLeft, d -= e.scrollLeft, e = e.offsetParent; return d }, links.Timeline.getAbsoluteTop = function (a) { for (var b = document.documentElement, c = document.body, d = a.offsetTop, e = a.offsetParent; null != e && e != c && e != b;)d += e.offsetTop, d -= e.scrollTop, e = e.offsetParent; return d }, links.Timeline.getPageY = function (a) { if ("targetTouches" in a && a.targetTouches.length && (a = a.targetTouches[0]), "pageY" in a) return a.pageY; var b = a.clientY, c = document.documentElement, d = document.body; return b + (c && c.scrollTop || d && d.scrollTop || 0) - (c && c.clientTop || d && d.clientTop || 0) }, links.Timeline.getPageX = function (a) { if ("targetTouches" in a && a.targetTouches.length && (a = a.targetTouches[0]), "pageX" in a) return a.pageX; var b = a.clientX, c = document.documentElement, d = document.body; return b + (c && c.scrollLeft || d && d.scrollLeft || 0) - (c && c.clientLeft || d && d.clientLeft || 0) }, links.Timeline.addClassName = function (a, b) { for (var c = a.className.split(" "), d = b.split(" "), e = !1, f = 0; f < d.length; f++)-1 == c.indexOf(d[f]) && (c.push(d[f]), e = !0); e && (a.className = c.join(" ")) }, links.Timeline.removeClassName = function (a, b) { for (var c = a.className.split(" "), d = b.split(" "), e = !1, f = 0; f < d.length; f++) { var g = c.indexOf(d[f]); -1 != g && (c.splice(g, 1), e = !0) } e && (a.className = c.join(" ")) }, links.Timeline.isArray = function (a) { return a instanceof Array || "[object Array]" === Object.prototype.toString.call(a) }, links.Timeline.clone = function (a) { var b = {}; for (var c in a) a.hasOwnProperty(c) && (b[c] = a[c]); return b }, links.Timeline.parseJSONDate = function (a) { if (void 0 != a) { if (a instanceof Date) return a; var b = a.match(/\/Date\((-?\d+)([-\+]?\d{2})?(\d{2})?\)\//i); if (b) { var c = b[2] ? 36e5 * b[2] + 6e4 * b[3] * (b[2] / Math.abs(b[2])) : 0; return new Date(1 * b[1] + c) } return Date.parse(a) } }; !function (a) { var b = {}, c = {}; a.ajaxq = function (d, e) { function f(a) { if (b[d]) b[d].push(a); else { b[d] = []; var e = a(); c[d] = e } } function g() { if (b[d]) { var a = b[d].shift(); if (a) { var e = a(); c[d] = e } else delete b[d], delete c[d] } } if ("undefined" == typeof e) throw "AjaxQ: queue name is not provided"; var h = a.Deferred(), i = h.promise(); i.success = i.done, i.error = i.fail, i.complete = i.always; var j = "function" == typeof e, k = j ? null : a.extend(!0, {}, e); return f(function () { var b = a.ajax.apply(window, [j ? e() : k]); return b.done(function () { h.resolve.apply(this, arguments) }), b.fail(function () { h.reject.apply(this, arguments) }), b.always(g), b }), i }, a.each(["getq", "postq"], function (b, c) { a[c] = function (b, d, e, f, g) { return a.isFunction(e) && (g = g || f, f = e, e = void 0), a.ajaxq(b, { type: "postq" === c ? "post" : "get", url: d, data: e, success: f, dataType: g }) } }); var d = function (a) { return b.hasOwnProperty(a) && b[a].length > 0 }, e = function () { for (var a in b) if (d(a)) return !0; return !1 }; a.ajaxq.isRunning = function (a) { return a ? d(a) : e() }, a.ajaxq.getActiveRequest = function (a) { if (!a) throw "AjaxQ: queue name is required"; return c[a] }, a.ajaxq.abort = function (d) { if (!d) throw "AjaxQ: queue name is required"; var e = a.ajaxq.getActiveRequest(d); delete b[d], delete c[d], e && e.abort() }, a.ajaxq.clear = function (a) { if (a) b[a] && (b[a] = []); else for (var c in b) b.hasOwnProperty(c) && (b[c] = []) } }(jQuery); !function () {
    "use strict"; function a(a) { return a.valueOf() / A - .5 + B } function b(a) { return new Date((a + .5 - B) * A) } function c(b) { return a(b) - C } function d(a, b) { return x(t(a) * u(D) - v(b) * t(D), u(a)) } function e(a, b) { return w(t(b) * u(D) + u(b) * t(D) * t(a)) } function f(a, b, c) { return x(t(a), u(a) * t(b) - v(c) * u(b)) } function g(a, b, c) { return w(t(b) * t(c) + u(b) * u(c) * u(a)) } function h(a, b) { return z * (280.16 + 360.9856235 * a) - b } function i(a) { return z * (357.5291 + .98560028 * a) } function j(a) { var b = z * (1.9148 * t(a) + .02 * t(2 * a) + 3e-4 * t(3 * a)), c = 102.9372 * z; return a + b + c + s } function k(a) { var b = i(a), c = j(b); return { dec: e(c, 0), ra: d(c, 0) } } function l(a, b) { return Math.round(a - G - b / (2 * s)) } function m(a, b, c) { return G + (a + b) / (2 * s) + c } function n(a, b, c) { return C + a + .0053 * t(b) - .0069 * t(2 * c) } function o(a, b, c) { return y((t(a) - t(b) * t(c)) / (u(b) * u(c))) } function p(a, b, c, d, e, f, g) { var h = o(a, c, d), i = m(h, b, e); return n(i, f, g) } function q(a) { var b = z * (218.316 + 13.176396 * a), c = z * (134.963 + 13.064993 * a), f = z * (93.272 + 13.22935 * a), g = b + 6.289 * z * t(c), h = 5.128 * z * t(f), i = 385001 - 20905 * u(c); return { ra: d(g, h), dec: e(g, h), dist: i } } function r(a, b) { return new Date(a.valueOf() + b * A / 24) } var s = Math.PI, t = Math.sin, u = Math.cos, v = Math.tan, w = Math.asin, x = Math.atan2, y = Math.acos, z = s / 180, A = 864e5, B = 2440588, C = 2451545, D = 23.4397 * z, E = {}; E.getPosition = function (a, b, d) { var e = z * -d, i = z * b, j = c(a), l = k(j), m = h(j, e) - l.ra; return { azimuth: f(m, i, l.dec), altitude: g(m, i, l.dec) } }; var F = E.times = [[-.833, "sunrise", "sunset"], [-.3, "sunriseEnd", "sunsetStart"], [-6, "dawn", "dusk"], [-12, "nauticalDawn", "nauticalDusk"], [-18, "nightEnd", "night"], [6, "goldenHourEnd", "goldenHour"]]; E.addTime = function (a, b, c) { F.push([a, b, c]) }; var G = 9e-4; E.getTimes = function (a, d, f) { var g, h, k, o, q, r = z * -f, s = z * d, t = c(a), u = l(t, r), v = m(0, r, u), w = i(v), x = j(w), y = e(x, 0), A = n(v, w, x), B = { solarNoon: b(A), nadir: b(A - .5) }; for (g = 0, h = F.length; h > g; g += 1)k = F[g], o = p(k[0] * z, r, s, y, u, w, x), q = A - (o - A), B[k[1]] = b(q), B[k[2]] = b(o); return B }, E.getMoonPosition = function (a, b, d) { var e = z * -d, i = z * b, j = c(a), k = q(j), l = h(j, e) - k.ra, m = g(l, i, k.dec); return m += .017 * z / v(m + 10.26 * z / (m + 5.1 * z)), { azimuth: f(l, i, k.dec), altitude: m, distance: k.dist } }, E.getMoonIllumination = function (a) {
        var b = c(a), d = k(b), e = q(b), f = 149598e3, g = y(t(d.dec) * t(e.dec) + u(d.dec) * u(e.dec) * u(d.ra - e.ra)), h = x(f * t(g), e.dist - f * u(g)), i = x(u(d.dec) * t(d.ra - e.ra), t(d.dec) * u(e.dec) - u(d.dec) * t(e.dec) * u(d.ra - e.ra)); return {
            fraction: (1 + u(h)) / 2, phase: .5 + .5 * h * (0 > i ? -1 : 1) / Math.PI,
            angle: i
        }
    }, E.getMoonTimes = function (a, b, c) { var d = new Date(a); d.setHours(0), d.setMinutes(0), d.setSeconds(0), d.setMilliseconds(0); for (var e, f, g, h, i, j, k, l, m, n, o, p, q, s = .133 * z, t = E.getMoonPosition(d, b, c).altitude - s, u = 1; 24 >= u && (e = E.getMoonPosition(r(d, u), b, c).altitude - s, f = E.getMoonPosition(r(d, u + 1), b, c).altitude - s, i = (t + f) / 2 - e, j = (f - t) / 2, k = -j / (2 * i), l = (i * k + j) * k + e, m = j * j - 4 * i * e, n = 0, m >= 0 && (q = Math.sqrt(m) / (2 * Math.abs(i)), o = k - q, p = k + q, Math.abs(o) <= 1 && n++ , Math.abs(p) <= 1 && n++ , -1 > o && (o = p)), 1 === n ? 0 > t ? g = u + o : h = u + o : 2 === n && (g = u + (0 > l ? p : o), h = u + (0 > l ? o : p)), !g || !h); u += 2)t = f; var v = {}; return g && (v.rise = r(d, g)), h && (v.set = r(d, h)), g || h || (v[l > 0 ? "alwaysUp" : "alwaysDown"] = !0), v }, "function" == typeof define && define.amd ? define(E) : "undefined" != typeof module ? module.exports = E : window.SunCalc = E
}(), !function (a) { "use strict"; function b(a, b) { var c = (65535 & a) + (65535 & b), d = (a >> 16) + (b >> 16) + (c >> 16); return d << 16 | 65535 & c } function c(a, b) { return a << b | a >>> 32 - b } function d(a, d, e, f, g, h) { return b(c(b(b(d, a), b(f, h)), g), e) } function e(a, b, c, e, f, g, h) { return d(b & c | ~b & e, a, b, f, g, h) } function f(a, b, c, e, f, g, h) { return d(b & e | c & ~e, a, b, f, g, h) } function g(a, b, c, e, f, g, h) { return d(b ^ c ^ e, a, b, f, g, h) } function h(a, b, c, e, f, g, h) { return d(c ^ (b | ~e), a, b, f, g, h) } function i(a, c) { a[c >> 5] |= 128 << c % 32, a[(c + 64 >>> 9 << 4) + 14] = c; var d, i, j, k, l, m = 1732584193, n = -271733879, o = -1732584194, p = 271733878; for (d = 0; d < a.length; d += 16)i = m, j = n, k = o, l = p, m = e(m, n, o, p, a[d], 7, -680876936), p = e(p, m, n, o, a[d + 1], 12, -389564586), o = e(o, p, m, n, a[d + 2], 17, 606105819), n = e(n, o, p, m, a[d + 3], 22, -1044525330), m = e(m, n, o, p, a[d + 4], 7, -176418897), p = e(p, m, n, o, a[d + 5], 12, 1200080426), o = e(o, p, m, n, a[d + 6], 17, -1473231341), n = e(n, o, p, m, a[d + 7], 22, -45705983), m = e(m, n, o, p, a[d + 8], 7, 1770035416), p = e(p, m, n, o, a[d + 9], 12, -1958414417), o = e(o, p, m, n, a[d + 10], 17, -42063), n = e(n, o, p, m, a[d + 11], 22, -1990404162), m = e(m, n, o, p, a[d + 12], 7, 1804603682), p = e(p, m, n, o, a[d + 13], 12, -40341101), o = e(o, p, m, n, a[d + 14], 17, -1502002290), n = e(n, o, p, m, a[d + 15], 22, 1236535329), m = f(m, n, o, p, a[d + 1], 5, -165796510), p = f(p, m, n, o, a[d + 6], 9, -1069501632), o = f(o, p, m, n, a[d + 11], 14, 643717713), n = f(n, o, p, m, a[d], 20, -373897302), m = f(m, n, o, p, a[d + 5], 5, -701558691), p = f(p, m, n, o, a[d + 10], 9, 38016083), o = f(o, p, m, n, a[d + 15], 14, -660478335), n = f(n, o, p, m, a[d + 4], 20, -405537848), m = f(m, n, o, p, a[d + 9], 5, 568446438), p = f(p, m, n, o, a[d + 14], 9, -1019803690), o = f(o, p, m, n, a[d + 3], 14, -187363961), n = f(n, o, p, m, a[d + 8], 20, 1163531501), m = f(m, n, o, p, a[d + 13], 5, -1444681467), p = f(p, m, n, o, a[d + 2], 9, -51403784), o = f(o, p, m, n, a[d + 7], 14, 1735328473), n = f(n, o, p, m, a[d + 12], 20, -1926607734), m = g(m, n, o, p, a[d + 5], 4, -378558), p = g(p, m, n, o, a[d + 8], 11, -2022574463), o = g(o, p, m, n, a[d + 11], 16, 1839030562), n = g(n, o, p, m, a[d + 14], 23, -35309556), m = g(m, n, o, p, a[d + 1], 4, -1530992060), p = g(p, m, n, o, a[d + 4], 11, 1272893353), o = g(o, p, m, n, a[d + 7], 16, -155497632), n = g(n, o, p, m, a[d + 10], 23, -1094730640), m = g(m, n, o, p, a[d + 13], 4, 681279174), p = g(p, m, n, o, a[d], 11, -358537222), o = g(o, p, m, n, a[d + 3], 16, -722521979), n = g(n, o, p, m, a[d + 6], 23, 76029189), m = g(m, n, o, p, a[d + 9], 4, -640364487), p = g(p, m, n, o, a[d + 12], 11, -421815835), o = g(o, p, m, n, a[d + 15], 16, 530742520), n = g(n, o, p, m, a[d + 2], 23, -995338651), m = h(m, n, o, p, a[d], 6, -198630844), p = h(p, m, n, o, a[d + 7], 10, 1126891415), o = h(o, p, m, n, a[d + 14], 15, -1416354905), n = h(n, o, p, m, a[d + 5], 21, -57434055), m = h(m, n, o, p, a[d + 12], 6, 1700485571), p = h(p, m, n, o, a[d + 3], 10, -1894986606), o = h(o, p, m, n, a[d + 10], 15, -1051523), n = h(n, o, p, m, a[d + 1], 21, -2054922799), m = h(m, n, o, p, a[d + 8], 6, 1873313359), p = h(p, m, n, o, a[d + 15], 10, -30611744), o = h(o, p, m, n, a[d + 6], 15, -1560198380), n = h(n, o, p, m, a[d + 13], 21, 1309151649), m = h(m, n, o, p, a[d + 4], 6, -145523070), p = h(p, m, n, o, a[d + 11], 10, -1120210379), o = h(o, p, m, n, a[d + 2], 15, 718787259), n = h(n, o, p, m, a[d + 9], 21, -343485551), m = b(m, i), n = b(n, j), o = b(o, k), p = b(p, l); return [m, n, o, p] } function j(a) { var b, c = ""; for (b = 0; b < 32 * a.length; b += 8)c += String.fromCharCode(a[b >> 5] >>> b % 32 & 255); return c } function k(a) { var b, c = []; for (c[(a.length >> 2) - 1] = void 0, b = 0; b < c.length; b += 1)c[b] = 0; for (b = 0; b < 8 * a.length; b += 8)c[b >> 5] |= (255 & a.charCodeAt(b / 8)) << b % 32; return c } function l(a) { return j(i(k(a), 8 * a.length)) } function m(a, b) { var c, d, e = k(a), f = [], g = []; for (f[15] = g[15] = void 0, e.length > 16 && (e = i(e, 8 * a.length)), c = 0; 16 > c; c += 1)f[c] = 909522486 ^ e[c], g[c] = 1549556828 ^ e[c]; return d = i(f.concat(k(b)), 512 + 8 * b.length), j(i(g.concat(d), 640)) } function n(a) { var b, c, d = "0123456789abcdef", e = ""; for (c = 0; c < a.length; c += 1)b = a.charCodeAt(c), e += d.charAt(b >>> 4 & 15) + d.charAt(15 & b); return e } function o(a) { return unescape(encodeURIComponent(a)) } function p(a) { return l(o(a)) } function q(a) { return n(p(a)) } function r(a, b) { return m(o(a), o(b)) } function s(a, b) { return n(r(a, b)) } function t(a, b, c) { return b ? c ? r(b, a) : s(b, a) : c ? p(a) : q(a) } "function" == typeof define && define.amd ? define(function () { return t }) : a.md5 = t }(this), Array.prototype.remove = function (a, b) { var c = this.slice((b || a) + 1 || this.length); return this.length = 0 > a ? this.length + a : a, this.push.apply(this, c) }; var s = void 0, u = !1, sjcl = { cipher: {}, hash: {}, keyexchange: {}, mode: {}, misc: {}, codec: {}, exception: { corrupt: function (a) { this.toString = function () { return "CORRUPT: " + this.message }, this.message = a }, invalid: function (a) { this.toString = function () { return "INVALID: " + this.message }, this.message = a }, bug: function (a) { this.toString = function () { return "BUG: " + this.message }, this.message = a }, notReady: function (a) { this.toString = function () { return "NOT READY: " + this.message }, this.message = a } } }; "undefined" != typeof module && module.exports && (module.exports = sjcl), "function" == typeof define && define([], function () { return sjcl }), sjcl.cipher.aes = function (a) { this.l[0][0][0] || this.G(); var b, c, d, e, f = this.l[0][4], g = this.l[1]; b = a.length; var h = 1; for (4 !== b && 6 !== b && 8 !== b && q(new sjcl.exception.invalid("invalid aes key size")), this.b = [d = a.slice(0), e = []], a = b; a < 4 * b + 28; a++)c = d[a - 1], (0 === a % b || 8 === b && 4 === a % b) && (c = f[c >>> 24] << 24 ^ f[c >> 16 & 255] << 16 ^ f[c >> 8 & 255] << 8 ^ f[255 & c], 0 === a % b && (c = c << 8 ^ c >>> 24 ^ h << 24, h = h << 1 ^ 283 * (h >> 7))), d[a] = d[a - b] ^ c; for (b = 0; a; b++ , a--)c = d[3 & b ? a : a - 4], e[b] = 4 >= a || 4 > b ? c : g[0][f[c >>> 24]] ^ g[1][f[c >> 16 & 255]] ^ g[2][f[c >> 8 & 255]] ^ g[3][f[255 & c]] }, sjcl.cipher.aes.prototype = { encrypt: function (a) { return w(this, a, 0) }, decrypt: function (a) { return w(this, a, 1) }, l: [[[], [], [], [], []], [[], [], [], [], []]], G: function () { var a, b, c, d, e, f, g, h = this.l[0], i = this.l[1], j = h[4], k = i[4], l = [], m = []; for (a = 0; 256 > a; a++)m[(l[a] = a << 1 ^ 283 * (a >> 7)) ^ a] = a; for (b = c = 0; !j[b]; b ^= d || 1, c = m[c] || 1)for (f = c ^ c << 1 ^ c << 2 ^ c << 3 ^ c << 4, f = f >> 8 ^ 255 & f ^ 99, j[b] = f, k[f] = b, e = l[a = l[d = l[b]]], g = 16843009 * e ^ 65537 * a ^ 257 * d ^ 16843008 * b, e = 257 * l[f] ^ 16843008 * f, a = 0; 4 > a; a++)h[a][b] = e = e << 24 ^ e >>> 8, i[a][f] = g = g << 24 ^ g >>> 8; for (a = 0; 5 > a; a++)h[a] = h[a].slice(0), i[a] = i[a].slice(0) } }, sjcl.bitArray = { bitSlice: function (a, b, c) { return a = sjcl.bitArray.R(a.slice(b / 32), 32 - (31 & b)).slice(1), c === s ? a : sjcl.bitArray.clamp(a, c - b) }, extract: function (a, b, c) { var d = Math.floor(-b - c & 31); return ((b + c - 1 ^ b) & -32 ? a[b / 32 | 0] << 32 - d ^ a[b / 32 + 1 | 0] >>> d : a[b / 32 | 0] >>> d) & (1 << c) - 1 }, concat: function (a, b) { if (0 === a.length || 0 === b.length) return a.concat(b); var c = a[a.length - 1], d = sjcl.bitArray.getPartial(c); return 32 === d ? a.concat(b) : sjcl.bitArray.R(b, d, 0 | c, a.slice(0, a.length - 1)) }, bitLength: function (a) { var b = a.length; return 0 === b ? 0 : 32 * (b - 1) + sjcl.bitArray.getPartial(a[b - 1]) }, clamp: function (a, b) { if (32 * a.length < b) return a; a = a.slice(0, Math.ceil(b / 32)); var c = a.length; return b &= 31, 0 < c && b && (a[c - 1] = sjcl.bitArray.partial(b, a[c - 1] & 2147483648 >> b - 1, 1)), a }, partial: function (a, b, c) { return 32 === a ? b : (c ? 0 | b : b << 32 - a) + 1099511627776 * a }, getPartial: function (a) { return Math.round(a / 1099511627776) || 32 }, equal: function (a, b) { if (sjcl.bitArray.bitLength(a) !== sjcl.bitArray.bitLength(b)) return u; var c, d = 0; for (c = 0; c < a.length; c++)d |= a[c] ^ b[c]; return 0 === d }, R: function (a, b, c, d) { var e; for (e = 0, d === s && (d = []); 32 <= b; b -= 32)d.push(c), c = 0; if (0 === b) return d.concat(a); for (e = 0; e < a.length; e++)d.push(c | a[e] >>> b), c = a[e] << 32 - b; return e = a.length ? a[a.length - 1] : 0, a = sjcl.bitArray.getPartial(e), d.push(sjcl.bitArray.partial(b + a & 31, 32 < b + a ? c : d.pop(), 1)), d }, g: function (a, b) { return [a[0] ^ b[0], a[1] ^ b[1], a[2] ^ b[2], a[3] ^ b[3]] }, byteswapM: function (a) { var b, c; for (b = 0; b < a.length; ++b)c = a[b], a[b] = c >>> 24 | c >>> 8 & 65280 | (65280 & c) << 8 | c << 24; return a } }, sjcl.codec.utf8String = { fromBits: function (a) { var b, c, d = "", e = sjcl.bitArray.bitLength(a); for (b = 0; b < e / 8; b++)0 === (3 & b) && (c = a[b / 4]), d += String.fromCharCode(c >>> 24), c <<= 8; return decodeURIComponent(escape(d)) }, toBits: function (a) { a = unescape(encodeURIComponent(a)); var b, c = [], d = 0; for (b = 0; b < a.length; b++)d = d << 8 | a.charCodeAt(b), 3 === (3 & b) && (c.push(d), d = 0); return 3 & b && c.push(sjcl.bitArray.partial(8 * (3 & b), d)), c } }, sjcl.codec.hex = { fromBits: function (a) { var b, c = ""; for (b = 0; b < a.length; b++)c += ((0 | a[b]) + 0xf00000000000).toString(16).substr(4); return c.substr(0, sjcl.bitArray.bitLength(a) / 4) }, toBits: function (a) { var b, c, d = []; for (a = a.replace(/\s|0x/g, ""), c = a.length, a += "00000000", b = 0; b < a.length; b += 8)d.push(0 ^ parseInt(a.substr(b, 8), 16)); return sjcl.bitArray.clamp(d, 4 * c) } }, sjcl.codec.base32 = { p: "ABCDEFGHIJKLMNOPQRSTUVWXYZ234567", O: "0123456789ABCDEFGHIJKLMNOPQRSTUV", BITS: 32, BASE: 5, REMAINING: 27, fromBits: function (a, b, c) { var d = sjcl.codec.base32.BASE, e = sjcl.codec.base32.REMAINING, f = "", g = 0, h = sjcl.codec.base32.p, i = 0, j = sjcl.bitArray.bitLength(a); for (c && (h = sjcl.codec.base32.O), c = 0; f.length * d < j;)f += h.charAt((i ^ a[c] >>> g) >>> e), g < d ? (i = a[c] << d - g, g += e, c++) : (i <<= d, g -= d); for (; 7 & f.length && !b;)f += "="; return f }, toBits: function (a, b) { a = a.replace(/\s|=/g, "").toUpperCase(); var c, d, e = sjcl.codec.base32.BITS, f = sjcl.codec.base32.BASE, g = sjcl.codec.base32.REMAINING, h = [], i = 0, j = sjcl.codec.base32.p, k = 0, l = "base32"; for (b && (j = sjcl.codec.base32.O, l = "base32hex"), c = 0; c < a.length; c++) { if (d = j.indexOf(a.charAt(c)), 0 > d) { if (!b) try { return sjcl.codec.base32hex.toBits(a) } catch (a) { } q(new sjcl.exception.invalid("this isn't " + l + "!")) } i > g ? (i -= g, h.push(k ^ d >>> i), k = d << e - i) : (i += f, k ^= d << e - i) } return 56 & i && h.push(sjcl.bitArray.partial(56 & i, k, 1)), h } }, sjcl.codec.base32hex = { fromBits: function (a, b) { return sjcl.codec.base32.fromBits(a, b, 1) }, toBits: function (a) { return sjcl.codec.base32.toBits(a, 1) } }, sjcl.codec.base64 = { p: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/", fromBits: function (a, b, c) { var d = "", e = 0, f = sjcl.codec.base64.p, g = 0, h = sjcl.bitArray.bitLength(a); for (c && (f = f.substr(0, 62) + "-_"), c = 0; 6 * d.length < h;)d += f.charAt((g ^ a[c] >>> e) >>> 26), 6 > e ? (g = a[c] << 6 - e, e += 26, c++) : (g <<= 6, e -= 6); for (; 3 & d.length && !b;)d += "="; return d }, toBits: function (a, b) { a = a.replace(/\s|=/g, ""); var c, d, e = [], f = 0, g = sjcl.codec.base64.p, h = 0; for (b && (g = g.substr(0, 62) + "-_"), c = 0; c < a.length; c++)d = g.indexOf(a.charAt(c)), 0 > d && q(new sjcl.exception.invalid("this isn't base64!")), 26 < f ? (f -= 26, e.push(h ^ d >>> f), h = d << 32 - f) : (f += 6, h ^= d << 32 - f); return 56 & f && e.push(sjcl.bitArray.partial(56 & f, h, 1)), e } }, sjcl.codec.base64url = { fromBits: function (a) { return sjcl.codec.base64.fromBits(a, 1, 1) }, toBits: function (a) { return sjcl.codec.base64.toBits(a, 1) } }, sjcl.hash.sha256 = function (a) { this.b[0] || this.G(), a ? (this.s = a.s.slice(0), this.o = a.o.slice(0), this.i = a.i) : this.reset() }, sjcl.hash.sha256.hash = function (a) { return (new sjcl.hash.sha256).update(a).finalize() }, sjcl.hash.sha256.prototype = { blockSize: 512, reset: function () { return this.s = this.P.slice(0), this.o = [], this.i = 0, this }, update: function (a) { "string" == typeof a && (a = sjcl.codec.utf8String.toBits(a)); var b, c = this.o = sjcl.bitArray.concat(this.o, a); for (b = this.i, a = this.i = b + sjcl.bitArray.bitLength(a), b = 512 + b & -512; b <= a; b += 512)x(this, c.splice(0, 16)); return this }, finalize: function () { var a, b = this.o, c = this.s, b = sjcl.bitArray.concat(b, [sjcl.bitArray.partial(1, 1)]); for (a = b.length + 2; 15 & a; a++)b.push(0); for (b.push(Math.floor(this.i / 4294967296)), b.push(0 | this.i); b.length;)x(this, b.splice(0, 16)); return this.reset(), c }, P: [], b: [], G: function () { function a(a) { return 4294967296 * (a - Math.floor(a)) | 0 } var b, c = 0, d = 2; a: for (; 64 > c; d++) { for (b = 2; b * b <= d; b++)if (0 === d % b) continue a; 8 > c && (this.P[c] = a(Math.pow(d, .5))), this.b[c] = a(Math.pow(d, 1 / 3)), c++ } } }, sjcl.mode.ccm = { name: "ccm", t: [], listenProgress: function (a) { sjcl.mode.ccm.t.push(a) }, unListenProgress: function (a) { a = sjcl.mode.ccm.t.indexOf(a), -1 < a && sjcl.mode.ccm.t.splice(a, 1) }, X: function (a) { var b, c = sjcl.mode.ccm.t.slice(); for (b = 0; b < c.length; b += 1)c[b](a) }, encrypt: function (a, b, c, d, e) { var f, g = b.slice(0), h = sjcl.bitArray, i = h.bitLength(c) / 8, j = h.bitLength(g) / 8; for (e = e || 64, d = d || [], 7 > i && q(new sjcl.exception.invalid("ccm: iv must be at least 7 bytes")), f = 2; 4 > f && j >>> 8 * f; f++); return f < 15 - i && (f = 15 - i), c = h.clamp(c, 8 * (15 - f)), b = sjcl.mode.ccm.M(a, b, c, d, e, f), g = sjcl.mode.ccm.q(a, g, c, b, e, f), h.concat(g.data, g.tag) }, decrypt: function (a, b, c, d, e) { e = e || 64, d = d || []; var f = sjcl.bitArray, g = f.bitLength(c) / 8, h = f.bitLength(b), i = f.clamp(b, h - e), j = f.bitSlice(b, h - e), h = (h - e) / 8; for (7 > g && q(new sjcl.exception.invalid("ccm: iv must be at least 7 bytes")), b = 2; 4 > b && h >>> 8 * b; b++); return b < 15 - g && (b = 15 - g), c = f.clamp(c, 8 * (15 - b)), i = sjcl.mode.ccm.q(a, i, c, j, e, b), a = sjcl.mode.ccm.M(a, i.data, c, d, e, b), f.equal(i.tag, a) || q(new sjcl.exception.corrupt("ccm: tag doesn't match")), i.data }, ea: function (a, b, c, d, e, f) { var g = [], h = sjcl.bitArray, i = h.g; if (d = [h.partial(8, (b.length ? 64 : 0) | d - 2 << 2 | f - 1)], d = h.concat(d, c), d[3] |= e, d = a.encrypt(d), b.length) for (c = h.bitLength(b) / 8, 65279 >= c ? g = [h.partial(16, c)] : 4294967295 >= c && (g = h.concat([h.partial(16, 65534)], [c])), g = h.concat(g, b), b = 0; b < g.length; b += 4)d = a.encrypt(i(d, g.slice(b, b + 4).concat([0, 0, 0]))); return d }, M: function (a, b, c, d, e, f) { var g = sjcl.bitArray, h = g.g; for (e /= 8, (e % 2 || 4 > e || 16 < e) && q(new sjcl.exception.invalid("ccm: invalid tag length")), (4294967295 < d.length || 4294967295 < b.length) && q(new sjcl.exception.bug("ccm: can't deal with 4GiB or more data")), c = sjcl.mode.ccm.ea(a, d, c, e, g.bitLength(b) / 8, f), d = 0; d < b.length; d += 4)c = a.encrypt(h(c, b.slice(d, d + 4).concat([0, 0, 0]))); return g.clamp(c, 8 * e) }, q: function (a, b, c, d, e, f) { var g, h = sjcl.bitArray; g = h.g; var i = b.length, j = h.bitLength(b), k = i / 50, l = k; if (c = h.concat([h.partial(8, f - 1)], c).concat([0, 0, 0]).slice(0, 4), d = h.bitSlice(g(d, a.encrypt(c)), 0, e), !i) return { tag: d, data: [] }; for (g = 0; g < i; g += 4)g > k && (sjcl.mode.ccm.X(g / i), k += l), c[3]++ , e = a.encrypt(c), b[g] ^= e[0], b[g + 1] ^= e[1], b[g + 2] ^= e[2], b[g + 3] ^= e[3]; return { tag: d, data: h.clamp(b, j) } } }, sjcl.mode.ocb2 = { name: "ocb2", encrypt: function (a, b, c, d, e, f) { 128 !== sjcl.bitArray.bitLength(c) && q(new sjcl.exception.invalid("ocb iv must be 128 bits")); var g, h = sjcl.mode.ocb2.J, i = sjcl.bitArray, j = i.g, k = [0, 0, 0, 0]; c = h(a.encrypt(c)); var l, m = []; for (d = d || [], e = e || 64, g = 0; g + 4 < b.length; g += 4)l = b.slice(g, g + 4), k = j(k, l), m = m.concat(j(c, a.encrypt(j(c, l)))), c = h(c); return l = b.slice(g), b = i.bitLength(l), g = a.encrypt(j(c, [0, 0, 0, b])), l = i.clamp(j(l.concat([0, 0, 0]), g), b), k = j(k, j(l.concat([0, 0, 0]), g)), k = a.encrypt(j(k, j(c, h(c)))), d.length && (k = j(k, f ? d : sjcl.mode.ocb2.pmac(a, d))), m.concat(i.concat(l, i.clamp(k, e))) }, decrypt: function (a, b, c, d, e, f) { 128 !== sjcl.bitArray.bitLength(c) && q(new sjcl.exception.invalid("ocb iv must be 128 bits")), e = e || 64; var g, h, i = sjcl.mode.ocb2.J, j = sjcl.bitArray, k = j.g, l = [0, 0, 0, 0], m = i(a.encrypt(c)), n = sjcl.bitArray.bitLength(b) - e, o = []; for (d = d || [], c = 0; c + 4 < n / 32; c += 4)g = k(m, a.decrypt(k(m, b.slice(c, c + 4)))), l = k(l, g), o = o.concat(g), m = i(m); return h = n - 32 * c, g = a.encrypt(k(m, [0, 0, 0, h])), g = k(g, j.clamp(b.slice(c), h).concat([0, 0, 0])), l = k(l, g), l = a.encrypt(k(l, k(m, i(m)))), d.length && (l = k(l, f ? d : sjcl.mode.ocb2.pmac(a, d))), j.equal(j.clamp(l, e), j.bitSlice(b, n)) || q(new sjcl.exception.corrupt("ocb: tag doesn't match")), o.concat(j.clamp(g, h)) }, pmac: function (a, b) { var c, d = sjcl.mode.ocb2.J, e = sjcl.bitArray, f = e.g, g = [0, 0, 0, 0], h = a.encrypt([0, 0, 0, 0]), h = f(h, d(d(h))); for (c = 0; c + 4 < b.length; c += 4)h = d(h), g = f(g, a.encrypt(f(h, b.slice(c, c + 4)))); return c = b.slice(c), 128 > e.bitLength(c) && (h = f(h, d(h)), c = e.concat(c, [-2147483648, 0, 0, 0])), g = f(g, c), a.encrypt(f(d(f(h, d(h))), g)) }, J: function (a) { return [a[0] << 1 ^ a[1] >>> 31, a[1] << 1 ^ a[2] >>> 31, a[2] << 1 ^ a[3] >>> 31, a[3] << 1 ^ 135 * (a[0] >>> 31)] } }, sjcl.mode.gcm = { name: "gcm", encrypt: function (a, b, c, d, e) { var f = b.slice(0); return b = sjcl.bitArray, d = d || [], a = sjcl.mode.gcm.q(!0, a, f, d, c, e || 128), b.concat(a.data, a.tag) }, decrypt: function (a, b, c, d, e) { var f = b.slice(0), g = sjcl.bitArray, h = g.bitLength(f); return e = e || 128, d = d || [], e <= h ? (b = g.bitSlice(f, h - e), f = g.bitSlice(f, 0, h - e)) : (b = f, f = []), a = sjcl.mode.gcm.q(u, a, f, d, c, e), g.equal(a.tag, b) || q(new sjcl.exception.corrupt("gcm: tag doesn't match")), a.data }, ba: function (a, b) { var c, d, e, f, g, h = sjcl.bitArray.g; for (e = [0, 0, 0, 0], f = b.slice(0), c = 0; 128 > c; c++) { for ((d = 0 !== (a[Math.floor(c / 32)] & 1 << 31 - c % 32)) && (e = h(e, f)), g = 0 !== (1 & f[3]), d = 3; 0 < d; d--)f[d] = f[d] >>> 1 | (1 & f[d - 1]) << 31; f[0] >>>= 1, g && (f[0] ^= -520093696) } return e }, h: function (a, b, c) { var d, e = c.length; for (b = b.slice(0), d = 0; d < e; d += 4)b[0] ^= 4294967295 & c[d], b[1] ^= 4294967295 & c[d + 1], b[2] ^= 4294967295 & c[d + 2], b[3] ^= 4294967295 & c[d + 3], b = sjcl.mode.gcm.ba(b, a); return b }, q: function (a, b, c, d, e, f) { var g, h, i, j, k, l, m, n, o = sjcl.bitArray; for (l = c.length, m = o.bitLength(c), n = o.bitLength(d), h = o.bitLength(e), g = b.encrypt([0, 0, 0, 0]), 96 === h ? (e = e.slice(0), e = o.concat(e, [1])) : (e = sjcl.mode.gcm.h(g, [0, 0, 0, 0], e), e = sjcl.mode.gcm.h(g, e, [0, 0, Math.floor(h / 4294967296), 4294967295 & h])), h = sjcl.mode.gcm.h(g, [0, 0, 0, 0], d), k = e.slice(0), d = h.slice(0), a || (d = sjcl.mode.gcm.h(g, h, c)), j = 0; j < l; j += 4)k[3]++ , i = b.encrypt(k), c[j] ^= i[0], c[j + 1] ^= i[1], c[j + 2] ^= i[2], c[j + 3] ^= i[3]; return c = o.clamp(c, m), a && (d = sjcl.mode.gcm.h(g, h, c)), a = [Math.floor(n / 4294967296), 4294967295 & n, Math.floor(m / 4294967296), 4294967295 & m], d = sjcl.mode.gcm.h(g, d, a), i = b.encrypt(e), d[0] ^= i[0], d[1] ^= i[1], d[2] ^= i[2], d[3] ^= i[3], { tag: o.bitSlice(d, 0, f), data: c } } }, sjcl.misc.hmac = function (a, b) { this.N = b = b || sjcl.hash.sha256; var c, d = [[], []], e = b.prototype.blockSize / 32; for (this.n = [new b, new b], a.length > e && (a = b.hash(a)), c = 0; c < e; c++)d[0][c] = 909522486 ^ a[c], d[1][c] = 1549556828 ^ a[c]; this.n[0].update(d[0]), this.n[1].update(d[1]), this.I = new b(this.n[0]) }, sjcl.misc.hmac.prototype.encrypt = sjcl.misc.hmac.prototype.mac = function (a) { return this.S && q(new sjcl.exception.invalid("encrypt on already updated hmac called!")), this.update(a), this.digest(a) }, sjcl.misc.hmac.prototype.reset = function () { this.I = new this.N(this.n[0]), this.S = u }, sjcl.misc.hmac.prototype.update = function (a) { this.S = !0, this.I.update(a) }, sjcl.misc.hmac.prototype.digest = function () { var a = this.I.finalize(), a = new this.N(this.n[1]).update(a).finalize(); return this.reset(), a }, sjcl.misc.pbkdf2 = function (a, b, c, d, e) { c = c || 1e3, (0 > d || 0 > c) && q(sjcl.exception.invalid("invalid params to pbkdf2")), "string" == typeof a && (a = sjcl.codec.utf8String.toBits(a)), "string" == typeof b && (b = sjcl.codec.utf8String.toBits(b)), e = e || sjcl.misc.hmac, a = new e(a); var f, g, h, i, j = [], k = sjcl.bitArray; for (i = 1; 32 * j.length < (d || 1); i++) { for (e = f = a.encrypt(k.concat(b, [i])), g = 1; g < c; g++)for (f = a.encrypt(f), h = 0; h < f.length; h++)e[h] ^= f[h]; j = j.concat(e) } return d && (j = k.clamp(j, d)), j }, sjcl.prng = function (a) { this.c = [new sjcl.hash.sha256], this.j = [0], this.H = 0, this.u = {}, this.F = 0, this.L = {}, this.Q = this.d = this.k = this.Z = 0, this.b = [0, 0, 0, 0, 0, 0, 0, 0], this.f = [0, 0, 0, 0], this.C = s, this.D = a, this.r = u, this.B = { progress: {}, seeded: {} }, this.m = this.Y = 0, this.w = 1, this.A = 2, this.U = 65536, this.K = [0, 48, 64, 96, 128, 192, 256, 384, 512, 768, 1024], this.V = 3e4, this.T = 80 }, sjcl.prng.prototype = { randomWords: function (a, b) { var c, d = []; c = this.isReady(b); var e; if (c === this.m && q(new sjcl.exception.notReady("generator isn't seeded")), c & this.A) { c = !(c & this.w), e = []; var f, g = 0; for (this.Q = e[0] = (new Date).valueOf() + this.V, f = 0; 16 > f; f++)e.push(4294967296 * Math.random() | 0); for (f = 0; f < this.c.length && (e = e.concat(this.c[f].finalize()), g += this.j[f], this.j[f] = 0, !(!c && this.H & 1 << f)); f++); for (this.H >= 1 << this.c.length && (this.c.push(new sjcl.hash.sha256), this.j.push(0)), this.d -= g, g > this.k && (this.k = g), this.H++ , this.b = sjcl.hash.sha256.hash(this.b.concat(e)), this.C = new sjcl.cipher.aes(this.b), c = 0; 4 > c && (this.f[c] = this.f[c] + 1 | 0, !this.f[c]); c++); } for (c = 0; c < a; c += 4)0 === (c + 1) % this.U && A(this), e = B(this), d.push(e[0], e[1], e[2], e[3]); return A(this), d.slice(0, a) }, setDefaultParanoia: function (a, b) { 0 === a && "Setting paranoia=0 will ruin your security; use it only for testing" !== b && q("Setting paranoia=0 will ruin your security; use it only for testing"), this.D = a }, addEntropy: function (a, b, c) { c = c || "user"; var d, e, f = (new Date).valueOf(), g = this.u[c], h = this.isReady(), i = 0; switch (d = this.L[c], d === s && (d = this.L[c] = this.Z++), g === s && (g = this.u[c] = 0), this.u[c] = (this.u[c] + 1) % this.c.length, typeof a) { case "number": b === s && (b = 1), this.c[g].update([d, this.F++, 1, b, f, 1, 0 | a]); break; case "object": if (c = Object.prototype.toString.call(a), "[object Uint32Array]" === c) { for (e = [], c = 0; c < a.length; c++)e.push(a[c]); a = e } else for ("[object Array]" !== c && (i = 1), c = 0; c < a.length && !i; c++)"number" != typeof a[c] && (i = 1); if (!i) { if (b === s) for (c = b = 0; c < a.length; c++)for (e = a[c]; 0 < e;)b++ , e >>>= 1; this.c[g].update([d, this.F++, 2, b, f, a.length].concat(a)) } break; case "string": b === s && (b = a.length), this.c[g].update([d, this.F++, 3, b, f, a.length]), this.c[g].update(a); break; default: i = 1 }i && q(new sjcl.exception.bug("random: addEntropy only supports number, array of numbers or string")), this.j[g] += b, this.d += b, h === this.m && (this.isReady() !== this.m && C("seeded", Math.max(this.k, this.d)), C("progress", this.getProgress())) }, isReady: function (a) { return a = this.K[a !== s ? a : this.D], this.k && this.k >= a ? this.j[0] > this.T && (new Date).valueOf() > this.Q ? this.A | this.w : this.w : this.d >= a ? this.A | this.m : this.m }, getProgress: function (a) { return a = this.K[a ? a : this.D], this.k >= a ? 1 : this.d > a ? 1 : this.d / a }, startCollectors: function () { this.r || (this.a = { loadTimeCollector: D(this, this.da), mouseCollector: D(this, this.fa), keyboardCollector: D(this, this.ca), accelerometerCollector: D(this, this.W), touchCollector: D(this, this.ha) }, window.addEventListener ? (window.addEventListener("load", this.a.loadTimeCollector, u), window.addEventListener("mousemove", this.a.mouseCollector, u), window.addEventListener("keypress", this.a.keyboardCollector, u), window.addEventListener("devicemotion", this.a.accelerometerCollector, u), window.addEventListener("touchmove", this.a.touchCollector, u)) : document.attachEvent ? (document.attachEvent("onload", this.a.loadTimeCollector), document.attachEvent("onmousemove", this.a.mouseCollector), document.attachEvent("keypress", this.a.keyboardCollector)) : q(new sjcl.exception.bug("can't attach event")), this.r = !0) }, stopCollectors: function () { this.r && (window.removeEventListener ? (window.removeEventListener("load", this.a.loadTimeCollector, u), window.removeEventListener("mousemove", this.a.mouseCollector, u), window.removeEventListener("keypress", this.a.keyboardCollector, u), window.removeEventListener("devicemotion", this.a.accelerometerCollector, u), window.removeEventListener("touchmove", this.a.touchCollector, u)) : document.detachEvent && (document.detachEvent("onload", this.a.loadTimeCollector), document.detachEvent("onmousemove", this.a.mouseCollector), document.detachEvent("keypress", this.a.keyboardCollector)), this.r = u) }, addEventListener: function (a, b) { this.B[a][this.Y++] = b }, removeEventListener: function (a, b) { var c, d, e = this.B[a], f = []; for (d in e) e.hasOwnProperty(d) && e[d] === b && f.push(d); for (c = 0; c < f.length; c++)d = f[c], delete e[d] }, ca: function () { E(1) }, fa: function (a) { var b, c; try { b = a.x || a.clientX || a.offsetX || 0, c = a.y || a.clientY || a.offsetY || 0 } catch (a) { c = b = 0 } 0 != b && 0 != c && sjcl.random.addEntropy([b, c], 2, "mouse"), E(0) }, ha: function (a) { a = a.touches[0] || a.changedTouches[0], sjcl.random.addEntropy([a.pageX || a.clientX, a.pageY || a.clientY], 1, "touch"), E(0) }, da: function () { E(2) }, W: function (a) { if (a = a.accelerationIncludingGravity.x || a.accelerationIncludingGravity.y || a.accelerationIncludingGravity.z, window.orientation) { var b = window.orientation; "number" == typeof b && sjcl.random.addEntropy(b, 1, "accelerometer") } a && sjcl.random.addEntropy(a, 2, "accelerometer"), E(0) } }, sjcl.random = new sjcl.prng(6); a: try { var F, G, H, I; if (I = "undefined" != typeof module) { var J; if (J = module.exports) { var K; try { K = require("crypto") } catch (a) { K = null } J = (G = K) && G.randomBytes } I = J } if (I) F = G.randomBytes(128), F = new Uint32Array(new Uint8Array(F).buffer), sjcl.random.addEntropy(F, 1024, "crypto['randomBytes']"); else if ("undefined" != typeof window && "undefined" != typeof Uint32Array) { if (H = new Uint32Array(32), window.crypto && window.crypto.getRandomValues) window.crypto.getRandomValues(H); else { if (!window.msCrypto || !window.msCrypto.getRandomValues) break a; window.msCrypto.getRandomValues(H) } sjcl.random.addEntropy(H, 1024, "crypto['getRandomValues']") } } catch (a) { "undefined" != typeof window && window.console && (console.log("There was an error collecting entropy from the browser:"), console.log(a)) } sjcl.json = { defaults: { v: 1, iter: 1e3, ks: 128, ts: 64, mode: "ccm", adata: "", cipher: "aes" }, aa: function (a, b, c, d) { c = c || {}, d = d || {}; var e, f = sjcl.json, g = f.e({ iv: sjcl.random.randomWords(4, 0) }, f.defaults); return f.e(g, c), c = g.adata, "string" == typeof g.salt && (g.salt = sjcl.codec.base64.toBits(g.salt)), "string" == typeof g.iv && (g.iv = sjcl.codec.base64.toBits(g.iv)), (!sjcl.mode[g.mode] || !sjcl.cipher[g.cipher] || "string" == typeof a && 100 >= g.iter || 64 !== g.ts && 96 !== g.ts && 128 !== g.ts || 128 !== g.ks && 192 !== g.ks && 256 !== g.ks || 2 > g.iv.length || 4 < g.iv.length) && q(new sjcl.exception.invalid("json encrypt: invalid parameters")), "string" == typeof a ? (e = sjcl.misc.cachedPbkdf2(a, g), a = e.key.slice(0, g.ks / 32), g.salt = e.salt) : sjcl.ecc && a instanceof sjcl.ecc.elGamal.publicKey && (e = a.kem(), g.kemtag = e.tag, a = e.key.slice(0, g.ks / 32)), "string" == typeof b && (b = sjcl.codec.utf8String.toBits(b)), "string" == typeof c && (g.adata = c = sjcl.codec.utf8String.toBits(c)), e = new sjcl.cipher[g.cipher](a), f.e(d, g), d.key = a, g.ct = "ccm" === g.mode && sjcl.arrayBuffer && sjcl.arrayBuffer.ccm && b instanceof ArrayBuffer ? sjcl.arrayBuffer.ccm.encrypt(e, b, g.iv, c, g.ts) : sjcl.mode[g.mode].encrypt(e, b, g.iv, c, g.ts), g }, encrypt: function (a, b, c, d) { var e = sjcl.json, f = e.aa.apply(e, arguments); return e.encode(f) }, $: function (a, b, c, d) { c = c || {}, d = d || {}; var e = sjcl.json; b = e.e(e.e(e.e({}, e.defaults), b), c, !0); var f, g; return f = b.adata, "string" == typeof b.salt && (b.salt = sjcl.codec.base64.toBits(b.salt)), "string" == typeof b.iv && (b.iv = sjcl.codec.base64.toBits(b.iv)), (!sjcl.mode[b.mode] || !sjcl.cipher[b.cipher] || "string" == typeof a && 100 >= b.iter || 64 !== b.ts && 96 !== b.ts && 128 !== b.ts || 128 !== b.ks && 192 !== b.ks && 256 !== b.ks || !b.iv || 2 > b.iv.length || 4 < b.iv.length) && q(new sjcl.exception.invalid("json decrypt: invalid parameters")), "string" == typeof a ? (g = sjcl.misc.cachedPbkdf2(a, b), a = g.key.slice(0, b.ks / 32), b.salt = g.salt) : sjcl.ecc && a instanceof sjcl.ecc.elGamal.secretKey && (a = a.unkem(sjcl.codec.base64.toBits(b.kemtag)).slice(0, b.ks / 32)), "string" == typeof f && (f = sjcl.codec.utf8String.toBits(f)), g = new sjcl.cipher[b.cipher](a), f = "ccm" === b.mode && sjcl.arrayBuffer && sjcl.arrayBuffer.ccm && b.ct instanceof ArrayBuffer ? sjcl.arrayBuffer.ccm.decrypt(g, b.ct, b.iv, b.tag, f, b.ts) : sjcl.mode[b.mode].decrypt(g, b.ct, b.iv, f, b.ts), e.e(d, b), d.key = a, 1 === c.raw ? f : sjcl.codec.utf8String.fromBits(f) }, decrypt: function (a, b, c, d) { var e = sjcl.json; return e.$(a, e.decode(b), c, d) }, encode: function (a) { var b, c = "{", d = ""; for (b in a) if (a.hasOwnProperty(b)) switch (b.match(/^[a-z0-9]+$/i) || q(new sjcl.exception.invalid("json encode: invalid property name")), c += d + '"' + b + '":', d = ",", typeof a[b]) { case "number": case "boolean": c += a[b]; break; case "string": c += '"' + escape(a[b]) + '"'; break; case "object": c += '"' + sjcl.codec.base64.fromBits(a[b], 0) + '"'; break; default: q(new sjcl.exception.bug("json encode: unsupported type")) }return c + "}" }, decode: function (a) { a = a.replace(/\s/g, ""), a.match(/^\{.*\}$/) || q(new sjcl.exception.invalid("json decode: this isn't json!")), a = a.replace(/^\{|\}$/g, "").split(/,/); var b, c, d = {}; for (b = 0; b < a.length; b++)(c = a[b].match(/^\s*(?:(["']?)([a-z][a-z0-9]*)\1)\s*:\s*(?:(-?\d+)|"([a-z0-9+\/%*_.@=\-]*)"|(true|false))$/i)) || q(new sjcl.exception.invalid("json decode: this isn't json!")), null != c[3] ? d[c[2]] = parseInt(c[3], 10) : null != c[4] ? d[c[2]] = c[2].match(/^(ct|adata|salt|iv)$/) ? sjcl.codec.base64.toBits(c[4]) : unescape(c[4]) : null != c[5] && (d[c[2]] = "true" === c[5]); return d }, e: function (a, b, c) { if (a === s && (a = {}), b === s) return a; for (var d in b) b.hasOwnProperty(d) && (c && a[d] !== s && a[d] !== b[d] && q(new sjcl.exception.invalid("required parameter overridden")), a[d] = b[d]); return a }, ja: function (a, b) { var c, d = {}; for (c in a) a.hasOwnProperty(c) && a[c] !== b[c] && (d[c] = a[c]); return d }, ia: function (a, b) { var c, d = {}; for (c = 0; c < b.length; c++)a[b[c]] !== s && (d[b[c]] = a[b[c]]); return d } }, sjcl.encrypt = sjcl.json.encrypt, sjcl.decrypt = sjcl.json.decrypt, sjcl.misc.ga = {}, sjcl.misc.cachedPbkdf2 = function (a, b) { var c, d = sjcl.misc.ga; return b = b || {}, c = b.iter || 1e3, d = d[a] = d[a] || {}, c = d[c] = d[c] || { firstSalt: b.salt && b.salt.length ? b.salt.slice(0) : sjcl.random.randomWords(2, 0) }, d = b.salt === s ? c.firstSalt : b.salt, c[d] = c[d] || sjcl.misc.pbkdf2(a, d, b.iter), { key: c[d].slice(0), salt: d.slice(0) } };